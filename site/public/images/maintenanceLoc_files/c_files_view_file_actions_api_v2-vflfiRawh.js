!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="6a56c74e-a178-3414-a4f9-af5de4da980b")}catch(e){}}();
define(["exports","./e_file_viewer_static_scl_page_folder","./c_src_sink_index"],(function(r,e,t){"use strict";const o=1e3,a=r=>({isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error",jobId:r}),i=(r,o)=>{var a,i;const n=JSON.stringify(null!==(i=null===(a=e.filterApiError(o))||void 0===a?void 0:a.error)&&void 0!==i?i:o);t.getMetricsReporter().createStats({ns:"web_browse",name:"file_actions/errors"},{error:n}).record(1)};function n(r){return Boolean("fq_path"in r?r:null)}function s(r){return n(r)?e.filename(r.fq_path):r.name}async function l(r,t,o,a){const i=e.parent_dir(r),n=e.normalize(i)+"/"+t,s=new e.DefaultUserApiV2Client(o),{checkFSWs:l}=a;try{const t=await e.GetFilesRoutes(s).rpc("move_v2",{from_path:r,to_path:n,autorename:!0,allow_ownership_transfer:!1,fsw_request:l?{".tag":"check"}:void 0},{});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(r){return f(r)}}const c=(r,t,o,a)=>()=>e.GetFilesRoutes(r).rpc("move_batch_v2",{entries:t,autorename:!0,allow_ownership_transfer:!!o,fsw_request:a?{".tag":"check"}:void 0},{}),u=r=>t=>e.GetFilesRoutes(r).rpc("move_batch/check_v2",{async_job_id:t},{});async function _(r,t){var n;try{const e=await r();if("complete"===e[".tag"])return g("relocation_batch",e),{isError:!1,result:e};{let r;do{await new Promise((r=>setTimeout(r,o))),r=await t(e.async_job_id)}while(r&&"in_progress"===r[".tag"]);if("complete"===r[".tag"]){const t=r;for(const r of t.entries){const t=d(r,e.async_job_id);if(t)return t}return g("relocation_batch",t),{isError:!1,result:t,jobId:e.async_job_id}}return i("relocation_batch_poll",{...r,...e}),a(e.async_job_id)}}catch(r){i("relocation_batch_poll",r);const t=e.filterApiError(r);return(null===(n=null==t?void 0:t.error)||void 0===n?void 0:n[".tag"])?{isError:!0,error:null==t?void 0:t.error,error_summary:null==t?void 0:t.error[".tag"]}:function(r){var t;const o=e.filterApiError(r);if(400===(null===(t=null==o?void 0:o.raw)||void 0===t?void 0:t.status))return{isError:!0,error:o.error,error_summary:"client_error"};return a()}(r)}}function d(r,e){return"failure"===r[".tag"]&&"relocation_error"===r.failure[".tag"]&&"to"===r.failure.relocation_error[".tag"]&&"file_system_warnings"===r.failure.relocation_error.to[".tag"]?{isError:!0,error:r.failure.relocation_error,error_summary:"file_system_warnings",jobId:e}:"failure"===r[".tag"]&&"relocation_error"===r.failure[".tag"]&&"internal_error"===r.failure.relocation_error[".tag"]?{isError:!0,error:r.failure.relocation_error,error_summary:"internal_error",jobId:e}:void 0}function f(r){var t;const o=e.filterApiError(r);if(null===(t=null==o?void 0:o.error)||void 0===t?void 0:t[".tag"]){const r={".tag":"failure",failure:{".tag":"relocation_error",relocation_error:o.error}},e=d(r,void 0);return void 0!==e?e:{isError:!1,result:{changeset_data:[],entries:[r]}}}return a()}async function h(r,t,n){var s;const l=new e.DefaultUserApiV2Client(t),c=r=>"file_id"in r?r.file_id:r.fq_path;if(1===r.length&&!r[0].is_dir)try{const t=await e.GetFilesRoutes(l).rpc("delete_v2",{path:c(r[0]),fsw_request:n?{".tag":"check"}:void 0},{});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",metadata:t.metadata}]}}}catch(r){const t=e.filterApiError(r);return(!t||t.error&&!F(t.error))&&i("delete_v2",r),(null===(s=null==t?void 0:t.error)||void 0===s?void 0:s[".tag"])?{isError:!1,result:{changeset_data:[],entries:[{".tag":"failure",failure:null==t?void 0:t.error}]}}:a()}return await async function(r,t){var n;try{const e=await r();if("complete"===e[".tag"])return g("delete_batch",e),{isError:!1,result:e};if("other"===e[".tag"])return i("delete_batch",e),a();{let r;do{await new Promise((r=>setTimeout(r,o))),r=await t(e.async_job_id)}while(r&&"in_progress"===r[".tag"]);return"complete"===r[".tag"]?(g("delete_batch",r),{isError:!1,result:r,jobId:e.async_job_id}):(i("delete_batch_poll",r),a(e.async_job_id))}}catch(r){i("delete_batch",r);const t=e.filterApiError(r);return(null===(n=null==t?void 0:t.error)||void 0===n?void 0:n[".tag"])?{isError:!0,error:t.error,error_summary:t.error[".tag"]}:function(r){var e;if(400===(null===(e=null==r?void 0:r.raw)||void 0===e?void 0:e.status))return{isError:!0,error:r.error,error_summary:"client_error"};return a()}(t)}}((()=>e.GetFilesRoutes(l).rpc("delete_batch",{entries:r.map((r=>({path:c(r)}))),fsw_request:n?{".tag":"check"}:void 0},{})),(r=>e.GetFilesRoutes(l).rpc("delete_batch/check",{async_job_id:r},{})))}async function p(r,t){const o=new e.DefaultUserApiV2Client(t);return e.GetFilesRoutes(o).rpc("team_folder/delete",{team_folder_id:r},{})}const m=(r,t,o,a,i)=>e.GetFilesRoutes(r).rpc("team_folder/move",{autorename:a,from_path:t,to_path:o,fsw_request:i?"check":void 0},{}),v=(r,t)=>e.GetFilesRoutes(r).rpc("team_folder/move/check",{async_job_id:t},{}),g=(r,e)=>{e.entries.forEach((e=>{".tag"in e&&"failure"===e[".tag"]&&i(r,e.failure)}))};async function w(r,t,o,n){var s,l;const c=new e.DefaultUserApiV2Client(o);try{return{isError:!1,result:await e.GetFilesRoutes(c).rpc("create_folder_v2",{path:e.normalize(r)+"/"+t,autorename:!0,fsw_request:n?{".tag":"check"}:void 0},{})}}catch(r){i("create_folder",r);const t=e.filterApiError(r);return(null===(s=null==t?void 0:t.error)||void 0===s?void 0:s[".tag"])?{isError:!0,error:null==t?void 0:t.error,error_summary:null!==(l=null==t?void 0:t.summary)&&void 0!==l?l:"unknown"}:a()}}const y=r=>"failure"===r[".tag"],F=r=>"path_lookup"===r[".tag"];var b=Object.freeze({__proto__:null,EXCLOG_TAG:"file_actions_client_error",convertSingleErrorResultToBatch:f,copyFiles:async function(r,t,o,a={}){var i;const n=new e.DefaultUserApiV2Client(o),{checkFSWs:s}=a;if(1===r.length&&!r[0].is_dir)try{const o=await e.GetFilesRoutes(n).rpc("copy_v2",{from_path:null!==(i=r[0].file_id)&&void 0!==i?i:r[0].fq_path,to_path:`${t}/${e.filename(r[0].fq_path)}`,autorename:!0,fsw_request:s?{".tag":"check"}:void 0},{});return{isError:!1,result:{changeset_data:o.changeset_data,entries:[{".tag":"success",success:o.metadata}]}}}catch(r){return f(r)}return await _((()=>e.GetFilesRoutes(n).rpc("copy_batch_v2",{entries:r.map((r=>{var o;return{from_path:null!==(o=r.file_id)&&void 0!==o?o:r.fq_path,to_path:`${t}/${e.filename(r.fq_path)}`}})),autorename:!0,fsw_request:s?{".tag":"check"}:void 0},{})),(r=>e.GetFilesRoutes(n).rpc("copy_batch/check_v2",{async_job_id:r},{})))},createFolder:w,createUndefinedRpcResult:a,deleteFiles:h,deleteTeamFolder:p,doNotBackupFiles:async function(r,t){var o,i;const n=new e.DefaultUserApiV2Client(t);try{return await function(r){return r.ns("device_sync")}(n).rpc("do_not_backup",{entries:r.map((r=>{return"file_id"in(e=r)?e.file_id:e.fq_path;var e}))},{}),{isError:!1,result:!0}}catch(r){const t=e.filterApiError(r);return(null===(o=null==t?void 0:t.error)||void 0===o?void 0:o[".tag"])?{isError:!0,error:t.error,error_summary:null!==(i=t.summary)&&void 0!==i?i:"unknown"}:a()}},fileInfoIsFqPathBased:n,getFilenameFromActionInfo:s,isFailure:y,isPathLookupFailure:F,moveAndRenameContent:async function(r,t,o,a,i={}){const s=new e.DefaultUserApiV2Client(a),{allowOwnershipTransfer:l,checkFSWs:d}=i,h=r=>{const e=`${t}/${o}`;return n(r)?{from_path:r.fq_path,to_path:e}:{from_path:r.id,to_path:e}};if(n(r)&&!r.is_dir)try{const t=await e.GetFilesRoutes(s).rpc("move_v2",{...h(r),allow_ownership_transfer:!!l,fsw_request:d?{".tag":"check"}:void 0},{});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(r){return f(r)}const p=c(s,[h(r)],l,d),m=u(s);return await _(p,m)},moveFiles:async function(r,t,o,a={}){const i=new e.DefaultUserApiV2Client(o),{allowOwnershipTransfer:l,checkFSWs:d}=a,h=r=>{const e=`${t}/${s(r)}`;return n(r)?{from_path:r.fq_path,to_path:e}:{from_path:r.id,to_path:e}};if(1===r.length&&n(r[0])&&!r[0].is_dir)try{const t=await e.GetFilesRoutes(i).rpc("move_v2",{...h(r[0]),allow_ownership_transfer:!!l,fsw_request:d?{".tag":"check"}:void 0},{});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(r){return f(r)}const p=c(i,r.map(h),l,d),m=u(i);return await _(p,m)},moveTeamFolder:async function(r,t,a,i,n){const s=new e.DefaultUserApiV2Client(i),l=await m(s,r,t,a,n);if(!l.async_job_id||l.file_system_warnings)return l;let c;do{await new Promise((r=>setTimeout(r,o))),c=await v(s,l.async_job_id)}while(c&&"in_progress"===c.result[".tag"]);return{metadata:c.metadata}},renameFile:l,renameTeamFolder:async function(r,t,o){const a=new e.DefaultUserApiV2Client(o);return e.GetFilesRoutes(a).rpc("team_folder/rename",{team_folder_id:r,name:t},{})},undo:async function(r,t){var o,n;const s=new e.DefaultUserApiV2Client(t);try{return{isError:!1,result:await e.GetFilesRoutes(s).rpc("undo_batch",{entries:r},{})}}catch(r){i("undo_batch",r);const t=e.filterApiError(r);return(null===(o=null==t?void 0:t.error)||void 0===o?void 0:o[".tag"])?{isError:!0,error:t.error,error_summary:null!==(n=t.summary)&&void 0!==n?n:"unknown"}:a()}}});r.ApiV2=b,r.createFolder=w,r.createUndefinedRpcResult=a,r.deleteFiles=h,r.deleteTeamFolder=p,r.fileInfoIsFqPathBased=n,r.getFilenameFromActionInfo=s,r.isFailure=y,r.isPathLookupFailure=F,r.renameFile=l}));
//# sourceMappingURL=c_files_view_file_actions_api_v2.js-vflWYvpFK.map

//# debugId=6a56c74e-a178-3414-a4f9-af5de4da980b