!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1c35c4f1-7eb8-382f-9dbd-e2edfadd3304")}catch(e){}}();
define(["require","exports","./e_file_viewer_static_scl_page_folder","react","./c_action_bar_action_bar_strings","./c_action_plugins_conversion_action_conditions","./c_action_plugins_download_action_definition","./c_file_viewer_action_plugins_titlebar_button","./c_file_viewer_preview_tour_preview_tour_configs","./c_cloud_docs_constants","./c_pap-events_docsend_view_docsend_hub_entry_button","./e_edison","./c_api_v2_routes_password_confirmation_provider","./e_core_exception","./c_api_v2_routes_folders_info_provider","./c_core_i18n","./c_pap-events_sign_save_signature_doc","./c_src_sink_index","./c_file_viewer_context_migration_context","./c_dig-icons_assets_ui-icon_line_rewind"],(function(e,t,i,n,o,r,s,a,c,l,d,_,u,f,p,g,w,m,h,A){"use strict";function S(e){return e&&e.__esModule?e:{default:e}}var v=S(n);const E="fp_app_id:slack_dropbox",O="fp_app_id:trello",P="fp_app_id:zoom";function y(e){return function(e){return void 0!==e.ext}(e)?e.ext:function(e){return void 0!==e.fq_path}(e)?"."+i.file_extension(i.filename(e.fq_path)):function(e){return void 0!==e.filename}(e)?"."+i.file_extension(e.filename):void 0}function D(e){return!!e.is_in_vault_folder}function I(e,t){return!(e.length>1&&!t.multiselect_enabled)&&e.every((e=>function(e,t){return void 0===t.filters||t.filters.every((t=>"matcher_any"===t[".tag"]&&!!t.matcher_any.some((t=>{if("extension"===t[".tag"]){const i=y(e);return t.extension===i}return"max_size_bytes"===t[".tag"]?e.bytes<=t.max_size_bytes:"is_file"===t[".tag"]?e.is_dir!==t.is_file:"is_cloud_doc"!==t[".tag"]||function(e){return!!e.is_cloud_doc}(e)===t.is_cloud_doc}))))}(e,t)))}function T(e){var t;const i=e.is_dir,n=D(e),o=function(e){return!!e.is_encrypted}(e),r=null===(t=e.per_node_metadata)||void 0===t?void 0:t.link_node;return!(i||n||o||r)}function b(e){const t=e.per_node_metadata;return!(D(e)||(null==t?void 0:t.link_node)||(null==t?void 0:t.suppress_ns_partition)||(null==t?void 0:t.suppress_shared_link))}function x(e,t){return function(e,t){return e.every(T)?t.filter((t=>I(e,t))):[]}(t,e)}function C(e,t){return t.every(b)?x(e,t).filter((e=>R(e)&&![E,P,O].includes(e.app_id))):[]}function R(e){return"share_menu"===e.menu_alignment[".tag"]}const N=t=>{const{file:n}=t.getActiveFile();return{label:o.DOWNLOAD_ACTION_STRING,icon:i.DownloadLine,userAction:i.UserAction.Download,action:{type:"click",handler:()=>new Promise((function(t,i){e(["./c_action_plugins_download_action_action"],t,i)})).then((({downloadActionWrapper:e})=>e(t)))},disabled:s.isDownloadPluginEnabled(n,t.sharePermission)?{disabled:!1}:{disabled:!0,tooltipMessage:o.DISABLED_FOR_THIS_FILE_TOOLTIP_STRING}}},L=t=>({label:o.COPY_TO_DROPBOX_ACTION_STRING,userAction:i.UserAction.SaveToDropbox,icon:i.DropboxLine,action:{type:"click",handler:()=>new Promise((function(t,i){e(["./c_action_plugins_download_action_action"],t,i)})).then((({sharedCopyActionWrapper:e})=>e(t)))},disabled:t.sharePermission&&i.isDownloadAllowed(t.sharePermission)?{disabled:!1}:{disabled:!0,tooltipMessage:o.SAVE_COPY_NO_PERMISSION_TOOLTIP_STRING},dataTooltip:c.TooltipDataSelector.SaveACopy}),F=r.withActionCondition(s.downloadActionConditions,((e,t,n,o,r,s,a,c,l,d,_,u,f)=>{const p={getActiveFile:t,logUserAction:n,fileContentMetadata:o,previewSurface:r,user:e.user,shareToken:s,sharePermission:a,encryptionOptions:c,authModalKind:l,fileName:d,userActionContext:_,onLogSharedActionClick:u,userPresentableVerdict:f};return i.isSharedFile(e.file)&&r!==i.SDKPreviewSurface.SHARED_COLLECTION?[L(p),N(p)]:[N(p)]}),[]),U=v.default.memo((e=>v.default.createElement(W,{...e,userActionContext:i.UserActionContext.PreviewTopNav})));U.displayName="DownloadActionButton";const W=({getActiveFile:t,fileContentMetadata:n,fileName:r,previewSurface:c,user:l,shareToken:d,sharePermission:_,encryptionOptions:u,authModalKind:f,outOfQuota:p,videoEditEligible:g,userActionContext:w,userPresentableVerdict:m})=>{const{logUserAction:h}=i.useFileViewerContext(),A=s.isDownloadPluginEnabled(t().file,_),S=v.default.useMemo((()=>A?{disabled:!1}:{disabled:!0,tooltipMessage:o.DISABLED_FOR_THIS_FILE_TOOLTIP_STRING}),[A]),E=i.useEmitter$1(),O=v.default.useCallback((()=>(h(i.UserAction.Download,w),i.isSharedFile(t().file)&&E.select(i.ON_CLICK_SHARED_CONTENT_ACTION).emit({actionElement:"action_bar",action:"download"}),new Promise((function(t,i){e(["./c_action_plugins_download_action_action"],t,i)})).then((({downloadActionWrapper:e})=>e({getActiveFile:t,logUserAction:h,fileContentMetadata:n,fileName:r,previewSurface:c,user:l,shareToken:d,sharePermission:_,encryptionOptions:u,authModalKind:f,outOfQuota:p,videoEditEligible:g,userActionContext:w,userPresentableVerdict:m}))))),[f,E,u,n,r,t,h,p,c,_,d,l,w,g]);return v.default.createElement(a.TitlebarButton,{label:o.DOWNLOAD_ACTION_STRING,icon:v.default.createElement(i.UIIcon,{src:i.DownloadLine}),action:O,disabled:S})};function M(e){return e.ns("cloud_docs")}function B(e,t){const n=M(new i.DefaultUserApiV2Client(e));let o;t.hasOwnProperty("docPathOrId")&&t.docPathOrId&&(o={".tag":"path_or_id",path_or_id:t.docPathOrId});const r=t.data&&t.data.webOpenId,s=t.data&&t.data.origDest,a=t.data&&t.data.routingDest;n.rpc("log_user_action",{action:t.actionEvent,doc_id:o,source:t.actionSource,open_id:r,orig_dest:s,routing_dest:a,extra_info:t.extra},{})}W.displayName="DownloadActionButtonImpl";function H(e){let t="";return e.hasOwnProperty("ext")?t=e.ext:e.hasOwnProperty("filename")?(t=i.file_extension(e.filename),t&&(t="."+t)):(t=i.file_extension(e),t&&(t="."+t)),t}let K;const V=[{id:"word",icon:"word",name:g.intl.formatMessage({id:"HAvNZw",defaultMessage:"Word for the web"}),exts:["odt","docm","docx"],sizeLimitBytes:104857600,editor:l.MicrosoftEditors.WORD},{id:"excel",icon:"excel",name:g.intl.formatMessage({id:"zaRK6L",defaultMessage:"Excel for the web"}),exts:["ods","xlsb","xlsm","xlsx"],sizeLimitBytes:104857600,editor:l.MicrosoftEditors.EXCEL},{id:"powerpoint",icon:"powerpoint",name:g.intl.formatMessage({id:"rvFsee",defaultMessage:"PowerPoint for the web"}),exts:["odp","ppsx","pptx"],sizeLimitBytes:536870912,editor:l.MicrosoftEditors.POWERPOINT}];class k{static initClass(){this.PRELOAD_URLS={},K=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"]}static is_adobe_app(e){return Array.from(K).includes(e)}static getWopiOpenWithButtonInfo(e){if(i.isEncryptedFile(e))return null;let t;t=e.fq_path?e.fq_path:e.filename?e.filename:"";const n=i.file_extension(t);for(const e of V)if(-1!==e.exts.indexOf(n))return e;return null}}k.initClass();let G;const q=async(t,i)=>{const n=await async function(t){const{DefaultUserApiV2Client:i}=await new Promise((function(t,i){e(["./e_file_viewer_static_scl_page_folder"],t,i)})).then((function(e){return e.default_user_client_esnext}));return M(new i(t))}(t);return n.rpc("get_cloud_editor_url",{file_id:i},{})};function z(e){!function(e){if(void 0!==e&&void 0!==e.error&&void 0!==e.error[".tag"])e.error[".tag"]}(e)}function X(e,t,n,o,r,s,a){const c=w.generateUUID("web_open_id"),l=p.URI.parse(e.cloud_editor_url).updateQuery({cloud_editor:r,web_open_id:c});s&&l.updateQuery({ignore_lock:"1"});const d=l.toString();d&&(void 0===a&&(a=i.UserActionSourceType.WEB),B(o,{actionEvent:i.UserActionEventType.PRE_OPEN,docPathOrId:n,actionSource:a,data:{webOpenId:c}}),null!=t?i.redirect(d,t):i.open_tab(d))}const Q=e=>({fileId:e.file_id,openToUrl:e.open_to_url}),Y=async({fileId:e,openToUrl:t},n,o,r,s)=>{try{const a=performance.now(),c=m.getMetricsReporter(),_={};try{_.editor=o,s&&(_.source=s[".tag"]);const a=(()=>{let e=!1;if(d.edge||d.msie||d.edgeChromium())try{e=window.self!==window.top}catch(t){e=!0}return e})();if(_.isInEdgeIframe=String(a),t&&t.startsWith("https://www.dropbox.com/scl/fi/")){_.usedOpenToURLFromFile="true";X({cloud_editor_url:t},null,e,n,o,r,s)}else{_.usedOpenToURLFromFile="false";const t=a?null:i.open_tab(l.LOADING_PAGE_URL,!0);X(a?await(async(e,t)=>(G||(G=q(e,t)),G))(n,e):await q(n,e),t,e,n,o,r,s)}_.error="false"}catch(e){_.error="true",z(e)}finally{c.createStats({ns:l.CLOUD_DOCS_AMP_NAMESPACE,name:"web/openWithCloudEditor"},_).recordDuration(performance.now()-a,d.TimeUnit.MILLISECONDS)}}catch(e){z(e)}};t.OpenWithCloudDocProvider=void 0,(t.OpenWithCloudDocProvider||(t.OpenWithCloudDocProvider={})).OfficeOnline="OfficeOnline";const j=(e,i,n)=>{const o=k.getWopiOpenWithButtonInfo(e);return o?{text:o.name,spriteName:o.icon,handler:()=>Y(Q(e),i,o.editor,!1,n),provider:t.OpenWithCloudDocProvider.OfficeOnline}:null};function Z(e){return!!function(e){return[".gdoc",".gsheet",".gslides"].indexOf(H(e))>=0}(e)||!!function(e){return".web"===H(e)}(e)}const J=[i.SDKPreviewSurface.BROWSE,i.SDKPreviewSurface.BACKUP,i.SDKPreviewSurface.FILE_LOCKING,i.SDKPreviewSurface.HELLOSIGN,i.SDKPreviewSurface.HOME,i.SDKPreviewSurface.INBAND_SHARE,i.SDKPreviewSurface.PHOTOS,i.SDKPreviewSurface.RECENTS,i.SDKPreviewSurface.SEARCH,i.SDKPreviewSurface.SHARED_CONTENT_LINK,i.SDKPreviewSurface.SHARED_LINK,i.SDKPreviewSurface.STANDALONE_PREVIEW,i.SDKPreviewSurface.STARRED,i.SDKPreviewSurface.POLLUX_DESKTOP_PREVIEW,i.SDKPreviewSurface.POLLUX_DESKTOP_SEARCH_PREVIEW],$={filterValidFile:e=>function(e){const t=r.fileActionCondition.filterValidFile(e);return!!t&&!Z(t)&&!l.isPointerByExtension(t.fq_path)}(e)?e:void 0,filterValidUser:r.filterLoggedInUser,shouldShowForPreviewSurface:r.filterSurfaceIn(J),shouldShowForPreviewType:r.alwaysShow};const ee=r.withActionCondition($,(t=>({label:o.VERSION_HISTORY_ACTION_STRING,icon:i.ClockLine,userAction:i.UserAction.VersionHistory,disabled:{disabled:!1},action:{type:"click",handler:()=>new Promise((function(t,i){e(["./c_action_plugins_version_history_action_action"],t,i)})).then((({versionHistoryActionWrapper:e})=>e(t.file,t.user)))}})),void 0),te=()=>{const{previewSurface:e,pluginArgs:t}=h.usePluginMigrationContext(),{user:n,canRestoreRevision:o,getActiveFile:s}=t,a=s().file,c=s().sharePermission,l=i.useIsNestedArchiveFile(),d=i.useRootPreviewType(),_=v.default.useMemo((()=>({file:a,user:n,previewSurface:e,previewType:d,isNestedArchiveFile:l,sharePermission:c,canRestoreRevision:o})),[a,o,e,d,l,c,n]),u=v.default.useMemo((()=>r.getActionCondition(_,$)),[_]);return u?v.default.createElement(ie,{user:u.user.user,file:u.file}):null};te.displayName="VersionHistoryActionButton";const ie=v.default.memo((t=>{const{user:n,file:r}=t,s=v.default.useCallback((()=>new Promise((function(t,i){e(["./c_action_plugins_version_history_action_action"],t,i)})).then((({versionHistoryActionWrapper:e})=>e(r,n)))),[n,r]);return v.default.createElement(a.TitlebarButton,{label:o.VERSION_HISTORY_ACTION_STRING,icon:v.default.createElement(i.UIIcon,{src:A.RewindLine}),action:s})}));ie.displayName="VersionHistoryActionButtonImpl";class ne{constructor(e){this.category="web-app_actions_telemetry",this.user_id=null,this.session_id=null,this.request_id=null,this.url=null,this.telemetry_session_id=e.telemetry_session_id,this.event_name=e.event_name,this.event_start_ts=e.event_start_ts,this.event_extras=e.event_extras,Object.seal(this)}}class oe{static generateRandomId(){return Math.random().toString(36).substring(2)}static getCurrentTimestamp(){return(new Date).getTime()}constructor(e,t){this.logger=e,this.context=t,this.sessionId=oe.generateRandomId()}event(e,t){const i=oe.getCurrentTimestamp(),n={...this.context,...t},o=new ne({telemetry_session_id:this.sessionId,event_name:e,event_start_ts:i,event_extras:JSON.stringify(n)});this.logger.log(o)}}class re{constructor(e,t){this.logger=e,this.context=t||{}}session(e){const t={...this.context,...e};return new oe(this.logger,t)}}const se=new i.HiveLogger;const ae=function(e){const t={};for(const i of e)t[i]=!0;return t}(["",".doc",".docx",".pdf",".dwg",".png",".jpg",".jpeg",".tiff",".m4v",".wmv",".mpg",".pptx",".xlsx",".pages",".numbers",".key"]);const ce={testFlag:"test_gated_feature",hellosignDeepIntegration:"hellosign_deep_integration_sidebar",fileTransfersAppAction:"file_transfers_app_action",docsendAnalyticsAddOn:"docsend_analytics_add_on",docsendHubTrial:"docsend_hub_trial",docsendHubTrialImplicit:"docsend_hub_trial_implicit"};function le(e){const t={};return function(){const e=[];for(const t in ce)if(ce.hasOwnProperty(t)){const i=t;e.push([i,ce[i]])}return e}().forEach((([i,n])=>{const o=e[n];void 0!==o&&(t[i]=o)})),t}t.DOCSEND_PROD_APP_ID="dbaid:AAA6hDRnKKWTEvY7Xb4xVXwWZA8c8Af3GOM",t.DownloadActionButton=U,t.GetCloudDocsRoutes=M,t.HELLOSIGN_PROD_APP_ID="dbaid:AAA8M7BsKD8QVXgtkUl5Rs7oFykwEx3Vm7U",t.OpenWith=k,t.TRANSFER_FP_APP_ID="fp_app_id:dropbox_transfer",t.VersionHistoryActionButton=te,t.createTelemetryClient=function(e){return new re(se,e)},t.fileToOpenWithParams=Q,t.getActionSourceFromNewFileMenuType=e=>{switch(e){case l.NewFileMenuFromType.BROWSE:return i.UserActionSourceType.WEB_BROWSE;case l.NewFileMenuFromType.HOME:return i.UserActionSourceType.WEB_HOME;default:return i.UserActionSourceType.WEB}},t.getActionSourceFromSurface=e=>"search"===e?i.UserActionSourceType.WEB_SEARCH:"previews"===e?i.UserActionSourceType.WEB_PREVIEW:"home_recent"===e||"home_starred"===e?i.UserActionSourceType.WEB_HOME:"browse"===e||"sidebar"===e?i.UserActionSourceType.WEB_BROWSE:i.UserActionSourceType.WEB,t.getCloudEditorUrl=q,t.getFileExt=y,t.getNonHellosignActionsForFiles=function(e,t,i){return C(e,t).filter((e=>e.app_id!==i))},t.getOpenActionsForFile=function(e,t){return x(e,[t]).filter((e=>!R(e)))},t.getOpenWithCloudEditorInfo=(e,t,i,n)=>{const o=[],r=j(e,t,n);return r&&i.wopi&&o.push(r),o},t.getPiiSafeExtension=function(e){return ae[e]?e:"__REDACTED__"},t.getShareActionsForFiles=C,t.handleError=z,t.isCloudBasedDoc=Z,t.isShareAction=R,t.logUserAction=B,t.makeDownloadActions=F,t.makeVersionHistoryAction=ee,t.openCloudEditorUrl=X,t.openWithCloudEditor=Y,t.parseActionsForUserResult=function(e){const t={};e.bylines.forEach((e=>{let i=e.extension_id[".tag"];(function(e){return"app_id"in e})(e.extension_id)&&(i=e.extension_id.app_id),t[i]=e.byline}));const i=le(e.stormcrow_assignments);return{bylines:t,featureFlags:i}}}));
//# sourceMappingURL=c_extensions_client.js-vflHHIX8r.map

//# debugId=1c35c4f1-7eb8-382f-9dbd-e2edfadd3304