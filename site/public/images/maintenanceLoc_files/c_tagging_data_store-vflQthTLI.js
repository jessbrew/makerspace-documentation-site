!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="8c302868-d620-3041-96bc-80216ed2188a")}catch(e){}}();
define(["require","exports","./e_file_viewer_static_scl_page_folder","./c_tagging_utils","./c_api_v2_routes_folders_info_provider","./e_core_exception","./c_core_i18n","./c_lodash","./c_sync_everything_redux_store"],(function(e,t,r,n,o,a,s,i,c){"use strict";const u="browse_right_rail_collapsed_preferences",l="browse_right_sidebar_preferences";function d(e){var t;try{return null===(t=r.UserLocalStorage.get(e,u))||void 0===t||t}catch(e){return a.reportException({err:e,severity:"non-critical"}),!0}}var E;function T(e){return function(e){var t;try{return null!==(t=r.UserLocalStorage.get(e,l))&&void 0!==t?t:void 0}catch(e){return void a.reportException({err:e,severity:"non-critical"})}}(e)}function _(e,t){const{unsortedFiles:n}=t.payload;return{...e,unsortedFiles:function(e){const t=new Set;let n=r.immutableExports.Map();return e.forEach(((e,r)=>{const o=e.file_id&&""!==e.file_id.trim()?e.file_id:r;t.has(o)||(t.add(o),n=n.set(r,e))})),n}(n)}}function S(a=n.defaultBrowseState,s){switch(s.type){case n.ActionTypes.APP_INIT:return function(e,t){const{props:r,user:n,viewer:a}=t.payload;o.assert(null===e.user,"Cannot reinitialize Browse store; changing invariants such as `user` is untested");const{browseExperiments:s,...i}=r;return{...e,user:n,viewer:a,experiments:s,...i,isRightRailCollapsed:(c=n.id,d(c)),rightSidebar:T(n.id)};var c}(a,s);case n.ActionTypes.PUSH_BOLT_IGNORE:return function(e,t){let{added:r,moved:n,removed:o}=e.boltIgnore;return t.payload.added&&(r=new Set(r),t.payload.added.forEach((e=>r.add(e)))),t.payload.moved&&(n=new Set(n),t.payload.moved.forEach((e=>n.add(e)))),t.payload.removed&&(o=new Set(o),t.payload.removed.forEach((e=>o.add(e)))),{...e,boltIgnore:{added:r,moved:n,removed:o}}}(a,s);case n.ActionTypes.POP_BOLT_IGNORE:return function(e,t){let{added:r,moved:n,removed:o}=e.boltIgnore;return t.payload.added&&(r=new Set(r),t.payload.added.forEach((e=>r.delete(e)))),t.payload.moved&&(n=new Set(n),t.payload.moved.forEach((e=>n.delete(e)))),t.payload.removed&&(o=new Set(o),t.payload.removed.forEach((e=>o.delete(e)))),{...e,boltIgnore:{added:r,moved:n,removed:o}}}(a,s);case n.ActionTypes.SELECT_FILES_BY_FQ_PATH:return function(e,t){const{fqPathsToSelect:n}=t.payload,o=n.map((e=>e.toLowerCase())),a=e.unsortedFiles.toList().filter((e=>o.includes(e.fq_path.toLowerCase()))).map((e=>e.fq_path)),s=r.immutableExports.OrderedSet(a),i=a.size?a.get(0):null;return{...e,selection:e.selection.set("selected",s).set("anchor",i)}}(a,s);case n.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES:return function(e,t){const{canDisplayFolderSizes:r}=t.payload;return{...e,canDisplayFolderSizes:r}}(a,s);case n.ActionTypes.SET_CLIPBOARD_FILES:return function(e,t){const{clipboard:r}=t.payload;return{...e,clipboard:r}}(a,s);case n.ActionTypes.SET_CONTEXT:return function(e,t){const{context:r}=t.payload;return{...e,context:r}}(a,s);case n.ActionTypes.SET_CURRENT_FOLDER_INFO:return function(e,t){const{currentFolderInfo:r}=t.payload;return{...e,currentFolderInfo:r}}(a,s);case n.ActionTypes.SET_FILE_JUMP_FILTER:return function(e,t){const{fileJumpFilter:r}=t.payload;return{...e,fileJumpFilter:r}}(a,s);case n.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return function(e,t){const{filePathsToSelectOnNextUpdate:r}=t.payload;return{...e,filePathsToSelectOnNextUpdate:r}}(a,s);case n.ActionTypes.SET_FOLDER_SIZES:return function(e,t){const{folderSizes:r}=t.payload;return{...e,folderSizes:r}}(a,s);case n.ActionTypes.SET_LOADING_STATE:return function(e,t){const{loadingState:n,path:o}=t.payload;return r.paths_are_equal(o,e.path)?n===r.LoadingState.LOADED?{...e,loadingState:n,filePathsToSelectOnNextUpdate:r.immutableExports.Set()}:{...e,loadingState:n}:e}(a,s);case n.ActionTypes.SET_LOAD_REJECTED:return function(e,t){const{rejected:n,path:o}=t.payload;return r.paths_are_equal(o,e.path)?{...e,loadRejected:n}:{...e,loadRejected:!1}}(a,s);case n.ActionTypes.SET_MOUNT_POINTS:return function(e,t){const{mountPoints:n}=t.payload;return{...e,mountPoints:r.immutableExports.Map(n)}}(a,s);case n.ActionTypes.SET_NEW_FOLDER_CREATION_STATE:return function(e,t){const{newFolderCreationState:r}=t.payload;return{...e,newFolderCreationState:r}}(a,s);case n.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES:return function(e,t){const{paginatedTotalNumFiles:r}=t.payload;return{...e,paginatedTotalNumFiles:r}}(a,s);case n.ActionTypes.SET_PATH:return function(e,t){const{path:r}=t.payload;return{...e,path:r}}(a,s);case n.ActionTypes.SET_SELECTION:return function(e,t){const{selection:r}=t.payload;return{...e,selection:r}}(a,s);case n.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES:return function(e,t){const{shouldShowDeletedFiles:r}=t.payload;return{...e,shouldShowDeletedFiles:r}}(a,s);case n.ActionTypes.SET_UNSORTED_FILES:return _(a,s);case n.ActionTypes.SHOW_TIMELINE:return function(e,t){return{...e,isRewindVisible:!0,clickRewindTimestamp:t.payload.timestamp}}(a,s);case n.ActionTypes.HIDE_TIMELINE:return function(e,t){return{...e,isRewindVisible:!1}}(a);case n.ActionTypes.SET_IS_FILE_VIEWER_SHOWN:return function(e,t){return{...e,isFileViewerShown:t.payload.isShown}}(a,s);case n.ActionTypes.SET_IS_REWIND_ENABLED:return function(e,t){return{...e,isRewindButtonEnabled:t.payload.value}}(a,s);case n.ActionTypes.REQUEST_FOLDER_SIZES:return function(e,r){const{fqPath:n}=r.payload;if(e.isQueryingFolderSizes)return e;const o=e.folderSizes.withMutations((e=>{e.set(n,{size:0,state:t.FetchFolderSizeState.LOADING})}));return{...e,folderSizes:o,isQueryingFolderSizes:!0}}(a,s);case n.ActionTypes.SET_FOLDER_SIZES_PENDING:return function(e,r){const{fetchFolderSizesResp:n}=r.payload;let o=e.currentFolderSizesQuery;const a=e.folderSizes.withMutations((e=>{for(const r of n.sizes_dict)e.update(r.fq_path,{size:0,state:t.FetchFolderSizeState.LOADING},(()=>({size:r.size,state:t.FetchFolderSizeState.LOADING}))),o=o.withMutations((e=>e.add(r.fq_path)))}));return{...e,currentFolderSizesQuery:o,folderSizes:a}}(a,s);case n.ActionTypes.COMPLETE_FOLDER_SIZES:return function(e,t){const{fetchFolderSizeState:n}=t.payload,o=e.folderSizes.withMutations((t=>{e.currentFolderSizesQuery.forEach((r=>{const o=e.folderSizes.get(r);o&&t.update(r,(()=>({size:o.size,state:n})))}))}));return{...e,currentFolderSizesQuery:r.immutableExports.Set(),folderSizes:o,isQueryingFolderSizes:!1}}(a,s);case n.ActionTypes.SET_VIEW_SCOPE:return function(e,t){return{...e,viewScope:t.payload.viewScope}}(a,s);case n.ActionTypes.SET_HIDE_FILES_AND_SIDEBAR:return function(e,t){return{...e,shouldHideFilesAndSidebar:t.payload.shouldHideFilesAndSidebar}}(a,s);case n.ActionTypes.SET_IS_CREATING_SHARED_LINK:return function(e,t){return{...e,isCreatingSharedLinkMap:e.isCreatingSharedLinkMap.set(t.payload.fileIdOrPath,t.payload.isCreatingSharedLink)}}(a,s);case n.ActionTypes.SET_RIGHTRAIL_IS_COLLAPSED:return function(e,t){return{...e,isRightRailCollapsed:t.payload.collapsed}}(a,s);case n.ActionTypes.SET_OVERFLOW_MENU_OPEN_REQUEST:return function(e,t){return{...e,overflowMenuOpenRequest:t.payload.overflowMenuOpenRequest}}(a,s);case n.ActionTypes.SET_FACET_FILES:return function(e,t){return{...e,facetFiles:t.payload.facetFiles}}(a,s);case n.ActionTypes.SET_FACETS_ARE_USED:return function(e,t){return{...e,facetsAreUsed:t.payload.facetsAreUsed}}(a,s);case n.ActionTypes.SET_OVERFLOW_MENU_CLOSE_REQUEST:return function(e,t){return e.overflowMenuCloseRequest===t.payload.overflowMenuCloseRequest?e:{...e,overflowMenuCloseRequest:t.payload.overflowMenuCloseRequest}}(a,s);case n.ActionTypes.SET_INLINE_OVERFLOW_MENU_OPEN_REQUEST:return function(e,t){return{...e,inlineOverflowMenuOpenRequest:t.payload.inlineOverflowMenuOpenRequest}}(a,s);case n.ActionTypes.SET_OVERFLOW_MENU_COORDINATES:return function(e,t){return{...e,overflowMenuCoordinates:t.payload.overflowMenuCoordinates}}(a,s);case n.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS:return function(e,t){const{browsePostTTIExperiments:r}=t.payload;return{...e,browsePostTTIExperiments:r}}(a,s);case n.ActionTypes.SET_BROWSE_POST_TTI_DATA:return function(e,t){const{browsePostTTIData:r}=t.payload;return{...e,browsePostTTIData:{...e.browsePostTTIData,...r}}}(a,s);case n.ActionTypes.SET_CREATE_MENU_OPEN_REQUEST:return function(e,t){return{...e,createMenuOpenRequest:t.payload.createMenuOpenRequest}}(a,s);case n.ActionTypes.HANDLE_APP_CLEANUP:return n.defaultBrowseState;case n.ActionTypes.ADD_FROM_GDRIVE:return function(t,r){return new Promise((function(t,r){e(["./c_file_imports_ui_entry"],t,r)})).then((e=>{var n;e.clickOnImportFromGoogleDrive({currentPath:null!==(n=r.payload.path)&&void 0!==n?n:t.path})})),t}(a,s);case n.ActionTypes.SET_FILTER_TYPES:return function(e,t){return{...e,filterTypes:t.payload.filterTypes}}(a,s);case n.ActionTypes.SET_BROWSE_USER:return function(e,t){return null==e.user?{...e,user:t.payload.user}:e}(a,s);case n.ActionTypes.SET_RIGHT_SIDEBAR:return function(e,t){return{...e,rightSidebar:t.payload.sidebar}}(a,s);case n.ActionTypes.SET_BROWSE_VIEWER:return function(e,t){return null==e.viewer?{...e,viewer:t.payload.viewer}:e}(a,s);case n.ActionTypes.SET_CURRENT_FOLDER_RENAME:return function(e,t){const{renameState:r}=t.payload;return r?{...e,currentFolderRenameState:r}:{...e,currentFolderRenameState:null}}(a,s);case n.ActionTypes.SET_QUICK_VIEW_FILE:return function(e,t){return{...e,quickViewFileId:t.payload.fileId}}(a,s);case n.ActionTypes.SET_UPLOAD_QUICK_VIEW_FILE_PATH:return function(e,t){return{...e,uploadQuickViewFilePath:t.payload.filePath}}(a,s)}return a}t.FetchFolderSizeState=void 0,(E=t.FetchFolderSizeState||(t.FetchFolderSizeState={})).LOADING="LOADING",E.COMPLETE="COMPLETE",E.NO_ACCESS="NO_ACCESS",E.ERROR="ERROR",t.ActionTypes=void 0,function(e){e.SET_FILE_TO_TAGS_MAP="TAGGING/SET_FILE_TO_TAGS_MAP",e.ADD_TAG_TO_FILE="TAGGING/ADD_TAG_TO_FILE",e.REMOVE_TAG_FROM_FILE="TAGGING/REMOVE_TAG_FROM_FILE",e.FILE_RENAME="TAGGING/FILE_RENAME",e.SET_ALL_TAGS="TAGGING/SET_ALL_TAGS"}(t.ActionTypes||(t.ActionTypes={}));const p={tagsByFile:{},tags:void 0},A=(e,t)=>{const r=[...e,...t],n=new Map(r.map((e=>[e.tag_text,e])));return[...Array.from(n.values())]};function y(e=p,r){switch(r.type){case t.ActionTypes.SET_FILE_TO_TAGS_MAP:return((e,{fileToTags:t,override:r})=>{const n=Object.keys(t).reduce(((r,n)=>{const o=e.tagsByFile[n],a=t[n];return void 0===o?(r[n]=a,r):(i.isEqual(i.sortBy(o,(e=>e.tag_text)),i.sortBy(a,(e=>e.tag_text)))?r[n]=o:r[n]=a,r)}),{});let o;if(void 0!==e.tags){const t=Object.entries(n).map((([e,t])=>t)).reduce(((e,t)=>[...t,...e]),[]);o=A(e.tags,t)}return{...e,tagsByFile:{...r?{}:e.tagsByFile,...n},tags:null!=o?o:e.tags}})(e,r.payload);case t.ActionTypes.FILE_RENAME:return((e,{file:t,newFile:r})=>{const o=n.getFileMapKey(t),a=n.getFileMapKey(r),s=e.tagsByFile[o];if(!s)return e;const i=e.tagsByFile;return delete i[o],i[a]=s,{...e,tagsByFile:i}})(e,r.payload);case t.ActionTypes.SET_ALL_TAGS:return((e,{tags:t})=>({...e,tags:t}))(e,r.payload);default:return e}}let f;const R=()=>(f||(f=r.getStoreAndRegisterReducers({[r.TAGGING_NAMESPACE_KEY]:y})),f);var F;!function(e){e.CloseRecorder="Capture/CloseRecorder",e.OpenRecorder="Capture/OpenRecorder",e.SetCaptureAccess="Capture/SetCaptureAccess",e.UploadResult="Capture/UploadResult",e.ClearUploadResult="Capture/ClearUploadResult",e.SetUserInfo="Capture/SetUserInfo"}(F||(F={}));const I={recorderState:{active:!1}};function O(e=I,t){switch(t.type){case F.CloseRecorder:return e.recorderState.active?{...e,recorderState:{active:!1}}:e;case F.OpenRecorder:return e.recorderState.active?e:{...e,recorderState:{active:!0,...t.payload}};case F.UploadResult:return{...e,uploadResult:t.payload};case F.ClearUploadResult:return{...e,uploadResult:void 0};default:return e}}let L;var g,h;!function(e){e.FILE_RENAME="STRUCTURED_TAGS/FILE_RENAME",e.SET_TEMPLATES="STRUCTURED_TAGS/SET_TEMPLATES",e.SET_FILE_TO_STRUCTURED_TAGS_MAP="STRUCTURED_TAGS/SET_FILE_TO_STRUCTURED_TAGS_MAP",e.SET_STATUS="STRUCTURED_TAGS/SET_STATUS"}(g||(g={})),function(e){e.DEFAULT="default",e.IS_LOADING="is_loading",e.DONE="done"}(h||(h={}));const N={templates:[],fileToTags:{},status:h.DEFAULT,currentClassification:void 0,tagOptions:[]};function C(e=N,t){switch(t.type){case g.SET_TEMPLATES:return((e,{structuredTagTemplates:t})=>({...e,status:h.DONE,templates:t}))(e,t.payload);case g.FILE_RENAME:return((e,{file:t,newFile:r})=>{const o=n.getFileMapKey(t),a=n.getFileMapKey(r),s=e.fileToTags[o];if(!s)return e;const{[o]:i,...c}=e.fileToTags;return c[a]=s,{...e,fileToTags:c}})(e,t.payload);case g.SET_STATUS:return((e,{status:t})=>({...e,status:t}))(e,t.payload);case g.SET_FILE_TO_STRUCTURED_TAGS_MAP:return((e,{fileToTags:t})=>({...e,fileToTags:{...e.fileToTags,...t}}))(e,t.payload);default:return e}}let v;const D=()=>(v||(v=r.getStoreAndRegisterReducers({[r.STRUCTURED_TAGS_NAMESPACE_KEY]:C})),v);let w;t.defaultStructuredTagState=N,t.getStoreForBrowse=()=>(w||(w=r.getStoreAndRegisterReducers({[r.BROWSE_NAMESPACE_KEY]:S})),R(),L||(L=r.getStoreAndRegisterReducers({[r.CAPTURE_NAMESPACE_KEY]:O})),c.getStoreForBackup(),D(),w),t.getStoreForStructuredTags=D,t.getStoreForTagging=R,t.setRightSidebar=function(e,t){try{r.UserLocalStorage.set(e,l,t)}catch(e){a.reportException({err:e,severity:"non-critical"})}}}));
//# sourceMappingURL=c_tagging_data_store.js-vflZTQmfI.map

//# debugId=8c302868-d620-3041-96bc-80216ed2188a