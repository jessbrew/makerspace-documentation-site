!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="e360e472-574e-39c8-ae6d-eeade2c7328f")}catch(e){}}();
define(["exports","./e_file_viewer_static_scl_page_folder","./c_reduxjs_toolkit_redux-toolkit","./c_browse_data_selectors","./c_sharing_avatar_info","./e_data_modules_stormcrow","./c_tagging_data_store"],(function(e,a,t,r,s,i,n){"use strict";const o={sharedFolderDataByTargetNamespaceId:{},hasSharedDataLoadedByParentPath:{},sharedLinkExistsByFileIdOrPath:{},sharedFileDataByFileId:{},integrationData:void 0};const d=(e,t,r)=>{return s=function(e){var t,r,s;const i=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/share_ajax/shared_with",n=null!==(r=null==e?void 0:e.routeParams)&&void 0!==r?r:{},o=null!==(s=null==e?void 0:e.base)&&void 0!==s?s:window.location.origin;return new a.AjaxURL(a.replacePattern(i,n),o)}(),i={max_results:r,fq_path_prefix:t,include_inherited:!0,sort_by_name:!0},n=!1,o=e,d=!0,new Promise(((e,t)=>{(n?a.SilentBackgroundRequest$2:a.WebRequest)({url:s,type:"POST",dataType:"json",data:i,subject_user:o,skipNotifyError:d,success:e,error:(e,a,r)=>t(Error(`error: ${r}, status: ${a}`))})}));var s,i,n,o,d};function l(e,a){return["share_ajax:shared_with",e,a.toString()]}const u=e=>r.user(e);let h=null;const _=({parentPath:e})=>(t,s)=>{const i=s(),n=u(i),o=r.mountPoints(i),d={};o&&o.forEach(((e,t)=>d[t]={memberCount:1,joinedMembers:[{...n,access_type:"owner",user_id:n.id,photo_url:n.photo_url,initials:a.getInitials(n.display_name)}]})),t(f.setNamespaceSharedWithData({parentPath:e,sharedFolderData:d}))},c=t.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedWithData`,(async({parentPath:e},{getState:a})=>{const t=a(),r=u(t);return await i.queryClient.fetchQuery(l(e,5),(async()=>await d(r,e,5).then((a=>{const t=(e=>{const a={};for(const t of e)a[t.ns_id]={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members,audienceDescription:t.audience_description,memberCount:t.num_users_and_invites,accessTextData:{total_groups_and_users:t.total_groups_and_users,total_unique_inherited_members:t.total_unique_inherited_members,total_unique_users:t.total_unique_users,users_outside_team:t.users_outside_team,is_confidential:t.is_confidential,isParentTmr:t.is_parent_tmr,is_parent_tsd:t.is_parent_tsd,is_parent_namespace:t.is_parent_namespace,has_team_group:t.has_team_group,has_group:t.has_group}};return a})(a);return{sharedFolderData:t,parentPath:e}})).finally((()=>h=null))))})),p=t.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedFileDataForFiles`,(async(e,{getState:t,dispatch:r,rejectWithValue:i})=>{const n=t(),o=u(n);if(!o.is_email_verified)return i("User's email is not verified.");const d=e.slice(0,100),l=e.slice(100);return await(h=d,_=5,c=o,new a.FileShareApiClient({userApiProps:c}).listMembersBatch({contentIds:h,limit:_})).then((e=>{const a={};return e.forEach(((e,t)=>{a[t]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(s.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(s.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(s.apiUserMemberToAvatarInfo).toArray()}})),(null==l?void 0:l.length)&&r(p(l)),{sharedFileData:a}}));var h,_,c})),m=t.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedLinkExists`,(async(e,{getState:t})=>{const s=t(),i=r.getBrowseState(s).user;if(i)return await((e,t)=>new a.FileShareApiClient({userApiProps:t}).sharedLinkInfo({fileIdOrPath:e}))(e,i).then((a=>({fileIdOrPath:e,sharedLinkExists:(null==a?void 0:a.length)>0})))})),S=t.createSlice({name:a.BROWSE_SHARED_WITH_NAMESPACE_KEY,initialState:o,reducers:{clear:(e,a)=>o,clearSharedFileDataByFileId:(e,a)=>{e.sharedFileDataByFileId={}},clearSharedLinkExistsCache:(e,a)=>{e.sharedLinkExistsByFileIdOrPath={}},setHasSharedDataLoaded:(e,a)=>{const{payload:t}=a;e.hasSharedDataLoadedByParentPath[t.parentPath]=t.isLoaded},setNamespaceSharedWithData:(e,a)=>{const{payload:t}=a;e.hasSharedDataLoadedByParentPath[t.parentPath]=!0,e.sharedFolderDataByTargetNamespaceId=t.sharedFolderData}},extraReducers:e=>{e.addCase(c.fulfilled,((e,{payload:a})=>{const t={...e.hasSharedDataLoadedByParentPath};return(null==a?void 0:a.parentPath)?(t[a.parentPath]=!0,{...e,hasSharedDataLoadedByParentPath:t,sharedFolderDataByTargetNamespaceId:a.sharedFolderData}):e})).addCase(p.fulfilled,((e,{payload:a})=>({...e,sharedFileDataByFileId:{...e.sharedFileDataByFileId,...a.sharedFileData}}))).addCase(m.fulfilled,((e,a)=>{a.payload&&(e.sharedLinkExistsByFileIdOrPath[a.payload.fileIdOrPath]=a.payload.sharedLinkExists)}))}}),{reducer:y}=S,f=S.actions;let P;e.getStoreForSharedWith=()=>(P||(P=a.getStoreAndRegisterReducers({[a.BROWSE_SHARED_WITH_NAMESPACE_KEY]:y})),n.getStoreForBrowse(),P),e.sharedFileDataOutOfDate=e=>a=>{a(p(e))},e.sharedFolderDataOutOfDate=e=>(a,t)=>{if(!e){const a=t();e=r.path(a)}i.queryClient.invalidateQueries(l(e,5)),a((({parentPath:e,abortCurrentRequest:a=!1})=>(t,s)=>{const i=s();a&&h&&h.abort(),r.isInsideBackupFolder(i)?t(_({parentPath:e})):t(c({parentPath:e}))})({parentPath:e}))},e.sharedLinkDataOutOfDate=e=>a=>{e&&a(m(e))}}));
//# sourceMappingURL=c_shared_with_redux_store.js-vflvt95QJ.map

//# debugId=e360e472-574e-39c8-ae6d-eeade2c7328f