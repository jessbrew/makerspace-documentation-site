!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9c517e5d-c857-3ef8-b82f-83919e9528c3")}catch(e){}}();
define(["require","exports","./c_pap-events_docsend_view_docsend_hub_entry_button","./c_api_v2_routes_password_confirmation_provider","./c_api_v2_routes_folders_info_provider","./e_core_exception","./c_lodash"],(function(e,t,r,s,n,i,a){"use strict";const o={DEBUG:!1,IDLE_TIMEOUT:200,NETWORK_TIMEOUT:6e4};class d{static format(...e){return["[ttvc]",...e,"::",performance.now()]}static debug(...e){o.DEBUG&&console.debug(...this.format(...e))}static info(...e){o.DEBUG&&console.info(...this.format(...e))}static warn(...e){o.DEBUG&&console.warn(...this.format(...e))}}class c{constructor(){this.pendingRequests=0,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{d.debug("AjaxIdleObservable.next()",e),this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{if(0===o.NETWORK_TIMEOUT)return;this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{d.warn("AjaxIdleObservable","::","Timed out waiting for requests to resolve.","Make sure that incrementAjaxCount() is always matched with decrementAjaxCount().","::","pendingRequests =",this.pendingRequests),this.didNetworkTimeOut=!0,this.pendingRequests=0,this.next("IDLE")}),o.NETWORK_TIMEOUT)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.increment=()=>{this.startCleanupTimeout(),0===this.pendingRequests&&this.next("BUSY"),this.pendingRequests+=1},this.decrement=()=>{this.abortCleanupTimeout(),1===this.pendingRequests?this.next("IDLE"):this.startCleanupTimeout(),this.pendingRequests=Math.max(this.pendingRequests-1,0),this.pendingRequests<10&&d.debug("AjaxIdleObservable.decrement()","::","pendingRequests =",this.pendingRequests)},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}}}}class l{constructor(){this.pendingResources=new Set,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{d.debug("ResourceLoadingIdleObservable.next()",e),this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{if(0===o.NETWORK_TIMEOUT)return;this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{d.warn("ResourceLoadingIdleObservable","::","Timed out waiting for resources to resolve.","Consider filing a bug report if this continues to occur.","::","pendingResources =",this.pendingResources),this.didNetworkTimeOut=!0,this.pendingResources=new Set,this.next("IDLE")}),o.NETWORK_TIMEOUT)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.add=e=>{e instanceof HTMLImageElement&&!e.src||e instanceof HTMLImageElement&&e.complete||e instanceof HTMLLinkElement&&!e.href||e instanceof HTMLScriptElement&&!e.src||e instanceof HTMLIFrameElement&&(!e.src||"about:blank"===e.src)||(this.startCleanupTimeout(),0===this.pendingResources.size&&this.next("BUSY"),this.pendingResources.add(e))},this.remove=e=>{this.abortCleanupTimeout(),this.pendingResources.delete(e),0===this.pendingResources.size?this.next("IDLE"):this.startCleanupTimeout(),this.pendingResources.size<10&&d.debug("ResourceLoadingIdleObservable.remove()","::","pendingResources =",this.pendingResources)},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},"undefined"!=typeof window&&(null===window||void 0===window?void 0:window.MutationObserver)&&window.addEventListener("load",(()=>{new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{e instanceof HTMLScriptElement||e instanceof HTMLLinkElement||e instanceof HTMLImageElement||e instanceof HTMLIFrameElement?this.add(e):e.hasChildNodes()&&e instanceof HTMLElement&&e.querySelectorAll("img").forEach(this.add)}))}))})).observe(window.document.documentElement,{childList:!0,subtree:!0}),["load","error"].forEach((e=>{window.document.addEventListener(e,(e=>{(e.target instanceof HTMLScriptElement||e.target instanceof HTMLLinkElement||e.target instanceof HTMLImageElement||e.target instanceof HTMLIFrameElement)&&this.remove(e.target)}),{capture:!0})}))}))}}class u{constructor(){this.ajaxIdleObservable=new c,this.resourceLoadingIdleObservable=new l,this.subscribers=new Set,this.ajaxIdle=!0,this.scriptLoadingIdle=!0,this.handleUpdate=e=>t=>{const r=this.ajaxIdle&&this.scriptLoadingIdle;"AJAX"===e&&(this.ajaxIdle="IDLE"===t),"RESOURCE_LOADING"===e&&(this.scriptLoadingIdle="IDLE"===t);const s=this.ajaxIdle&&this.scriptLoadingIdle;r!==s&&this.next(s?"IDLE":"BUSY")},this.next=e=>{d.debug("NetworkIdleObservable.next()",e),this.subscribers.forEach((t=>t(e)))},this.incrementAjaxCount=()=>this.ajaxIdleObservable.increment(),this.decrementAjaxCount=()=>this.ajaxIdleObservable.decrement(),this.isIdle=()=>this.ajaxIdle&&this.scriptLoadingIdle,this.didNetworkTimeOut=()=>this.ajaxIdleObservable.didNetworkTimeOut||this.resourceLoadingIdleObservable.didNetworkTimeOut,this.resetDidNetworkTimeOut=()=>{this.ajaxIdleObservable.didNetworkTimeOut=!1,this.resourceLoadingIdleObservable.didNetworkTimeOut=!1},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},this.ajaxIdleObservable.subscribe(this.handleUpdate("AJAX")),this.resourceLoadingIdleObservable.subscribe(this.handleUpdate("RESOURCE_LOADING"))}}let m;const h=()=>(m||(m=new u),m);class g{constructor(e){this.mutationObserverConfig={attributeFilter:["hidden","style","src"],attributeOldValue:!0,attributes:!0,childList:!0,subtree:!0},this.mutations=new Map,this.mutationObserverCallback=e=>{d.debug("InViewportMutationObserver.mutationObserverCallback()","::","mutations =",e),e.forEach((e=>{e.timestamp=performance.now();let t=null;if(e.target instanceof Element&&(t=e.target),e.target instanceof Text&&(t=e.target.parentElement),t)if("childList"===e.type)e.addedNodes.forEach((t=>{t instanceof HTMLElement&&(this.intersectionObserver.observe(t),this.mutations.set(t,e)),t instanceof Text&&null!=t.parentElement&&(this.intersectionObserver.observe(t.parentElement),this.mutations.set(t.parentElement,e))}));else this.intersectionObserver.observe(t),this.mutations.set(t,e)}))},this.intersectionObserverCallback=e=>{d.debug("InViewportMutationObserver.intersectionObserverCallback()","::","entries =",e),e.forEach((e=>{const t=this.mutations.get(e.target);e.isIntersecting&&null!=t&&(d.info("InViewportMutationObserver.callback()","::","mutation =",t),this.callback(t)),this.mutations.delete(e.target),this.intersectionObserver.unobserve(e.target)}))},this.callback=e,this.mutationObserver=new MutationObserver(this.mutationObserverCallback),this.intersectionObserver=new IntersectionObserver(this.intersectionObserverCallback)}observe(e){d.info("InViewportMutationObserver.observe()","::","target =",e),this.mutationObserver.observe(e,this.mutationObserverConfig)}disconnect(){d.info("InViewportMutationObserver.disconnect()"),this.mutationObserver.disconnect(),this.intersectionObserver.disconnect()}}function p(e){const t=h();let r,s=t.isIdle();const n=e=>{s="IDLE"===e,s?(e=>{var t;(null!==(t=window.requestIdleCallback)&&void 0!==t?t:window.setTimeout)((()=>{window.requestAnimationFrame((()=>window.requestAnimationFrame(e)))}))})(i):(window.clearTimeout(r),r=void 0)},i=()=>{d.debug("requestAllIdleCallback.handleCpuIdle()"),s&&!r&&a()},a=()=>{r=window.setTimeout((()=>{const r=t.didNetworkTimeOut();t.resetDidNetworkTimeOut(),d.info("requestAllIdleCallback: ALL IDLE"),e(r),c()}),o.IDLE_TIMEOUT)},c=t.subscribe(n);s&&n("IDLE")}class f{constructor(e){this.imageLoadTimes=new Map,this.lastImageLoadTimestamp=0,this.intersectionObserverCallback=e=>{e.forEach((e=>{const t=e.target,r=this.imageLoadTimes.get(t);e.isIntersecting&&null!=r&&(d.info("InViewportImageObserver.callback()","::","timestamp =",r),this.callback(r,t)),this.intersectionObserver.unobserve(t),this.imageLoadTimes.delete(t)}))},this.handleLoadOrErrorEvent=e=>{(e.target instanceof HTMLImageElement||e.target instanceof HTMLIFrameElement)&&(d.debug("InViewportImageObserver.handleLoadOrErrorEvent()","::","event =",e),this.imageLoadTimes.set(e.target,e.timeStamp),this.intersectionObserver.observe(e.target))},this.callback=e,this.intersectionObserver=new IntersectionObserver(this.intersectionObserverCallback)}observe(){d.info("InViewportImageObserver.observe()"),document.addEventListener("load",this.handleLoadOrErrorEvent,{capture:!0}),document.addEventListener("error",this.handleLoadOrErrorEvent,{capture:!0})}disconnect(){d.info("InViewportImageObserver.disconnect()"),this.lastImageLoadTimestamp=0,this.imageLoadTimes.clear(),this.intersectionObserver.disconnect(),document.removeEventListener("load",this.handleLoadOrErrorEvent),document.removeEventListener("error",this.handleLoadOrErrorEvent)}}const w=()=>{var e;return(null===(e=window.performance.getEntriesByType("navigation")[0])||void 0===e?void 0:e.type)||(()=>{const e=window.performance.navigation.type;return 2===e?"back_forward":1===e?"reload":"navigate"})()};class v{constructor(){if(this.debug=!1,this.idleTimeout=200,this.lastImageLoadTimestamp=-1,this.navigationCount=0,this.observations=new Map,this.successSubscribers=new Set,this.errorSubscribers=new Set,this.onTTVC=(e,t)=>(this.successSubscribers.add(e),t&&this.errorSubscribers.add(t),()=>{this.successSubscribers.delete(e),t&&this.errorSubscribers.delete(t)}),!v.isSupportedEnvironment())throw new Error("VisuallyCompleteCalculator: This browser/runtime is not supported.");this.inViewportMutationObserver=new g((e=>{var t,r,s;(null!==(t=e.timestamp)&&void 0!==t?t:0)>=(null!==(s=null===(r=this.lastMutation)||void 0===r?void 0:r.timestamp)&&void 0!==s?s:0)&&(this.lastMutation=e)})),this.inViewportImageObserver=new f(((e,t)=>{e>=this.lastImageLoadTimestamp&&(this.lastImageLoadTimestamp=e,this.lastImageLoadTarget=t)}))}static isSupportedEnvironment(){var e;return void 0!==window&&"MutationObserver"in window&&"IntersectionObserver"in window&&"function"==typeof document.querySelectorAll&&(null===(e=window.performance)||void 0===e?void 0:e.timing)}cancel(e){const t=this.observations.get(this.observations.size);t&&"ACTIVE"===t.state&&(t.cancel("MANUAL_CANCELLATION",e),t.state="CANCELLED")}async start(e=0,t=!1){var r,s;const n=this.navigationCount+=1;d.info("VisuallyCompleteCalculator.start()","::","index =",n);const i=this.observations.get(n-1);i&&"ACTIVE"===i.state&&i.cancel("NEW_MEASUREMENT");let a=t?"back_forward":e>0?"script":w();const o=(()=>{var e;return(null===(e=window.performance.getEntriesByType("navigation")[0])||void 0===e?void 0:e.activationStart)||0})();o>e&&(e=o,a="prerender");const c=(t,r)=>{const s=this.observations.get(n);if(!s||"ACTIVE"!==s.state)return;s.state="CANCELLED";const i=performance.now();this.error(Object.assign({start:e,end:i,duration:i-e,cancellationReason:t,navigationType:a,lastVisibleChange:this.getLastVisibleChange()},r&&{eventType:r.type,eventTarget:r.target||void 0}),s)},l={index:n,state:"ACTIVE",cancel:c};this.observations.set(n,l);const u=e=>c("USER_INTERACTION",e),m=e=>c("NEW_NAVIGATION",e),h=e=>c("VISIBILITY_CHANGE",e);this.inViewportImageObserver.observe(),this.inViewportMutationObserver.observe(document.documentElement),window.addEventListener("pagehide",m),window.addEventListener("visibilitychange",h),window.setTimeout((()=>{window.addEventListener("click",u),window.addEventListener("keydown",u)}),0),await("complete"===document.readyState?Promise.resolve():new Promise((e=>{const t=()=>{e(),window.removeEventListener("load",t)};window.addEventListener("load",t)})));const g=await new Promise(p);if("ACTIVE"===l.state){l.state="COMPLETED";const t=Math.max(e,this.lastImageLoadTimestamp,null!==(s=null===(r=this.lastMutation)||void 0===r?void 0:r.timestamp)&&void 0!==s?s:0);this.next({start:e,end:t,duration:t-e,detail:{navigationType:a,didNetworkTimeOut:g,lastVisibleChange:this.getLastVisibleChange()}},l)}else d.debug("VisuallyCompleteCalculator: Measurement discarded","::","index =",n);window.removeEventListener("pagehide",m),window.removeEventListener("visibilitychange",h),window.removeEventListener("click",u),window.removeEventListener("keydown",u),n===this.navigationCount&&(this.inViewportImageObserver.disconnect(),this.inViewportMutationObserver.disconnect())}next(e,t){var r,s;e.end>Number.MAX_SAFE_INTEGER?d.warn("VisuallyCompleteCalculator.next()","::","This browser reported a time larger than MAX_SAFE_INTEGER. We are ignoring it.","::",e):(d.debug("VisuallyCompleteCalculator.next()","::","lastImageLoadTimestamp =",this.lastImageLoadTimestamp,"lastMutationTimestamp =",null!==(s=null===(r=this.lastMutation)||void 0===r?void 0:r.timestamp)&&void 0!==s?s:0,"::","index =",t.index),d.info("TTVC:",e,"::","index =",t.index),this.successSubscribers.forEach((t=>t(e))))}error(e,t){d.debug("VisuallyCompleteCalculator.error()","::","cancellationReason =",e.cancellationReason,"::","eventType =",e.eventType||"none","::","index =",t.index),this.errorSubscribers.forEach((t=>t(e)))}getLastVisibleChange(){var e,t;return this.lastImageLoadTimestamp>(null!==(t=null===(e=this.lastMutation)||void 0===e?void 0:e.timestamp)&&void 0!==t?t:0)?this.lastImageLoadTarget:this.lastMutation}}let b;let E;const T=h().incrementAjaxCount,S=h().decrementAjaxCount,_=["edison:preloadCss","js:requireCssWithComponent","js:require_css","ensemble","css-modules"],P=["css-modules"];function y(e,t,r){if(r[t].length>0){if(P.includes(t)){const s=r[t];for(let t=0;t<s.length;t++){const{elem:r,path:n}=s[t];if(n>e.path)return[r,t]}}return[r[t][r[t].length-1].elem.nextElementSibling,null]}const s=_.indexOf(t);for(let e=s-1;e>=0;e--){const t=r[_[e]]||[];if(t.length>0)return[t[t.length-1].elem.nextElementSibling,null]}for(let e=s+1;e<_.length;e++){const t=r[_[e]]||[];if(t.length>0)return[t[0].elem,null]}return[null,null]}function C(e,t,r,s,n){e.elem.setAttribute("data-loader",t),e.elem instanceof HTMLStyleElement&&e.elem.setAttribute("path",e.path);let i=null,a=null;if(!n){if(P.includes(t)&&function(e,t,r){if(r.hasOwnProperty(t)&&null!=r[t]&&r[t].length>0)return r[t].map((({path:e})=>e)).includes(e.path);return!1}(e,t,r))return!1;[i,a]=y(e,t,r)}return null===a?r[t].push(e):r[t].splice(a,0,e),i?s.insertBefore(e.elem,i):s.appendChild(e.elem),!0}function I(e,t,r=document){const s=r.defaultView;s.__injectCssCache||(s.__injectCssCache=function(){const e={};for(const t of["edison:preloadCss","js:require_css","js:requireCssWithComponent","ensemble","css-modules"])e[t]=[];return e}());const n=s.__injectCssCache;n[t]=n[t]?n[t]:[];const i=P.includes(t);if(!i&&e.length>1){const[s]=y(e[0],t,n),a=r.createDocumentFragment();let o=0;for(const r of e){C(r,t,n,a,!i)&&o++}return null===s?r.head.appendChild(a):r.head.insertBefore(a,s),o}{let s=0;for(const i of e){C(i,t,n,r.head,!1)&&s++}return s}}function M(e){try{const t=new URL(e);return t.pathname?decodeURIComponent(t.pathname):""}catch(e){return""}}function L(e=document){const t=R(e),r=e.querySelectorAll('link[rel="stylesheet"]');for(let e=0;e<r.length;e++){let s=M(r[e].href);null==t.already_loaded_css_paths[s]&&(t.loaded_css[s]=Promise.resolve(),t.already_loaded_css_paths[s]="loaded")}}function R(e){const t=e;return t._cssCache||(t._cssCache={loaded_css:Object.create(null),already_loaded_css_paths:Object.create(null)}),t._cssCache}function O(e,t,r,s){const n=r.pathname;let i=t.loaded_css[n];return i||(i=new Promise(((i,a)=>{const o=e.createElement("link");return o.href=r.toString(),o.rel="stylesheet",o.type="text/css",o.crossOrigin="anonymous",o.onload=function(){return t.already_loaded_css_paths[n]="loaded",i()},o.onerror=a,I([{elem:o,path:r.pathname}],s,e),o})),t.loaded_css[n]=i,t.already_loaded_css_paths[n]="downloading"),i}var k,A;function x(){const e=window.performance?window.performance.now():0;return Math.floor(e)}function N(){const e={};return"number"==typeof window.EDISON_METRICS_JS_EXECUTION_START&&(e[k.JsExecutionStart]=window.EDISON_METRICS_JS_EXECUTION_START),"number"==typeof window.EDISON_METRICS_REQUIRE_LOAD_CALLBACK_TIME&&(e[k.RequireLoadCallbackTime]=window.EDISON_METRICS_REQUIRE_LOAD_CALLBACK_TIME),"number"==typeof window.EDISON_METRICS_INIT_PAGE_MODULE_LOAD_TIME&&(e[k.InitPageModuleLoadTime]=window.EDISON_METRICS_INIT_PAGE_MODULE_LOAD_TIME),"number"==typeof window.EDISON_METRICS_PRELOAD_MODULES_LOAD_TIME&&(e[k.PreloadModulesLoadTime]=window.EDISON_METRICS_PRELOAD_MODULES_LOAD_TIME),e}L(),function(e){e.JsExecutionStart="js_execution_start",e.RequireLoadCallbackTime="require_load_callback_time",e.InitPageModuleLoadTime="init_page_module_load_time",e.PreloadModulesLoadTime="preload_modules_load_time",e.InitReceived="init_received",e.RenderStarted="render_started",e.RenderComplete="render_complete",e.FirstDataModuleReceived="first_data_module_received",e.LastDataModuleReceived="last_data_module_received",e.FirstCssPreloadReceived="first_css_preload_received",e.LastCssPreloadReceived="last_css_preload_received",e.ServerSidePrefetchStartedReceived="server_side_prefetch_started_received",e.DoneStreamingReceived="done_streaming_received",e.StreamedPrefetchWaitTime="streamed_prefetch_wait_time"}(k||(k={})),function(e){e.PageLoadComplete="page_load_complete",e.ErrorPageShown="error_page_shown"}(A||(A={}));class D{constructor(e){this.AMP_NAMESPACE="web_timing",this.marked={};const{atlasservlet:t,pageName:r,performanceNow:s=x,getLazyMetricsReporter:n}=e;this.atlasservlet=t,this.pageName=r,this.performanceNow=s,this.lazyMetricsReporter=n?n():null;let i=()=>{};this.renderCompletePromise=new Promise((e=>{i=e})),this.renderCompleteResolveFn=i,this.eventTimings={},this.streamedPrefetchRequestTimingQueues={},this.streamedPrefetchResponseTimings={}}recordEventTime(e){this.eventTimings[e]=this.performanceNow()}recordEventTimeOnce(e){this.eventTimings[e]||this.recordEventTime(e)}getTags(e){return{atlasservlet:this.atlasservlet,edison_page_name:this.pageName,...e}}recordInitReceived(){this.recordEventTimeOnce(k.InitReceived)}recordRenderStarted(){this.recordEventTimeOnce(k.RenderStarted)}recordRenderComplete(){this.recordEventTimeOnce(k.RenderComplete),this.renderCompleteResolveFn()}recordDataModuleReceived(){this.recordEventTimeOnce(k.FirstDataModuleReceived),this.recordEventTime(k.LastDataModuleReceived)}recordCssPreloadReceived(){this.recordEventTimeOnce(k.FirstCssPreloadReceived),this.recordEventTime(k.LastCssPreloadReceived)}recordServerSidePrefetchStartedReceived(){this.recordEventTimeOnce(k.ServerSidePrefetchStartedReceived)}recordDoneStreamingReceived(){this.recordEventTimeOnce(k.DoneStreamingReceived)}async saveEventTimings(){if(!this.lazyMetricsReporter)return;await this.renderCompletePromise;const e=await this.lazyMetricsReporter,t={...N(),...this.eventTimings};for(const[s,n]of Object.entries(t)){const t=this.getTags();e.createStats({ns:this.AMP_NAMESPACE,name:`edison/${s}`},t).recordDuration(n,r.TimeUnit.MILLISECONDS)}}async recordStreamedPrefetchRequestTime(e,t){this.streamedPrefetchRequestTimingQueues[e]||(this.streamedPrefetchRequestTimingQueues[e]=[]),this.streamedPrefetchRequestTimingQueues[e].push({loggingIdentifier:t,requestTime:this.performanceNow(),processed:!1}),await this.flushPrefetchTimingRecordQueue()}async recordStreamedPrefetchResponseTime(e,t){this.streamedPrefetchResponseTimings[e]||(this.streamedPrefetchResponseTimings[e]={responseTime:this.performanceNow(),failed:t},await this.flushPrefetchTimingRecordQueue())}markPageLoadSuccess(){this.recordPageMarker(A.PageLoadComplete,{result:"success"})}markPageLoadFailed(){this.recordPageMarker(A.PageLoadComplete,{result:"error"})}markErrorPageShown(){const e=!!this.marked[A.PageLoadComplete];e||this.markPageLoadFailed(),this.recordPageMarker(A.ErrorPageShown,{page_load_completed:e.toString()})}async recordPageMarker(e,t={}){try{const s=await this.lazyMetricsReporter;if(this.marked[e])return;const n=null==s?void 0:s.createCounter({ns:this.AMP_NAMESPACE,name:`edison/page/${e}`},this.getTags({browser:r.getBrowserShortName(),source:r.is_mobile_or_tablet()?"mobile":"web",...t}));null==n||n.increment(),null==n||n.record(),this.marked[e]=!0}catch{console.error("Fail to record page event: ",e)}}async flushPrefetchTimingRecordQueue(){if(!this.lazyMetricsReporter)return;const e=await this.lazyMetricsReporter,t={};for(const[s,n]of Object.entries(this.streamedPrefetchRequestTimingQueues)){const i=this.streamedPrefetchResponseTimings[s];if(i)for(const s of n){const{loggingIdentifier:n,requestTime:a}=s,{responseTime:o,failed:d}=i;if(t[n]||(t[n]=0),t[n]++,s.processed)continue;const c=`${n}_${t[n]}`,l=this.getTags({prefetch_id:c,failed:`${d}`}),u=e.createStats({ns:this.AMP_NAMESPACE,name:`edison/${k.StreamedPrefetchWaitTime}`},l),m=Math.max(o-a,0);if(u.recordDuration(m,r.TimeUnit.MILLISECONDS),s.processed=!0,window.performance)try{window.performance.measure(`edison:${k.StreamedPrefetchWaitTime}:${n}`,{start:0,end:o,detail:{prefetchId:c}})}catch(e){}}}}}class q extends s.Message{constructor(e){super(),this.originalUrl="",this.currentUrl="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new q).fromBinary(e,t)}static fromJson(e,t){return(new q).fromJson(e,t)}static fromJsonString(e,t){return(new q).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(q,e,t)}}q.runtime=s.proto3,q.typeName="edison.prefetch.PrefetchArgs",q.fields=s.proto3.util.newFieldList((()=>[{no:10,name:"original_url",kind:"scalar",T:9},{no:11,name:"current_url",kind:"scalar",T:9}]));class j extends s.Message{constructor(e){super(),this.type={case:void 0},s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new j).fromBinary(e,t)}static fromJson(e,t){return(new j).fromJson(e,t)}static fromJsonString(e,t){return(new j).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(j,e,t)}}j.runtime=s.proto3,j.typeName="edison.prefetch.Prefetch",j.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"pending",kind:"message",T:J,oneof:"type"},{no:2,name:"result",kind:"message",T:B,oneof:"type"}]));class J extends s.Message{constructor(e){super(),this.requestKeys=[],s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new J).fromBinary(e,t)}static fromJson(e,t){return(new J).fromJson(e,t)}static fromJsonString(e,t){return(new J).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(J,e,t)}}J.runtime=s.proto3,J.typeName="edison.prefetch.Prefetch.Pending",J.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"request_keys",kind:"scalar",T:9,repeated:!0}]));class B extends s.Message{constructor(e){super(),this.requestKey="",this.response=new Uint8Array(0),this.error="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new B).fromBinary(e,t)}static fromJson(e,t){return(new B).fromJson(e,t)}static fromJsonString(e,t){return(new B).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(B,e,t)}}B.runtime=s.proto3,B.typeName="edison.prefetch.Prefetch.Result",B.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"request_key",kind:"scalar",T:9},{no:2,name:"response",kind:"scalar",T:12},{no:3,name:"error",kind:"scalar",T:9}]));const F={typeName:"edison.prefetch.PrefetchService",methods:{streamPrefetches:{name:"StreamPrefetches",I:q,O:j,kind:n.MethodKind.ServerStreaming}}};class U extends s.Message{constructor(e){super(),this.isFromOfficeIp=!1,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new U).fromBinary(e,t)}static fromJson(e,t){return(new U).fromJson(e,t)}static fromJsonString(e,t){return(new U).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(U,e,t)}}U.runtime=s.proto3,U.typeName="edison_dws2.PrefetchArguments",U.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"is_from_office_ip",kind:"scalar",T:8},{no:2,name:"proto_arguments",kind:"message",T:s.Any}]));class V extends s.Message{constructor(e){super(),this.rpcProxyUrl="",this.atlasservlet="",this.pageName="",this.pageLifecycle="",this.activeUserId=s.protoInt64.zero,this.activeTeamId=s.protoInt64.zero,this.authRole=0,this.authActionType=0,this.uriPath="",this.legacyController="",this.legacyAction="",this.isOfficeIp=!1,this.staticRepoRev="",this.dws2RepoRev="",this.streamingEnabled=!1,this.isBuildTimePrefetchesEnabled=!1,this.isCssPreloadEnabled=!1,this.isReactNextEnabled=!1,this.entryPointModuleName="",this.isDws2Stage=!1,this.originalUrl="",this.originalReferer="",this.prefetchVersion=0,this.isProd=!1,this.gates={},this.browserId="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new V).fromBinary(e,t)}static fromJson(e,t){return(new V).fromJson(e,t)}static fromJsonString(e,t){return(new V).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(V,e,t)}}V.runtime=s.proto3,V.typeName="edison_dws2.EdisonInitParams",V.fields=s.proto3.util.newFieldList((()=>[{no:22,name:"rpc_proxy_url",kind:"scalar",T:9},{no:2,name:"atlasservlet",kind:"scalar",T:9},{no:3,name:"page_name",kind:"scalar",T:9},{no:15,name:"page_lifecycle",kind:"scalar",T:9},{no:4,name:"active_user_id",kind:"scalar",T:4},{no:5,name:"active_team_id",kind:"scalar",T:4},{no:31,name:"auth_role",kind:"scalar",T:13},{no:32,name:"auth_action_type",kind:"scalar",T:13},{no:6,name:"uri_path",kind:"scalar",T:9},{no:9,name:"legacy_controller",kind:"scalar",T:9},{no:10,name:"legacy_action",kind:"scalar",T:9},{no:11,name:"is_office_ip",kind:"scalar",T:8},{no:12,name:"static_repo_rev",kind:"scalar",T:9},{no:13,name:"dws2_repo_rev",kind:"scalar",T:9},{no:14,name:"streaming_enabled",kind:"scalar",T:8},{no:30,name:"is_build_time_prefetches_enabled",kind:"scalar",T:8},{no:36,name:"is_css_preload_enabled",kind:"scalar",T:8},{no:39,name:"is_react_next_enabled",kind:"scalar",T:8},{no:25,name:"entry_point_module_name",kind:"scalar",T:9},{no:27,name:"is_dws2_stage",kind:"scalar",T:8},{no:28,name:"original_url",kind:"scalar",T:9},{no:29,name:"original_referer",kind:"scalar",T:9},{no:33,name:"prefetchVersion",kind:"scalar",T:5},{no:34,name:"is_prod",kind:"scalar",T:8},{no:35,name:"gates",kind:"map",K:9,V:{kind:"scalar",T:8}},{no:38,name:"browserId",kind:"scalar",T:9}]));class K extends s.Message{constructor(e){super(),this.type={case:void 0},this.b64RequestKey="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new K).fromBinary(e,t)}static fromJson(e,t){return(new K).fromJson(e,t)}static fromJsonString(e,t){return(new K).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(K,e,t)}}K.runtime=s.proto3,K.typeName="edison_dws2.EdisonRequest",K.fields=s.proto3.util.newFieldList((()=>[{no:2,name:"service_method_prefetch",kind:"message",T:W,oneof:"type"},{no:3,name:"css_preload",kind:"message",T:H,oneof:"type"},{no:5,name:"module_preload",kind:"message",T:G,oneof:"type"},{no:4,name:"b64_request_key",kind:"scalar",T:9}]));class W extends s.Message{constructor(e){super(),this.service="",this.method="",this.initialPageAtlasservlet="",this.initialPageName="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new W).fromBinary(e,t)}static fromJson(e,t){return(new W).fromJson(e,t)}static fromJsonString(e,t){return(new W).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(W,e,t)}}W.runtime=s.proto3,W.typeName="edison_dws2.EdisonRequest.ServiceMethodPrefetch",W.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"service",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"proto_arguments",kind:"message",T:s.Any},{no:5,name:"initial_page_atlasservlet",kind:"scalar",T:9},{no:6,name:"initial_page_name",kind:"scalar",T:9}]));class H extends s.Message{constructor(e){super(),this.cssPaths=[],s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new H).fromBinary(e,t)}static fromJson(e,t){return(new H).fromJson(e,t)}static fromJsonString(e,t){return(new H).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(H,e,t)}}H.runtime=s.proto3,H.typeName="edison_dws2.EdisonRequest.CssPreload",H.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"css_paths",kind:"scalar",T:9,repeated:!0}]));class G extends s.Message{constructor(e){super(),this.modulePaths=[],s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new G).fromBinary(e,t)}static fromJson(e,t){return(new G).fromJson(e,t)}static fromJsonString(e,t){return(new G).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(G,e,t)}}G.runtime=s.proto3,G.typeName="edison_dws2.EdisonRequest.ModulePreload",G.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"module_paths",kind:"scalar",T:9,repeated:!0}]));class z extends s.Message{constructor(e){super(),this.encodedProto="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new z).fromBinary(e,t)}static fromJson(e,t){return(new z).fromJson(e,t)}static fromJsonString(e,t){return(new z).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(z,e,t)}}z.runtime=s.proto3,z.typeName="edison_dws2.InitProps",z.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"encodedProto",kind:"scalar",T:9}]));class $ extends s.Message{constructor(e){super(),this.modules=[],this.yapsProject="",this.yapsDeployment="",this.atlasservlet="",this.pageName="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new $).fromBinary(e,t)}static fromJson(e,t){return(new $).fromJson(e,t)}static fromJsonString(e,t){return(new $).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals($,e,t)}}$.runtime=s.proto3,$.typeName="datamodules.DataModulesPrefetchArguments",$.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"modules",kind:"scalar",T:9,repeated:!0},{no:3,name:"yaps_project",kind:"scalar",T:9},{no:4,name:"yaps_deployment",kind:"scalar",T:9},{no:5,name:"atlasservlet",kind:"scalar",T:9},{no:6,name:"page_name",kind:"scalar",T:9}]));class Q extends s.Message{constructor(e){super(),this.type={case:void 0},s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new Q).fromBinary(e,t)}static fromJson(e,t){return(new Q).fromJson(e,t)}static fromJsonString(e,t){return(new Q).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(Q,e,t)}}Q.runtime=s.proto3,Q.typeName="datamodules.JsonOrProtoAny",Q.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"json",kind:"scalar",T:9,oneof:"type"},{no:2,name:"proto_any",kind:"message",T:s.Any,oneof:"type"}]));class X extends s.Message{constructor(e){super(),this.name="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new X).fromBinary(e,t)}static fromJson(e,t){return(new X).fromJson(e,t)}static fromJsonString(e,t){return(new X).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(X,e,t)}}X.runtime=s.proto3,X.typeName="datamodules.DataModule",X.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"data",kind:"message",T:Q}]));class Y extends s.Message{constructor(e){super(),this.dataModules=[],s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new Y).fromBinary(e,t)}static fromJson(e,t){return(new Y).fromJson(e,t)}static fromJsonString(e,t){return(new Y).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(Y,e,t)}}function Z(e){return n.assert(e.startsWith("/static/"),`'${e}' is not a /static url`),new n.URI({scheme:"https",authority:"cfl.dropboxstatic.com",path:e}).toString()}Y.runtime=s.proto3,Y.typeName="datamodules.DataModulesPrefetchData",Y.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"data_modules",kind:"message",T:X,repeated:!0}]));class ee{constructor(){this.pendingPrefetches={},this.metadataCache={},this.resultsCache={}}async get(e,t){if(this.isReady(e))return this.resultsCache[e].getter();if(!this.pendingPrefetches[e]){let r=()=>{};const s=new Promise((e=>{r=e}));this.pendingPrefetches[e]={promise:s,resolve:r},t&&(this.metadataCache[e]=t)}return await this.pendingPrefetches[e].promise,this.resultsCache[e].getter()}getMetadata(e){if(!this.metadataCache[e])throw new Error("Metadata does not exist for key");return this.metadataCache[e]}has(e){return!!this.pendingPrefetches[e]||!!this.resultsCache[e]}set(e,t){this.pendingPrefetches[e]&&(this.pendingPrefetches[e].resolve(),delete this.pendingPrefetches[e]),this.resultsCache[e]={getter:t}}delete(e){delete this.pendingPrefetches[e],delete this.metadataCache[e],delete this.resultsCache[e]}clear(){this.pendingPrefetches={},this.metadataCache={},this.resultsCache={}}listAllKeys(){return Array.from(new Set([...this.listPendingKeys(),...this.listCachedKeys()]))}listCachedKeys(){return Object.keys(this.resultsCache)}listPendingKeys(){return Object.keys(this.pendingPrefetches)}isPending(e){return!this.isReady(e)&&!!this.pendingPrefetches[e]}isReady(e){return!!this.resultsCache[e]}}class te extends Error{}var re;function se(){if("undefined"==typeof jest&&!s.isServerSide())return async()=>{const{getMetricsReporter:t}=await new Promise((function(t,r){e(["./c_src_sink_index"],t,r)})).then((function(e){return e.index_esnext}));return t()}}t.EdisonPrefetchStatus=void 0,(re=t.EdisonPrefetchStatus||(t.EdisonPrefetchStatus={}))[re.PendingStreaming=0]="PendingStreaming",re[re.PendingAjax=1]="PendingAjax",re[re.StreamedAndNotConsumed=2]="StreamedAndNotConsumed",re[re.StreamedAndConsumed=3]="StreamedAndConsumed",re[re.FetchedByAjax=4]="FetchedByAjax";class ne{setEntryInPrefetchLog(e,t,r,s){for(const n of this.prefetchLog)if(n.requestKey===e&&n.status===t)return n.status=r,void(s&&Object.assign(n,s))}constructor(){this.isDoneStreaming=!1,this.isServerSidePrefetchStarted=!1,this.streamingEnabled=!0,this.buildTimePrefetchesEnabled=!1,this.cssPreloadEnabled=!1,this.reactNextEnabled=!1,this.loadedDataModules={},this.pendingDataModulePromises={},this.pendingDataModuleResolveFns={},this.consumedPrefetches={},this.prefetchCacheMgr=new ee,this.pendingServerSidePrefetchKeys=[],this.prefetchLog=[],this.preloadedCssPaths=new Set,this.metrics=new D({atlasservlet:s.getAtlasservlet(),pageName:s.getPageName(),getLazyMetricsReporter:se()}),this.metrics.recordInitReceived()}static async waitUntilInitialized(){ne.getSingleton()}static getSingleton(){return ne.instance||(ne.instance=new ne),ne.instance}static init(){ne.getSingleton()}static reset(){ne.instance=null}static setIsStreamingEnabled(e){ne.getSingleton().streamingEnabled=e}static getIsStreamingEnabled(){return ne.getSingleton().streamingEnabled}static setIsBuildTimePrefetchesEnabled(e){ne.getSingleton().buildTimePrefetchesEnabled=e}static getIsBuildTimePrefetchesEnabled(){return ne.getSingleton().buildTimePrefetchesEnabled}static setIsCSSPreloadEnabled(e){ne.getSingleton().cssPreloadEnabled=e}static getIsCSSPreloadEnabled(){return ne.getSingleton().cssPreloadEnabled}static setIsReactNextEnabled(e){ne.getSingleton().reactNextEnabled=e}static getIsReactNextEnabled(){return ne.getSingleton().reactNextEnabled}static getPrefetchLog(){return[...ne.getSingleton().prefetchLog]}static getMetrics(){return ne.getSingleton().metrics}static getStaticRevision(){return s.getRepoRev()}static async _grpcWebAjax(e,r,i,a,o){T();try{const d=n.createEdisonGrpcWebTransport(),{message:c}=await d.unary({typeName:r},{name:i,I:a.getType(),O:o},void 0,void 0,void 0,a);return ne.getSingleton().setEntryInPrefetchLog(e,t.EdisonPrefetchStatus.PendingAjax,t.EdisonPrefetchStatus.FetchedByAjax,{failed:!1,result:s.protoBase64.enc(c.toBinary())}),c}finally{S()}}static preloadCSS(e){const t=ne.getSingleton(),r=window;if(s.isServerSide()){const n=[];for(const r of e)t.preloadedCssPaths.has(r)||(n.push(r),t.preloadedCssPaths.add(r));if(n.length>0){const e=new K({type:{case:"cssPreload",value:{cssPaths:n}}}),t=s.marshalProto(e);r.ReactserverEdisonClient.sendEdisonRequest(t)}}else{t.metrics.recordCssPreloadReceived();const r=document,s=R(r);e.forEach((e=>{O(r,s,new URL(Z(e)),"edison:preloadCss")}))}}static async _prefetch(e,r,n,i){const a=ne.getSingleton(),o=new K({type:{case:"serviceMethodPrefetch",value:{service:e,method:r,protoArguments:s.wrapInAny(n),initialPageAtlasservlet:s.getAtlasservlet(),initialPageName:s.getPageName()}}}),d=`${e}.${r}`;if(o.b64RequestKey)throw new Error("The EdisonRequest proto message parameter to prefetchHelper must not have a b64PrefetchKey set (it is computed here so we make sure it is the same between browser and streaming reactserver).");const c=s.marshalProto(o),l=a.prefetchCacheMgr.has(c);if(!s.isServedByEdisonWebServer()||!a.streamingEnabled||a.consumedPrefetches[c]||a.isServerSidePrefetchStarted&&!a.pendingServerSidePrefetchKeys.includes(c)&&!l||a.isDoneStreaming&&!l)return a.prefetchLog.push({edisonRequest:o,requestKey:c,status:t.EdisonPrefetchStatus.PendingAjax,isAjax:!0,isAfterStreaming:a.isDoneStreaming}),ne._grpcWebAjax(c,e,r,n,i);l?a.setEntryInPrefetchLog(c,t.EdisonPrefetchStatus.StreamedAndNotConsumed,t.EdisonPrefetchStatus.StreamedAndConsumed):a.prefetchLog.push({edisonRequest:o,requestKey:c,status:t.EdisonPrefetchStatus.PendingStreaming}),a.metrics.recordStreamedPrefetchRequestTime(c,d),a.consumedPrefetches[c]=!0;const u=await a.prefetchCacheMgr.get(c,{service:e,method:r,outputType:i,input:n});return"string"==typeof u?s.unmarshalProto(u,i):u}static async fetch(e,t,r){if(s.isServerSide())return new Promise((()=>{}));const n=e.methods[(i=t,i.charAt(0).toLowerCase()+i.slice(1))].O;var i;const a=s.getRequestOriginalUrl(),o=new q({originalUrl:a,currentUrl:a,...r||{}});return await this._prefetch(e.typeName,t,o,n)}static preloadJSModules(e){if(s.isServerSide()){const t=new K({type:{case:"modulePreload",value:{modulePaths:e}}}),r=s.marshalProto(t);window.ReactserverEdisonClient.sendEdisonRequest(r)}}static resetPendingPrefetches(){const e=ne.getSingleton();e.prefetchCacheMgr.listAllKeys().filter((t=>!e.consumedPrefetches[t])).forEach((r=>{e.consumedPrefetches[r]=!0,e.prefetchCacheMgr.delete(r),e.setEntryInPrefetchLog(r,t.EdisonPrefetchStatus.StreamedAndNotConsumed,t.EdisonPrefetchStatus.StreamedAndConsumed)}))}static registerStreamedPrefetch(e,r,n=!1){const i=ne.getSingleton();if(i.isDoneStreaming)throw new Error("Cannot register new streamed prefetch after marking that we are done streaming.");if(i.metrics.recordStreamedPrefetchResponseTime(e,n),i.prefetchCacheMgr.has(e))i.setEntryInPrefetchLog(e,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.StreamedAndConsumed,{result:r,failed:n,isAjax:!1,isAfterStreaming:!1});else{const a=s.unmarshalProto(e,K),o={requestKey:e,status:t.EdisonPrefetchStatus.StreamedAndNotConsumed,failed:n,result:r,isAjax:!1,isAfterStreaming:!1,edisonRequest:a};i.prefetchLog.push(o)}i.prefetchCacheMgr.set(e,(()=>{if(n)throw new te(r);return r}))}static loadDataModule(e){const t=ne.getSingleton(),r={};for(const s of e)s in t.loadedDataModules&&(r[s]=t.loadedDataModules[s]);if(Object.keys(r).length===e.length)return Promise.resolve(r);const s=e.filter((e=>!(e in t.loadedDataModules)));return ne._prefetch("data_modules.DataModules","DataModulesPrefetch",new $({modules:s}),Y).then((({dataModules:e})=>{if(e.length!==s.length)throw new Error("unexpected number of data modules in the response -- we should have received exactly "+s.length+" but instead we got "+e.length);for(const{data:t,name:s}of e){if(!t||"json"!==t.type.case||!t.type.value)throw new Error("handling data modules with protobuf return type not yet implemented");{const e=JSON.parse(t.type.value);ne.getSingleton().loadedDataModules[s]=e,r[s]=e}}return r}))}static registerStreamedDataModule(e,t,r){const s=ne.getSingleton();if(s.isDoneStreaming)throw new Error("Cannot register new streamed data modules after marking that we are done streaming.");if("proto"===t)throw new Error("handling data modules with protobuf return type not yet implemented");s.metrics.recordDataModuleReceived();const n=JSON.parse(r);if(s.pendingDataModulePromises[e]){if(!s.pendingDataModuleResolveFns[e])throw new Error(`Trying to resolve the promise for the streamed data module "${e}" but could not find resolve function in pendingDataModuleResolveFns`);s.pendingDataModuleResolveFns[e].resolve(n),delete s.pendingDataModuleResolveFns[e]}else s.pendingDataModulePromises[e]=Promise.resolve(n)}static getStreamedDataModule(e){const t=ne.getSingleton();if(!t.pendingDataModulePromises[e]){if(t.isDoneStreaming)throw new Error(`Data module "${e}" was not streamed.`);t.pendingDataModulePromises[e]=new Promise(((r,s)=>{t.pendingDataModuleResolveFns[e]={resolve:r,reject:s}}))}return t.pendingDataModulePromises[e]}static markServerSidePrefetchStarted(e){if(!Array.isArray(e))throw new Error("requestKeys must be an array");const r=ne.getSingleton();r.isServerSidePrefetchStarted=!0,r.pendingServerSidePrefetchKeys=e,r.metrics.recordServerSidePrefetchStartedReceived();r.prefetchCacheMgr.listPendingKeys().filter((t=>!e.includes(t))).forEach((async e=>{r.setEntryInPrefetchLog(e,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.PendingAjax),ne.performGrpcWebAjaxForPendingRequest(e)}))}static doneStreaming(){const e=ne.getSingleton();if(!e.isDoneStreaming){e.metrics.recordDoneStreamingReceived(),e.metrics.saveEventTimings();for(const t in e.pendingDataModuleResolveFns)if(e.pendingDataModuleResolveFns.hasOwnProperty(t)){if(t in e.loadedDataModules)throw new Error(`${t} was still pending registration by streamed inline chunks at time of "done streaming", but there already is a result for this data module being loaded already. This is an invalid state.`);e.pendingDataModuleResolveFns[t].reject(new Error("canceling data module progress: done streaming before receiving data module result")),delete e.pendingDataModuleResolveFns[t]}e.prefetchCacheMgr.listPendingKeys().forEach((async r=>{e.setEntryInPrefetchLog(r,t.EdisonPrefetchStatus.PendingStreaming,t.EdisonPrefetchStatus.PendingAjax,{isAjax:!0,isAfterStreaming:!0}),ne.performGrpcWebAjaxForPendingRequest(r)})),e.pendingServerSidePrefetchKeys=[],e.isDoneStreaming=!0}}static getPrefetchCounts(){return ne.getSingleton().prefetchLog.reduce(((e,{isAjax:t,isAfterStreaming:r})=>("boolean"==typeof t&&"boolean"==typeof r&&(r?e.numPrefetchesRequestedAfterDoneStreaming++:e.numPrefetchesRequestedBeforeDoneStreaming++,t?e.numPrefetchesByAjax++:e.numPrefetchesStreamed++),e)),{numPrefetchesRequestedAfterDoneStreaming:0,numPrefetchesRequestedBeforeDoneStreaming:0,numPrefetchesByAjax:0,numPrefetchesStreamed:0})}static async loadPrefetches(){const e=n.createEdisonGRPCWebPromiseClient(F,"/dws2/rpc/"),t=s.getRequestOriginalUrl(),r=new q({originalUrl:t,currentUrl:t}),i=new Set;try{for await(const t of e.streamPrefetches(r))if("pending"===t.type.case&&(ne.markServerSidePrefetchStarted(t.type.value.requestKeys),t.type.value.requestKeys.forEach((e=>i.add(e)))),"result"===t.type.case){const{requestKey:e,response:r,error:n}=t.type.value;i.delete(e),n?ne.registerStreamedPrefetch(e,n,!0):ne.registerStreamedPrefetch(e,s.protoBase64.enc(r),!1)}}catch(e){i.forEach((t=>{ne.registerStreamedPrefetch(t,e.toString(),!0)}))}finally{ne.doneStreaming()}}static async performGrpcWebAjaxForPendingRequest(e){const t=ne.getSingleton();if(!t.prefetchCacheMgr.has(e))throw new Error("Input request key does not match any pending prefetch request");try{const{service:r,method:s,input:n,outputType:i}=t.prefetchCacheMgr.getMetadata(e),a=await ne._grpcWebAjax(e,r,s,n,i);t.prefetchCacheMgr.set(e,(()=>a))}catch(r){t.prefetchCacheMgr.set(e,(()=>{throw r}))}}}ne.instance=null;var ie=Object.freeze({__proto__:null,Edison:ne,get EdisonPrefetchStatus(){return t.EdisonPrefetchStatus},PrefetchError:te});t.Edison=ne,t.EdisonInitParams=V,t.InitProps=z,t.PrefetchArgs=q,t.PrefetchError=te,t.decrementAjaxCount=S,t.edison_esnext=ie,t.getOrCreateCache=R,t.incrementAjaxCount=T,t.init=e=>{var t;(e=>{(null==e?void 0:e.debug)&&(o.DEBUG=e.debug),(null==e?void 0:e.idleTimeout)&&(o.IDLE_TIMEOUT=e.idleTimeout),(null==e?void 0:e.networkTimeout)&&(o.NETWORK_TIMEOUT=e.networkTimeout)})(e),d.info("init()"),b||(b=new v),E=b,t=()=>{E.start(),window.addEventListener("locationchange",(e=>{E.start(e.timeStamp)})),window.addEventListener("pageshow",(e=>{e.persisted&&E.start(e.timeStamp,!0)}))},document.prerendering?window.addEventListener("prerenderingchange",t,!0):t()},t.injectCss=I,t.loadCssWithCache=O,t.onTTVC=(e,t)=>null==E?void 0:E.onTTVC(e,t),t.rescanForMoreCssLinks=L,t.start=()=>null==E?void 0:E.start(performance.now()),t.static_url=Z}));
//# sourceMappingURL=e_edison.js-vflOaIrhr.map

//# debugId=9c517e5d-c857-3ef8-b82f-83919e9528c3