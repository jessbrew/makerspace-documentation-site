!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f82302a5-f3cf-3302-853f-3e3d446cfa89")}catch(e){}}();
define(["require","exports","./c_core_i18n","react","./e_file_viewer_static_scl_page_folder","./c_src_bolt_flows_client","./c_api_v2_routes_flows_provider","./c_api_v2_routes_folders_info_provider","./e_core_exception","./c_browse_action_logger","./c_tagging_utils","./c_tagging_data_store","./c_search_search_helpers","./c_sync_everything_redux_types","./c_flows_redux_reducer","./c_flows_redux_store","./c_flows_redux_actions","./c_flows_utils_browse_logger","./c_flows_utils_auto_folder_helpers","./c_flows_redux_selectors","./c_browse_data_selectors","./c_flows_utils_async_modal_launchers","./c_dig-icons_assets_ui-icon_line_file-history","react-dom"],(function(e,t,o,n,i,a,r,s,l,c,u,d,_,f,p,g,m,v,h,A,w,y,k,b){"use strict";function E(e){return e&&e.__esModule?e:{default:e}}function T(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(o){if("default"!==o){var n=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,n.get?n:{enumerable:!0,get:function(){return e[o]}})}})),t.default=e,Object.freeze(t)}var S=E(n),C=T(b);function F(e,t,o){const n={update_adoption_status_arg:{".tag":"update_automated_adoption_status_arg",conversion_type:e,folder_rule_action:t,do_not_show:o}};return r.GetFlowsRoutes(new i.DefaultUserApiV2Client(i.mustGetActiveUserApiV2Properties())).rpc("update_adoption_status",n,{})}i.injectInternalStyle("/static/metaserver/static/js/flows/conversions/adoption.module.out-vflavgTy9.css",(e=>"._adoptionTooltipContainer_kztpv_1{background-color:var(--color__core__primary);bottom:0;height:210px;margin-bottom:150px;margin-right:50px;padding:15px 15px 10px;position:fixed;right:0;width:220px;z-index:1000}._additionalButton_kztpv_14{margin-left:var(--spacing__unit--2)}._tooltipCloseButton_kztpv_18{margin-right:var(--spacing__unit--1);margin-top:var(--spacing__unit--1);position:absolute;right:0;top:0}@media only screen and (max-width:640px){._adoptionTooltipContainer_kztpv_1{display:none}}"));const R="_adoptionTooltipContainer_kztpv_1",x={icon:k.AutomationLine,name:"automate_current_folder",text:o.intl.formatMessage({id:"/Z33r/",defaultMessage:"Yes, automate folder"}),onClick:I((async function e(t){D();const{filePath:o,conversionArg:n,userId:a,ns_id:r}=t;if(!n)return;const{conversionType:s,folderRuleAction:l}=n;F(s,l,!1);const c=i.parent_dir(o),u=i.parentDirName(o);v.showPendingSnackbar({folderName:u,type:"add"});const d=g.getStoreForAutomations(),_=await L(n);if(!_)return void v.showErrorSnackbar({folderName:u,onRetry:()=>{e(t)},type:"generic-add"});await p.updateFolderRule({fqPath:c,actions:[{actionType:l,data:_}],enabled:!0,applyToExistingFiles:!1,trigger:p.DEFAULT_CLIENT_FOLDER_TRIGGER}).then((()=>{v.logAutoFolderEvent(i.WebUserActionLogEvent.CONFIRM_ADD_FOLDER_RULES,{user_id:a,file_nsid:r,extra:{rule_type:l,entry_point:"adoption_snackbar"}}),d.dispatch(m.addUserAutomation({actions:[{actionType:l,data:_}],inheritable:!1,fqPath:c,isEnabled:!0,nsId:r,trigger:p.DEFAULT_CLIENT_FOLDER_TRIGGER})),v.showSuccessSnackbar({folderName:u,shouldShowDashboardCta:!0,type:"add"})}),(o=>{var n;v.logAutoFolderEvent(i.WebUserActionLogEvent.CONFIRM_ADD_FOLDER_RULES,{user_id:a,file_nsid:r,extra:{rule_type:l,error:null===(n=o.error)||void 0===n?void 0:n[".tag"],entry_point:"adoption_snackbar"}}),v.showErrorSnackbar({folderName:u,onRetry:()=>{e(t)},type:"generic-add"})}))}),"automate_folder")},M={name:"show_me_how_to_automate",text:o.intl.formatMessage({id:"Y2ppp4",defaultMessage:"Show me"}),onClick:I(U,"show_me")},P={name:"do_not_show_me_this_again",text:o.intl.formatMessage({id:"g74H0b",defaultMessage:"Skip"}),onClick:I(O,"dont_show_again")};function I(e,t){return o=>{const{userId:n,conversionArg:a,ns_id:r}=o;if(!a)return;const{folderRuleAction:s,source:l}=a;c.logAutoFolderAdoptionSnackbar({user_id:n,action_source:"adoption",event_name:i.WebUserActionLogEvent.AUTOMATED_FOLDER_ADOPTION_SNACKBAR_CLICK,file_nsid:r,trigger_rule:s,snackbar_click_option:t,source:l}),e(o)}}async function U({userId:e,filePath:t,ns_id:o,conversionArg:n}){if(!n)return;const{conversionType:a,folderRuleAction:r}=n,s=i.parent_dir(t),l=await L(n);F(a,r,!1),y.asyncLaunchWorkflowBuilder({operation:"add",folderFqPath:s,surface:"browse",entryPoint:"adoption_snackbar",actionElement:"adoption_snackbar",initialActionType:r,initialActionData:l,initialScreen:"settings",initialTriggerType:"file_add"}),D()}function O({userId:e,conversionArg:t}){if(!t)return;const{conversionType:o,folderRuleAction:n}=t;F(o,n,!0),D()}function D(){i.Snackbar.close("flows-conversion-snackbar")}async function L(t){const{folderRuleAction:o,fileType:n}=t,{loadWorkflowActionUi:i}=await new Promise((function(t,o){e(["./c_workflow_builder_workflow_actions_action_ui_config"],t,o)})),a=i(o),r=null==a?void 0:a.defaultAction.data;if(r)switch(o){case"image_conversion":case"video_conversion":r.format=n}return r}const N="flows_adoption_tooltip";function z(){const e=document.getElementById(N);e&&e.remove()}const B=({outputExt:e,folderRuleAction:t,clickHandlerArgs:n})=>{const a="unzip"===t?o.intl.formatMessage({id:"7bOS9k",defaultMessage:"Automatically unzip compressed files"}):o.intl.formatMessage({id:"W0dLEK",defaultMessage:"Automatically convert files to {outputExt}s"},{outputExt:null==e?void 0:e.toUpperCase()}),r="unzip"===t?o.intl.formatMessage({id:"kLjQYK",defaultMessage:"Set up this folder to automatically unzip compressed files as they are added."}):o.intl.formatMessage({id:"r7sQQK",defaultMessage:"Set up this folder to automatically convert files to {outputExt}s as they are added."},{outputExt:null==e?void 0:e.toUpperCase()});return S.default.createElement(S.default.Fragment,null,S.default.createElement(i.Title,{size:"medium",inverse:!0},a),S.default.createElement(i.IconButton,{variant:"borderless",className:"_tooltipCloseButton_kztpv_18",inverse:!0,onClick:z},S.default.createElement(i.UIIcon,{src:i.CloseLine})),S.default.createElement(i.Text,{inverse:!0,size:"small",tagName:"p"},r),S.default.createElement(i.Button,{onClick:()=>{U(n),z()},variant:"outline",inverse:!0},o.intl.formatMessage({id:"vvt1hU",defaultMessage:"Yes, show me"})),S.default.createElement(i.Button,{className:"_additionalButton_kztpv_14",onClick:()=>{O(n),z()},variant:"transparent",inverse:!0},o.intl.formatMessage({id:"tEEvw9",defaultMessage:"Skip"})))};B.displayName="AdoptionTooltip";const W="flows-conversion-snackbar",G=268435456;async function V(e){var t;const{file:o,user:n,shareToken:s,conversionFn:l,loggingFunctions:u,conversionType:d,folderRuleAction:_,getAdoptionSnackbarProps:f,source:p,template:m,outputExt:h,asyncThresholdBytes:w}=e;i.logBrowseTTS("workflows_save_as"),u.logConvert(p);const y=w||G;if(o.bytes>y&&m)return v.updateSnackbar({variant:"sync",title:"Loading"}),void await K(o,m,p,s);j({...e,state:"saving"});try{const a=await l(o,n,s);if(a){const s=f?f(a):void 0;let l=!1;if(s&&_){const e=await function(e,t){const o={check_adoption_status_arg:{".tag":"check_automation_adoption_status_arg",conversion_type:e,folder_rule_action:t}};return r.GetFlowsRoutes(new i.DefaultUserApiV2Client(i.mustGetActiveUserApiV2Properties())).rpc("check_adoption_status",o,{})}(d,_);l="show_automation_adoption_tooltips"===(null===(t=e.check_automation_adoption_status_result)||void 0===t?void 0:t[".tag"])&&e.check_automation_adoption_status_result.show_automation_adoption_tooltips.valueOf()}if(l&&"video-home"!==p){(function(){const e=g.getStoreForAutomations().getState(),t=A.getUserExperiments(e).find((e=>e.feature===r.UI_EXPERIMENTS.ADOPTION_UI_VARIANT));return"V3_TOOLTIP"===(null==t?void 0:t.variant)})()?(j({...e,state:"success",resultPath:a}),function(e,t,o){if(!e&&"unzip"!==t||!t||!o)return;let n=document.getElementById(N);n&&n.remove(),n=document.createElement("div"),n.className=R,n.id=N,document.body.insertBefore(n,document.body.firstChild);const i=S.default.createElement(B,{outputExt:e,folderRuleAction:t,clickHandlerArgs:o});C.render(i,n)}(h,_,null==s?void 0:s.clickHandlerArgs)):(c.logAutoFolderAdoptionSnackbar({user_id:n.id,action_source:"adoption",event_name:i.WebUserActionLogEvent.AUTOMATED_FOLDER_ADOPTION_SNACKBAR_SHOW,file_nsid:o.ns_id,source:p,trigger_rule:_}),j({...e,state:"successAutomatedAdoption",resultPath:a,adoptionSnackbarProps:s}))}else j({...e,state:"success",resultPath:a})}else j({...e,state:"failGeneric"});return a}catch(t){const o=a.getConversionStateFromException(t);return void j({...e,state:o})}}function j(e){const{user:t,getStrings:n,state:a,resultPath:r,loggingFunctions:s,adoptionSnackbarProps:l,source:c}=e,u={...n(r||"",{clickableFileName:!!l,loggingFunctions:s,source:c}),open:o.intl.formatMessage({id:"+JIEsO",defaultMessage:"Open"}),close:o.intl.formatMessage({id:"In8b64",defaultMessage:"Close"}),retry:o.intl.formatMessage({id:"Y/tkCj",defaultMessage:"Try again"})},d={closeButtonText:u.close,onCloseClick:()=>s.logConvertClose(c)},_={saving:{variant:"sync",syncProgressLoop:!0},failGeneric:{variant:"fail",...d},failOverQuota:{variant:"fail",...d},failTooLarge:{variant:"fail",...d},failCorrupt:{variant:"fail",...d},failPassword:{variant:"fail",...d},failPasswordLink:{variant:"fail",...d},failRetryable:{variant:"fail",onActionClick:()=>{s.logConvertRetry(c),V(e)},...d},successAutomatedAdoption:{variant:"complete",onActionClick:()=>H(t,r,s,c),richSnackbarProps:l,...d},success:{variant:"complete",actionButtonText:u.open,onActionClick:()=>H(t,r,s,c),...d}};i.Snackbar.update(S.default.createElement(i.Snackbar,{id:W,title:u[a],..._[a]}))}function H(e,t,o,n){o.logConvertOpen(n),i.replace_location(i.preview_uri_for_fq_path(e,t))}async function K(e,t,o,n){const s=g.getStoreForAutomations();s.dispatch(m.setShouldSubscribeToBolt(!0));const l=h.mapConversionSourceToWorkflowEntrypoint(o),c=a.getFileIdentifier(e,n);let u;if(c&&c.identifier&&(u="shared_link_url"===c.identifier[".tag"]&&""!==c.identifier.shared_link_url?c.identifier.shared_link_url:void 0),i.isSharedFile(e)){s.dispatch(m.getWorkflowStepsConfig());const o=i.getActiveUserApiV2Properties(),{submitFileWorkflow:n}=a.makeMetaserverFlowsClient(new i.DefaultUserApiV2Client(o));n({template:t,file_ids:[e.file_id],shared_link_url:u},60)}else try{await p.submitFileWorkflow(t,[e.file_id],u),r.PapLogger.logSucceedSubmitManualWorkflow(l,t,1)}catch(e){r.PapLogger.logFailSubmitManualWorkflow(l,t,1,e)}}t.convertDocToImage=function(e,t,o,n){const a={file:t,format:o,dest_path:n};return r.GetFlowsRoutes(new i.DefaultUserApiV2Client(e)).rpc("convert_doc_to_image",a,{})},t.convertFileAndShowSnackbar=V,t.convertImageFormat=function(e,t,o,n){const a={file:t,format:o,dest_path:n};return r.GetFlowsRoutes(new i.DefaultUserApiV2Client(e)).rpc("convert_image_format",a,{})},t.convertSingleFileAsynchronously=K,t.convertToPdf=function(e,t,o){const n={file:t,dest_path:o};return r.GetFlowsRoutes(new i.DefaultUserApiV2Client(e)).rpc("convert_to_pdf",n,{})},t.getAdoptionSnackbarProps=function(e){const{user:t,conversionType:n,folderRuleAction:a,resultPath:r,source:s,nsId:l}=e;if(!function(e){const t=!!w.isInsideFlowsEligibleFolder(d.getStoreForBrowse().getState()),o=null!=A.getUserAutomation(i.parent_dir(e))(g.getStoreForAutomations().getState());return t&&!o}(r))return;const c={user:t,conversionType:n,folderRuleAction:a,fileType:"unzip"===a?void 0:e.fileType,source:s},u={userId:t.id,filePath:r||"",ns_id:l,conversionArg:c},_="unzip"===a?o.intl.formatMessage({id:"+Ath7j",defaultMessage:"Want to automatically unzip files by setting up an automated folder?"}):o.intl.formatMessage({id:"+9Utp7",defaultMessage:"Want to automatically save {fileType} copies by setting up an automated folder?"},{fileType:e.fileType.toUpperCase()});return{actions:[x,M,P],helperText:_,clickHandlerArgs:u}},t.mediaRemux=function(e,t,o,n){const a={file:t,dest_path:n,container:o};return r.GetFlowsRoutes(new i.DefaultUserApiV2Client(e)).rpc("media_remux",a,{})},t.unzip=function(e,t,o){const n={file:t,dest_path:o};return r.GetFlowsRoutes(new i.DefaultUserApiV2Client(e)).rpc("unzip",n,{})}}));
//# sourceMappingURL=c_flows_conversions_convert.js-vflXrsOxz.map

//# debugId=f82302a5-f3cf-3302-853f-3e3d446cfa89