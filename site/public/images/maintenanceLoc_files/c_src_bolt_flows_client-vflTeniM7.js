!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="e310481f-d44c-3e75-9263-c129a4febe74")}catch(e){}}();
define(["require","exports","react","./c_browse_models","./e_file_viewer_static_scl_page_folder","./c_action_plugins_conversion_action_conditions","./c_replay_replay_extensions","./c_unity_utils","./c_api_v2_routes_flows_provider","./c_core_i18n","./c_api_v2_routes_folders_info_provider","./c_viewer_hoc","./c_lodash"],(function(e,i,r,t,o,n,l,a,s,u,c,d,f){"use strict";function _(e){return e&&e.__esModule?e:{default:e}}var v=_(r);const p=e=>{const i=`.${o.getExtension$1(e)}`,r=l.isReplayFileTypeWithPDFAndPSD(i);let a=!1;return".pdf"===i&&e.bytes>=l.MAX_DOCUMENT_UPLOAD_SIZE&&(a=!0),!(e instanceof t.FileSharedWithMe)&&n.isLiveFile(e)&&o.isBrowseFile(e)&&!o.isEncryptedFile(e)&&!n.isInsideVaultFolder(e)&&r&&!a},S=[o.SDKPreviewSurface.BACKUP,o.SDKPreviewSurface.BROWSE,o.SDKPreviewSurface.FILE_LOCKING,o.SDKPreviewSurface.HELLOSIGN,o.SDKPreviewSurface.HOME,o.SDKPreviewSurface.INBAND_SHARE,o.SDKPreviewSurface.PHOTOS,o.SDKPreviewSurface.RECENTS,o.SDKPreviewSurface.SEARCH,o.SDKPreviewSurface.SHARED_CONTENT_LINK,o.SDKPreviewSurface.SHARED_LINK,o.SDKPreviewSurface.SHARED_COLLECTION,o.SDKPreviewSurface.STANDALONE_PREVIEW,o.SDKPreviewSurface.STARRED,o.SDKPreviewSurface.QUICK_VIEW_BROWSE,o.SDKPreviewSurface.QUICK_VIEW_SEARCH,o.SDKPreviewSurface.FSS_DESKTOP_PREVIEW],w={filterValidFile:e=>!n.isLiveFile(e)||n.isInsideVaultFolder(e)||n.isPnmLinkNodeSelected(e)?void 0:e,filterValidUser:n.filterLoggedInUser,shouldShowForPreviewSurface:n.filterSurfaceIn(S),shouldShowForPreviewType:n.alwaysShow},g=d.withViewer((e=>{const{text:i,resultPath:r,user:t,viewer:n,clickableFileName:l,loggingFunctions:a,source:s}=e;return l?v.default.createElement(o.Link,{inverse:!0,href:o.get_browse_root(n,t)+c.URI.encode_parts(r),onClick:()=>{null==a||a.logConvertOpen(s)}},i):i}));const m={generic_error:"failGeneric",permission_error:"failGeneric",unsupported_error:"failGeneric",filesystem_error:"failGeneric",filesystem_transient_error:"failRetryable",over_quota_error:"failOverQuota",riviera_permanent_error:"failGeneric",riviera_retryable_error:"failRetryable",riviera_too_large_error:"failTooLarge",riviera_source_corrupt_error:"failCorrupt",riviera_password_protected_error:"failPassword",password_protected_shared_link_error:"failPasswordLink",riviera_internal_failure_error:"failGeneric",riviera_invalid_request_error:"failGeneric",riviera_unsupported_format_error:"failGeneric",other:"failGeneric"};function y(e,i){return(o.isBrowseFile(e)||i&&i.canDownloadRoles.length>0)&&!o.isEncryptedFile(e)}function P(e){return i=>{if(1!==i.length||i[0].is_dir)return!1;const r=o.getExtension$1(i[0]);return e.includes(r)}}function E(e,i,r){const t=o.filename(e),n=o.parentDirName(e);return n?i(t,n):r(t)}const h=[o.SDKPreviewSurface.BROWSE,o.SDKPreviewSurface.FILE_LOCKING,o.SDKPreviewSurface.HELLOSIGN,o.SDKPreviewSurface.HOME,o.SDKPreviewSurface.INBAND_SHARE,o.SDKPreviewSurface.PHOTOS,o.SDKPreviewSurface.RECENTS,o.SDKPreviewSurface.SEARCH,o.SDKPreviewSurface.SHARED_CONTENT_LINK,o.SDKPreviewSurface.SHARED_LINK,o.SDKPreviewSurface.SHARED_COLLECTION,o.SDKPreviewSurface.STANDALONE_PREVIEW,o.SDKPreviewSurface.STARRED,o.SDKPreviewSurface.LOW_DISTRACTION_VIEW],D={filterValidFile:(e,i)=>{if(e&&y(e,i)&&P(s.SUPPORTED_UNZIP_EXTENSIONS)([e]))return e},filterValidUser:n.filterLoggedInUser,shouldShowForPreviewSurface:n.filterSurfaceIn(h),shouldShowForPreviewType:e=>e===o.PreviewType.Archive||e===o.PreviewType.Error};const C={};let T=null,F=0;const b=(e,i)=>{const r=()=>{T&&(T.unsubscribe(),T=null)},t=async()=>{if(T)return;const n=await s.GetFlowsRoutes(i()).rpc("get_bolt_data",void 0,{}).catch((()=>{}));if(!((null==n?void 0:n.app_id)&&n.unique_id&&n.revision&&n.token))return;const l=new o.SignedChannelState(n.app_id,n.unique_id,n.revision,n.token);T=new o.ThunderClient([l],(e=>{const i=e.map((e=>e.payloads)).reduce(((e,i)=>e.concat(i)),[]).map((e=>e.payload));for(const e of Object.values(C))e(i)}),(()=>{r(),t()}),e),T.start()};return{subscribe:e=>{const i="flows-subscription-"+F++;return C[i]=e,1===Object.keys(C).length&&t(),i},unsubscribe:e=>{delete C[e],0===Object.keys(C).length&&r()}}};let R=null;const N=()=>{return e="thunder.dropbox.com",i=()=>new o.ActiveUserApiV2Client,R||(R=b(e,i)),R;var e,i},I=e=>{var i;return(null===(i=null==e?void 0:e.headers)||void 0===i?void 0:i["x-dropbox-request-id"])||""};async function K(i){const{preprocessPayload:r,handleMultiStepNotification:t,handleSingleStepNotification:o}=await new Promise((function(i,r){e(["./c_flows_utils_notifications"],i,r)})),n=r(i);if(n.template&&n.template.length>1)t([n],(()=>{}));else{if(!n.action_type||"list_directory"===n.action_type||"transcribe_media"===n.action_type||"video_edit"===n.action_type||"video_scale"===n.action_type)return;const[{getAllowedWorkflowActions:i},{getStoreForAutomations:r},{loadWorkflowActionUi:t}]=await Promise.all([new Promise((function(i,r){e(["./c_flows_redux_selectors"],i,r)})),new Promise((function(i,r){e(["./c_flows_redux_store"],i,r)})),new Promise((function(i,r){e(["./c_workflow_builder_workflow_actions_action_ui_config"],i,r)}))]),l=i(r().getState()),a=t(n.action_type);a&&l.includes(n.action_type)&&o([n],a,(()=>{}))}}i.ResourceLink=g,i.canConvertFile=y,i.canOpenInReplay=p,i.getCloudDocExitUrl=e=>{var i,r;const t=null==e?void 0:e.previewType;if((t===o.PreviewType.SsrDoc||t===o.PreviewType.CloudDoc)&&"cloud_doc"===(null===(i=null==e?void 0:e.content)||void 0===i?void 0:i[".tag"])&&(null===(r=null==e?void 0:e.content)||void 0===r?void 0:r.exit_url))return e.content.exit_url},i.getConversionLoggingFunctions=function(e){return{logConvert:(i,r=1)=>{s.PapLogger.logInitiateFileConversion(e,r,i)},logConvertRetry:(i,r=1)=>{s.PapLogger.logSelectFileConversionRetryButton(e,r,i)},logConvertClose:(i,r=1)=>{s.PapLogger.logDimissFileConversionSnackbar(e,r,i)},logConvertOpen:i=>{s.PapLogger.logSelectFileConversionOpenButton(e,i)}}},i.getConversionStateFromException=function(e){const i=null==e?void 0:e.error;return function(e){return e&&e[".tag"]&&e[".tag"]in m}(i)?m[i[".tag"]]:"failGeneric"},i.getDefaultConversionStrings=function(e,i,r,t){const o=u.intl.formatMessage({id:"WthXj+",defaultMessage:"Couldn't save as {fileType}"},{fileType:e}),n=E(i,((e,o)=>u.intl.formatMessage({id:"jyMgWg",defaultMessage:"<a>{fileName}</a> saved to {dirName} folder"},{fileName:e,dirName:o,a:e=>v.default.createElement(g,{user:r,text:e,resultPath:i,clickableFileName:null==t?void 0:t.clickableFileName,loggingFunctions:null==t?void 0:t.loggingFunctions,source:null==t?void 0:t.source})})),(e=>u.intl.formatMessage({id:"ukwwi2",defaultMessage:"{fileName} saved to your main Dropbox folder"},{fileName:e})));return{saving:u.intl.formatMessage({id:"Bdb4J5",defaultMessage:"Saving {fileType}..."},{fileType:e}),success:n,successAutomatedAdoption:n,failGeneric:o,failRetryable:o,failOverQuota:u.intl.formatMessage({id:"QP2WHb",defaultMessage:"Couldn't save as {fileType} because your Dropbox account is out of space"},{fileType:e}),failTooLarge:u.intl.formatMessage({id:"cmnQAC",defaultMessage:"Couldn't save as {fileType} because the file is too large"},{fileType:e}),failCorrupt:u.intl.formatMessage({id:"INKSmo",defaultMessage:"Couldn't save as {fileType} because the file is damaged"},{fileType:e}),failPassword:u.intl.formatMessage({id:"dnnNdt",defaultMessage:"Couldn't save as {fileType} because the file is password protected"},{fileType:e}),failPasswordLink:u.intl.formatMessage({id:"qzTamN",defaultMessage:"Couldn't save as {fileType} because the file was shared using a password-protected link"},{fileType:e})}},i.getFileIdentifier=function(e,i){return o.isBrowseFile(e)||(null==i?void 0:i.linkType)===o.SharedLinkType.Content?{identifier:{file_id:e.file_id,".tag":"file_id"}}:{identifier:{shared_link_url:e.href?e.href:"",".tag":"shared_link_url"}}},i.getSuccessString=E,i.makeMetaserverFlowsClient=e=>{return i=N(),r=e,t=K,{submitFileWorkflow:async(e,o)=>{var n,l,a;const u=null===(a=null===(l=null===(n=e.template)||void 0===n?void 0:n.sequence)||void 0===l?void 0:l[0].workflow_action)||void 0===a?void 0:a[".tag"];if(!u)throw new Error("Unknown operation");let c;const d=Date.now(),f=window.setTimeout((()=>{_({status:"error",error:"timeout",errorReason:"timeout",timeToStartRecieved:c})}),1e3*o);let _;const v=new Promise((e=>{_=i=>{window.clearTimeout(f),e(i)}}));return i.subscribe((e=>{e.forEach((e=>{var i;if((null==(i=e)?void 0:i.revkey)&&i.action_type&&i.status&&e.action_type===u){if(t(e),"start"===e.status)return void(c=Date.now()-d);"fail"===e.status?_({status:"error",error:"failure",errorReason:e.exit_reason,timeToStartRecieved:c}):"success"===e.status&&_({status:"success",createdFqPath:e.created_fq_path})}}))})),await s.GetFlowsRoutes(r).rpc("submit_file_workflow",e,{}).catch((e=>{var i,r;const t=(null===(i=null==e?void 0:e.error)||void 0===i?void 0:i[".tag"])||(null===(r=null==e?void 0:e.raw)||void 0===r?void 0:r.status)||"";_({status:"error",error:"failed_to_submit",requestId:I(e),errorReason:t,timeToStartRecieved:c})})),await v}};var i,r,t},i.multiFileWithExtensionSelector=function(e){return i=>!(i.length<1||i.some((e=>e.is_dir)))&&i.every((i=>e.includes(o.getExtension$1(i))))},i.openInActionConditions=w,i.singleFileWithExtensionAndResolutionSelector=function(e,i){return(r,t,n)=>{if(1!==r.length||r[0].is_dir)return!1;const l=o.getExtension$1(r[0]),a="video"===(null==n?void 0:n[".tag"])?n.resolution_height:void 0,s="video"===(null==n?void 0:n[".tag"])?n.resolution_width:void 0;return!!(e.includes(l)&&i&&a&&s&&i<Math.min(a,s))}},i.singleFileWithExtensionSelector=P,i.strictMultiFileWithExtensionSelector=function(e){return i=>!(i.length<=1||i.some((e=>e.is_dir)))&&i.every((i=>e.includes(o.getExtension$1(i))))},i.unzipActionConditions=D,i.useLogExposure=(e,i,r)=>{const t=(e=>{const{optionalIOClients:{stormcrowClient:i}}=o.useFileViewerContext();return v.default.useMemo((()=>f.lodashExports.once((r=>{i&&"OFF"!==r&&i.logStormcrowExposure(e,r)}))),[e,i])})(e);v.default.useEffect((()=>{r&&t(i)}),[r,t])},i.usePrintCallback=()=>{const{optionalIOClients:{printClient:e}}=o.useFileViewerContext(),i=function(){var e,i;const r=o.useRootPreviewMetadata();if(!r)return"";const{content:t}=r;return"image"===(null==t?void 0:t[".tag"])?null!==(e=null==t?void 0:t.full_size_src)&&void 0!==e?e:"":"ssr_doc"===(null==t?void 0:t[".tag"])&&null!==(i=null==t?void 0:t.autoprint_url)&&void 0!==i?i:""}(),r=o.useRootPreviewType();return v.default.useMemo((()=>()=>{i&&(null==e||e.print(i,r))}),[r,e,i])},i.useReplayActionHandler=e=>v.default.useMemo((()=>e instanceof t.FileSharedWithMe||!p(e)?void 0:()=>(e=>{o.UDCL.logEvent({class:"navigation",action:"navigate_to",object:"replay",properties:{actionElement:"preview_titlebar",actionSurface:"previews",destinationSurface:"replay_preview"}});const i=e?`https://replay.dropbox.com/project/creating/${e.file_id}?creationSource=dropbox_previews_open_in_menu`:"https://replay.dropbox.com/?login=true";window.open(i)})(e)),[e]),i.useUnity=(e,i,r)=>{const[t,o]=v.default.useState(),n=v.default.useCallback((()=>{o({local_path:null,resolved_local_path:null,can_open_directly:!1,is_locally_available:!1,is_infinite_placeholder:!1,open_application_identifier:null,open_application_name:null,path_is_dir:!1,error_message:null})}),[]);return v.default.useEffect((()=>{r||a.UnityHelpers.getUnityFileInfoIfAppropriate(e,i,o,n)}),[n,e,i,r]),t}}));
//# sourceMappingURL=c_src_bolt_flows_client.js-vflomK9Pc.map

//# debugId=e310481f-d44c-3e75-9263-c129a4febe74