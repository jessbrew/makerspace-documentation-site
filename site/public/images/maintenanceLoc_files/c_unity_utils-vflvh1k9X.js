!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="30d8192d-1b7b-36f5-8b0f-e0ea93050bc9")}catch(e){}}();
define(["exports","./c_core_i18n","./c_extensions_open_button_types","./c_extensions_client","./e_file_viewer_static_scl_page_folder","./c_api_v2_routes_password_confirmation_provider","./c_pap-events_docsend_view_docsend_hub_entry_button","./c_api_v2_routes_folders_info_provider","./c_lodash","./c_core_notify","./c_browse_models"],(function(e,t,n,s,i,_,o,r,a,l,c){"use strict";const d={0:{displayName:t.intl.formatMessage({id:"wYkgel",defaultMessage:"DEFAULT"})},1:{displayName:t.intl.formatMessage({id:"EMXHTJ",defaultMessage:"Send for signature"}),developerDescription:t.intl.formatMessage({id:"EMXHTJ",defaultMessage:"Send for signature"})},2:{displayName:t.intl.formatMessage({id:"aIQiHy",defaultMessage:"PDF Editing"}),developerDescription:t.intl.formatMessage({id:"fG5ZbA",defaultMessage:"PDF editing"})},3:{displayName:t.intl.formatMessage({id:"e6EJBF",defaultMessage:"View or Edit"}),developerDescription:t.intl.formatMessage({id:"p+tBI0",defaultMessage:"View or edit"})},4:{displayName:t.intl.formatMessage({id:"gN/zWT",defaultMessage:"Image Editing"}),developerDescription:t.intl.formatMessage({id:"KQT2xh",defaultMessage:"Image editing"})},5:{displayName:t.intl.formatMessage({id:"miE3lp",defaultMessage:"Video comment"}),developerDescription:t.intl.formatMessage({id:"miE3lp",defaultMessage:"Video comment"})},6:{displayName:t.intl.formatMessage({id:"Mcwc+5",defaultMessage:"Send fax"}),developerDescription:t.intl.formatMessage({id:"Mcwc+5",defaultMessage:"Send fax"})},8:{displayName:t.intl.formatMessage({id:"UwFkjc",defaultMessage:"Edit"}),developerDescription:t.intl.formatMessage({id:"RBrgq4",defaultMessage:"Video Editing"})},9:{displayName:t.intl.formatMessage({id:"Ufb68N",defaultMessage:"Send with"}),developerDescription:t.intl.formatMessage({id:"tBDUcB",defaultMessage:"Send Files"})},10:{displayName:t.intl.formatMessage({id:"sDGta5",defaultMessage:"Cloud Editors"}),developerDescription:t.intl.formatMessage({id:"sDGta5",defaultMessage:"Cloud Editors"})},11:{displayName:t.intl.formatMessage({id:"gffk/L",defaultMessage:"Send to notary"}),developerDescription:t.intl.formatMessage({id:"O/A0V6",defaultMessage:"Notarize"})},12:{displayName:t.intl.formatMessage({id:"oNuOaL",defaultMessage:"Expense"}),developerDescription:t.intl.formatMessage({id:"oNuOaL",defaultMessage:"Expense"})},13:{displayName:t.intl.formatMessage({id:"VlZABW",defaultMessage:"Publish"}),developerDescription:t.intl.formatMessage({id:"itZX4g",defaultMessage:"Publish Video"})},14:{displayName:t.intl.formatMessage({id:"E0v6mC",defaultMessage:"Share with"}),developerDescription:t.intl.formatMessage({id:"uukIVm",defaultMessage:"Share a file"})}};var h,u,p;function E(e,t,n){e&&e.event(t,n)}function f(e){return e.link_state[".tag"].indexOf("_linked")>=0}function N(e,t){if(e.priority&&t.priority){const n=t.priority-e.priority;return 0!==n?n:e.description<t.description?-1:e.description>t.description?1:0}return e.priority?-1:t.priority?1:e.description<t.description?-1:e.description>t.description?1:0}!function(e){function t(e){return d[e]||null}e.DEFAULT=0,e.ESIGNATURE=1,e.PDF_EDITING=2,e.VIEW_OR_EDIT=3,e.IMAGE_EDITING=4,e.VIDEO_COMMENT=5,e.SEND_FAX=6,e.OPEN_WITH_CLOUD_DOC=7,e.VIDEO_EDITING=8,e.SEND_WITH=9,e.CLOUD_EDITORS=10,e.SEND_TO_NOTARY=11,e.EXPENSE=12,e.PUBLISH=13,e.SHARE_WITH=14,e.getDisplayName=function(e){const n=t(e);return n&&n.displayName},e.getDeveloperDescription=function(e){const n=t(e);return n&&n.developerDescription||null}}(h||(h={})),function(e){e.CONNECTION_TIMEOUT="connection_timeout",e.CONNECTION_CLOSED="connection_closed",e.COULD_NOT_SEND="could_not_send",e.UNEXPECTED_ERROR="unexpected_error"}(u||(u={})),function(e){e[e.LATEST=16]="LATEST",e[e.INITIAL_UNITY=1]="INITIAL_UNITY",e[e.UNITY_HANDSHAKE=2]="UNITY_HANDSHAKE",e[e.REUNITY=3]="REUNITY",e[e.OPEN_IN_FILE_BROWSER=4]="OPEN_IN_FILE_BROWSER",e[e.CHECK_FILE_RETURNS_OBJ=5]="CHECK_FILE_RETURNS_OBJ",e[e.PERMISSION_LEVELS=6]="PERMISSION_LEVELS",e[e.WEB_DESTINY=7]="WEB_DESTINY",e[e.WEB_DESTINY_V2=8]="WEB_DESTINY_V2",e[e.PORT_CHECK=9]="PORT_CHECK",e[e.CHIME_OPEN=10]="CHIME_OPEN",e[e.OPEN_COLLAB_BROWSE=16]="OPEN_COLLAB_BROWSE"}(p||(p={}));var I=p;function S(e){var t,n,s;const _=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/unity_connection_log",o=null!==(n=null==e?void 0:e.routeParams)&&void 0!==n?n:{},r=null!==(s=null==e?void 0:e.base)&&void 0!==s?s:window.location.origin;return new i.AjaxURL(i.replacePattern(_,o),r)}function g(e){var t,n,s;const _=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/unity_open_log",o=null!==(n=null==e?void 0:e.routeParams)&&void 0!==n?n:{},r=null!==(s=null==e?void 0:e.base)&&void 0!==s?s:window.location.origin;return new i.AjaxURL(i.replacePattern(_,o),r)}class O{constructor(){this._data={logging_source:"web",web_unity_version:I.LATEST}}update(e){return this._data={...this._data,...e},this._data}report_event(e,t={}){this._data.event_name=e,this._data.local_ts=(new Date).getTime()/1e3,this._data.extra=JSON.stringify({...t,user_id:t.user_id||_.getActiveUserId()}),i.SilentBackgroundRequest$2({url:S(),data:this._data})}get_log_data_for_client(){return{web_unity_version:this._data.web_unity_version,user_agent:window.navigator.userAgent}}unity_session_id(){return this._data.unity_session_id}}const m={canUnityConnect:()=>m.canBrowserSupportNonSecureWebsocket(),canBrowserSupportNonSecureWebsocket(){const e=parseInt(o.version,10);return!!(o.safari&&e<9)||(!!(o.mozilla&&e>=55)||(!!(o.chrome&&e>=53)||!!o.edgeChromium()))}},v={create(e){const t=new O;return m.canUnityConnect()&&t.report_event("using_default_web_socket"),new WebSocket(e)},web_sockets_supported:()=>m.canUnityConnect()};function y(e){var t,n,s;const _=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/retrieve_unity_nonce",o=null!==(n=null==e?void 0:e.routeParams)&&void 0!==n?n:{},r=null!==(s=null==e?void 0:e.base)&&void 0!==s?s:window.location.origin;return new i.AjaxURL(i.replacePattern(_,o),r)}var w,R,k;!function(e){e.CONNECTION_OPENED="CONNECTION_OPENED",e.VERSION_CHECK="VERSION_CHECK",e.FETCHING_NONCE="FETCHING_NONCE",e.NONCE_RETURNED_TO_CLIENT="NONCE_RETURNED_TO_CLIENT",e.HANDSHAKE_COMPLETED="HANDSHAKE_COMPLETED"}(w||(w={})),function(e){e.PENDING="PENDING",e.ESTABLISHED="ESTABLISHED",e.CLOSED="CLOSED",e.RETRYING="RETRYING"}(R||(R={})),function(e){e.SECURE_PERMISSION="secure",e.INSECURE_WEB_PERMISSION="insecure_web",e.INSECURE_CLIENT_PERMISSION="insecure_client",e.INSECURE_PERMISSION="insecure"}(k||(k={}));class C{constructor(){this.client_version=null,this.logger=new O,this._on_open_callbacks=[],this._on_open_failed_callbacks=[],this._on_close_callbacks=[],this._pending_callbacks=[],this._response_callbacks={},this._webSocket=null,this._port=null,this._active_ports={},this._connection_state=R.PENDING,this._current_message_id=1,this._permission_level=null,this._on_close=e=>t=>{[1e3,1001,1005,1006].includes(t.code)||this.logger.report_event("unity_failure",{message:`WebSocket closed. Code: ${t.code}. Reason: ${t.reason}`,port:e}),this._close_port(e)},this._on_error=e=>t=>{this.logger.report_event("unity_failure",{message:"WebSocket unknown error",port:e}),this._close_port(e)},this._set_connection_state=e=>{if(e===this._connection_state)return;const t=this._connection_state;if(r.assert(t!==R.CLOSED,"Shouldn't unclose a closed connection."),this._connection_state=e,e===R.ESTABLISHED){r.assert(this._is_connection_in_progress(t),"Can only establish from pending or retrying."),this.logger.report_event("handshake_complete"),t===R.PENDING&&this._on_open_callbacks.forEach((e=>e()));const e=[];for(;this._pending_callbacks.length;){const{callback:t,error_callback:n}=this._pending_callbacks.pop();this.is_ready()?e.push(t()):e.push("function"==typeof n?n(u.UNEXPECTED_ERROR):void 0)}return e}if(e!==R.RETRYING){if(e===R.CLOSED){t===R.PENDING?(this.logger.report_event("connection_not_established"),this._on_open_failed_callbacks.forEach((e=>e()))):t===R.RETRYING?(this.logger.report_event("connection_terminated"),this._on_close_callbacks.forEach((e=>e()))):r.assert(!1,"CONNECTION_CLOSED can only be set from PENDING or RETRYING");const e=[];for(;this._pending_callbacks.length;){const{error_callback:t}=this._pending_callbacks.pop();e.push("function"==typeof t?t(u.CONNECTION_CLOSED):void 0)}return e}return r.assert(!1,"Changing connection_state to CONNECTION_PENDING not supported.")}},this._on_message=e=>t=>{const n=JSON.parse(t.data);if(n.func&&n.header&&n.header.message_id&&void 0!==n.header.should_respond)if(n.header.log_data&&this.logger.update(n.header.log_data),this.logger.update({port:e.port}),"response"===n.func)this._on_response(n.header.message_id,n.data);else{const t=this._routes[n.func];if(null==t)return void this._terminate_handshake(e.ws,"Unknown function.",{function:n.func});const s=this.is_ready()?t(n.data):t(e,n.data);n.header&&n.header.should_respond&&this.send("response",s,null,null,n.header.message_id)}else this._terminate_handshake(e.ws,"Malformed message from client.",{message:t.data})},this._on_response_timeout=e=>()=>{const{error_callback:t}=this._response_callbacks[e];delete this._response_callbacks[e],t&&t(u.CONNECTION_TIMEOUT)},this._check_unity_version=(e,t)=>{if(e.state!==w.CONNECTION_OPENED)return void this._terminate_handshake(e.ws,"Handshake version check at wrong time of protocol.");if(e.state=w.VERSION_CHECK,e.client_version=t.client_version,t.client_version<I.UNITY_HANDSHAKE)return void this._terminate_handshake(e.ws,"Client version is too old.");const n=this._web_has_auth();if(!(t.client_version<I.PERMISSION_LEVELS)||n)return this.logger.report_event("handshake_version_check"),t.client_version>=I.PERMISSION_LEVELS?this._send_with_ws(e.ws,"initiate_handshake",{secure_web:n}):this._send_with_ws(e.ws,"initiate_handshake");this._terminate_handshake(e.ws,"Client version is too old to support insecure web connections.")},this._fetch_unity_nonce=(e,t)=>{e.state===w.VERSION_CHECK?(e.state=w.FETCHING_NONCE,this.logger.report_event("handshake_fetch_nonce"),this._retrieve_unity_nonce(e,t.nonce_key)):this._terminate_handshake(e.ws,"Fetch Unity nonce at wrong time of protocol.")},this._complete_handshake=(e,t)=>{if(e.state===w.NONCE_RETURNED_TO_CLIENT&&t.is_success)if(e.state=w.HANDSHAKE_COMPLETED,this._connection_state===R.CLOSED)this._terminate_handshake(e.ws,"No more handshakes are allowed to complete.");else if(null!=this._webSocket){const t="Only one Unity handshake can succeed! There's likely a MITM attack, so close all connections.";this._terminate_handshake(e.ws,t),this._terminate_handshake(this._webSocket,t),this.client_version=null,this._webSocket=null,this._port=null,this._set_connection_state(R.CLOSED)}else this.client_version=e.client_version,this._webSocket=e.ws,this._port=e.port,this._set_connection_state(R.ESTABLISHED);else this._terminate_handshake(e.ws,"Unable to complete handshake.")},this._routes={check_unity_version:this._check_unity_version,fetch_unity_nonce:this._fetch_unity_nonce,complete_handshake:this._complete_handshake}}start(){m.canUnityConnect()?this._attempt_handshake():(this._set_connection_state(R.CLOSED),this.logger.report_event("unity_failure",{message:"WebSocket creation failed. Not able to create web socket."}))}_getWebSocketURI(e){const t={scheme:"ws",authority:`127.0.0.1:${e.toString()}`,path:"/ws"};return new r.URI(t).toString()}_attempt_handshake(){for(let e=17600;e<=17602;e++)try{this._active_ports[e]=!0;const t=v.create(this._getWebSocketURI(e));t.onmessage=this._on_message({ws:t,port:e,state:w.CONNECTION_OPENED,client_version:null,client_has_auth:null}),t.onclose=this._on_close(e),t.onerror=this._on_error(e)}catch(t){const n=t instanceof Error?t:void 0,s=(null==n?void 0:n.message)||"Unknown error";this.logger.report_event("unity_failure",{message:`WebSocket creation failed. Message: ${s}`,error_name:null==n?void 0:n.name,port:e}),this._set_connection_state(R.CLOSED)}this.logger.report_event("handshake_started")}_close_port(e){if(e in this._active_ports&&(delete this._active_ports[e],a.isEmpty(this._active_ports)))return this._connection_state===R.ESTABLISHED?this._retry_connection():this._set_connection_state(R.CLOSED)}_retry_connection(){return this.logger.report_event("connection_retrying"),this._set_connection_state(R.RETRYING),this.client_version=this._webSocket=this._port=null,this._attempt_handshake()}send(e,t=null,n=null,s=null,i=null){if(this._webSocket)return this._send_with_ws(this._webSocket,e,t,n,s,i)}_send_with_ws(e,t,n=null,s=null,i=null,_=null){if(null==_&&(_=this._current_message_id,r.assert(this._current_message_id%2==1,"Web-initiated message_ids should remain odd"),this._current_message_id+=2),null!==s){const e=window.setTimeout(this._on_response_timeout(_),5e3);this._response_callbacks[_]={response_callback:s,error_callback:i,timeout_id:e}}const o={func:t,header:{message_id:_,should_respond:null!==s,log_data:this.logger.get_log_data_for_client()}};null!=n&&(o.data=n);try{return e.send(JSON.stringify(o))}catch(e){const t=e instanceof Error?e:void 0,n=(null==t?void 0:t.message)||"Unknown error";this.logger.report_event("unity_failure",{message:`WebSocket send failed. Message: ${n}`,error_name:null==t?void 0:t.name}),i&&i(u.COULD_NOT_SEND)}}_on_response(e,t){if(e in this._response_callbacks){const{response_callback:n,timeout_id:s}=this._response_callbacks[e];delete this._response_callbacks[e],window.clearTimeout(s),n&&n(t)}}_web_has_auth(){return _.isAnyUserSignedIn()}_retrieve_unity_nonce(e,t){return i.WebRequest({url:y(),dataType:"json",data:{nonce_key:t},success:t=>{switch(t.status){case"OK":if(e.state=w.NONCE_RETURNED_TO_CLIENT,(null===e.client_version||e.client_version>=I.PORT_CHECK)&&(r.assert(t.message.client_port,`Port check must happen in version ${e.client_version}`),t.message.client_port!==e.port))return void this._terminate_handshake(e.ws,"Mismatched ports.",{client_port:t.message.client_port,web_port:e.port});e.client_has_auth=t.message.client_has_auth;const n=this._web_has_auth();return e.client_has_auth&&n?this._permission_level=C.SECURE_PERMISSION:(r.assert(null===e.client_version||e.client_version>=I.PERMISSION_LEVELS,`Insecure connections only supported by client_version >= ${I.PERMISSION_LEVELS}.`),this._permission_level=e.client_has_auth?C.INSECURE_WEB_PERMISSION:n?C.INSECURE_CLIENT_PERMISSION:C.INSECURE_PERMISSION),this.logger.update({unity_permission_level:this._permission_level}),this.logger.report_event("handshake_nonce_sent_to_unity_server"),this._send_with_ws(e.ws,"verify_unity_nonce",{nonce:t.message.nonce});case"MISMATCHED_USER_IDS":return this._terminate_handshake(e.ws,"Mismatched user_ids.",{client_user_ids:t.message.client_user_ids,web_user_ids:t.message.web_user_ids});case"INVALID":return this._terminate_handshake(e.ws,"Could not find nonce with given nonce_key.");case"AUTH_REQUIRED":return this._terminate_handshake(e.ws,"Did not have the necessary authentication to retrieve nonce.");case"LOCAL_INFORMATION_PERMISSION_REQUIRED":return this._terminate_handshake(e.ws,"Did not have permission to start a local-information-allowed connection.")}},error:(t,n,s)=>{this._terminate_handshake(e.ws,"Unable to retrieve nonce from server",{status:n,error_string:s})}})}_terminate_handshake(e,t,n={}){const s={message:t,...n};this.logger.report_event("unity_failure",s),e&&e.close()}_is_connection_in_progress(e){return e===R.PENDING||e===R.RETRYING}add_on_open_callback(e){this._on_open_callbacks.push(e)}add_on_open_failed_callback(e){this._on_open_failed_callbacks.push(e)}add_on_close_callback(e){this._on_close_callbacks.push(e)}call_when_ready(e,t=null){return this.is_ready()?e():this._is_connection_in_progress(this._connection_state)?this._pending_callbacks.push({callback:e,error_callback:t}):t?t(u.CONNECTION_CLOSED):void 0}is_ready(){return this._webSocket&&this._webSocket.readyState===WebSocket.OPEN&&this._connection_state===R.ESTABLISHED}feature_supported(e,t=[]){return r.assert(null!==this._permission_level,"Connection is not ready."),!(null!==this.client_version&&this.client_version<e)&&t.includes(this._permission_level)}isUnityServerRunning(e){return new Promise((t=>{setTimeout((()=>t(!1)),e);for(let e=17600;e<=17602;e++){const n=new WebSocket(this._getWebSocketURI(e));n.onopen=function(){n.close(),t(!0)}}}))}}C.SECURE_PERMISSION=k.SECURE_PERMISSION,C.INSECURE_WEB_PERMISSION=k.INSECURE_WEB_PERMISSION,C.INSECURE_CLIENT_PERMISSION=k.INSECURE_CLIENT_PERMISSION,C.INSECURE_PERMISSION=k.INSECURE_PERMISSION;const b=()=>v.web_sockets_supported(),T={_uc:new C,_has_handshake_started:!1,_cached_file_browser_display_name:null,_start_handshake_if_needed(){this._has_handshake_started||(this._uc.start(),this._has_handshake_started=!0)},continue_as_user(e,t,n,s=null){return this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{if(this._uc.feature_supported(I.WEB_DESTINY,[C.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("continue_as_user",{browser:e,refresh_token:t}),this._uc.send("continue_as_user",{browser:e,refresh_token:t},n,s)}),s)},continue_as_user_direct(e,t=null){return this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{if(this._uc.feature_supported(I.WEB_DESTINY_V2,[C.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("continue_as_user_direct"),this._uc.send("continue_as_user_direct",null,e,t)}),t)},web_destiny_info(e,t=null){return this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{if(this._uc.feature_supported(I.WEB_DESTINY_V2,[C.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("web_destiny_info"),this._uc.send("web_destiny_info",null,e,t)}),t)},client_supports_open_in_file_browser(){return this._uc.feature_supported(I.OPEN_IN_FILE_BROWSER,[C.SECURE_PERMISSION])},ensure_unity_ready(){return this._start_handshake_if_needed(),new Promise((e=>this._uc.call_when_ready((()=>{e(!0)}),(()=>{this._uc=new C,this._has_handshake_started=!1,e(!1)}))))},open_file(e,t,n,s,_=null,o=!1){this._start_handshake_if_needed();const a=this.server_path(e,t);return this._uc.call_when_ready((()=>{if(this._uc.feature_supported(I.UNITY_HANDSHAKE,[C.SECURE_PERMISSION])){this._uc.logger.report_event("open_file",{user_id:n,path_id:a,file_extension:i.file_extension(a),in_file_browser:o}),i.SilentBackgroundRequest$2({url:g(),data:{user_id:n,server_path:a,file_extension:i.file_extension(a),in_file_browser:o,unity_session_id:this._uc.logger.unity_session_id(),buildno:this._uc.logger._data.buildno,host_id:this._uc.logger._data.host_id}});const e={server_path:a,user_id:n};this._uc.client_version>=I.OPEN_IN_FILE_BROWSER?e.in_file_browser=o:r.assert(!o,"The connected client doesn't support opening in file browser."),this._uc.send("open_file",e,s,_)}}),_)},standard_open_file_handler(e){if(!e)return l.Notify.error(t.intl.formatMessage({id:"9HWjA9",defaultMessage:"Error opening file"}))},check_file(e,t,n,s,_=null){this._start_handshake_if_needed();const o=this.server_path(e,t),r=e=>{this._check_file_deprecated_on_client()&&(e={is_locally_available:e}),s(e)};this._uc.call_when_ready((()=>{if(this._uc.feature_supported(I.UNITY_HANDSHAKE,[C.SECURE_PERMISSION]))return this._uc.logger.report_event("check_file",{user_id:n,path_id:o,file_extension:i.file_extension(o)}),this._uc.send("check_file",{server_path:o,user_id:n},r,_)}),_)},add_on_ready_callback(e){return this._uc.call_when_ready(e)},check_file_batch(e,t,n,s=null){return new Promise(((_,o)=>{this._start_handshake_if_needed();const r=e.map((e=>this.server_path(e.ns_id,e.ns_path))),a=e=>{if(this._check_file_deprecated_on_client())for(const t in e){const n=e[t];e[t]={is_locally_available:n}}n&&n(e),_(e)},l=function(e){s&&s(e),o(e)};this._uc.call_when_ready((()=>{if(this._uc.feature_supported(I.UNITY_HANDSHAKE,[C.SECURE_PERMISSION]))return this._uc.logger.report_event("check_file_batch",{user_id:t,path_ids:r,file_extensions:r.map(i.file_extension)}),this._uc.send("check_file_batch",{server_paths:r,user_id:t},a,l)}),l)}))},file_browser_display_name(e,t=null){if(null!=this._cached_file_browser_display_name)return void e(this._cached_file_browser_display_name);const n=t=>(this._cached_file_browser_display_name=t,e(t));this._start_handshake_if_needed();return this._uc.call_when_ready((()=>this._uc.feature_supported(I.CHECK_FILE_RETURNS_OBJ,[C.SECURE_PERMISSION])?(this._uc.logger.report_event("file_browser_display_name"),this._uc.send("file_browser_display_name",null,n,t)):e(null)),t)},_check_file_deprecated_on_client(){return I.UNITY_HANDSHAKE<=this._uc.client_version&&this._uc.client_version<I.CHECK_FILE_RETURNS_OBJ},server_path:(e,t)=>`${e}:${t}`,has_chime(e,t=null){this._start_handshake_if_needed();return this._uc.call_when_ready((()=>{if(this._uc.feature_supported(I.CHIME_OPEN,[C.SECURE_PERMISSION]))return this._uc.logger.report_event("has_chime"),this._uc.send("has_chime",null,e,t)}),t)},open_chime(e,t,n=null){this._start_handshake_if_needed();return this._uc.call_when_ready((()=>{if(this._uc.feature_supported(I.CHIME_OPEN,[C.SECURE_PERMISSION]))return this._uc.logger.report_event("open_chime",{parameters:e}),this._uc.send("open_chime",e,t,n)}),n)},can_open_apollo(){return new Promise(((e,t)=>(this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{this._uc.feature_supported(I.OPEN_COLLAB_BROWSE,[C.SECURE_PERMISSION,C.INSECURE_WEB_PERMISSION])&&this._uc.send("can_open_apollo",{},e,t)}),t))))},open_apollo_main_window(){return new Promise(((e,t)=>(this._start_handshake_if_needed(),this._uc.call_when_ready((()=>{this._uc.feature_supported(I.OPEN_COLLAB_BROWSE,[C.SECURE_PERMISSION,C.INSECURE_WEB_PERMISSION])&&this._uc.send("open_apollo_main_window",{},e,t)}),t))))},isUnityServerRunning(){return this._uc.isUnityServerRunning(200)},isUnitySupported:()=>b()};b();class D{static is_cached_and_locally_available(e,t){const n=this._cache[T.server_path(e,t)];return null!=n&&n.is_locally_available}static get(e,t){return this._cache[T.server_path(e,t)]}static set(e,t){this._cache[e]=t}static set_batch(e){Object.assign(this._cache,e)}static clear(){this._cache={}}}D._cache={};let M=D;T.isUnitySupported()||(M=void 0);var U=M;function P(e,t){T.file_browser_display_name((function(n){e.file_browser_display_name=n,t(e)}),(()=>t(e)))}const L={isUnityEnabled:function(){return T.isUnitySupported()},isFileInUnityCache:function(e,t){return!!U.is_cached_and_locally_available(e,t)},clientSupportsOpenInFileBrowser:function(){return T.client_supports_open_in_file_browser()},getFileInfoFromUnityCache:function(e,t){return U.get(e,t)},fetchUnityFileInfo:function(e,t,n,s,i){T.check_file(e,t,n,(e=>{e.is_locally_available?P(e,s):s(e)}),i)},getUnityFileInfo:function(e,t,n,s,i){if(L.isFileInUnityCache(e,t)){const n=L.getFileInfoFromUnityCache(e,t);n.is_locally_available&&null==n.file_browser_display_name?P(n,s):s(n)}else L.fetchUnityFileInfo(e,t,n,s,i)},openFile:function(e,t,n,s){T.open_file(e,t,n,T.standard_open_file_handler,(()=>T.standard_open_file_handler(!1)),s)},isUnityFolderSupported:function(e){return null!=e&&(!!e.is_locally_available||!!e.is_infinite_placeholder)&&L.clientSupportsOpenInFileBrowser()},isUnityFileSupported:function(e){return null!=e&&!!e.is_locally_available&&!1!==e.can_open_directly},getUnityFileInfoIfAppropriate:function(e,t,n,s){!(e instanceof c.FileSharedWithMe)&&i.isBrowseFile(e)&&t&&L.isUnityEnabled()&&L.getUnityFileInfo(e.ns_id,e.ns_path,t.id,n,s)}};e.UnityCheckFileCache=U,e.UnityFeatures=T,e.UnityHelpers=L,e.actionCompareFn=N,e.getAppActionExtras=function(e){return{action_id:e.id,encoded_app_id:e.app_id,action_type:f(e)?"select_action":"select_connect"}},e.getOpenOptionsWithLogging=function(e,t){return e.map((e=>({...e,handler:()=>{e.handler(),E(t,"select_legacy_action",{type:e.type,userAction:e.userAction})}})))},e.handleShowByline=function(e,t){return()=>{E(t,"show_byline",{extension_id:e})}},e.isLinked=f,e.logEvent=E,e.partitionActions=function(e,t=0){const n=[],i=[],_=[],o=[],r=[];return e.sort(N).forEach((e=>{e.category===h.CLOUD_EDITORS?n.push(e):e.app_id===s.TRANSFER_FP_APP_ID?i.push(e):f(e)||function(e){return"oauth_prelinked"===e.link_state[".tag"]}(e)?_.push(e):void 0!==e.priority&&e.priority>0&&o.length<t?o.push(e):r.push(e)})),{cloudEditors:n,transferActions:i,installedActions:_,promotedActions:o,unpromotedActions:r}},e.partitionOptions=function(e){const t=[],s=[];let i,_,o,r,a,l,c,d;return e.forEach((e=>{const{type:h}=e;h===n.OpenButtonAction.UNITY_FILE||h===n.OpenButtonAction.UNITY_FOLDER?t.push(e):h===n.OpenButtonAction.OPEN_WITH||h===n.OpenButtonAction.OPEN_WITH_CLOUD_DOC?s.push(e):h===n.OpenButtonAction.DOWNLOAD?i=e:h===n.OpenButtonAction.PREVIEW_FILE?_=e:h===n.OpenButtonAction.OPEN_IN_REPLAY?o=e:h===n.OpenButtonAction.OPEN_IN_DESKTOP?r=e:h===n.OpenButtonAction.GO_TO_FOLDER?a=e:h===n.OpenButtonAction.OPEN_IN_NEW_TAB?l=e:h===n.OpenButtonAction.QUICK_VIEW?c=e:h===n.OpenButtonAction.INSTALL_DESKTOP_APP&&(d=e)})),{unityOptions:t,cloudEditorOptions:s,downloadOption:i,previewOption:_,openInReplayOption:o,openInDesktopOption:r,openInNewTabOption:l,goToFolderOption:a,openInQuickViewOption:c,openInInstallDesktopOption:d}}}));
//# sourceMappingURL=c_unity_utils.js-vflzAjDgh.map

//# debugId=30d8192d-1b7b-36f5-8b0f-e0ea93050bc9