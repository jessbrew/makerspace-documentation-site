!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3cc1fa32-a7a0-364f-95a0-5c63f6ed8201")}catch(e){}}();
define(["exports","./e_file_viewer_static_scl_page_folder","./c_file_viewer_pap_logger_utils","./c_core_logging_video","./c_extensions_open_button_types","./c_api_v2_routes_hellosign_provider","./c_pap-events_previews_delete_file","./c_src_sink_index","./c_pap-events_docsend_view_docsend_hub_entry_button","./c_api_v2_routes_password_confirmation_provider"],(function(e,t,i,o,n,r,a,c,s,l){"use strict";const p=["left","right","horizontal","vertical"];function d(e){return p.find((t=>t===(null==e?void 0:e.toLowerCase())))}const _=["save_copy_error","replace_original_error","file_load_error","too_large","too_long","too_short","over_4k","unsupported_extension","unsupported_codec"];function v(e){return _.find((t=>t===(null==e?void 0:e.toLowerCase())))}const u=["rotate","flip","crop","trim","adjust","draw","highlight","add_text"];function g(e){return u.find((t=>t===(null==e?void 0:e.toLowerCase())))}function A(e){return{class:"navigation",action:"navigate_to",object:"edit",properties:e}}function w(e){return{class:"previews",action:"cancel",object:"edit_mode",properties:e}}function S(e){return{class:"previews",action:"eng",object:"editing_error",properties:e}}function f(e){return{class:"previews",action:"preview",object:"audio_video_scrubber_thumbnails",properties:e}}function U(e){return{class:"previews",action:"save",object:"edit_mode",properties:e}}function b(e){return{class:"previews",action:"select",object:"preview_action",properties:e}}const y={"utf-8":"utf_8","utf-16le":"utf_16le","utf-16be":"utf_16be","windows-1252":"windows_1252","iso-8859-1":"iso_8859_1","iso-8859-15":"iso_8859_15",macintosh:"macintosh",ibm866:"ibm866","iso-8859-2":"iso_8859_2","iso-8859-3":"iso_8859_3","iso-8859-4":"iso_8859_4","iso-8859-5":"iso_8859_5","iso-8859-6":"iso_8859_6","iso-8859-7":"iso_8859_7","iso-8859-8":"iso_8859_8","iso-8859-8i":"iso_8859_8i","iso-8859-10":"iso_8859_10","iso-8859-13":"iso_8859_13","iso-8859-14":"iso_8859_14","iso-8859-16":"iso_8859_16","koi8-r":"koi8_r","koi8-u":"koi8_u","windows-874":"windows_874","windows-1250":"windows_1250","windows-1251":"windows_1251","windows-1253":"windows_1253","windows-1254":"windows_1254","windows-1255":"windows_1255","windows-1256":"windows_1256","windows-1257":"windows_1257","windows-1258":"windows_1258",gbk:"gbk",gb18030:"gb18030","euc-jp":"euc_jp","iso-2022-jp":"iso_2022_jp","shift-jis":"shift_jis","euc-kr":"euc_kr",big5:"big5"};var k;function E(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_ask",properties:e}}function C(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_summarize",properties:e}}e.WorkflowsEvent=void 0,(k=e.WorkflowsEvent||(e.WorkflowsEvent={})).WatermarkApplySaveAsCopy="watermark_apply_save_as_copy",k.WatermarkStart="watermark_start",k.WatermarkSuccess="watermark_success",k.WatermarkFailed="watermark_failed",k.WatermarkCancel="watermark_cancel",k.WatermarkAddImage="watermark_add_image",k.WatermarkRotate="watermark_rotate",k.WatermarkUpdatePosition="watermark_update_position",k.WatermarkUpdateColor="watermark_update_color";const m=["dropbox_sign_home_screen","dropbox_core_signature_screen","dropbox_sign_edit","dropbox_sign_recipient_email_input","docsend_content_screen","docsend_create_link_screen","capture_home_screen","screen_recording_modal","replay_home_screen","replay_preview","pdf_edit","video_edit","image_edit","pdf_edit_signature_box","ml_video_editor","watermark","dropbox_screen","backup_screen","transfer_screen","paper_screen","password_screen","dash_screen","app_center_screen","file_requests","gmail","outlook","whatsapp","facebook_workplace","line_works","dropbox_transfer","canvas","user_created_app","sign_deep_integration","browse_screen","shared_screen","deleted_files","photos_screen","third_party_app","transfer_modal","desktop_preview","web_preview","desktop_folder","text_edit","self_sign","quick_view","docsend_marketing_page","docsend_trial_start_modal","docsend_upload_modal","docsend_trial_modal","sign_home","sign_modal","sign_banner","sign_global","docsend_standalone","desktop_file","connect_more_apps","connect_apps","mobile_app","office_online","office_desktop"];function P(e){return m.find((t=>t===(null==e?void 0:e.toLowerCase())))}const T=["zoom_in","zoom_out"];function D(e){return T.find((t=>t===(null==e?void 0:e.toLowerCase())))}function L(e){return{class:"file_actions",action:"download",object:"file",properties:e}}function x(e){return{class:"navigation",action:"navigate_to",object:"sign",properties:e}}function h(e){return{class:"navigation",action:"select",object:"edit_action",properties:e}}function F(e){return{class:"pdf_edit",action:"select",object:"replace_original",properties:e}}function z(e){return{class:"pdf_edit",action:"select",object:"save_a_copy",properties:e}}function j(e){return{class:"previews",action:"edit",object:"watermark",properties:e}}function I(e){return{class:"previews",action:"next",object:"file",properties:e}}function O(e){return{class:"previews",action:"previous",object:"file",properties:e}}function R(e){return{class:"previews",action:"rename",object:"file",properties:e}}function V(e){return{class:"previews",action:"select",object:"logged_out_image_edit",properties:e}}function M(e){return{class:"previews",action:"start",object:"edit_mode",properties:e}}function W(e){return{class:"previews",action:"watermark",object:"file",properties:e}}const H=["start","success","failed","canceled","rejected"];const N=async(o,c,s)=>{const l={previousSurface:s.isPreviewAsRecipientView?"share_sender_preview":i.previewSurfaceToPreviousSurface[s.previewSurface],file:s.file};"background"===o?(async(e,o)=>{const{file:n}=o,{event:r,context:a}=e.extra,c=n.extension,s={fileType:i.getPapFileType(c),fileSize:n.size,actionElement:a,actionSurface:"video_edit",previewType:i.getPapPreviewType(n.previewType)};switch(r){case t.BackgroundEvent.EditVideoSaveSucceeded:t.UDCL.logEnd(U({...s,eventState:"success"}));break;case t.BackgroundEvent.EditVideoSaveFailed:t.UDCL.logEnd(U({...s,eventState:"failed"}))}})(c,l):"user_action"===o?((async(o,c,s=!1)=>{var l,p,_;const{previousSurface:u,file:f}=c,k=o.extra,m=k.action,T=k.context,N=f.extension,q={fileType:t.getFileTypeFromString(N),fileSize:f.size,previewType:f.previewType?i.getPapPreviewType(f.previewType):void 0,actionElement:null!==(l=k.context)&&void 0!==l?l:t.UserActionContext.PreviewTitlebar,actionSurface:null!==(p=k.actionSurface)&&void 0!==p?p:"previews",previousSurface:u,editorSessionId:null!==(_=k.editorSessionId)&&void 0!==_?_:""},B=(e,i)=>{var n;const r=null!==(n=null==i?void 0:i.key)&&void 0!==n?n:o.file_preview_session_id;t.UDCL.logStart(e,{key:r})},$=(e,i)=>{var n;const r=null!==(n=null==i?void 0:i.key)&&void 0!==n?n:o.file_preview_session_id;t.UDCL.logEnd(e,{key:r})};switch(m){case t.UserAction.EditError:t.UDCL.logEvent(S({...q,editorErrorType:v(k.errorType)}));break;case t.UserAction.EditCancel:t.UDCL.logEvent(w({...q,eventState:(J=k.eventState,H.find((e=>e===(null==J?void 0:J.toLowerCase())))),haveChanges:"true"===k.haveChanges||"false"!==k.haveChanges&&void 0}));break;case t.UserAction.EditFailure:$(U({eventState:"failed",...q}),{key:k.editorSessionId});break;case t.UserAction.EditSuccess:$(U({eventState:"success",...q}),{key:k.editorSessionId});break;case t.UserAction.EditSaveCopyCancel:$(U({eventState:"canceled",...q,actionElement:"save_a_copy"}));break;case t.UserAction.EditReplaceOriginalCancel:$(U({eventState:"canceled",...q,actionElement:"replace_original"}));break;case t.UserAction.EditReplaceOriginalClicked:B(U({eventState:"start",...q,actionElement:"replace_original"}),{key:k.editorSessionId});break;case t.UserAction.EditSaveCopyClicked:B(U({eventState:"start",...q,actionElement:"save_a_copy"}),{key:k.editorSessionId});break;case t.UserAction.EditImageAttempt:t.UDCL.logEvent(A({...q,direction:d(k.direction),entryAction:g(k.entryAction),destinationSurface:"image_edit",actionElement:t.maybeMapToPreviewTitlebar(T)}));break;case t.UserAction.FlipNext:case t.UserAction.FlipPrevious:const o=t.UserAction.FlipNext?I:O;t.UDCL.logEvent(o({eventState:"start",actionScreen:"keyboard"===k.context?k.context:u,fileSize:f.size,fileType:i.getPapFileType(N)})),t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m}));break;case t.UserAction.EditPdf:case t.UserAction.Draw:case t.UserAction.Highlight:case t.UserAction.AddText:s||t.UDCL.logEvent(A({destinationSurface:"pdf_edit",actionElement:t.maybeMapToPreviewTitlebar(T),previewType:i.getPapPreviewType(f.previewType),fileType:i.getPapFileType(N),fileSize:f.size,actionSurface:"previews",entryAction:(()=>{switch(m){case t.UserAction.Draw:case t.UserAction.Highlight:case t.UserAction.AddText:return m;default:return}})()})),t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m}));break;case t.UserAction.OpenIn:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m,destinationSurface:P(k.destination_surface)}));break;case t.UserAction.ShareToAction:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m,destinationSurface:"third_party_app",appId:k.appId}));break;case t.UserAction.SendForSignature:t.UDCL.logEvent(x({...q,destinationSurface:"dropbox_sign_edit",actionElement:t.maybeMapToPreviewTitlebar(T)})),t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m}));break;case t.UserAction.ZoomIn:case t.UserAction.ZoomOut:t.UDCL.logEvent({class:"previews",action:"zoom",object:"file",properties:{...q,eventState:"success",actionSurface:u,actionScreen:k.context,zoomType:D(k.action)}}),t.UDCL.logEvent(b({...q,previewAction:m}));break;case t.UserAction.ChangeTextEncoding:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:t.UserAction.ChangeTextEncoding,textEncoding:k.text_encoding?y[k.text_encoding]:void 0}));break;case t.UserAction.OpenDocSidebar:t.UDCL.logEvent({class:"previews",action:"open",object:"sidebar",properties:{eventState:"success",actionScreen:k.context,fileSize:f.size,fileType:i.getPapFileType(N)}});break;case t.UserAction.CloseDocSidebar:t.UDCL.logEvent(function(e){return{class:"previews",action:"close",object:"sidebar",properties:e}}({eventState:"success",actionScreen:k.context,fileSize:f.size,fileType:i.getPapFileType(N)}));break;case t.UserAction.FindInDocStart:t.UDCL.logEvent(function(e){return{class:"previews",action:"open",object:"search_box",properties:e}}({eventState:"start",actionScreen:k.context,fileSize:f.size,fileType:i.getPapFileType(N)}));break;case t.UserAction.DownloadStart:B(L({...q,eventState:"start",actionSurface:u,actionElement:T}));break;case t.UserAction.DownloadFailed:$(L({...q,eventState:"failed",actionSurface:u}));break;case t.UserAction.DownloadSuccess:$(L({...q,eventState:"success",actionSurface:u}));break;case t.UserAction.OpenInMenu:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:t.UserAction.OpenIn}));break;case t.UserAction.OpenSendForSignature:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"add_signatures_menu",properties:e}}(q));break;case t.UserAction.OpenActionBarOverflow:t.UDCL.logEvent(function(e){return{class:"navigation",action:"select",object:"action_bar_overflow_menu",properties:e}}({actionSurface:u})),s&&t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:"click_overflow_menu"}));break;case t.UserAction.DeleteStart:B(a.PAP_Delete_File({...q,eventState:"start",actionSurface:u}));break;case t.UserAction.DeleteSuccess:$(a.PAP_Delete_File({...q,eventState:"success",actionSurface:u}));break;case t.UserAction.DeleteFailed:case t.UserAction.DeleteFailedNoPermission:$(a.PAP_Delete_File({...q,eventState:"failed",actionSurface:u}));break;case t.UserAction.DeleteCancel:$(a.PAP_Delete_File({...q,eventState:"canceled",actionSurface:u}));break;case t.UserAction.RenameStart:B(R({...q,eventState:"start",actionSurface:u}));break;case t.UserAction.RenameFailed:$(R({...q,eventState:"failed",actionSurface:u}));break;case t.UserAction.RenameSuccess:$(R({...q,eventState:"success",actionSurface:u}));break;case t.UserAction.SelectSaveAs:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m,conversionType:k.conversion_type.toLowerCase()}));break;case t.UserAction.GoToFolder:t.UDCL.logEvent(function(e){return{class:"previews",action:"open",object:"folder",properties:e}}({actionScreen:u}));break;case e.WorkflowsEvent.WatermarkStart:B(W({eventState:"start",actionScreen:T,fileSize:f.size,fileType:i.getPapFileType(N)}));break;case e.WorkflowsEvent.WatermarkSuccess:$(W({eventState:"success",fileSize:f.size,fileType:i.getPapFileType(N)}));break;case e.WorkflowsEvent.WatermarkFailed:$(W({eventState:"failed",fileSize:f.size,fileType:i.getPapFileType(N)}));break;case e.WorkflowsEvent.WatermarkCancel:$(W({eventState:"canceled",fileSize:f.size,fileType:i.getPapFileType(N)}));break;case e.WorkflowsEvent.WatermarkRotate:t.UDCL.logEvent(j({actionElement:"rotate"}));break;case e.WorkflowsEvent.WatermarkAddImage:t.UDCL.logEvent(j({actionElement:"add_image"}));break;case e.WorkflowsEvent.WatermarkUpdatePosition:t.UDCL.logEvent(j({actionElement:"update_position"}));break;case e.WorkflowsEvent.WatermarkUpdateColor:t.UDCL.logEvent(j({actionElement:"update_color"}));break;case t.UserAction.SelectSidebarPage:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"doc_page",properties:e}}({actionScreen:T,fileSize:f.size,fileType:i.getPapFileType(N)}));break;case t.UserAction.OpenFileMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"file_menu",properties:e}}({...q,actionSurface:"preview"}));break;case t.UserAction.OpenEditMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"edit_menu",properties:e}}({...q,actionSurface:"preview"}));break;case t.UserAction.OpenViewMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"view_menu",properties:e}}({...q,actionSurface:"preview"}));break;case t.UserAction.OpenHelpMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"help_menu",properties:e}}({...q,actionSurface:"preview"}));break;case t.UserAction.AddToCollection:t.UDCL.logEvent(function(e){return{class:"previews",action:"add",object:"file_new_collection",properties:e}}({...q,eventState:"start",actionSurface:"preview"}));break;case t.UserAction.OpenWithImageEditor:t.UDCL.logEvent(A({destinationSurface:"image_edit",actionElement:T,previewType:i.getPapPreviewType(f.previewType),fileType:i.getPapFileType(N),fileSize:f.size,actionSurface:"previews"}));break;case t.UserAction.AdjustTrim:case t.UserAction.AdjustCrop:t.UDCL.logEvent(h({editAction:m,...q}));break;case t.UserAction.EditTranscriptTimer:t.UDCL.logEvent(function(e){return{class:"edit",action:"edit",object:"transcript",properties:e}}({actionId:k.actionId,timeToCompletionMs:parseInt(k.timeToCompletionMs,10),...q}));break;case t.UserAction.Move:case t.UserAction.Copy:case t.UserAction.Delete:case t.UserAction.Rename:case t.UserAction.Star:case t.UserAction.Unstar:case t.UserAction.Info:case t.UserAction.VersionHistory:case t.UserAction.FileActivity:case t.UserAction.Print:case t.UserAction.SaveToDropbox:case t.UserAction.OpenMoreApps:case t.UserAction.Comment:case t.UserAction.Download:case t.UserAction.CopyLink:case t.UserAction.Share:case t.UserAction.ShareMenu:case t.UserAction.SendACopy:case t.UserAction.ShareWithAnalytics:case t.UserAction.PrivacyLegal:case t.UserAction.CookieCCPA:case t.UserAction.ReportIssue:case t.UserAction.HelpAndResources:case t.UserAction.HelpCenter:case t.UserAction.AddTag:case t.UserAction.RemoveTag:case t.UserAction.InfoHide:case t.UserAction.InfoShowMoreMetadata:case t.UserAction.InfoHideMoreMetadata:case t.UserAction.ShowComments:case t.UserAction.HideComments:case t.UserAction.TranscriptHide:case t.UserAction.TranscriptShow:case t.UserAction.TranscriptCopyAllClick:case t.UserAction.TranscriptCopySegmentClick:case t.UserAction.TranscriptSearchAttempt:case t.UserAction.TranscriptJumpToTimestamp:case t.UserAction.EditTranscript:case t.UserAction.SaveEditTranscript:case t.UserAction.CancelEditTranscript:case t.UserAction.ExtractAll:case t.UserAction.Crop:case t.UserAction.Adjust:case t.UserAction.Trim:case t.UserAction.Upscale:case t.UserAction.ColorCorrect:case t.UserAction.AutoStraighten:case t.UserAction.ImageFilter:case t.UserAction.Search:case t.UserAction.Cancel:case t.UserAction.ReportToDropbox:case t.UserAction.ShowLinkWarningModal:case t.UserAction.CloseViewer:case t.UserAction.EditVideo:case t.UserAction.EditImage:case t.UserAction.CheckFileAccess:case t.UserAction.SwipeToolbar:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m}));break;case t.UserAction.ClickDropboxLogo:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:"close"}));break;case t.UserAction.OpenInApp:s&&t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:"open_in",destinationSurface:"mobile_app"}));break;case t.UserAction.SelfSign:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m})),s||t.UDCL.logEvent(x({...q,actionElement:t.maybeMapToPreviewTitlebar(T),destinationSurface:"self_sign"}));break;case t.UserAction.EditText:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m})),t.UDCL.logEvent(A({...q,actionElement:t.maybeMapToPreviewTitlebar(T),destinationSurface:"text_edit"}));break;case t.UserAction.Watermark:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m})),t.UDCL.logEvent(A({...q,actionElement:t.maybeMapToPreviewTitlebar(T),destinationSurface:"watermark"}));break;case t.UserAction.SendAndTrack:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m})),t.UDCL.logEvent(r.PAP_NavigateTo_Docsend({...q,actionElement:t.maybeMapToPreviewTitlebar(T),destinationSurface:"docsend_create_link_screen"}));break;case t.UserAction.ZoomFitToWidth:case t.UserAction.ZoomFitToPage:case t.UserAction.ZoomChangePercentage:case t.UserAction.HideTools:case t.UserAction.ShowTools:case t.UserAction.ToggleFullscreenOn:case t.UserAction.ToggleFullscreenOff:case t.UserAction.HidePageSelector:case t.UserAction.PageSelector:case t.UserAction.ChangeSpeed:t.UDCL.logEvent(b({...q,actionSurface:"previews",previewAction:m}));break;case t.UserAction.OpenActivityFilterMenu:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"activity_filter_menu",properties:e}}({...q,actionElement:t.UserActionContext.PreviewSidebar}));break;case t.UserAction.AddActivityFilter:t.UDCL.logEvent(function(e){return{class:"previews",action:"add",object:"activity_filter",properties:e}}({...q,actionElement:t.UserActionContext.PreviewSidebar,filterElement:i.getPapFilterElement(T)}));break;case t.UserAction.Filter:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m,filterType:k.filterType}));break;case t.UserAction.FilterSelectAll:case t.UserAction.FilterClearAll:case t.UserAction.FileActivityHide:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m}));break;case n.OpenInUserAction.InviteViaEmail:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"share_with_dropbox",properties:e}}({...q,actionSurface:"preview"}));break;case n.OpenInUserAction.Transfer:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"send_a_copy",properties:e}}({...q,actionSurface:"preview"})),t.UDCL.logEvent(function(e){return{class:"navigation",action:"navigate_to",object:"transfer",properties:e}}({...q,destinationSurface:"transfer_modal"}));break;case n.OpenInUserAction.ShareWithAnalytics:t.UDCL.logEvent(r.PAP_NavigateTo_Docsend({...q,destinationSurface:"docsend_create_link_screen"})),t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m}));break;case n.OpenInUserAction.SendForSignatureAction:t.UDCL.logEvent(x({...q,actionSurface:"preview",destinationSurface:"dropbox_sign_recipient_email_input"}));break;case t.UserAction.RotateLeft:case t.UserAction.RotateRight:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:t.UserAction.Rotate,direction:m===t.UserAction.RotateLeft?"left":"right"}));break;case t.UserAction.FlipHorizontal:case t.UserAction.FlipVertical:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:t.UserAction.Flip,direction:m===t.UserAction.FlipHorizontal?"horizontal":"vertical"}));break;case t.UserAction.Enhance:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,actionSurface:"image_edit",actionElement:"edit_toolbar",contentAction:t.UserAction.Enhance}));break;case t.UserAction.SaveACopy:t.UDCL.logEvent(z({...q}));break;case t.UserAction.ReplaceOriginal:t.UDCL.logEvent(F({...q}));break;case t.UserAction.EditStart:t.UDCL.logEvent(M({...q,eventState:i.getPapEventState(null==k?void 0:k.eventState),actionElement:void 0}));break;case t.UserAction.DropboxAI:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai",properties:e}}({...q,isSharedLinkPage:"true"===k.is_shared_link_page,isLoggedIn:"true"===k.is_logged_in,isBrowsePage:"true"===k.is_browse_page})),t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:m,actionSource:"true"===k.is_browse_page?"browse":"previews"}));break;case t.UserAction.ShownDropboxAI:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"shown",object:"dropbox_ai",properties:e}}({...q,isSharedLinkPage:"true"===k.is_shared_link_page,isLoggedIn:"true"===k.is_logged_in,isBrowsePage:"true"===k.is_browse_page}));break;case t.UserAction.CreateDropboxAIQuery:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"create",object:"dropbox_ai_query",properties:e}}({...q}));break;case t.UserAction.SelectDropboxAIFeedback:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_feedback",properties:e}}({...q,dropboxAiHelpful:"true"===k.is_helpful}));break;case t.UserAction.SelectDropboxAIShowSources:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_show_sources",properties:e}}(q));break;case t.UserAction.SelectDropboxAIConsentAllow:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_consent_modal_allow",properties:e}}(q));break;case t.UserAction.SelectDropboxAIConsentCancel:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_consent_modal_cancel",properties:e}}(q));break;case t.UserAction.ShownDropboxAIConsentModal:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"shown",object:"dropbox_ai_consent_modal",properties:e}}(q));break;case t.UserAction.SelectDropboxAIHideSources:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_hide_sources",properties:e}}(q));break;case t.UserAction.SelectDropboxAISummarizeStart:B(C({...q,eventState:"start",isSharedLinkPage:"true"===k.is_shared_link_page,isLoggedIn:"true"===k.is_logged_in,isBrowsePage:"true"===k.is_browse_page}));break;case t.UserAction.SelectDropboxAISummarizeSuccess:$(C({...q,eventState:"success",isSharedLinkPage:"true"===k.is_shared_link_page,isLoggedIn:"true"===k.is_logged_in,isBrowsePage:"true"===k.is_browse_page}));break;case t.UserAction.SelectDropboxAIHelpCenter:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_help_center",properties:e}}(q));break;case t.UserAction.SelectDropboxAIGiveFeedback:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_give_feedback",properties:e}}(q));break;case t.UserAction.SelectDropboxAIAskStart:B(E({...q,eventState:"start",isSharedLinkPage:"true"===k.is_shared_link_page,isLoggedIn:"true"===k.is_logged_in,isBrowsePage:"true"===k.is_browse_page}));break;case t.UserAction.SelectDropboxAIAskSuccess:$(E({...q,eventState:"success",isSharedLinkPage:"true"===k.is_shared_link_page,isLoggedIn:"true"===k.is_logged_in,isBrowsePage:"true"===k.is_browse_page}));break;case t.UserAction.SelectDropboxAIPageNavigation:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_page_navigation",properties:e}}(q));break;case t.UserAction.SelectDropboxAIVideoSeek:t.UDCL.logEvent(function(e){return{class:"dropbox_ai",action:"select",object:"dropbox_ai_video_seek",properties:e}}(q));break;case t.UserAction.LoggedOutRotateLeft:case t.UserAction.LoggedOutRotateRight:t.UDCL.logEvent(V({...q,entryAction:"rotate"}));break;case t.UserAction.LoggedOutFlipHorizontal:case t.UserAction.LoggedOutFlipVertical:t.UDCL.logEvent(V({...q,entryAction:"flip"}));break;case t.UserAction.LoggedOutCrop:t.UDCL.logEvent(V({...q,entryAction:"crop"}));break;case t.UserAction.LoggedOutAdjust:t.UDCL.logEvent(V({...q,entryAction:"adjust"}));break;case t.UserAction.LoggedOutEditImageAttempt:t.UDCL.logEvent(V(q));break;case t.UserAction.LoggedOutEditPdfAttempt:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"logged_out_pdf_edit",properties:e}}(q));break;case t.UserAction.LoggedOutEditAudioVideoAttempt:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"logged_out_audio_video_edit",properties:e}}({...q,entryAction:g(k.initialAction)}));break;case t.UserAction.Continue:t.UDCL.logEvent(a.PAP_Select_ContentAction({...q,contentAction:t.UserAction.Continue,dontAskAgainChecked:"true"===k.dontAskAgainChecked}))}var J})(c,l,"mobile"===c.device_type),(async(e,o)=>{var n;const{previousSurface:r,file:a}=o,c=e.extra,s=c.action,l=c.context,p=a.extension,_=null!=l?l:t.UserActionContext.PreviewToolbar,u={fileType:i.getPapFileType(p),fileSize:a.size,previewType:a.previewType?i.getPapPreviewType(a.previewType):void 0,actionSurface:null!==(n=c.actionSurface)&&void 0!==n?n:"video_edit",actionElement:_,previousSurface:r},f={actionElement:_,actionSurface:"previews",fileType:i.getPapFileType(p),fileSize:a.size,previewType:a.previewType?i.getPapPreviewType(a.previewType):void 0,previousSurface:r},y=i=>{t.UDCL.logStart(i,{key:e.file_preview_session_id})},k=i=>{t.UDCL.logEnd(i,{key:e.file_preview_session_id})};function E(e){t.UDCL.logEvent(b({...f,eventState:e,previewAction:"closed_captioning_on"}))}function C(e){t.UDCL.logEvent(b({...f,eventState:e,previewAction:"closed_captioning_off"}))}switch(s){case t.UserAction.EditVideoAttempt:t.UDCL.logEvent(A({actionElement:t.maybeMapToPreviewTitlebar(l),actionSurface:"previews",destinationSurface:"video_edit",direction:d(c.direction),entryAction:g(c.entryAction),fileSize:a.size,fileType:i.getPapFileType(p),previewType:i.getPapPreviewType(a.previewType)}));break;case t.UserAction.EditVideoFailure:t.UDCL.logEvent(S({fileType:i.getPapFileType(p),fileSize:a.size,previewType:a.previewType?i.getPapPreviewType(a.previewType):void 0,actionSurface:"video_edit",editorErrorType:v(c.reason),videoDuration:c.duration?Number.parseInt(c.duration,10):void 0}));break;case t.UserAction.EditVideoCancel:t.UDCL.logEvent(w({eventState:"canceled",actionSurface:"video_edit",fileSize:a.size,fileType:i.getPapFileType(p),haveChanges:"true"===c.have_changes}));break;case t.UserAction.EditVideoDiscardChangesCancel:t.UDCL.logEvent(w({eventState:"canceled",actionSurface:"video_edit",fileSize:a.size,fileType:i.getPapFileType(p)}));break;case t.UserAction.EditVideoDiscardChangesConfirmed:t.UDCL.logEvent(w({eventState:"success",actionSurface:"video_edit",fileSize:a.size,fileType:i.getPapFileType(p)}));break;case t.UserAction.EditVideoRedo:t.UDCL.logEvent({class:"previews",action:"redo",object:"edit_mode",properties:{...u,actionSurface:"video_edit"}});break;case t.UserAction.EditVideoUndo:t.UDCL.logEvent({class:"previews",action:"undo",object:"edit_mode",properties:{...u,actionSurface:"video_edit"}});break;case t.UserAction.EditVideoReplaceOriginalClicked:y(U({eventState:"start",fileSize:a.size,fileType:i.getPapFileType(p),actionElement:"replace_original",previewType:i.getPapPreviewType(a.previewType),actionSurface:"video_edit"}));break;case t.UserAction.EditVideoReplaceOriginalCancel:k(U({eventState:"canceled",fileSize:a.size,fileType:i.getPapFileType(p),actionElement:"replace_original",previewType:i.getPapPreviewType(a.previewType),actionSurface:"video_edit"}));break;case t.UserAction.EditVideoSaveCopyClicked:y(U({eventState:"start",fileSize:a.size,fileType:i.getPapFileType(p),actionElement:"save_a_copy",previewType:i.getPapPreviewType(a.previewType),actionSurface:"video_edit"}));break;case t.UserAction.EditVideoSaveCopyCancel:k(U({eventState:"canceled",fileSize:a.size,fileType:i.getPapFileType(p),actionElement:"save_a_copy",previewType:i.getPapPreviewType(a.previewType),actionSurface:"video_edit"}));break;case t.UserAction.ClosedCaptionsClick:"true"===c.cc_state_open?C("start"):E("start");break;case t.UserAction.ClosedCaptionsClickSuccess:"true"===c.new_cc_state_open?E("success"):C("success");break;case t.UserAction.AudioVideoSettingsMenuOpened:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_settings_menu",properties:e}}({actionScreen:l,fileSize:a.size,fileType:i.getPapFileType(p)}));break;case t.UserAction.QualitySettingsSubmenuOpened:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_quality_menu",properties:e}}({actionScreen:l,fileSize:a.size,fileType:i.getPapFileType(p)}));break;case t.UserAction.PlaybackRateSubmenuOpened:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_speed_menu",properties:e}}({actionScreen:l,fileSize:a.size,fileType:i.getPapFileType(p)}));break;case t.UserAction.SetVolume:t.UDCL.logEvent(b({...f,previewAction:"volume_change"}));break;case t.UserAction.SetMuted:t.UDCL.logEvent(b({...f,previewAction:"mute"}));break;case t.UserAction.SetUnmuted:t.UDCL.logEvent(b({...f,previewAction:"unmute"}));break;case t.UserAction.AudioVideoSeeked:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_scrub",properties:e}}({eventState:"success",actionScreen:l,fileSize:a.size,fileType:i.getPapFileType(p)}));break;case t.UserAction.AudioTrackChanged:t.UDCL.logEvent(b({...f,previewAction:"media_track_change"}));break;case t.UserAction.AudioTrackSubmenuOpened:t.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"audio_video_track_menu",properties:e}}({actionScreen:r,fileSize:a.size,fileType:i.getPapFileType(p)}));break;case t.UserAction.ChangePlaybackPosition:switch(c.playback_control){case"forward":t.UDCL.logEvent(b({...f,previewAction:"skip_forward"}));break;case"backward":t.UDCL.logEvent(b({...f,previewAction:"skip_backward"}));break;case"select_next_frame":t.UDCL.logEvent(b({...f,previewAction:"skip_forward",skipDuration:0}));break;case"select_prev_frame":t.UDCL.logEvent(b({...f,previewAction:"skip_backward",skipDuration:0}))}}})(c,l)):q(o,l,c)},q=async(e,o,n)=>{const{previousSurface:r,file:a}=o,c=a.extension;let s,l;switch(e){case t.SessionEventType.FilePreviewAttemptStarted:s="start";break;case t.SessionEventType.FilePreviewRenderSucceeded:s="success";break;case t.SessionEventType.FilePreviewSupportDenied:s="rejected",l="unimplemented";break;case t.SessionEventType.FilePreviewDownloadFailed:s="failed",l="network_error";break;case t.SessionEventType.FilePreviewRenderFailed:const e=n.extra.error_code;s=e===t.FVErrorCode.PasswordProtected||e===t.FVErrorCode.NestedFiletypeNotSupported?"rejected":"failed",l="rendering_error";break;case t.SessionEventType.FilePreviewSessionEnded:switch(n.extra.last_event){case t.SessionEventType.FilePreviewSupportDenied:case t.SessionEventType.FilePreviewDownloadFailed:case t.SessionEventType.FilePreviewRenderFailed:case t.SessionEventType.FilePreviewRenderSucceeded:return;default:s="canceled"}break;default:return}const p=n.extra.page_start_ts?Date.now()-parseInt(n.extra.page_start_ts,10):void 0;("start"===s?t.UDCL.logStart:t.UDCL.logEnd)({class:"previews",action:"preview",object:"file",properties:{eventState:s,actionScreen:r,fileType:i.getPapFileType(c),fileSize:a.size,previewType:a.previewType?i.getPapPreviewType(a.previewType):void 0,startType:"initial",actionId:n.file_preview_session_id,contentIdentifier:a.fileId,previewFailureReason:l,timeSinceStartMs:p,validationTraceId:n.extra.validation_trace_id}},{key:n.file_preview_session_id,tags:{previewType:i.getPapPreviewType(a.previewType)||"",actionScreen:r}})};function B(e){var i,o,n;const r=null!==(i=null==e?void 0:e.path)&&void 0!==i?i:"/log/file_preview",a=null!==(o=null==e?void 0:e.routeParams)&&void 0!==o?o:{},c=null!==(n=null==e?void 0:e.base)&&void 0!==n?n:window.location.origin;return new t.AjaxURL(t.replacePattern(r,a),c)}const $=()=>l.getYapsDeployment(),J=[t.SessionEventType.FilePreviewSupportConfirmed,t.SessionEventType.FilePreviewSupportDenied,t.SessionEventType.FilePreviewDownloadAttempted,t.SessionEventType.FilePreviewDownloadSucceeded,t.SessionEventType.FilePreviewDownloadFailed,t.SessionEventType.FilePreviewRenderSucceeded,t.SessionEventType.FilePreviewRenderFailed,t.SessionEventType.FilePreviewSessionEnded],Q=new Set([t.SessionEventType.FilePreviewAttemptStarted,t.SessionEventType.FilePreviewRenderSucceeded,t.SessionEventType.FilePreviewSupportDenied,t.SessionEventType.FilePreviewDownloadFailed,t.SessionEventType.FilePreviewRenderFailed,t.SessionEventType.FilePreviewSessionEnded]),Z="core_tags",G=async e=>{try{t.SilentBackgroundBeaconRequest(e)}catch(e){if(!(e instanceof TypeError&&"Illegal invocation"===e.message))throw e}},Y=e=>({device_type:e.device_type,...e.extra.source_context&&{source_context:e.extra.source_context},...e.extra.preview_type&&{preview_type:e.extra.preview_type},...e.extra.action&&{action:e.extra.action}}),K=(e,t={})=>({...t,...e.source_context&&{source_context:e.source_context},...e.preview_type&&{preview_type:e.preview_type}}),X=(e,i,o,n,r={},a={})=>{const s={...r,...n&&Y(n),deployment:$(),is_edison:String(l.isServedByEdisonWebServer())},p=K(s,r);c.getMetricsReporter().createStats({ns:o,name:e},s).record(i),c.getMetricsReporter().createStats({ns:o,name:`${Z}/${e}`},p).record(i),t.UDCL$1.track(`${o}/${e}`,{startTime:Date.now(),detail:{...t.withUdclTags(s),quantity:i,hiveData:a}}),t.UDCL$1.track(`${o}/${Z}/${e}`,{startTime:Date.now(),detail:{...t.withUdclTags(p),quantity:i}})},ee=(e,i,o,n,r={},a=void 0)=>{const p={...r,...n&&Y(n),deployment:$(),is_edison:String(l.isServedByEdisonWebServer())},d=K(p,r);c.getMetricsReporter().createStats({ns:o,name:e},p).recordDuration(i,s.TimeUnit.MILLISECONDS),c.getMetricsReporter().createStats({ns:o,name:`${Z}/${e}`},d).recordDuration(i,s.TimeUnit.MILLISECONDS);const _=Date.now();t.UDCL$1.measure(`${o}/${e}`,{start:_-i,end:_,detail:{...t.withUdclTags(p),hiveData:a}}),t.UDCL$1.measure(`${o}/${Z}/${e}`,{start:_-i,end:_,detail:t.withUdclTags(d)})},te=(e,i,o)=>{const n=i.extra.file_preview_timeline?JSON.stringify(Object.entries(JSON.parse(i.extra.file_preview_timeline)).reduce(((e,[t,i])=>({...e,[t+"_ts"]:i})),{})):void 0,r={device_type:i.device_type,event_name:e,extra:JSON.stringify({...i.extra,initial_request_id:l.getRequestId()}),file_viewer_session_id:i.file_viewer_session_id,file_preview_session_id:i.file_preview_session_id,file_ns_id:i.ns_id,file_sjid:i.sj_id,file_preview_timeline:n,file_preview_size:i.file_preview_size,file_id:i.file_id,file_extension:i.file_extension,request_id:l.getRequestId()};var a;G({url:B(),data:r}),X(e,1,"web_previews",i,o,r),J.includes(e)&&((e,i)=>{const o=i.extra.file_preview_timeline?JSON.parse(i.extra.file_preview_timeline):{};if(t.SessionEventType.FilePreviewAttemptStarted in o&&e in o){const n=o[e]-o[t.SessionEventType.FilePreviewAttemptStarted];n>0&&ee("time_from_attempt_ms",n,"web_previews",i,{event_name:e})}})(e,i),(a=i.extra).event===t.BackgroundEvent.EditVideoSaveSucceeded?t.UserSurvey.trackEvent("save_video_edit","previews"):(a.action===t.UserAction.EditVideoCancel&&"false"===a.have_changes||a.action===t.UserAction.EditVideoDiscardChangesConfirmed)&&t.UserSurvey.trackEvent("quit_video_edit","previews"),ie(e,i),re(e,i)},ie=(e,i)=>{var o,n,r,a;const c=null===(o=i.extra)||void 0===o?void 0:o.event;if(e===t.EventType.Background&&c===t.BackgroundEvent.DocPageLoad){const e=null===(n=i.extra)||void 0===n?void 0:n.status,o=null===(r=i.extra)||void 0===r?void 0:r.durationMs,c=null===(a=i.extra)||void 0===a?void 0:a.error;e===t.DocPageLoadState.Loaded&&void 0!==o?(X("doc_preview/page_load_status",1,"web_previews",i,{status:t.DocPageLoadState.Loaded}),ee("doc_preview/page_success_load_duration_ms",Number.parseInt(o,10),"web_previews",i)):e===t.DocPageLoadState.Error&&void 0!==c&&X("doc_preview/page_load_status",1,"web_previews",i,{status:t.DocPageLoadState.Error,error:c})}},oe=(e,i,o,n)=>(r,a,c)=>{Q.has(r)&&(a.extra={validation_trace_id:t.UUID.v4(),...n&&{session_id:n},...a.extra}),te(r,a,c);const s=i();N(r,a,{previewSurface:e,file:s,isPreviewAsRecipientView:o})},ne=({eventName:e,durationInMs:i,session:o,tags:n={},shouldLogToHive:r})=>{let a;if(r&&o){const n={event_name:e,duration:i.toString()};a={event_name:"user_timing",device_type:o.device_type,client_timestamp_ms:t.WebTimingUtil.getNow(),file_preview_session_id:o.file_preview_session_id,file_viewer_session_id:o.file_viewer_session_id,file_preview_size:o.file_preview_size,file_ns_id:o.ns_id,file_sjid:o.sj_id,extra:JSON.stringify({...o.extra,...n}),file_id:o.file_id,file_extension:o.file_extension,request_id:l.getRequestId()}}ee(e,i,"web_previews",o,n,a),a&&!t.ONLY_USE_UDCL&&G({url:B(),data:a})},re=(e,i)=>{var o,n;e===t.EventType.UserAction&&(null===(o=i.extra)||void 0===o?void 0:o.action)===t.UserAction.OpenIn&&"third_party_app"===(null===(n=i.extra)||void 0===n?void 0:n.destination_surface)&&X("open_in_third_party_app",1,"web_previews",i)};var ae=Object.freeze({__proto__:null,asyncBeaconRequest:G,logDuration:ne,logDurationToAMISAndUDCL:ee,logEvent:te,logQuantityToAMISAndUDCL:X,makeLogger:oe});e.PAP_NavigateTo_Edit=A,e.PAP_NavigateTo_Sign=x,e.PAP_Save_EditMode=U,e.PAP_Select_EditAction=h,e.PAP_Select_ReplaceOriginal=F,e.PAP_Select_SaveACopy=z,e.PAP_Start_EditMode=M,e.asyncBeaconRequest=G,e.logAudioPlayToPap=async(e,n)=>{const{previousSurface:r,file:a}=n,c=a.extension,s={actionSurface:"previews",fileType:i.getPapFileType(c),fileSize:a.size,previewType:a.previewType?i.getPapPreviewType(a.previewType):void 0,previousSurface:r},l=e=>{t.UDCL.logEvent(b({...s,eventState:e,previewAction:"play"}))};switch(e){case o.VideoPreviewEvent.VideoStartsPlaying:l("success");break;case o.VideoPreviewEvent.MediaError:l("failed");break;case o.VideoPreviewEvent.VideoResumesPlaying:t.UDCL.logEvent(b({...s,previewAction:"play"}))}},e.logAudioVideoEventToPap=(e,n,r,a)=>{var c;const s=e.extension,l={actionSurface:"previews",fileType:i.getPapFileType(s),fileSize:e.size,previousSurface:n};switch(r){case o.VideoPreviewEvent.ChangeVideoQuality:"user_selected"===(null===(c=a.extra)||void 0===c?void 0:c.video_quality_changer)&&t.UDCL.logEvent(b({...l,previewAction:"quality_change"}));break;case o.VideoPreviewEvent.ChangePlaybackRate:t.UDCL.logEvent(b({...l,previewAction:"playback_speed_change"}));break;case o.VideoPreviewEvent.HoverScrubberThumbnailsSucceeded:t.UDCL.logEvent(f({eventState:"success",actionScreen:n,fileSize:e.size,fileType:i.getPapFileType(s)}));break;case o.VideoPreviewEvent.HoverScrubberThumbnailsFailed:t.UDCL.logEvent(f({eventState:"failed",actionScreen:n,fileSize:e.size,fileType:i.getPapFileType(s)}))}},e.logDuration=ne,e.logDurationToAMISAndUDCL=ee,e.logQuantityToAMISAndUDCL=X,e.logVideoPlayPauseToPap=async(e,n,r)=>{const{previousSurface:a,file:c}=n,s=c.extension,l={actionElement:r,actionSurface:"previews",fileType:i.getPapFileType(s),fileSize:c.size,previewType:c.previewType?i.getPapPreviewType(c.previewType):void 0,previousSurface:a},p=e=>{t.UDCL.logEvent(b({...l,eventState:e,previewAction:"play"}))};switch(e){case o.VideoPreviewEvent.VideoStartsPlaying:p("success");break;case o.VideoPreviewEvent.MediaError:p("failed");break;case o.VideoPreviewEvent.VideoPaused:t.UDCL.logEvent(b({...l,previewAction:"pause"}));break;case o.VideoPreviewEvent.VideoResumesPlaying:t.UDCL.logEvent(b({...l,previewAction:"play"}))}},e.makeLogger=oe,e.preview_logger_esnext=ae}));
//# sourceMappingURL=c_file_viewer_preview_logger.js-vfl9us1Dq.map

//# debugId=3cc1fa32-a7a0-364f-95a0-5c63f6ed8201