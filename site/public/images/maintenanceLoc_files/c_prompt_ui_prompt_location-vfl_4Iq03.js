!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="13e0a7d6-9d4a-3eaf-b43b-96fce2cb1ab0")}catch(e){}}();
define(["exports","react","./c_api_v2_routes_folders_info_provider","./e_file_viewer_static_scl_page_folder","./c_api_v2_routes_password_confirmation_provider","./e_edison","./c_src_sink_index","./c_core_i18n"],(function(e,t,n,s,r,i,o,a){"use strict";function m(e){return e&&e.__esModule?e:{default:e}}var c=m(t);const p={"/prompt/confirm":()=>s.GetUrlForConfirmUidAware(),"/prompt/confirm_v2":()=>s.GetUrlForConfirmV2UidAware(),"/prompt/dismiss":()=>s.GetUrlForDismissUidAware(),"/prompt/log_impression":()=>s.GetUrlForLogImpression({path:"/prompt/log_impression"}),"/prompt/log_event":()=>s.GetUrlForLogEventUidAware({path:"/prompt/log_event"})};class d{constructor(e){this.campaignProps=e}recordClientImpression(){const e=this.getUpsellControllerURI("/prompt/log_impression");this.recordAck(e)}recordConfirm(e){const t=this.getUpsellControllerURI("/prompt/confirm",{confirmUrl:e});this.recordAck(t,"db:prompt:confirm")}recordDismiss(e){const t=this.getUpsellControllerURI("/prompt/dismiss",{remindMeLater:e});this.recordAck(t,"db:prompt:dismiss")}recordEvent(e){const t=this.getUpsellControllerURI("/prompt/log_event",{eventName:e});this.recordAck(t)}recordAck(e,t){s.SilentBackgroundRequest$1({url:e,success:()=>{t&&this.triggerExternalEvent(t)}})}getUpsellControllerURI(e,t){return function(e,t){const n=p[e]();if(n.searchParams.set("campaign_id",t.campaignId.toString()),t.versionId&&n.searchParams.set("version_id",t.versionId.toString()),"number"==typeof t.promptQueriedAtMs&&n.searchParams.set("prompt_queried_at_ms",t.promptQueriedAtMs.toString()),window&&window.performance&&window.performance.now){const e=Math.round(window.performance.now());n.searchParams.set("delta_from_request_start_ms",e.toString())}const s=r.getActiveUserId();return s&&n.searchParams.set("_subject_uid",String(s)),t.requestId&&n.searchParams.set("prompt_parent_request_id",t.requestId),t.eventName&&n.searchParams.set("event_name",t.eventName),void 0!==t.remindMeLater&&n.searchParams.set("remind_me_later",(!!t.remindMeLater).toString()),t.csrfToken&&n.searchParams.set("csrf_token",t.csrfToken),t.csrfTokenType&&n.searchParams.set("csrf_token_type",t.csrfTokenType),t.confirmUrl&&n.searchParams.set("confirm_url",t.confirmUrl),n}(e,{campaignId:this.campaignProps.campaign.campaignId,versionId:this.campaignProps.campaign.versionId,promptQueriedAtMs:this.campaignProps.promptQueriedAtMs,requestId:this.campaignProps.requestId,csrfToken:this.campaignProps.csrfToken,csrfTokenType:this.campaignProps.csrfTokenType,eventName:t&&t.eventName,remindMeLater:t&&t.remindMeLater,confirmUrl:t&&t.confirmUrl})}triggerExternalEvent(e){const t=new CustomEvent(e,{detail:{campaignName:this.campaignProps.campaign.campaignName}});document.dispatchEvent(t)}}const l=["HOME_INLINE_CONTENT"];function f(e){return`ON_${e}_LOADED`}const h={ON_HA_LOADED:"ON_HA_LOADED",REACT_HA_DID_UPDATE:"REACT_HA_DID_UPDATE",ON_PROMPT_INITIALIZED:"ON_PROMPT_INITIALIZED",ON_PROMPT_SHOWN:"ON_PROMPT_SHOWN",ON_PROMPT_DISMISSED:"ON_PROMPT_DISMISSED",ON_PROMPT_PROPS_SET:"ON_PROMPT_PROPS_SET"};for(const e of l){const t=f(e);h[t]=t}new o.EventEmitter;class u extends o.EventEmitter{constructor(){super(),this.allEventBuffers={},this.delegatedEvents={},this._reset()}on(e,t){super.on(e,t);const n=this.allEventBuffers[e.toString()];return void 0!==n&&n.forEach((t=>{super.emit(e,t)})),this}emit(e,t){return e=e.toString(),void 0===this.allEventBuffers[e]&&(this.allEventBuffers[e]=[]),this.allEventBuffers[e].push(t),super.emit(e,t)}maybeEmitDelegatedEvent(e){const t=[];for(const n in e){const s=e[n];if(!s)continue;const r=s.campaign.campaignLocationId;if(-1===l.indexOf(r))continue;const i=f(r);i in this.delegatedEvents||(this.delegatedEvents[i]=!0,t.push(r),this.emit(i,s))}return t}_reset(){this.allEventBuffers={},this.delegatedEvents={},this.removeAllListeners()}}window.ensemble&&!window.ensemble.bufferedEventEmitter&&(window.ensemble.bufferedEventEmitter=new u);const g=window.ensemble&&window.ensemble.bufferedEventEmitter?window.ensemble.bufferedEventEmitter:new u,_="/prompt/confirm_v2";class v{constructor(e){this.buildConfirmEndpointURI=e=>{if(!(e=e||this.getConfirmUrlFromContent())||"#"===e)return"#";const t=this.eventLogger.getUpsellControllerURI(_),n=this.component.props.campaign.content,s="confirmIsPost"in n&&n.confirmIsPost,r=this.getRedirectURL(e);return r&&t.searchParams.set("redirect_url",r),s&&t.searchParams.set("preserve_post","1"),t.toString()},this.shouldConfirmUsingPost=()=>{const e=this.getConfirmUrlFromContent(),t=this.component.props.campaign.content,n="confirmIsPost"in t&&t.confirmIsPost;return!!(e&&"#"!==e||n)},this.onShow=()=>{this.component.state.isShown||(this.component.setState((e=>({...e,isShown:!0}))),g.emit(h.ON_PROMPT_SHOWN,this.component.props.campaign.campaignLocationId),this.eventLogger.triggerExternalEvent("db:prompt:show"),this.eventLogger.recordClientImpression())},this.onConfirm=e=>{this.onConfirmWithoutCallback(e),this.ensureConfirmIsRecorded(e)},this.onConfirmWithoutCallback=e=>{this.isAckInProgress()||(this.component.setState((e=>({...e,isConfirmed:!0}))),this.eventLogger.triggerExternalEvent("db:prompt:pre-confirm"))},this.isHTMLAnchorElement=e=>void 0!==e.href,this.isHTMLFormElement=e=>void 0!==e.action,this.onDismiss=(e,t)=>{this.isAckInProgress()||(this.component.setState((e=>({...e,isDismissed:!0}))),null==e||e.preventDefault(),g.emit(h.ON_PROMPT_DISMISSED,this.component.props.campaign.campaignLocationId),this.eventLogger.triggerExternalEvent("db:prompt:pre-dismiss"),this.eventLogger.recordDismiss(t&&t.remindMeLater))},this.enhanceHTMLButtons=(e,{confirmButtonSelector:t=".confirm-button",dismissButtonSelector:n=".dismiss-button",onConfirmOverride:s,onDismissOverride:r}={})=>{if(e){let i=null;const o=e.querySelectorAll(t),a=e.querySelectorAll(n);for(let e=0;e<o.length;e++){if(i=o[e],!this.mayEnhanceButton(i))continue;i.href=this.buildConfirmEndpointURI(i.getAttribute("href"));const t=this.component.props.campaign.content,n="confirmInNewTab"in t&&t.confirmInNewTab;i.target=n?"_blank":"_self",i.addEventListener("click",s||this.onConfirm)}for(let e=0;e<a.length;e++)i=a[e],this.mayEnhanceButton(i)&&i.addEventListener("click",r||this.onDismiss)}},this.component=e,this.eventLogger=new d(this.component.props),this.onConfirmWithoutEvent=this.onConfirmWithoutEvent.bind(this)}getConfirmUrlFromContent(){const e=this.component.props.campaign.content;return s.isTopNotificationContent(e)?e.buttonUrl:s.isTargetedBubbleContent(e)||s.isConfirmableContent(e)?e.confirmUrl:void 0}getRedirectURL(e){if(e){if(this.component.props.campaign.addTkParams){const t=n.URI.parse(e);let s=this.component.props.campaign.versionId;return null==s&&(s=this.component.props.campaign.campaignId),t.updateQuery({_tk:this.component.props.campaign.campaignLocationTkId,_camp:s.toString()}),t.toString()}return e}}onConfirmWithoutEvent(e){this.onConfirmWithoutCallback(),this.eventLogger.recordConfirm(e)}ensureConfirmIsRecorded(e){if(!this.eventWillRecordConfirm(e)){this.eventLogger.recordConfirm();const t=this.getEventHrefOrAction(e);t&&"#"!==t||e.preventDefault()}}eventWillRecordConfirm(e){return(this.getEventHrefOrAction(e)||"").indexOf(_)>-1}getEventHrefOrAction(e){let t=null;const n=e.currentTarget;return n&&this.isHTMLAnchorElement(n)?t=n.getAttribute("href"):n&&this.isHTMLFormElement(n)&&(t=n.getAttribute("action")),t}mayEnhanceButton(e){return!e.classList.contains("prompt-enhanced")&&(e.classList.add("prompt-enhanced"),!0)}isAckInProgress(){return this.component.state.isConfirmed||this.component.state.isDismissed}}class E extends c.default.Component{constructor(e){super(e),this.updateSecondsDiff=()=>{const e=this.state.secondsDiff-1;e<=0?this.clearInterval():this.setState({secondsDiff:e,interval:this.state.interval})},this.clearInterval=()=>{this.state.interval&&window.clearInterval(this.state.interval)},this.state={secondsDiff:this.props.endDateUtctimestamp-Math.floor(Date.now()/1e3)}}componentDidMount(){const e=window.setInterval(this.updateSecondsDiff,1e3);this.setState({secondsDiff:this.props.endDateUtctimestamp-Math.floor(Date.now()/1e3),interval:e})}componentWillUnmount(){this.clearInterval()}get_timer_text(){const e=Math.floor(Date.now()/1e3),t=this.props.startDateUtctimestamp;if(t&&e<t)return"";const n=this.state.secondsDiff;if(n<=0)return"";const s=Math.floor(n/86400),r=Math.floor(n/3600%24),i=Math.floor(n/60%60),o=Math.floor(n%60),{endsIn:m,hour:c,hours:p,min:d,mins:l,day:f,days:h,sec:u,secs:g}={endsIn:a.intl.formatMessage({id:"1N/Yn3",defaultMessage:"Ends in"}),hour:a.intl.formatMessage({id:"Y6D/4x",defaultMessage:"hour"}),hours:a.intl.formatMessage({id:"wiePli",defaultMessage:"hours"}),day:a.intl.formatMessage({id:"mC8LRm",defaultMessage:"day"}),days:a.intl.formatMessage({id:"p41TEs",defaultMessage:"days"}),min:a.intl.formatMessage({id:"ZES8sE",defaultMessage:"min"}),mins:a.intl.formatMessage({id:"TqF6bR",defaultMessage:"mins"}),sec:a.intl.formatMessage({id:"SPpftz",defaultMessage:"sec"}),secs:a.intl.formatMessage({id:"MAuFqw",defaultMessage:"secs"})},_=m+" ";return s>0?_+s+" "+(s>1?h:f)+".":_+r+" "+(r>1?p:c)+" "+i+" "+(i>1?l:d)+" "+o+" "+(o>1?g:u)+"."}render(){return c.default.createElement(c.default.Fragment,null,c.default.createElement("strong",{className:"promo-timer-"+this.props.identifier},this.get_timer_text()))}}E.displayName="CountdownTimer";class I extends c.default.Component{constructor(e,t){super(e),this.state=t,this.state_manager=new v(this)}getTimerComponent(e,t,n){return c.default.createElement(E,{endDateUtctimestamp:e,startDateUtctimestamp:t,identifier:n})}}I.displayName="PromptLocation";e.Events=h,e.PromptEventLogger=d,e.PromptLocationWithDefaultState=class extends I{constructor(e){super(e,{isConfirmed:!1,isDismissed:!1,isShown:!1})}},e.promptBufferedEventEmitter=g}));
//# sourceMappingURL=c_prompt_ui_prompt_location.js-vflavxYbI.map

//# debugId=13e0a7d6-9d4a-3eaf-b43b-96fce2cb1ab0