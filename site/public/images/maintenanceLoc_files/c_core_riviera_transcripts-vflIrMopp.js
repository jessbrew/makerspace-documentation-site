!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="2b423377-209d-3bd9-ae99-5d71c0c6eb79")}catch(e){}}();
define(["exports","./e_file_viewer_static_scl_page_folder","./c_file_viewer_api_navigation","./c_core_data_ui","react","./c_api_v2_routes_password_confirmation_provider","./e_data_modules_stormcrow","./c_core_data_actions","./c_react-redux_hooks_useDispatch","./c_lodash"],(function(e,t,i,r,a,n,o,s,l,d){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}var c=u(a);const p=t.fileViewerAtom(1),m=t.fileViewerAtom(!1),v=t.atom((e=>({volume:e(p),muted:e(m)})));const _=t.atom({}),g=t.fileViewerAtom({segmentIndex:-1,startingCharIndex:-1,endingCharIndex:-1}),w=t.fileViewerAtom(void 0);var f;e.ReplaceOption=void 0,(f=e.ReplaceOption||(e.ReplaceOption={})).ALL="all",f.CURRENT="current";const h=["en","en_GB","da_DK","de","es","es_ES","fr","id","it","ja","ko","ms","nb_NO","nl_NL","pl","pt_BR","ru","sv_SE","th_TH","uk_UA","zh_CN","zh_TW"],E=["English (United States)","English (United Kingdom)","Danish (Denmark)","German (Germany)","Spanish (Latin America)","Spanish (Spain / Iberian)","French (France)","Indonesian (Indonesia)","Italian (Italy)","Japanese","Korean","Malay (Malaysia)","Norwegian (BokmÃ¥l)","Dutch","Polish","Portuguese (Brazil)","Russian","Swedish (Sweden)","Thai (Thailand)","Ukrainian (Ukraine)","Chinese (Simplified)","Chinese (Traditional)"],T={};h.forEach(((e,t)=>{T[E[t]]=e}));const C="User Locale",y=e=>{const{fileViewerId:i}=t.useFileViewerContext(),r=t.useFileViewerSelector(t.getCurrentPreviewKey,i),a=t.useParameterizedSelector(t.getIsUserLocaleShowing,i,r),o=n.getPageLocale(),s="default",l=t.usePreviewKeyAtomValue(_,r);return l&&l!==C?T[l]:e&&h.includes(o)?a?s:o:s};function x(e){return e.ns("transcript_edit")}const A="transcript_edit:get_transcript",D=(e,t="OFF")=>o.createGenericQuery({queryRouteFilter:["custom",A],queryFn:({apiArg:i})=>async({})=>{if(["OFF","CONTROL"].includes(t))return{apiData:{segments:[]},pkgData:null};return{apiData:(await x(e).rpcWithResponseHeaders("get_transcript",i,{})).result,pkgData:null}},getQueryKey:o.getGenericQueryKey("custom",A)});class I extends c.default.PureComponent{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){this.props.onException(e)}render(){const{fallback:e,children:t}=this.props;return this.state.hasError?e:t}}I.displayName="ErrorBoundaryInternal";const F=({children:e,fallback:i,onError:r})=>{const a=l.useDispatch(),n=t.useCurrentPreviewMetadata(),o=c.default.useCallback((e=>{var t;null==r||r(e),a(s.reportException({error:e,fileType:(null===(t=null==n?void 0:n.content)||void 0===t?void 0:t[".tag"])||"unknown",severity:"critical"}))}),[a,r,null==n?void 0:n.content]);return c.default.createElement(I,{fallback:i,children:e,onException:o})};F.displayName="ErrorBoundary";const U="media_addon:get_features",b=e=>o.createGenericQuery({queryRouteFilter:["apiv2",U],queryFn:()=>async()=>{var t;return{apiData:await(t=e,t.ns("media_addon")).rpc("get_features",void 0,{}),pkgData:null}},getQueryKey:o.getGenericQueryKey("apiv2",U)}),O=e=>{var t,i;const r=null===(i=null===(t=e.data)||void 0===t?void 0:t.apiData)||void 0===i?void 0:i.segments;return r&&(null==r?void 0:r.length)>0},R=e=>e===t.RivieraStatus.NotFound||e===t.RivieraStatus.TemporaryFailure;e.ErrorBoundary=F,e.USER_LOCALE_OPTION=C,e.canGenerateTranscriptFromRivieraStatus=R,e.currentMatchSegmentAtom=g,e.getReplaceEdits=(t,i,r,a,n,o)=>{const s=[],l=[];if(o)if(n===e.ReplaceOption.ALL)for(const[e,t]of o){const t=new RegExp(r,"ig");s.push({index:e,start_time:i[e].startTime,end_time:i[e].endTime,text:i[e].text}),l.push({index:e,start_time:i[e].startTime,end_time:i[e].endTime,text:i[e].text.replace(t,a)})}else if(n===e.ReplaceOption.CURRENT){const e=t.segmentIndex,r=t.startingCharIndex,n=t.endingCharIndex,o=i[e].text;s.push({index:e,start_time:i[e].startTime,end_time:i[e].endTime,text:i[e].text}),l.push({index:e,start_time:i[e].startTime,end_time:i[e].endTime,text:o.substring(0,r)+a+o.substring(n+1)})}return{originalSegments:s,edits:l}},e.getTranscriptPermission=e=>"video"===(null==e?void 0:e[".tag"])||"audio"===(null==e?void 0:e[".tag"])?e.transcript_permission:{".tag":"ineligible"},e.localeWords=E,e.locales=h,e.mutedAtom=m,e.onTranscriptEdit=(e,t,i,r,a,n,o,s,l)=>{const d="previews/client/view_transcription",u=r.map((({index:e,...t})=>t));if(i)o({file_id:e,feature:d,edits:{edits:u}});else{let i=[];a.forEach((e=>{const t=e.text.split(/\s+/),r=t.length,a=(e.endTime-e.startTime)/r;i=i.concat(t.map(((t,i)=>({text:" "+t,start_time:e.startTime+i*a,end_time:e.startTime+(i+1)*a}))))}));try{s({file_id:e,feature:d,transcript:{words:i,caption_timestamps:a.map((e=>({start_time:e.startTime,end_time:e.endTime})))},edits:{edits:u},locale:t})}catch(e){return}}const c=[...a];r.forEach((e=>{var t;c[e.index].text=null!==(t=e.text)&&void 0!==t?t:""})),n(c),l()},e.prefetchGetEditedTranscript=async(e,t,i,r="OFF",a)=>{const n=D(e,r);"default"===a&&await n.prefetchQuery(t,{apiArg:{file_id:i,feature:"previews/client/view_transcription",level:{".tag":"caption"}},pkgArg:null})},e.prefetchMediaAddon=async(e,t)=>{const i=b(e);await i.prefetchQuery(t,{})},e.replaceHistoryAtom=w,e.translationLanguageAtom=_,e.useCreateEditedTranscript=()=>{const e=t.useFileViewerContext();if(!e)throw new Error("useCreateEditedTranscript must be called within a FileViewerContext");const{apiV2Client:i}=e;return c.default.useMemo((()=>{return e=i,o.createGenericMutation({mutationFn:()=>async t=>({apiData:(await x(e).rpcWithResponseHeaders("create_transcript",t.apiArg,{})).result,pkgData:null}),getMutationKey:o.getGenericMutationKey("custom","transcript_edit:create_transcript")});var e}),[i]).useMutation()},e.useGetEditedCaptions=(e,i="OFF",r)=>{var a,n,o;const s=t.useFileViewerContext();if(!s)throw new Error("useGetEditedTranscript must be called within a FileViewerContext");const{apiV2Client:l}=s,d=y(r),u=c.default.useMemo((()=>D(l,i)),[l,i]).useQuery({apiArg:{file_id:e,feature:"previews/client/view_transcription",level:{".tag":"caption"}},pkgArg:null});if("default"===d&&(null===(a=u.data)||void 0===a?void 0:a.apiData.closed_captions)){const e=new Blob([atob(null===(o=null===(n=u.data)||void 0===n?void 0:n.apiData)||void 0===o?void 0:o.closed_captions)]);return{url:URL.createObjectURL(e),result:u}}return{url:void 0,result:void 0}},e.useGetMediaAddonQuery=e=>{var t,i;return null===(i=null===(t=b(e).useQuery({}))||void 0===t?void 0:t.data)||void 0===i?void 0:i.apiData},e.useGetTranscript=(e,i,r,a="OFF",n)=>{var o,s;const l=t.useFileViewerContext();if(!l)throw new Error("useGetEditedTranscript must be called within a FileViewerContext");const d=y(n),{apiV2Client:u}=l,p=c.default.useMemo((()=>D(u,a)),[u,a]),m=t.useTranscriptDataQuery(i,r,d,!["OFF","CONTROL"].includes(a)),v=p.useQuery({apiArg:{file_id:e,feature:"previews/client/view_transcription",level:{".tag":"caption"}},pkgArg:null});if("default"===d){if(v.error)return{isEditedTranscript:!0,result:v};if((null===(o=v.data)||void 0===o?void 0:o.apiData.segments)&&(null===(s=v.data)||void 0===s?void 0:s.apiData.segments.length)>0)return{isEditedTranscript:!0,result:v}}return{isEditedTranscript:!1,result:m}},e.useInvalidateEditedTranscriptCallback=(e,i,r="OFF",a)=>{const n=t.useFileViewerContext();if(!n)throw new Error("useInvalidateEditedTranscriptCallback must be called within a FileViewerContext");const{apiV2Client:o}=n,s=y(a),l=c.default.useMemo((()=>D(o,r)),[o,r]);return c.default.useCallback((()=>{"default"===s&&e&&l.invalidateQueries(i,{file_id:e,feature:"previews/client/view_transcription",level:{".tag":"caption"}})}),[e,i,l])},e.useIsEditingVideo=function(e){return t.useFileViewerSelector(r.getSelectedEditPluginId,e)===i.VIDEO_EDITOR_PLUGIN_ID},e.useIsTranscriptAvailable=O,e.useLanguageForLocale=y,e.useMaybeOpenEditorBasedOnUrl=()=>{const{logUserAction:e}=t.useFileViewerContext(),r=t.useCurrentPreviewMetadata().previewType,a=i.useSetActiveEditorCallback(),n=c.default.useCallback((()=>{a(i.PDF_EDITOR_PLUGIN_ID,t.UserActionContext.PostDownloadEditModal),e(t.UserAction.EditPdf,t.UserActionContext.PostDownloadEditModal)}),[e,a]),o=c.default.useCallback((()=>{a(i.PHOTO_EDITOR_PLUGIN_ID,t.UserActionContext.PostDownloadEditModal,{initialAction:"adjust"}),e(t.UserAction.EditImageAttempt,t.UserActionContext.PostDownloadEditModal,{entryAction:"adjust"})}),[e,a]),s=c.default.useCallback((()=>{a(i.VIDEO_EDITOR_PLUGIN_ID,t.UserActionContext.Initialization,{initialEditAction:"crop"}),e(t.UserAction.EditVideoAttempt,t.UserActionContext.PostDownloadEditModal,{entryAction:"crop"})}),[e,a]),l=c.default.useCallback((()=>{a(i.VIDEO_EDITOR_PLUGIN_ID,t.UserActionContext.Initialization,{initialEditAction:"trim"}),e(t.UserAction.EditVideoAttempt,t.UserActionContext.PostDownloadEditModal,{entryAction:"trim"})}),[e,a]);c.default.useEffect((()=>{const e=()=>{"#edit"===window.location.hash&&(r===t.PreviewType.Image?o():r===t.PreviewType.Video?s():r===t.PreviewType.Audio?l():n())};return window.addEventListener("hashchange",e,!1),()=>{window.removeEventListener("hashchange",e)}}),[n,o,s,r,l])},e.useMaybeOpenTranscriptSidebarBasedOnUrl=()=>{const e=i.useSetRightSidebarCallback(i.TRANSCRIPT_BLADE_PLUGIN_ID,t.UserActionContext.Initialization);c.default.useEffect((()=>{const t=new URL(window.location.href);t.searchParams.get("transcript")&&(t.searchParams.delete("transcript"),window.history.replaceState(null,"",t.href),e())}),[e])},e.useShouldEnableClosedCaptionsButton=(e,i,r,a)=>{var n,o,s,l,d;const{isLoggedIn:u}=t.useFileViewerContext(),c="video"===(null===(n=null==i?void 0:i.content)||void 0===n?void 0:n[".tag"])||"audio"===(null===(o=null==i?void 0:i.content)||void 0===o?void 0:o[".tag"])?i.content.transcript_permission:void 0,p=t.useTranscriptDataQuery(e,i,r,a),m=t.useMaybeGenerateTranscript(e,i);return!!O(p)||!!c&&(!(p.isError&&!R(p.error.statusCode))&&((!p.isSuccess||0!==(null===(d=null===(l=null===(s=p.data)||void 0===s?void 0:s.apiData)||void 0===l?void 0:l.segments)||void 0===d?void 0:d.length))&&(!m.isError&&!!u)))},e.useShouldGenerateTranscript=(e,i,r,a)=>{var n,o;const s=t.useTranscriptDataQuery(e,i,r,a),l=t.useMaybeGenerateTranscript(e,i);return!(!e||!i||"video"!==(null===(n=i.content)||void 0===n?void 0:n[".tag"])&&"audio"!==(null===(o=i.content)||void 0===o?void 0:o[".tag"]))&&(!(!s.error||!R(s.error.statusCode))&&(!l.isLoading&&!l.isError))},e.useUpdateEditedTranscript=()=>{const e=t.useFileViewerContext();if(!e)throw new Error("useUpdateEditedTranscript must be called within a FileViewerContext");const{apiV2Client:i}=e;return c.default.useMemo((()=>{return e=i,o.createGenericMutation({mutationFn:()=>async t=>({apiData:(await x(e).rpcWithResponseHeaders("update_transcript",t.apiArg,{})).result,pkgData:null}),getMutationKey:o.getGenericMutationKey("custom","transcript_edit:update_transcript")});var e}),[i]).useMutation()},e.volumeAtom=p,e.volumeStateAtom=v,e.writeTranscriptToClipboard=(e,t=!1)=>{if(!e||0===e.length)return;const i=d.lodashExports.flatten(e.map((({text:e,startTime:i})=>t?[i,e]:[e]))).join("\r\n");navigator.clipboard.writeText(i)}}));
//# sourceMappingURL=c_core_riviera_transcripts.js-vflucJlKN.map

//# debugId=2b423377-209d-3bd9-ae99-5d71c0c6eb79