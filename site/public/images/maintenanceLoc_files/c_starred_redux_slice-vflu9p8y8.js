!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9a805aa4-19f3-370d-b666-02a0ebb3e3dc")}catch(e){}}();
define(["exports","./c_reduxjs_toolkit_redux-toolkit","./c_api_v2_routes_password_confirmation_provider","./e_file_viewer_static_scl_page_folder","./c_core_i18n","./e_core_exception","./c_lodash","./c_flux_dispatcher","./c_api_v2_routes_folders_info_provider","./e_data_modules_stormcrow","./e_edison"],(function(e,t,r,i,a,n,s,o,d,c,l){"use strict";var _="NOT_FOUND";var u=function(e,t){return e===t};function E(e,t){var r,i,a="object"==typeof t?t:{equalityCheck:t},n=a.equalityCheck,s=void 0===n?u:n,o=a.maxSize,d=void 0===o?1:o,c=a.resultEqualityCheck,l=function(e){return function(t,r){if(null===t||null===r||t.length!==r.length)return!1;for(var i=t.length,a=0;a<i;a++)if(!e(t[a],r[a]))return!1;return!0}}(s),E=1===d?(r=l,{get:function(e){return i&&r(i.key,e)?i.value:_},put:function(e,t){i={key:e,value:t}},getEntries:function(){return i?[i]:[]},clear:function(){i=void 0}}):function(e,t){var r=[];function i(e){var i=r.findIndex((function(r){return t(e,r.key)}));if(i>-1){var a=r[i];return i>0&&(r.splice(i,1),r.unshift(a)),a.value}return _}return{get:i,put:function(t,a){i(t)===_&&(r.unshift({key:t,value:a}),r.length>e&&r.pop())},getEntries:function(){return r},clear:function(){r=[]}}}(d,l);function S(){var t=E.get(arguments);if(t===_){if(t=e.apply(null,arguments),c){var r=E.getEntries().find((function(e){return c(e.value,t)}));r&&(t=r.value)}E.put(arguments,t)}return t}return S.clearCache=function(){return E.clear()},S}function S(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];var n,s=0,o={memoizeOptions:void 0},d=i.pop();if("object"==typeof d&&(o=d,d=i.pop()),"function"!=typeof d)throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof d+"]");var c=o.memoizeOptions,l=void 0===c?r:c,_=Array.isArray(l)?l:[l],u=function(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"==typeof e}))){var r=t.map((function(e){return"function"==typeof e?"function "+(e.name||"unnamed")+"()":typeof e})).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+r+"]")}return t}(i),E=e.apply(void 0,[function(){return s++,d.apply(null,arguments)}].concat(_)),S=e((function(){for(var e=[],t=u.length,r=0;r<t;r++)e.push(u[r].apply(null,arguments));return n=E.apply(null,e)}));return Object.assign(S,{resultFunc:d,memoizedResultFunc:E,dependencies:u,lastResult:function(){return n},recomputations:function(){return s},resetRecomputations:function(){return s=0}}),S}}var T,h=S(E);function R(e){var t,r,a;const n=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/starred/get_status",s=null!==(r=null==e?void 0:e.routeParams)&&void 0!==r?r:{},o=null!==(a=null==e?void 0:e.base)&&void 0!==a?a:window.location.origin;return new i.AjaxURL(i.replacePattern(n,s),o)}e.HOME_RESOURCE_ID_TYPE=void 0,(T=e.HOME_RESOURCE_ID_TYPE||(e.HOME_RESOURCE_ID_TYPE={})).ENCODED_FILE_OBJ_ID="ENCODED_FILE_OBJ_ID",T.FQ_PATH="FQ_PATH",T.PAPER_DOCUMENT_ID="PAPER_DOCUMENT_ID",T.PAPER_FOLDER_ID="PAPER_FOLDER_ID",T.PAPER_DOCUMENT_ID_PATH="PAPER_DOCUMENT_ID_PATH",T.PAPER_FOLDER_ID_PATH="PAPER_FOLDER_ID_PATH",T.EXTERNAL_RESOURCE_ID="EXTERNAL_RESOURCE_ID",T.UNKNOWN="UNKNOWN";const f=(e,t,a)=>new Promise(((n,s)=>{(a?i.SilentBackgroundRequest$2:i.WebRequest)({url:e,type:"POST",dataType:"json",data:t,subject_user:r.mustGetActiveUserId(),success:n,error:(e,t,r)=>s(Error(`error: ${r}, status: ${t}`))})}));function p(e,t){const r=[];for(let i=0;i<e.length;i+=t){const a=e.slice(i,i+t);r.push(a)}return r}const D=(e,t,r,a)=>f(function(e){var t,r,a;const n=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/starred/update",s=null!==(r=null==e?void 0:e.routeParams)&&void 0!==r?r:{},o=null!==(a=null==e?void 0:e.base)&&void 0!==a?a:window.location.origin;return new i.AjaxURL(i.replacePattern(n,s),o)}(),{role:e,resource_id:t,id_type:r,is_starred:a},!0),O=({itemName:e,isStarred:t,success:r})=>{if(r){let r;r=e?t?a.intl.formatMessage({id:"m96IvY",defaultMessage:"Starred {itemName}."},{itemName:e}):a.intl.formatMessage({id:"Yn2gx1",defaultMessage:"Unstarred {itemName}."},{itemName:e}):t?a.intl.formatMessage({id:"IxGSEU",defaultMessage:"Starred."},{itemName:e}):a.intl.formatMessage({id:"RZWOu0",defaultMessage:"Unstarred."},{itemName:e}),i.Snackbar.complete(r,"star-action")}else{let r;r=e?t?a.intl.formatMessage({id:"5O9Xva",defaultMessage:"There was a problem starring {item_name}"},{item_name:e}):a.intl.formatMessage({id:"CvW0nU",defaultMessage:"There was a problem unstarring {item_name}"},{item_name:e}):t?a.intl.formatMessage({id:"jouX9E",defaultMessage:"There was a problem starring your selection"}):a.intl.formatMessage({id:"TkdYlT",defaultMessage:"There was a problem unstarring your selection"}),i.Snackbar.fail(r,"star-action")}};function g(e){var t,r,a;const n=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/home_feed/log_activities",s=null!==(r=null==e?void 0:e.routeParams)&&void 0!==r?r:{},o=null!==(a=null==e?void 0:e.base)&&void 0!==a?a:window.location.origin;return new i.AjaxURL(i.replacePattern(n,s),o)}const m=()=>Date.now();let A=0,I=m();const P=function(e,{delayRequest:t,isBackground:r,shouldAssertResponse:a}={}){A++;const n=new Promise((async(a,n)=>{await async function(e){const t=I;if(I=m(),e||I-t<40){const e=10+~~(90*Math.random());return await new Promise((t=>setTimeout(t,e))),e}return 0}(!!t);(r?i.SilentBackgroundRequest$2:i.WebRequest)({dataType:"json",success:a,error:(t,r,i)=>{"abort"!==r&&(e&&e.url,n())},...e})}));return n.finally((()=>A--)),n};let C={};s.throttle((()=>{s.size(C)>1&&n.reportStack("Multiple role activities",{severity:n.SEVERITY.NONCRITICAL,exc_extra:C}),Object.keys(C).forEach((e=>{const t=C[e];P({url:g(),type:"POST",subject_user:r.mustGetActiveUserId(),data:{role:e,activities_json:JSON.stringify(s.map(t,"json")),send_ts:m(),page_start_ts:window.performance&&window.performance.timing?window.performance.timing.navigationStart||window.performance.timing.fetchStart:void 0}},{isBackground:!0,delayRequest:!0,shouldAssertResponse:!0}).then((()=>t.forEach((e=>e.resolve()))),(()=>t.forEach((e=>e.reject()))))})),C={}}),1e3,{leading:!0,trailing:!0});var v;!function(e){e.NOT_STARTED="NOT_STARTED",e.LOADING="LOADING",e.LOAD_SUCCESS="LOAD_SUCCESS",e.LOAD_FAILED="LOAD_FAILED"}(v||(v={}));const y={starredStates:{},starredFilesMetadata:{loadingState:v.NOT_STARTED,items:[],hasMore:!0,hasLoadedInitial:!1}},N=e=>i.getStateAtNamespace(e,i.STARRED_NAMESPACE_KEY)||y,L=h(N,(e=>e.starredStates)),M=h(L,((e,t)=>t),((e,t)=>e[t])),U=h(L,(e=>e),((e,t)=>Object.keys(e).reduce(((e,r)=>(e[r]=w(t,r),e)),{})));h(U,(e=>Object.keys(e).filter((t=>e[t]))));const w=h(M,(e=>(null==e?void 0:e.loadingState)!==v.LOAD_FAILED&&((null==e?void 0:e.isStarred)||!1))),F=e=>N(e).starredFilesMetadata;h(F,L,((e,t)=>e.items.filter((({resourceId:e})=>void 0!==t[e]&&b(t[e])))));const b=e=>{var t;return(e.loadingState===v.LOAD_SUCCESS||e.loadingState===v.LOADING)&&(null!==(t=e.isStarred)&&void 0!==t&&t)};class k{constructor(e){this._listeners=[],this._dispatcher=e,this._dispatchToken=this._dispatcher.register(this.__invokeOnDispatch.bind(this)),this.__hasChanged=!1}teardown(){this._dispatcher.unregister(this._dispatchToken)}getDispatcher(){return this._dispatcher}getDispatchToken(){return this._dispatchToken}addListener(e){return this._listeners.push(e),()=>this._listeners=Array.from(this._listeners).filter((t=>t!==e))}hasChanged(){return this.__hasChanged}__emitChange(){this.__hasChanged=!0}__invokeOnDispatch(e){if(this.__hasChanged=!1,this.__onDispatch(e),this.__hasChanged)return Array.from(this._listeners).map((e=>e()))}}var H,x,G;!function(e){e.AGGREGATION="AGGREGATION",e.DOC="DOC",e.MSDOC="DOC",e.MSDOC_DEPRECATED="MSDOC",e.PDF="PDF",e.SPREADSHEET="SPREADSHEET",e.FILE="FILE",e.FOLDER="FOLDER",e.SHARED_FOLDER="SHARED_FOLDER",e.TEAM_FOLDER="TEAM_FOLDER",e.PAPER_DOCUMENT="PAPER_DOCUMENT",e.PAPER_FOLDER="PAPER_FOLDER",e.PAPER_PUBLIC_FOLDER="PAPER_PUBLIC_FOLDER",e.PAPER_PROJECT="PAPER_PROJECT",e.EXTERNAL="EXTERNAL",e.CDM_TEAM_MEMBER_FOLDER="CDM_TEAM_MEMBER_FOLDER",e.TEAM_READ_ONLY="TEAM_READ_ONLY",e.SHARED_FOLDER_READ_ONLY="SHARED_FOLDER_READ_ONLY",e.RESTRICTED_FOLDER="RESTRICTED_FOLDER",e.CAMERA_UPLOADS="CAMERA_UPLOADS"}(H||(H={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.DO_NOT_LOAD=1]="DO_NOT_LOAD",e[e.IMMEDIATE=2]="IMMEDIATE",e[e.POST_TTI=3]="POST_TTI"}(x||(x={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SYNCHRONOUS=1]="SYNCHRONOUS",e[e.ASYNCHRONOUS_PRE_TTI=2]="ASYNCHRONOUS_PRE_TTI",e[e.POST_TTI=3]="POST_TTI"}(G||(G={}));const Y="HOME_INITIALIZE_STORE",V="HOME_SET_POST_TTI_PROPS_PROMISE",j="HOME_SET_SECTION_VISIBILITY",B="HOME_STORE_LOADED_ASYNC_CONDITIONAL_SECTION",q="HOME_STORE_DECLARE_CONDITIONAL_SECTION",K="HOME_PREFETCH_RECEIVED_DATA",W="HOME_SET_TAB_ID";var J;!function(e){e.STARRED="Starred",e.TASKS="To-do"}(J||(J={}));const z="HOME_RESOURCE_STORE_RECEIVED_RESOURCE_ID_TO_FILE",$={STARRED:"starred",RECENTS:"recents",SUGGEST:"suggest",TEAMS:"teams",PROMPT:"prompt",RECOMMENDED_MEMBERS:"recommended_members"},X={isPaperEnabledForUser:!1,activeVariants:{},homeStarredActionBar:"OFF",starredTableRedesign:"OFF"},Q={RETRIEVE_STARRED:"retrieve_starred",RECENTS_JSON:"recents_json",RETRIEVE_PAPER_RECENTS:"retrieve_paper_recents",GET_SUGGESTED:"get_suggested"};x.IMMEDIATE,x.POST_TTI;const Z={[Q.RETRIEVE_STARRED]:{fragment:"retrieve_starred",handle:"__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER",section:$.STARRED,conditionalSection:$.STARRED},[Q.RECENTS_JSON]:{fragment:"recents/json",handle:"__REGISTER_RECENTS_PRELOAD_HANDLER",section:$.RECENTS,conditionalSection:$.RECENTS},[Q.RETRIEVE_PAPER_RECENTS]:{fragment:"retrieve_paper_recents",handle:"__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER",section:$.RECENTS,conditionalSection:"paper_recents"},[Q.GET_SUGGESTED]:{fragment:"get_suggested",handle:"__REGISTER_SUGGEST_GRID_PRELOAD_HANDLER",section:$.SUGGEST,conditionalSection:$.SUGGEST,isOptional:!0}};class ee extends k{constructor(){super(o.dispatcherSingleton),this.handledPrefetches=[],this.activeTabId=J.STARRED,this.canRenderItems=()=>!!this.pendingPreTTIPrefetches&&!this.pendingPreTTIPrefetches.length,this.thumbStore=new i.GenericThumbStore,this.sectionToDidLoadSynchronously={},this.sectionToPendingCallbacks={},this.preTTIProps=X}getRole(e){var t;return this.role||(null===(t=this.getUser(e))||void 0===t?void 0:t.role)}getUser(e){return this.user||e.active_user}getThumbStore(){return this.thumbStore}getSectionVisibility(){return this.sectionVisibility}getPreTTIProps(){return this.preTTIProps}getPostTTIPropsPromise(){return this.postTTIPropsPromise}getActiveTabId(){return this.activeTabId}getActiveVariants(){return this.preTTIProps.activeVariants}getActiveVariant(e){const t=this.getActiveVariants();return t&&t[e]}getPageType(e){switch(e){case"/recents":case"/edison_test/recents":return"RECENTS";case"/starred":return"STARRED";default:return"HOME"}}executeWhenSectionIsReady(e,t,r){const i=this.getSectionLoadingPreference(e);return i===x.DO_NOT_LOAD?null:i===x.IMMEDIATE||this.getSectionLoadingMode(e)!==G.UNKNOWN?r(!0):(t&&(this.sectionToPendingCallbacks[e]?this.sectionToPendingCallbacks[e].push(r):this.sectionToPendingCallbacks[e]=[r]),null)}getSectionLoadingPreference(e){if(this.sectionToExtendedConditionalData){const t=this.sectionToExtendedConditionalData[e];return t?t.isPostTti?x.POST_TTI:x.IMMEDIATE:x.DO_NOT_LOAD}return x.UNKNOWN}getSectionLoadingMode(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]?this.sectionToExtendedConditionalData[e].loadingMode:G.UNKNOWN}canRenderAllHomeSections(){return this.sectionToExtendedConditionalData?s.values(this.sectionToExtendedConditionalData).every((e=>!e.isBlocking||(!!e.isPostTti||e.loadingMode!==G.UNKNOWN))):(this.role||n.reportStack("Called canRenderAllHomeSections before initialization",{severity:n.SEVERITY.NONCRITICAL}),!0)}setSectionVisibility({section:e,visible:t}){this.sectionVisibility[e]!==t&&(this.sectionVisibility={...this.sectionVisibility,[e]:t})}setSectionLoadingMode(e,t){const r=this.getExtendedConditionalData(e);r&&(this.sectionToExtendedConditionalData[e]={...r,loadingMode:t})}getExtendedConditionalData(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]}onPrefetchReceivedData({homePrefetchType:e}){this.handledPrefetches.push(e),this.pendingPreTTIPrefetches&&(this.pendingPreTTIPrefetches=s.without(this.pendingPreTTIPrefetches,e),this.pendingPreTTIPrefetches.length||this.__emitChange())}onInitializeStore({viewer:e,role:t,sectionVisibility:r,preTTIProps:i,sectionToConditionalData:a}){this.role=t,this.sectionVisibility=r,this.user=e.get_user_by_role(t),d.assert(!!this.user,`Could not find user for role ${t}`),this.preTTIProps=i||this.preTTIProps,this.pendingPreTTIPrefetches=s.without([Q.RECENTS_JSON].concat(s.compact(s.map(Z,(({section:e},t)=>{if(a){const r=a[e];if(r&&!r.isPostTti)return t}return null})))),...this.handledPrefetches),this.sectionToExtendedConditionalData=s.mapValues(a,((e,t)=>{return{...e,loadingMode:G.UNKNOWN,isBlocking:(r=t,ne(r))};var r})),Object.keys(this.sectionToDidLoadSynchronously).forEach((e=>{(0,this.sectionToDidLoadSynchronously[e])(this.getSectionLoadingPreference(e))&&this.setSectionLoadingMode(e,G.SYNCHRONOUS)})),this.sectionToDidLoadSynchronously={}}onDeclareConditionalSection({section:e,didInitializeSynchronously:t}){this.sectionToExtendedConditionalData?n.reportStack("declared conditional section too late",{severity:n.SEVERITY.CRITICAL,exc_extra:{section:e}}):this.sectionToDidLoadSynchronously[e]?n.reportStack("Re-declared a conditional section",{severity:n.SEVERITY.CRITICAL,exc_extra:{section:e}}):this.sectionToDidLoadSynchronously[e]=t}onLoadedAsyncConditionalSection({section:e}){const t=this.getExtendedConditionalData(e);t&&this.setSectionLoadingMode(e,t.isPostTti?G.POST_TTI:G.ASYNCHRONOUS_PRE_TTI),(this.sectionToPendingCallbacks[e]||[]).forEach((e=>e(!1))),this.sectionToPendingCallbacks[e]=[]}onSetTabId({activeTabId:e}){this.activeTabId=e}onSetPostTTIPropsPromise({postTTIPropsPromise:e}){this.postTTIPropsPromise=e}__onDispatch(e){const t=e.action;switch(t.type){case Y:this.onInitializeStore(t.payload),this.__emitChange();break;case W:this.onSetTabId(t.payload),this.__emitChange();break;case V:this.onSetPostTTIPropsPromise(t.payload),this.__emitChange();break;case K:this.onPrefetchReceivedData(t.payload);break;case j:this.setSectionVisibility(t.payload),this.__emitChange();break;case q:this.onDeclareConditionalSection(t.payload),this.__emitChange();break;case B:this.onLoadedAsyncConditionalSection(t.payload),this.__emitChange()}}}let te=null;function re(e){return(null===te&&(te=new ee),te).getUser(e)}function ie(e){return re(e).role}const ae=function(e){const t={};for(const r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}($);function ne(e){return!!ae[e]}const se=["network_failure","invalid_csrf_token","user_not_logged_in","invalid_logged_out_cookie"];function oe(e){return{isError:!0,error:e}}const de={".tag":"undefined_error"};async function ce(e){var t,r,a,n,s;try{return function(e){return{isError:!1,result:e}}(await(new i.ActiveUserApiV2Client).ns("starring").rpc("get_starred_items_v2",{limit:e},{}))}catch(e){const o=i.filterApiError(e);return void 0!==(null===(t=null==o?void 0:o.error)||void 0===t?void 0:t[".tag"])?oe(o.error):void 0!==(null===(a=null===(r=null==o?void 0:o.error)||void 0===r?void 0:r.reason)||void 0===a?void 0:a[".tag"])?oe({".tag":null===(s=null===(n=null==o?void 0:o.error)||void 0===n?void 0:n.reason)||void 0===s?void 0:s[".tag"]}):(null==o?void 0:o.message.includes("network failure"))?oe({".tag":"network_failure"}):oe(de)}}async function le(e){const t=e.map((e=>e.idTypePair));if(0===t.length)return;const r=await i.fetchViewer(),a=await function(e,t){return P({url:"/home_feed/get_file_metadata",type:"POST",subject_user:e.id,data:{resources_json:JSON.stringify(t)}},{isBackground:!0})}(re(r),t),n={};a.forEach((e=>{return n[(t=e,t.type+":"+t.id)]=e.file_metadata;var t})),o.dispatcherSingleton.dispatch({type:z,resourceIdToFile:n})}function _e({details:t,title:r,url:i,display_type:a,id_type:n,resource_id:s,is_mounted:o,per_node_metadata:d,icon:c,is_encrypted:l}){if(void 0===n)return;const _=function(t){switch(t){case e.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID:case e.HOME_RESOURCE_ID_TYPE.FQ_PATH:case e.HOME_RESOURCE_ID_TYPE.PAPER_DOCUMENT_ID:case e.HOME_RESOURCE_ID_TYPE.PAPER_FOLDER_ID:case e.HOME_RESOURCE_ID_TYPE.PAPER_DOCUMENT_ID_PATH:case e.HOME_RESOURCE_ID_TYPE.PAPER_FOLDER_ID_PATH:case e.HOME_RESOURCE_ID_TYPE.EXTERNAL_RESOURCE_ID:return t;default:return}}(n);return void 0!==_&&void 0!==t?{details:ue(t.fq_path||"",t.target_ns_id,t.is_team_member_folder),title:r||"",url:i||"",display_type:a||"",id_type:_||"",resource_id:s||"",is_mounted:o,per_node_metadata:d,icon:c,is_encrypted:l}:void 0}function ue(e,t,r){return void 0===t||void 0===r?{fq_path:e}:{fq_path:e,target_ns_id:t,is_team_member_folder:r}}const Ee=t.createAsyncThunk(`${i.STARRED_NAMESPACE_KEY}/getStarredStatus`,(async(e,{getState:t,dispatch:r})=>{const a=ie(await i.fetchViewer()),n=N(t());if(!n)return[];const s=e.filter((({id:e})=>{var t;return(null===(t=n.starredStates[e])||void 0===t?void 0:t.loadingState)!==v.LOADING}));if(0===s.length)return[];r(De.setLoadingStates(s));const o=await(async(e,t)=>{const r=p(p(t,250),8),i=[];for(const t of r){const r=t.map((t=>f(R(),{role:e,resources_json:JSON.stringify(t)},!0))),a=await Promise.all(r);i.push(...a.flat())}return i})(a,s);return r({type:"UPDATE_FAVORITES_ACTION",payload:{}}),o})),Se=t.createAsyncThunk(`${i.STARRED_NAMESPACE_KEY}/updateStarredStatus`,(async({id:t,newStatus:r,idType:a=e.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID},{getState:n,dispatch:s})=>{const o=(d=n(),F(d).hasLoadedInitial);var d;const c=await i.fetchViewer(),l=await D(ie(c),t,a,r);return o&&!0===r&&s(Te()),l})),Te=t.createAsyncThunk(`${i.STARRED_NAMESPACE_KEY}/getAllStarred`,(async()=>{const e=await ce(1e3);if(e.isError){const i=r.getActiveUserId()?n.SEVERITY.CRITICAL:n.SEVERITY.USER_ERROR;return t=e.error,se.some((e=>t[".tag"].includes(e)))||n.reportStack("Failed to fetch starred files with GetStarredItems",{severity:i,exc_extra:e.error,silent:!0}),Promise.reject(new Error(e.error[".tag"]))}var t;const i=e.result;if("success"===i.status&&i.items){const e=function(e){if(void 0===e.items)return{status:e.status||"failure",items:[],has_more:e.has_more||!1};const t=[];for(const r of e.items){const e=_e(r);if(void 0===e)return;t.push(e)}return{status:e.status||"failure",items:t,has_more:e.has_more||!1}}(i);return void 0===e||void 0===e.items?(n.reportStack("GetStarredItems returned items without required fields.",{severity:n.SEVERITY.CRITICAL,exc_extra:i,silent:!0}),Promise.reject(new Error("GetStarredItems returned items without required fields."))):(le(e.items.map((e=>({idTypePair:{id:e.resource_id,type:e.id_type},starred:!0})))),e)}return n.reportStack("Failed to fetch starred files with GetStarredItems",{severity:n.SEVERITY.CRITICAL,exc_extra:i,silent:!0}),Promise.reject(new Error("Failed to fetch starred files with GetStarredItems"))})),he=({resource_id:e,id_type:t,display_type:r,details:{fq_path:i,...a},...n})=>({resourceId:e,idType:t,displayType:r,isMounted:n.is_mounted,perNodeMetadata:n.per_node_metadata,isEncrypted:n.is_encrypted,details:{fqPath:i,...a},...n}),Re=e=>{e.starredFilesMetadata.items.forEach((({resourceId:t})=>{e.starredStates[t]={isStarred:!0,loadingState:v.LOAD_SUCCESS}}))},fe=t.createSlice({name:i.STARRED_NAMESPACE_KEY,initialState:y,reducers:{clear:()=>y,setStarredStatus:(e,t)=>{e.starredStates[t.payload.id]={loadingState:v.LOAD_SUCCESS,isStarred:t.payload.isStarred}},deleteStarredItem:(e,t)=>{e.starredFilesMetadata.items=e.starredFilesMetadata.items.filter((e=>e.resourceId!==t.payload.id))},deleteStarredItems:(e,t)=>{e.starredFilesMetadata.items=e.starredFilesMetadata.items.filter((e=>!t.payload.ids.includes(e.resourceId)))},setLoadingStates:(e,t)=>{t.payload.forEach((({id:t})=>{void 0===e.starredStates[t]&&(e.starredStates[t]={loadingState:v.LOADING})}))},setStarredStates:(e,t)=>{e.starredStates=t.payload.starredStates,e.starredFilesMetadata.loadingState=v.NOT_STARTED,e.starredFilesMetadata.hasMore=!1,e.starredFilesMetadata.hasLoadedInitial=!0},setStarredMetadata:(e,t)=>{const r=t.payload;"success"===r.status?(e.starredFilesMetadata={items:r.items.map(he),loadingState:v.LOAD_SUCCESS,hasMore:r.hasMore,hasLoadedInitial:!0},Re(e)):e.starredFilesMetadata.loadingState=v.LOAD_FAILED}},extraReducers:e=>{e.addCase(Ee.fulfilled,((e,t)=>{t.payload.forEach((({id:t,is_starred:r})=>{e.starredStates[t]={loadingState:v.LOAD_SUCCESS,isStarred:r}}))})).addCase(Ee.rejected,((e,t)=>{t.meta.arg.forEach((({id:r})=>{var i,a;e.starredStates[r]={loadingState:v.LOAD_FAILED,error:null!==(a=null===(i=null==t?void 0:t.error)||void 0===i?void 0:i.message)&&void 0!==a?a:"error fetching starred starred data"}}))})).addCase(Se.fulfilled,((e,t)=>{const{id:r}=t.meta.arg,i=e.starredStates[r];if(i&&i.loadingState===v.LOAD_SUCCESS&&(i.isStarred=t.meta.arg.newStatus,t.meta.arg.showSnackbar)){const{itemName:e,newStatus:r}=t.meta.arg;O({itemName:e,isStarred:r,success:!0})}})).addCase(Se.rejected,((e,t)=>{if(t.meta.arg.showSnackbar){const{itemName:e,newStatus:r}=t.meta.arg;O({itemName:e,isStarred:r,success:!1})}})).addCase(Te.pending,(e=>{e.starredFilesMetadata.loadingState=v.LOADING})).addCase(Te.fulfilled,((e,t)=>{e.starredFilesMetadata.loadingState=v.LOAD_SUCCESS,t.payload.items&&(e.starredFilesMetadata.items=t.payload.items.map(he),Re(e),e.starredFilesMetadata.hasLoadedInitial=!0,e.starredFilesMetadata.hasMore=!!t.payload.has_more)})).addCase(Te.rejected,(e=>{e.starredFilesMetadata.loadingState=v.LOAD_FAILED}))}}),{reducer:pe}=fe,De=fe.actions;e.displayStarSnackbar=O,e.fetchMissingStarredStatuses=Ee,e.getIsStarred=w,e.getUser=re,e.itemNameFromStarrableItem=function(e){return function(e){return!!e.file_id}(e)||function(e){return!!e.fq_path}(e)?i.filename(e.fq_path):function(e){return!!e.pad_id}(e)?e.title:function(e){return!!e.folder_id}(e)?e.name:function(e){return!!e.filename}(e)?e.filename:e},e.reducer=pe,e.updateStarredStatus=Se}));
//# sourceMappingURL=c_starred_redux_slice.js-vflEDAmEs.map

//# debugId=9a805aa4-19f3-370d-b666-02a0ebb3e3dc