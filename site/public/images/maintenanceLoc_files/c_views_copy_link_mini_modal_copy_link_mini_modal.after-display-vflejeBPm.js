!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="0fdd17f6-293c-347d-b3cb-a132a22d4d48")}catch(e){}}();
define(["exports","react","./e_file_viewer_static_scl_page_folder","./c_pap-events_docsend_view_docsend_hub_entry_button","./e_data_modules_stormcrow","./c_core_i18n","./c_components_sharing_spinner","./c_dig-icons_assets_ui-icon_line_rewind","./c_react-use_useEffectOnce","./c_dig-icons_assets_ui-icon_line_lock","./c_dig-icons_assets_ui-icon_line_passwords","./c_stormcrow_stormcrow_exposure_logger","./c_datatypes_sharing_account-metadata","./c_lodash","./c_shared_with_redux_store","./c_sharing_sharing_pap_logging_create_shared_link_util","./c_api_v2_routes_folders_info_provider","./e_core_exception","./c_api_v2_routes_password_confirmation_provider","./e_edison","./c_src_sink_index","./c_sharing_low_distraction_view_gating_utils","./c_sharing_async_share_modal_util","./c_core_notify","react-dom","metaserver/static/js/modules/constants/viewer","./c_api_v2_routes_team_provider","metaserver/static/js/langpack","./c_reduxjs_toolkit_redux-toolkit","./c_pap-events_previews_create_folder","./c_browse_data_selectors","./c_tagging_utils","./c_browse_models","./c_search_search_helpers","./c_pap-events_navigation_select_create_folder_action","./c_dig-icons_assets_ui-icon_line_star","./c_browse_action_logger","./c_files_view_util","./c_pnm_utils","./c_onboarding_survey_lib_oa_pulsar_campaigns","./c_sync_everything_redux_selectors","./c_sync_everything_redux_types","./c_sharing_avatar_info","./c_tagging_data_store","./c_sync_everything_redux_store","./c_flux_action_type"],(function(e,t,i,s,n,o,r,a,l,c,p,d,h,u,m,_,g,f,E,L,k,y,I,C,v,S,T,A,w,O,M,b,R,N,x,P,F,D,B,U,V,H,W,z,q,K){"use strict";function Y(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var G=Y(t);const j="copy-link-mini-modal__header",Q=o.defineMessages({pending:{id:"LPF3tp",defaultMessage:"Getting the link..."},copy:{id:"emiHs/",defaultMessage:"Copy Link"},successResult:{id:"v2yJMn",defaultMessage:"Link copied."},successResultWithContentName:{id:"2hYKWz",defaultMessage:"Link copied to <b>{contentNameInHeader}.</b>"},successResultWithComment:{id:"VplQol",defaultMessage:"Link copied to comment in <b>{contentNameInHeader}.</b>"},error:{id:"rp1Lxc",defaultMessage:"Couldn't copy the link."},errorWithComment:{id:"f1LIBk",defaultMessage:"Couldn't copy the link to comment."},tryAgain:{id:"wXhxJC",defaultMessage:"Try again"}});class $ extends G.Component{constructor(){super(...arguments),this._getContentName=e=>{if(e){const t=e.split("/");return t[t.length-1]}}}render(){return G.createElement("div",{className:j},G.createElement("div",{className:`${j}-content`},this.props.stageType===i.ModalStage.PENDING&&this._renderPendingStage(),this.props.stageType===i.ModalStage.COPY&&this._renderCopyStage(),this.props.stageType===i.ModalStage.RESULT&&this._renderResultStage(),this.props.stageType===i.ModalStage.ERROR_CLIENT&&this._renderClientErrorStage(),this.props.stageType===i.ModalStage.ERROR_SERVER&&this._renderServerErrorStage()),this._renderCloseButton())}_renderPendingStage(){return G.createElement(G.Fragment,null,G.createElement(r.SharingSpinner,{ariaValue:"Loading xsmall",textSize:"standard"}),G.createElement(i.Text,{className:`${j}--pending-text`},o.intl.formatMessage(Q.pending)))}_renderCopyStage(){return G.createElement(i.Text,null,G.createElement(i.Link,{href:"#",hasNoUnderline:!0,onClick:()=>{var e,t;return null===(t=(e=this.props).actionHandler)||void 0===t?void 0:t.call(e,!0)},isBold:!0},G.createElement(i.UIIcon,{src:i.LinkLine,"aria-label":""}),o.intl.formatMessage(Q.copy)))}_renderResultStage(){let e;this.props.fileInfo?e=this.props.fileInfo.fq_path:this.props.fileUploadInfo?e=this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name:this.props.browseFileInfo&&(e=this.props.browseFileInfo.fq_path);const t=this._getContentName(e),s=this.props.isLinkToComment||this.props.isFileEligiblePreviewLinkRecipient?150:225,n=t?G.createElement(i.Truncate,{className:`${j}--content-name`,maxWidth:s,observeParent:!0,location:.5},t):void 0;let r=o.intl.formatMessage(Q.successResult);if(n){const e={contentNameInHeader:n,b:e=>G.createElement("b",{style:{display:"flex",flexGrow:"1"}},e)};r=Boolean(this.props.isLinkToComment)?o.intl.formatMessage(Q.successResultWithComment,e):o.intl.formatMessage(Q.successResultWithContentName,e)}return G.createElement(G.Fragment,null,G.createElement(i.UIIcon,{className:`${j}--result-icon`,style:{paddingBottom:"4px"},src:i.LinkLine,size:"standard","aria-label":""}),G.createElement("div",{className:`${j}--result-container`,style:{marginLeft:"0px"}},G.createElement(i.Text,{className:`${j}--result-text`,size:this.props.isFileEligiblePreviewLinkRecipient?"xsmall":"medium"},r)))}_renderClientErrorStage(){const e=this.props.isLinkToComment?o.intl.formatMessage(Q.errorWithComment):o.intl.formatMessage(Q.error);return G.createElement(G.Fragment,null,G.createElement(i.UIIcon,{className:`${j}--client-error-icon`,src:i.FailLine,"aria-label":""}),G.createElement(i.Text,{className:`${j}--client-error-text`},G.createElement("b",null,e,"Â "),G.createElement(i.Link,{href:"#",hasNoUnderline:!0,onClick:()=>{var e,t;return null===(t=(e=this.props).actionHandler)||void 0===t?void 0:t.call(e,!0)},isBold:!0},o.intl.formatMessage(Q.tryAgain))))}_renderServerErrorStage(){return G.createElement(G.Fragment,null,G.createElement("div",null,G.createElement(i.UIIcon,{size:"standard",src:i.FailLine,"aria-label":""})),G.createElement(i.Text,{className:`${j}--server-error-text`},this.props.errorMessage))}_renderCloseButton(){const e=this.props.isFileEligiblePreviewLinkRecipient?{paddingBottom:"4px"}:{};return G.createElement(i.IconButton,{"aria-label":"close",onClick:this.props.closeButtonHandler,variant:"transparent",isRounded:!0,size:"small",style:e},G.createElement(i.UIIcon,{src:i.CloseLine,"aria-label":""}))}}$.displayName="CopyLinkMiniModalHeaderComponent";const X=i.requireCssWithComponent($,["/static/metaserver/static/css/dig-components/index.web-vflnMddsO.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css"]);class J extends G.Component{constructor(){super(...arguments),this.handleCopy=()=>{this.props.onCopyToClipboard(i.CopyLinkMethod.MANUAL)}}componentDidMount(){this.props.shouldFocusOnLink&&this.props.focusOnInput()}componentDidUpdate(){this.props.shouldFocusOnLink&&this.props.focusOnInput()}render(){return G.createElement("div",{className:"copy-link-mini-modal__link"},G.createElement(i.TextInput,{onCopy:this.handleCopy,size:this.props.isFileEligiblePreviewLinkRecipient?"large":"standard","aria-label":o.intl.formatMessage({id:"qx4buj",defaultMessage:"Link for copy link click"}),value:this.props.sharedLink.url,readOnly:!0,onClick:this.props.focusOnInput,ref:this.props.inputRef,wrapperProps:{className:"link-container"}}))}}J.displayName="CopyLinkMiniModalLinkComponent";const Z=i.requireCssWithComponent(J,["/static/metaserver/static/css/dig-components/index.web-vflnMddsO.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css"]),ee="copy-link-mini-modal__footer",te="link-info";class ie extends G.Component{constructor(){super(...arguments),this.textSize=this.props.isFileEligiblePreviewLinkRecipient?"xsmall":"small",this.alignItemsPreviewLink=this.props.isFileEligiblePreviewLinkRecipient?{alignItems:"center"}:{},this.handleManageClick=()=>{var e;i.ShareTibEventLogger.log(this.props.user.id,i.TiburonEventName.ClickManageLinkSettings,i.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL,{...i.buildExtraFromLinkMetadata(this.props.sharedLink),fq_path:this.getFqPath()}),i.logPAPSelectCopyLinkMiniModalEvent(this.props.sharedLink,"manage_setting",null===(e=this.props.loggingProps)||void 0===e?void 0:e.content),this.props.openShareModalSettings(i.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL)}}render(){return G.createElement("div",{className:ee},G.createElement("div",{className:`${ee}-content`},this.props.isLowDistractionViewSettingEnabled&&G.createElement("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",width:"100%",padding:"12px 12px 0px",...this.alignItemsPreviewLink}},this._renderLowDistractionLinkInfo(),!this.isShortcutFileType()&&this._renderManageButton(),this._renderPreviewButton()),!this.props.isLowDistractionViewSettingEnabled&&G.createElement(G.Fragment,null,this._renderLinkInfo(),!this.isShortcutFileType()&&this._renderManageButton(),this._renderPreviewButton())))}_renderLinkInfo(){return G.createElement(i.Text,{"data-testid":te,style:{display:"flex",alignItems:"flex-start"},color:"subtle",size:this.props.isFileEligiblePreviewLinkRecipient?"xsmall":"small"},this.renderAudienceIcon(),this.formatLinkInfoText())}_renderLowDistractionLinkInfo(){const e=G.createRef();return G.createElement("div",{style:{display:"flex",flexDirection:"column"}},G.createElement(i.Text,{"data-testid":te,style:{marginBottom:"4px"},size:this.textSize},this.formatLinkLowDistractionInfoText()),G.createElement("div",{style:{display:"flex",alignItems:"center"}},G.createElement(i.Text,{size:this.textSize},o.intl.formatMessage({id:"/8kLW4",defaultMessage:"Link shows a focused view"})),G.createElement(i.Tooltip,{title:o.intl.formatMessage({id:"xJTk2B",defaultMessage:"Hides activity and prompts to sign up"}),triggerRef:e,placement:"bottom-end",maxWidth:150},G.createElement("span",{ref:e,style:{marginLeft:"4px"}},G.createElement(i.UIIcon,{src:i.InfoLine,size:"small"})))))}_renderManageButton(){const e=this.props.isLowDistractionViewSettingEnabled?{alignSelf:"flex-end",paddingTop:"0px",marginBottom:"2px"}:{},t=this.props.isFileEligiblePreviewLinkRecipient?{paddingTop:"0px",alignSelf:"center",marginLeft:"16px",marginRight:"8px"}:{};return G.createElement(i.Button,{variant:"transparent",size:"small",style:{marginLeft:"8px",alignSelf:"flex-start",paddingTop:"2px",...e,...t},onClick:this.handleManageClick},o.intl.formatMessage({id:"6BOuuN",defaultMessage:"Manage"}))}getFqPath(){let e;return this.props.fileInfo?e=this.props.fileInfo.fq_path:this.props.fileUploadInfo?e=this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name:this.props.browseFileInfo&&(e=this.props.browseFileInfo.fq_path),e}isShortcutFileType(){const e=this.getFqPath();return e&&e.endsWith(".web")}formatLinkInfoText(){return this.props.contentType?"public"===this.props.linkAudience?o.intl.formatMessage({id:"8kew9O",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"team"===this.props.linkAudience?o.intl.formatMessage({id:"LlzMnS",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"password"===this.props.linkAudience?o.intl.formatMessage({id:"2yevNp",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"no_one"===this.props.linkAudience?o.intl.formatMessage({id:"iv/o3s",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"":"public"===this.props.linkAudience?o.intl.formatMessage({id:"5n50wF",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"team"===this.props.linkAudience?o.intl.formatMessage({id:"HcnRtr",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"password"===this.props.linkAudience?o.intl.formatMessage({id:"ego60b",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"no_one"===this.props.linkAudience?o.intl.formatMessage({id:"VUeAlW",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):""}formatLinkLowDistractionInfoText(){return this.props.contentType?"public"===this.props.linkAudience?o.intl.formatMessage({id:"qU437C",defaultMessage:"Anyone with this link <bold>can {canEdit, select, true {edit} other {view}}</bold> the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType,bold:(...e)=>G.createElement(i.Text,{isBold:!0,size:this.textSize},e)}):"team"===this.props.linkAudience?o.intl.formatMessage({id:"dvfXQN",defaultMessage:"Team members with this link <bold>can {canEdit, select, true {edit} other {view}}</bold> the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType,bold:(...e)=>G.createElement(i.Text,{isBold:!0,size:this.textSize},e)}):"password"===this.props.linkAudience?o.intl.formatMessage({id:"2AvhLq",defaultMessage:"People with the password <bold>can {canEdit, select, true {edit} other {view}}</bold> the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType,bold:(...e)=>G.createElement(i.Text,{isBold:!0,size:this.textSize},e)}):"no_one"===this.props.linkAudience?o.intl.formatMessage({id:"piQTVL",defaultMessage:"Only people invited <bold>can {canEdit, select, true {edit} other {view}}</bold> the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType,bold:(...e)=>G.createElement(i.Text,{isBold:!0,size:this.textSize},e)}):"":"public"===this.props.linkAudience?o.intl.formatMessage({id:"u6TiLO",defaultMessage:"Anyone with this link <bold>can {canEdit, select, true {edit} other {view}}</bold>"},{canEdit:"editor"===this.props.linkAccessLevel,bold:(...e)=>G.createElement(i.Text,{isBold:!0,size:this.textSize},e)}):"team"===this.props.linkAudience?o.intl.formatMessage({id:"RsM+DV",defaultMessage:"Team members with this link <bold>can {canEdit, select, true {edit} other {view}}</bold>"},{canEdit:"editor"===this.props.linkAccessLevel,bold:(...e)=>G.createElement(i.Text,{isBold:!0,size:this.textSize},e)}):"password"===this.props.linkAudience?o.intl.formatMessage({id:"Um/GGI",defaultMessage:"People with the password <bold>can {canEdit, select, true {edit} other {view}}</bold>"},{canEdit:"editor"===this.props.linkAccessLevel,bold:(...e)=>G.createElement(i.Text,{isBold:!0,size:this.textSize},e)}):"no_one"===this.props.linkAudience?o.intl.formatMessage({id:"S7cnsi",defaultMessage:"Only people invited <bold>can {canEdit, select, true {edit} other {view}}</bold>"},{canEdit:"editor"===this.props.linkAccessLevel,bold:(...e)=>G.createElement(i.Text,{isBold:!0,size:this.textSize},e)}):""}renderAudienceIcon(){let e=null;return"public"===this.props.linkAudience?e=a.GlobeLine:"team"===this.props.linkAudience?e=l.TeamLine:"no_one"===this.props.linkAudience?e=c.LockLine:"password"===this.props.linkAudience&&(e=p.PasswordsLine),null===e?null:G.createElement(i.UIIcon,{"data-testid":"audience-icon",src:e,size:"small",style:{marginRight:"4px",paddingTop:"4px"}})}_renderPreviewButton(){return this.props.loggingProps&&this.props.isFileEligiblePreviewLinkRecipient?G.createElement(i.PreviewAsRecipientButton,{sharedLink:this.props.sharedLink,openShareModalSettings:this.props.openShareModalSettings,loggingProps:this.props.loggingProps}):null}}ie.displayName="CopyLinkMiniModalFooterComponent";const se=i.requireCssWithComponent(ie,["/static/metaserver/static/css/dig-components/index.web-vflnMddsO.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css"]),ne=e=>e.formatMessage({id:"ypX/4G",defaultMessage:"Password protection is an advanced option for your shared links. Buy to unlock this option."}),oe=e=>e.formatMessage({id:"tRNjz7",defaultMessage:"Expiration dates are an advanced option for your shared links. Buy to unlock this option."}),re=e=>e.formatMessage({id:"mMVdb/",defaultMessage:"Disabling downloads is an advanced option for your shared links. Buy to unlock this option."}),ae=e=>e.formatMessage({id:"nARRI/",defaultMessage:"Allow downloads setting is on. To disable, purchase access to advanced options."});const le=Symbol("ON_BUY_NOW_CLICK_FROM_COPY_LINK_MINI_MODAL"),{useEmitter:ce,defaultEmitter:pe}=i.defineLogger((async({event:e})=>{if(e.key!==le)var t;else i.UDCL.logEvent({class:"share",action:"click",object:"share_copy_link_mini_modal_upsell",properties:t})}));i.injectInternalStyle("/static/metaserver/static/js/sharing/views/copy_link_mini_modal/copy_link_mini_modal_upsell.module.out-vflXn91fX.css",(e=>"._copy-link-mini-modal-upsell-root_1iwy0_3{background-color:#f8fcea;border:1px solid var(--dig-color__identity__green);border-radius:6px;height:244px;margin-top:var(--dig-spacing__micro__small);width:402px}._copy-link-mini-modal-upsell-info_1iwy0_16,._copy-link-mini-modal-upsell-root_1iwy0_3{align-items:center;display:flex;flex-direction:column;justify-content:center}._copy-link-mini-modal-upsell-info_1iwy0_16{height:50%;text-align:center}._copy-link-mini-modal-upsell-settings_1iwy0_25{display:flex;flex-direction:column;height:50%;justify-content:space-around;padding:0 20px 16px;width:100%}._copy-link-mini-modal-upsell-button_1iwy0_34{background-color:var(--dig-color__identity__green);color:var(--dig-color__text__base)}._copy-link-mini-modal-upsell-button_1iwy0_34:hover{color:#fff}._copy-link-mini-modal-upsell-settings-item_1iwy0_43{align-items:center;display:flex;justify-content:space-between}._copy-link-mini-modal-upsell-settings-label_1iwy0_49{align-items:center;display:flex}._copy-link-mini-modal-upsell-settings-icon_1iwy0_54{color:var(--dig-color__border__bold);height:16px;width:16px}._copy-link-mini-modal-upsell-settings-toggle_1iwy0_60{align-items:center;display:flex}._copy-link-mini-modal-upsell-settings-toggle-text_1iwy0_65{margin-left:4px}._copy-link-mini-modal-upsell-subheader-text_1iwy0_69{color:var(--dig-color__border__bold);padding-bottom:12px}._copy-link-mini-modal-upsell-header-text_1iwy0_74{padding-bottom:4px}._copy-link-mini-modal-upsell-disabled-text_1iwy0_78{color:var(--dig-color__border__bold)}"));const de="_copy-link-mini-modal-upsell-root_1iwy0_3",he="_copy-link-mini-modal-upsell-info_1iwy0_16",ue="_copy-link-mini-modal-upsell-settings_1iwy0_25",me="_copy-link-mini-modal-upsell-button_1iwy0_34",_e="_copy-link-mini-modal-upsell-settings-item_1iwy0_43",ge="_copy-link-mini-modal-upsell-settings-label_1iwy0_49",fe="_copy-link-mini-modal-upsell-settings-icon_1iwy0_54",Ee="_copy-link-mini-modal-upsell-settings-toggle_1iwy0_60",Le="_copy-link-mini-modal-upsell-settings-toggle-text_1iwy0_65",ke="_copy-link-mini-modal-upsell-subheader-text_1iwy0_69",ye="_copy-link-mini-modal-upsell-header-text_1iwy0_74",Ie="_copy-link-mini-modal-upsell-disabled-text_1iwy0_78",Ce=({stage:e,isFromShareMe24Modal:t,overlayRef:s})=>{var n;const{variant:r}=i.useExperimentVariant("sharing_advanced_clmm_upsell"),a=ce(),l=G.useCallback((async()=>{await a.select(le).emit(null),i.open_tab("/buy/essentials?_tk=clmm_upsell_button",!1)}),[a]),c=i.sharingAccountInfoPackage.useQuery({},{retry:!0}),p=h.isFreeUnpairedNonTeamUser(null===(n=c.data)||void 0===n?void 0:n.apiData),u=[i.ModalStage.RESULT,i.ModalStage.COPY].includes(e)&&t&&p;return G.useEffect((()=>{u&&(i.logExposure({feature:"sharing_advanced_clmm_upsell",variant:r}),d.logVariantExposure("sharing_advanced_clmm_upsell",r))}),[u]),"ON"===r&&u?(s.current&&s.current.update(),G.createElement(i.ThemeProvider,{mode:"bright"},G.createElement(i.ThemeContainer,null,G.createElement("div",{className:de},G.createElement(i.Box,{className:he},G.createElement(i.Text,{className:ye,variant:"label",size:"medium",isBold:!0,tagName:"h2"},o.intl.formatMessage({id:"P+scIC",defaultMessage:"Add more security when sharing"})),G.createElement(i.Text,{className:ke,variant:"label",size:"medium",tagName:"h3"},(e=>e.formatMessage({id:"KpUUfL",defaultMessage:"Advanced options for your shared links."}))(o.intl)),G.createElement(i.Button,{className:me,variant:"primary",withIconStart:G.createElement(i.UIIcon,{src:i.ActivityFill}),onClick:l},(e=>e.formatMessage({id:"95iLz4",defaultMessage:"Buy now"}))(o.intl))),G.createElement(i.Box,{className:ue},G.createElement(i.Box,{className:_e},G.createElement(i.Box,{className:ge},G.createElement(i.UIIcon,{className:fe,src:i.ActivityFill,"aria-hidden":"true"}),G.createElement(i.Text,{className:Ie,variant:"label",size:"small",isBold:!0,"aria-label":ne(o.intl)},(e=>e.formatMessage({id:"X4D2qV",defaultMessage:"Password"}))(o.intl))),G.createElement(i.Box,null,G.createElement(i.Text,{className:Ie,variant:"label",size:"small","aria-hidden":"true"},(e=>e.formatMessage({id:"0SN7of",defaultMessage:"set password"}))(o.intl)))),G.createElement(i.Box,{className:_e},G.createElement(i.Box,{className:ge},G.createElement(i.UIIcon,{className:fe,src:i.ActivityFill,"aria-hidden":"true"}),G.createElement(i.Text,{className:Ie,variant:"label",size:"small",isBold:!0,"aria-label":oe(o.intl)},(e=>e.formatMessage({id:"VJadj5",defaultMessage:"Expiration"}))(o.intl))),G.createElement(i.Box,null,G.createElement(i.Text,{className:Ie,variant:"label",size:"small","aria-hidden":"true"},(e=>e.formatMessage({id:"nZqK7W",defaultMessage:"set expiration date"}))(o.intl)))),G.createElement(i.Box,{className:_e},G.createElement(i.Box,{className:ge},G.createElement(i.UIIcon,{className:fe,src:i.ActivityFill,"aria-hidden":"true"}),G.createElement(i.Text,{className:Ie,variant:"label",size:"small",isBold:!0,"aria-label":re(o.intl)},(e=>e.formatMessage({id:"CfBEH2",defaultMessage:"Allow downloads"}))(o.intl))),G.createElement(i.Box,{className:Ee},G.createElement(i.Toggle,{isToggled:!0,disabled:!0,wrapperProps:{"aria-label":ae(o.intl)}}),G.createElement(i.Text,{className:i.cx(Le,Ie),color:"disabled",variant:"label",size:"medium","aria-hidden":"true"},(e=>e.formatMessage({id:"gYfhmN",defaultMessage:"On"}))(o.intl))))))))):null};Ce.displayName="CopyLinkMiniModalUpsell";const ve=()=>{const[e,t]=G.useState(!0);if(!e)return null;const s=o.intl.formatMessage({id:"FABv5W",defaultMessage:"Recipients can comment on your files without a Dropbox account."});return G.createElement(i.Box,{borderRadius:"Large",backgroundColor:"Primary Surface",padding:"Micro Medium",marginTop:"Micro Medium",style:{display:"flex",justifyContent:"space-between"}},G.createElement(i.Text,{variant:"paragraph",size:"medium"},s,G.createElement(i.Link,{href:"https://help.dropbox.com/view-edit/turn-off-comment-feature",variant:"monochromatic",isBold:!0,style:{marginLeft:"var(--dig-spacing__micro__xsmall)"},target:"_blank"},o.intl.formatMessage({id:"onr7U5",defaultMessage:"Learn more"}))),G.createElement(i.IconButton,{variant:"transparent",size:"small",onClick:()=>t(!1)},G.createElement(i.UIIcon,{src:i.CloseLine,"aria-label":o.intl.formatMessage({id:"+qEQdA",defaultMessage:"Close"})})))};ve.displayName="LoggedOutCommentingBanner";class Se extends G.default.Component{constructor(e){super(e),this.onWindowResize=u.throttle((()=>{this.props.anchorRef.current||this.props.closeButtonHandler()}),500),this.handleClick=e=>{e.stopPropagation()},this.overlayRef=G.default.createRef()}componentDidMount(){window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}componentDidUpdate(){var e;null===(e=this.overlayRef.current)||void 0===e||e.update()}render(){const{anchorRef:e,inputRef:t,stage:s,closeButtonHandler:o,linkAccessLevel:r,sharedLink:a,shouldFocusOnLink:l,focusOnInput:c,actionHandler:p,errorMessage:d,onCopyToClipboard:h,zIndexOverride:u,placement:m,fileInfo:_,fileUploadInfo:g,browseFileInfo:f,linkAudience:E,user:L,isLowDistractionViewSettingEnabled:k,yOffsetDistance:y,isLoggedOutCommentingEnabled:I,isFileEligiblePreviewLinkRecipient:C,openShareModalSettings:v,loggingProps:S,isLinkToComment:T}=this.props,A=G.default.createElement(X,{stageType:s,isLinkToComment:T,actionHandler:p,closeButtonHandler:o,sharedLink:a,errorMessage:d,fileInfo:_,fileUploadInfo:g,browseFileInfo:f,isFileEligiblePreviewLinkRecipient:C});let w=G.default.createElement(G.default.Fragment,null);a&&c&&t&&(w=G.default.createElement(Z,{sharedLink:a,focusOnInput:c,inputRef:t,shouldFocusOnLink:l,onCopyToClipboard:h,isFileEligiblePreviewLinkRecipient:C}));let O=G.default.createElement(G.default.Fragment,null);if(a&&s===i.ModalStage.RESULT){let e;"object"==typeof a&&".tag"in a&&(e=a[".tag"]),e||(e=a.file_type),O=G.default.createElement(se,{linkAccessLevel:r,linkAudience:E,contentType:e,fileInfo:_,fileUploadInfo:g,browseFileInfo:f,user:L,sharedLink:a,openShareModalSettings:v,isLowDistractionViewSettingEnabled:k,isFileEligiblePreviewLinkRecipient:C,loggingProps:S})}const M=G.default.createElement(n.QueryClientProvider,{client:n.queryClient},G.default.createElement(Ce,{stage:s,isFromShareMe24Modal:this.props.isFromShareMe24Modal,overlayRef:this.overlayRef}));return G.default.createElement(i.LayerContext.Provider,{value:{zIndex:u||20}},G.default.createElement(i.ClickOutside,{isActive:!0,onClickOutside:o,shouldPropagateMouseEvents:!1,isBlock:!0,shouldClickOutsideWhenDefaultPrevented:!0},G.default.createElement(i.Overlay,{className:i.cx("copy-link-mini-modal__overlay",{"preview-link":C}),anchorRef:e,placement:m||"bottom",auto:!0,offsetDistance:null!=y?y:4,onClick:this.handleClick,ref:this.overlayRef},A,w,O,M,I&&G.default.createElement(ve,null))))}}Se.displayName="CopyLinkMiniModalOverlayComponent";const Te=i.requireCssWithComponent(Se,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css","/static/metaserver/static/css/dig-components/index.web-vflnMddsO.css"]);class Ae extends G.default.Component{constructor(e){super(e),this.getIsLowDistractionViewAllowed=()=>{let e=i.FileTypes.FILE,t="";return this.props.file?(t=i.getFilename(this.props.file),e=this.props.file.type):this.props.browseFile?(t=i.getFilename(this.props.browseFile),e=this.props.browseFile.type):this.props.fileUpload&&(t=this.props.fileUpload.name,e=i.FileTypes.FILE),"viewer"===this.getAccessLevel()&&e===i.FileTypes.FILE&&y.isLowDistractionViewAvailableForFile(t)},this.getIsLowDistractionViewEnabled=()=>!!this.props.isLowDistractionViewEnabled&&this.getIsLowDistractionViewAllowed(),this.getIsLowDistractionViewControlVariant=()=>"CONTROL"===this.props.lowDistractionViewVariant&&this.getIsLowDistractionViewAllowed(),this.getPAPLoggerContent=()=>this.props.file?i.getContentFromFile(this.props.file):this.props.browseFile?i.getContentFromFile(this.props.browseFile):this.props.fileUpload?i.getContentFromFileUpload(this.props.fileUpload):void 0,this.getIsFileEligiblePreviewLinkRecipient=()=>{let e="";return this.props.file?e=i.getFilename(this.props.file):this.props.browseFile?e=i.getFilename(this.props.browseFile):this.props.fileUpload&&(e=this.props.fileUpload.name),this.props.previewLinkRecipientEnabled&&i.isFilePreviewSupportedForPLAR(e)&&!s.is_mobile_or_tablet()&&i.hasSharedLinkPermissions(this.sharedLink)},this.getLoggingProps=()=>({actionSurface:this.actionSurface,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent()}),this.appendSenderTrackeyToLink=()=>{this.sharedLink&&this.sharedLink.url&&(this.sharedLink=i.getNewLinkMetadataWithSenderTrackeyURL(this.sharedLink,this.senderTrackey))},this.appendCommentIdToLink=()=>{this.sharedLink&&this.sharedLink.url&&this.props.commentId&&(this.sharedLink=i.getNewLinkMetadataWithUrlFragment(this.sharedLink,"comment_id="+this.props.commentId))},this.handleClipboardWriterCopyLinkToClipboard=()=>{var e;this.appendSenderTrackeyToLink(),this.appendCommentIdToLink(),null===(e=this.props.clipboardWriter)||void 0===e||e.write(this.sharedLink.url),this.handleClipboardSuccess(i.CopyLinkMethod.CLIPBOARD_API)},this.handleCopyLinkToClipboard=(e=!1)=>{e&&i.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId}),this.appendSenderTrackeyToLink(),this.appendCommentIdToLink(),i.copyToClipboard(this.sharedLink.url,(()=>{this.handleClipboardSuccess(i.CopyLinkMethod.EXEC_COMMAND)}),this.handleClipboardFailure)},this.handleClipboardSuccess=e=>{e!==i.CopyLinkMethod.MANUAL&&this.setState({stage:i.ModalState.RESULT}),this.logEvent(i.TiburonEventName.CopySharedLink,{created_new_link:this.isLinkNewlyCreated,copy_method:e,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCopyLinkTime),sender_trackey:this.senderTrackey,sharing_view_type:this.sharedLink.link_permissions.is_low_distraction_view?"focused_view":"basic_view",commentId:this.props.commentId}),i.logPAPCopySharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,httpCode:this.httpCode,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId})},this.handleOnCopyToClipboard=e=>{i.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId}),this.handleClipboardSuccess(e)},this.handleClipboardFailure=()=>{this.copyLinkToClipboardNewAPI()},this.copyLinkToClipboardNewAPI=()=>{if(navigator.clipboard){const e=this.sharedLink.url;navigator.clipboard.writeText(e).then((()=>{this.handleClipboardSuccess(i.CopyLinkMethod.CLIPBOARD_API)}),(()=>{this.handleClipboardFailureNewAPI()}))}else this.handleClipboardFailureNewAPI()},this.handleClipboardFailureNewAPI=()=>{this.exceptionType=i.CopyLinkException.FAILED_COPY_TO_CLIPBOARD,this.failToFetchCopyLinkHelper()},this.logPreviewsLoggedOutCommentingExposure=()=>{this.props.loggedOutCommentingVariant&&i.logExposure({feature:"previews_logged_out_commenting",variant:this.props.loggedOutCommentingVariant})},this.getLinkActionTTI=e=>Date.now()-e,this.onClose=()=>{this.props.setIsCreatingSharedLink(!1,this.fileIdOrPath),this.props.userActionSource===i.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!1}),this.props.onActionFlowComplete&&this.props.onActionFlowComplete(),this.setState({isOpen:!1})},this.focusOnInput=()=>{this.inputRef.current&&this.inputRef.current.select()},this.openShareModalSettings=e=>{const t={origin:e,initialScreen:"settings",initialTab:"editor"===this.getAccessLevel()?"edit_link_settings":"view_link_settings"};if(this.props.file)I.asyncShowShareModal(this.props.user,this.props.file,t);else if(this.props.fileUpload)I.asyncShowShareModal(this.props.user,{fqPath:this.props.fileUpload.dest+"/"+this.props.fileUpload.name,isFolder:!1},t);else{if(!this.props.browseFile)return void i.sharingNotificationError((s=o.intl,s.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."})));I.asyncShowShareModal(this.props.user,this.props.browseFile,t)}var s;this.onClose()},this.inputRef=G.default.createRef(),this.state={isOpen:!0,stage:i.ModalState.PENDING},this.fileIdOrPath=this.getFileIdOrPath(),this.loggingKey=i.UUID.v4();const{actionSurface:t,actionElement:n,origin:r,contentAction:a}=this.getOriginAndAction();this.actionSurface=t,this.actionElement=n,this.contentAction=a,this.origin=r,this.requestedAccessLevel="default",this.senderTrackey=i.vendSenderTrackey(),this.snackbarModeAlreadyShown=!1}componentDidMount(){_.logPAPCreateSharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey}),i.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId}),this.createSharedLink(),this.props.lowDistractionViewVariant&&this.getIsLowDistractionViewAllowed()&&i.logExposure({feature:"pro_sharing_presentation_links",variant:this.props.lowDistractionViewVariant})}componentDidUpdate(e,t){t.stage===i.ModalState.RESULT||this.state.stage!==i.ModalState.RESULT||this.props.snackbarModeOnly||i.logPAPViewCopyLinkMiniModalEvent(this.sharedLink,this.getPAPLoggerContent())}createSharedLink(){this.props.setIsCreatingSharedLink(!0,this.fileIdOrPath),this.props.userActionSource===i.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!0}),this.startCreateLinkTime=Date.now();const e=i.getApiClient(this.props.user),t=this.requestedAccessLevel;e.createSharedLinkNonAlpha({fileIdOrPath:this.fileIdOrPath,settings:{access:t,is_low_distraction_view:this.getIsLowDistractionViewEnabled()}}).then((e=>{this.startCopyLinkTime=Date.now(),this.succeedToFetchLinkHelper(e,!0),"folder"!==e.file_type&&this.logPreviewsLoggedOutCommentingExposure(),this.logEvent(i.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:this.getAccessLevel(),commentId:this.props.commentId})})).catch((e=>{this.startCopyLinkTime=Date.now(),e.error[".tag"]===i.CopyLinkException.SHARED_LINK_ALREADY_EXISTS?this.succeedToFetchLinkHelper(e.error.shared_link_already_exists.metadata,!1,e):e.error[".tag"]===i.CopyLinkException.ACCESS_DENIED?(this.exceptionType=i.CopyLinkException.ACCESS_DENIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===i.CopyLinkException.SETTINGS_ERROR&&e.error.settings_error[".tag"]===i.CopyLinkException.NOT_AUTHORIZED?(this.exceptionType=i.CopyLinkException.NOT_AUTHORIZED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===i.CopyLinkException.PATH&&e.error.path[".tag"]===i.CopyLinkException.NOT_FOUND?(this.exceptionType=i.CopyLinkException.NOT_FOUND,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===i.CopyLinkException.EMAIL_NOT_VERIFIED?(this.exceptionType=i.CopyLinkException.EMAIL_NOT_VERIFIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===i.CopyLinkException.BANNED_MEMBER?(this.exceptionType=i.CopyLinkException.BANNED_MEMBER,this.userMessage=e.message,this.failToFetchCopyLinkHelper(e)):(this.exceptionType=e.error[".tag"]?e.error[".tag"]:i.CopyLinkException.UNDEFINED_ERROR,this.failToFetchCopyLinkHelper(e)),this.logEvent(i.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:t,timing:this.getLinkActionTTI(this.startCopyLinkTime),commentId:this.props.commentId})}))}succeedToFetchLinkHelper(e,t,s){this.sharedLink=e,this.isLinkNewlyCreated=t,this.httpCode=t?200:s&&s.raw&&s.raw.status,this.logEvent(i.TiburonEventName.SucceedCreateSharedLinkWithSettings,{created_new_link:t,http_status_code:this.httpCode,response_status:"success",is_alpha:!1,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCreateLinkTime),commentId:this.props.commentId}),_.logPAPCreateSharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,httpCode:this.httpCode,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey}),t&&this.props.file&&!this.props.isSearchMode&&m.getStoreForSharedWith().dispatch(m.sharedLinkDataOutOfDate(this.props.file.fq_path)),i.isBrowserCopyEnabled()?this.handleCopyLinkToClipboard():this.props.clipboardWriter?this.handleClipboardWriterCopyLinkToClipboard():(this.setState({stage:i.ModalState.COPY}),i.logPAPCopySharedLinkEvent({eventState:"canceled",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId})),i.publishEvent(i.CampaignEvents.FILE_SHARE_SUCCESS,{context:{file_name:this.props.file?i.getFilename(this.props.file):"",file_extension:this.props.file?i.getExtension$1(this.props.file):"",file_path:this.props.file?this.props.file.fq_path:""}})}failToFetchCopyLinkHelper(e){e&&(this.logEvent(i.TiburonEventName.FailCreateSharedLinkWithSettings,{error_message:this.exceptionType,http_status_code:e.raw&&e.raw.status,is_alpha:!1,timing:this.getLinkActionTTI(this.startCreateLinkTime),commentId:this.props.commentId}),_.logPAPCreateSharedLinkEvent({eventState:i.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e&&e.raw&&e.raw.status,exception:this.exceptionType,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey})),this.setState({stage:i.ModalState.ERROR}),this.logEvent(i.TiburonEventName.CopySharedLinkFailure,{error:this.exceptionType,timing:this.getLinkActionTTI(this.startCopyLinkTime),commentId:this.props.commentId}),i.logPAPCopySharedLinkEvent({eventState:i.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e&&e.raw&&e.raw.status,exception:this.exceptionType,metadata:this.sharedLink?this.sharedLink:void 0,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId})}getFileIdOrPath(){var e,t;return(null===(e=this.props.file)||void 0===e?void 0:e.file_id)||(null===(t=this.props.file)||void 0===t?void 0:t.fq_path)||this.props.filePath}getAccessLevel(){const e=this.sharedLink?this.sharedLink.link_permissions.link_access_level:void 0;let t="viewer";return e&&(t=e.hasOwnProperty(".tag")?e[".tag"]:e),t}getLinkVisibilityMapping(e){switch(e){case"public":case"password":case"no_one":return e;case"team_only":return"team";case"team_and_password":return"password";case"shared_folder_only":case"only_you":return"no_one"}}getLinkAudience(){if(!this.sharedLink)return;let e;const t=this.sharedLink.link_permissions;if(t.effective_audience)e=t.effective_audience,"object"==typeof e&&".tag"in e&&(e=e[".tag"]);else{let i;i=t.resolved_visibility,"object"==typeof i&&".tag"in i&&(i=i[".tag"]),e=this.getLinkVisibilityMapping(i)}return e}logEvent(e,t){var n,o;let r=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON;this.props.isFromShareMe24Modal?r=this.props.origin:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.RIGHT_SIDEBAR?r=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS_BUTTON:this.props.userActionSource===i.ActionSourceValue.OVERFLOW_MENU?r=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU:this.props.userActionSource===i.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?r=i.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.PREVIEW_TITLEBAR?r=i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.CONTENT_TILE?r=this.props.isSearchMode?i.SHARE_ACTION_ORIGIN_TYPE.SEARCH_CONTENT_TILE_BUTTON:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE?r=this.props.isSearchMode?i.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_SEARCH_CONTENT_TILE:i.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_BROWSE_CONTENT_TILE:this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.COMMENTS_SIDEBAR&&(r=i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_COMMENTS_SIDEBAR);const a=s.get_browser_info();i.ShareTibEventLogger.log(this.props.user.id,e,r,{...i.buildExtraFromLinkMetadata(this.sharedLink),file_id:null===(n=this.props.file)||void 0===n?void 0:n.file_id,fq_path:(null===(o=this.props.file)||void 0===o?void 0:o.fq_path)||this.props.filePath,browser:a.browser,browser_version:a.version,...t}),e===i.TiburonEventName.CopySharedLink&&(this.getIsLowDistractionViewEnabled()&&this.sharedLink.link_permissions.is_low_distraction_view?i.trackUserLeapEvent(i.SharingUserLeapEvent.LOW_DISTRACTION_LINK_COPY_SUCCESS,r):this.getIsLowDistractionViewControlVariant()?i.trackUserLeapEvent(i.SharingUserLeapEvent.LOW_DISTRACTION_LINK_CONTROL_COPY_SUCCESS,r):i.trackUserLeapEvent(i.SharingUserLeapEvent.SHARE_LINK_COPY_SUCCESS,r))}getOriginAndAction(){let e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON,t="browse_screen",s="browse_directory_row";return this.props.isFromShareMe24Modal?(e=this.props.origin,t=this.props.actionSurface,s=this.props.actionElement):this.props.isSearchMode?(t="search",s="search_directory_row",this.props.userActionSource===i.ActionSourceValue.OVERFLOW_MENU?s="content_overflow_menu":this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.CONTENT_TILE?(e=i.SHARE_ACTION_ORIGIN_TYPE.SEARCH_CONTENT_TILE_BUTTON,s="content_tile"):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE&&(e=i.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_SEARCH_CONTENT_TILE,t="search_quick_view",s=i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE)):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.RIGHT_SIDEBAR?(e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,s="action_bar_overflow_menu"):this.props.userActionSource===i.ActionSourceValue.OVERFLOW_MENU?this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.FOLDER_SETTINGS_MENU?(e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,s="context_menu"):(e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU,s="content_overflow_menu"):this.props.userActionSource===i.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?(e=i.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL,s="upload_modal"):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.PREVIEW_TITLEBAR?(e=i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR,t="previews",s="preview_titlebar"):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.CONTENT_TILE?(e=i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON,t="browse_screen",s="content_tile"):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE?(e=i.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_BROWSE_CONTENT_TILE,t="browse_quick_view",s=i.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE):this.props.userActionSurfaceLogValue===i.ActionSurfaceLogValue.COMMENTS_SIDEBAR&&(e=i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_COMMENTS_SIDEBAR,t="previews",s="comment"),{origin:e,actionSurface:t,actionElement:s,contentAction:"copy_link"}}render(){var e;if(!this.state.isOpen)return null;this.appendSenderTrackeyToLink(),this.appendCommentIdToLink();const t=(null===(e=this.sharedLink)||void 0===e?void 0:e.link_permissions.allow_logged_out_commenting)&&"public"===this.getLinkAudience();switch(this.state.stage){case i.ModalState.PENDING:return this.props.snackbarModeOnly?null:G.default.createElement(Te,{stage:i.ModalStage.PENDING,closeButtonHandler:this.onClose,anchorRef:this.props.anchorRef,zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement,isLinkToComment:!!this.props.commentId,isFileEligiblePreviewLinkRecipient:this.getIsFileEligiblePreviewLinkRecipient()});case i.ModalState.COPY:return this.props.snackbarModeOnly?null:G.default.createElement(Te,{stage:i.ModalStage.COPY,actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,anchorRef:this.props.anchorRef,inputRef:this.inputRef,shouldFocusOnLink:!1,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement,isFromShareMe24Modal:this.props.isFromShareMe24Modal,isLoggedOutCommentingEnabled:t,isLinkToComment:!!this.props.commentId});case i.ModalState.ERROR:return this.exceptionType!==i.CopyLinkException.FAILED_COPY_TO_CLIPBOARD?this.props.snackbarModeOnly?this.snackbarModeAlreadyShown?null:(this.snackbarModeAlreadyShown=!0,this.props.onErrorResult&&this.props.onErrorResult(),this.exceptionType===i.CopyLinkException.BANNED_MEMBER&&this.userMessage?(i.failBannerWithHelpCenter(this.userMessage,i.ABUSE_HELP_ARTICLE_LINK),null):(i.showErrorSnackbarWithoutClose(i.getServerErrorMessage(this.exceptionType)),null)):this.exceptionType===i.CopyLinkException.BANNED_MEMBER&&this.userMessage?(this.onClose(),i.failBannerWithHelpCenter(this.userMessage,i.ABUSE_HELP_ARTICLE_LINK),null):G.default.createElement(Te,{stage:i.ModalStage.ERROR_SERVER,closeButtonHandler:this.onClose,anchorRef:this.props.anchorRef,errorMessage:i.getServerErrorMessage(this.exceptionType),zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement,isLinkToComment:!!this.props.commentId}):this.props.snackbarModeOnly?(this.snackbarModeAlreadyShown||(this.snackbarModeAlreadyShown=!0,this.props.onErrorResult&&this.props.onErrorResult(),i.showErrorSnackbarWithoutClose(o.intl.formatMessage({id:"YslL2g",defaultMessage:"Couldnât copy the link."}))),null):G.default.createElement(Te,{stage:i.ModalStage.ERROR_CLIENT,actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,anchorRef:this.props.anchorRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement,isLinkToComment:!!this.props.commentId});case i.ModalState.RESULT:return this.props.snackbarModeOnly?(this.snackbarModeAlreadyShown||(this.snackbarModeAlreadyShown=!0,this.props.onSuccessResult&&this.props.onSuccessResult(),i.showCopyLinkSuccessAccessLevelSnackbar(this.getAccessLevel(),this.getIsLowDistractionViewEnabled()&&this.sharedLink.link_permissions.is_low_distraction_view,this.getIsFileEligiblePreviewLinkRecipient(),this.sharedLink,this.openShareModalSettings,this.getLoggingProps(),"share_modal")),null):G.default.createElement(Te,{stage:i.ModalStage.RESULT,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,anchorRef:this.props.anchorRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,isLowDistractionViewSettingEnabled:this.getIsLowDistractionViewEnabled()&&this.sharedLink.link_permissions.is_low_distraction_view,isFromShareMe24Modal:this.props.isFromShareMe24Modal,isLoggedOutCommentingEnabled:t,isFileEligiblePreviewLinkRecipient:this.getIsFileEligiblePreviewLinkRecipient(),openShareModalSettings:this.openShareModalSettings,loggingProps:this.getLoggingProps(),isLinkToComment:!!this.props.commentId})}}}Ae.displayName="CopyLinkMiniModalComponent";const we=e=>{const{variant:t}=i.useExperimentVariant("pro_sharing_presentation_links"),{variant:s}=i.useExperimentVariant("previews_logged_out_commenting"),{variant:n}=i.useExperimentVariant("pro_sharing_2024_07_22_preview_link_as_recipient");return G.default.createElement(Ae,{...e,lowDistractionViewVariant:t,loggedOutCommentingVariant:s,previewLinkRecipientEnabled:"ON"===n})};we.displayName="CopyLinkMiniModalWithHooks";const Oe=e=>G.default.createElement(n.QueryClientProvider,{client:n.queryClient},G.default.createElement(we,{...e}));Oe.displayName="CopyLinkMiniModalWithProviders";const Me=i.requireCssWithComponent(Oe,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css","/static/metaserver/static/css/dig-components/index.web-vflnMddsO.css"]);Me.show=(e,t)=>{i.Modal$1.showInstance(G.default.createElement(Me,{...e}),!0,t)},e.CopyLinkMiniModal=Me,e.CopyLinkMiniModalComponent=Ae}));
//# sourceMappingURL=c_views_copy_link_mini_modal_copy_link_mini_modal.after-display.js-vflqQ6mnL.map

//# debugId=0fdd17f6-293c-347d-b3cb-a132a22d4d48