!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="21df1eeb-ec1d-37e3-b371-0fb541a8ca73")}catch(e){}}();
define(["require","exports","./e_file_viewer_static_scl_page_folder","./c_plugin_utils_getImageDefaultSizes","react","./c_core_i18n","./c_admin_registration_source_constants","./c_api_v2_routes_password_confirmation_provider","./c_src_common_filepath","./c_pap-events_docsend_view_docsend_hub_entry_button","./c_unity_utils","./c_extensions_client","./c_src_bolt_flows_client","./c_photo-editor_plugin_use_image_enhancements","./c_file_viewer_title_bar_title_bar_right_section","./c_file_viewer_common_show_auth_modal","./c_file_viewer_context_migration_context","./e_edison","./e_core_exception","./c_api_v2_routes_folders_info_provider","./c_file_viewer_mobile_web_redesign_mobile_action_bar","./c_file_viewer_mobile_web_redesign_mobile_header","./c_src_sidebar","./c_file_viewer_api_navigation","./c_file_viewer_hooks_use_mouse_active","./c_file_viewer_components_titlebar_dropdowns","./c_browse_models","./c_core_data_ui","./c_viewer_helpers","./c_file_viewer_logging_timing","./c_file_viewer_preview_content","./c_action_plugins_comment_action_button","./c_action_plugins_conversion_action_conditions","./c_dig-icons_assets_ui-icon_line_expand-left","./c_dig-icons_assets_ui-icon_line_twinkle-2","./c_dig-icons_assets_ui-icon_line_stamp","./c_action_plugins_audio_video_edit_action_definition","./c_file_viewer_toolbar_utils","./c_dig-icons_assets_ui-icon_line_scale","./c_dig-icons_assets_ui-icon_line_shape-rotate-right","./c_dig-icons_assets_ui-icon_line_text-box","./c_action_bar_action_bar_strings","./c_dig-icons_assets_ui-icon_line_upload-file","./c_dig-icons_assets_ui-icon_line_signature","./c_file_viewer_components_preview_button","./c_action_plugins_transcript_action_utils","./c_dig-icons_assets_ui-icon_line_full-width","./c_dig-icons_assets_ui-icon_line_zip","./c_react_query_helpers_queries_file_content_metadata","./c_preview_audio_video_video_editing_strings","./c_integrations_data_selectors","./c_file_viewer_toolbar","./c_core_data_actions","./c_core_logging_actions","./c_file_viewer_toolbar_toolbar_holder","./c_file_viewer_hooks_lifecycle_logging","./c_file_viewer_keyboard_bindings","./c_react-redux_hooks_useDispatch","./c_file_viewer_loading_indicator","./c_file_viewer_preview_archive_utils","./e_data_modules_stormcrow","./c_file_viewer_preview_text","./c_core_riviera_transcripts","./c_dig-components_drawer_index","./c_file_viewer_hooks_usePrevious","./c_portable_delete","./c_portable_delete_snackbars","./c_portable_rename_snackbars","./c_files_view_file_actions_api_v2","./c_referrer_cleansing_redirect","./c_file_viewer_preview_tour_mini_modal","./c_file_viewer_preview_logger","./c_file_viewer_pap_logger_utils","./c_file_viewer_preview_tour_async_tour","./c_file_viewer_preview_tour_utils","./c_contacts_hooks","./c_lodash","./c_views_copy_link_mini_modal_after_display_utils","./c_file_viewer_comments2_utils","./c_queries_utils_preview_metadata","./c_react-intl_src_components_message","./c_cloud_docs_constants","./c_onboarding_survey_lib_oa_pulsar_campaigns","./c_sharing_async_share_modal_util","./c_styled-components","./c_growth_ui_api","./c_pdf_editor_plugin_show_plugin_util","./c_memoize-one","./c_react-use_misc_util","./c_file_viewer_title_bar_title_bar_pass_ui","./c_src_sink_index","./c_hooks_use_stabilized_callback","./c_previews_util","./c_dig-icons_assets_ui-icon_line_file-history","./c_resize-observer-polyfill_ResizeObserver","./c_dig-logos_src_glyph_fss","./c_src_common_format_bytes","./c_dig-icons_assets_ui-icon_line_upload","./c_dig-components_skeleton_index","./c_dig-icons_assets_ui-icon_line_rewind","./c_core_logging_video","./c_core_utils_uuid"],(function(e,t,i,n,a,r,o,s,l,d,c,u,_,m,p,f,g,v,h,w,y,E,S,b,C,I,T,x,A,M,k,N,P,L,R,D,F,O,U,V,B,z,H,W,K,G,j,q,Q,Y,$,X,Z,J,ee,te,ie,ne,ae,re,oe,se,le,de,ce,ue,_e,me,pe,fe,ge,ve,he,we,ye,Ee,Se,be,Ce,Ie,Te,xe,Ae,Me,ke,Ne,Pe,Le,Re,De,Fe,Oe,Ue,Ve,Be,ze,He,We,Ke,Ge,je,qe){"use strict";function Qe(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var Ye=Qe(a);const $e={filePreviews:{}};const Xe={[i.PREVIEW_NAMESPACE_KEY]:function(e=$e,t){return t.type===i.ActionTypes.UpdatePreviewData?{...e,filePreviews:{...e.filePreviews,...t.payload}}:e}};const Ze=()=>i.getStoreAndRegisterReducers(Xe);var Je;!function(e){e.OFF="OFF",e.ON="ON",e.GLOBAL_HOLDOUT="GLOBAL_HOLDOUT",e.CONTROL="CONTROL",e.DEV="DEV"}(Je||(Je={}));function et(){const e=/comment_id=(.*)/.exec(i.get_uri().getFragment());return e?e[1]:void 0}function tt(){const e=i.get_uri().getQuery().shouldFocusComment;return e?Boolean(e):void 0}const it=e=>i.getLinkType(e)===i.LinkTypes.Righteous?s.Cookies.read("rl_auth"):i.getLinkType(e)===i.LinkTypes.Shmodel?s.Cookies.read("sm_auth"):null,nt=e=>l.isAIBladeSupportedForFile(i.getFilename(e))&&!i.isEncryptedFile(e),at=({file:e,previewType:t,sharePermission:n,user:a})=>{if(!a||!e)return!1;if(i.isEncryptedFile(e))return!1;if(n&&!i.isDownloadAllowed(n))return!1;if(!t||t===i.PreviewType.Loading){const n=i.getExtension$1(e);t=i.resolvePreviewTypeFromExtension(`.${n}`)}return!d.is_supported_mobile_browser()&&(t===i.PreviewType.Video||t===i.PreviewType.Audio)},rt=({file:e,user:t,shareToken:n,sourceContext:a})=>{const r=i.useAppActions({enabled:!!t}).data,o=u.getOpenActionsForFile((null==r?void 0:r.actions)||[],e),s=Ye.default.useMemo((()=>c.partitionActions(o).cloudEditors),[o]),l=Ye.default.useMemo((()=>{if(a===i.SourceContext.EdisonDesktopPreview)return!1;if(_.canOpenInReplay(e))return!0;if(i.isSharedFile(e)){if(0===s.length)return!1;if((e=>(null==e?void 0:e.linkType)===i.SharedLinkType.Shmodel)(n))return!1}return 0!==o.length||void 0}),[s.length,e,o.length,n,a]),d=a===i.SourceContext.EdisonDesktopPreview||void 0!==l,m=_.useUnity(e,t,d);return Ye.default.useMemo((()=>void 0!==l?(c.UnityHelpers.getUnityFileInfoIfAppropriate(e,t,(()=>{}),(()=>{})),l):0!==o.length||!!m&&c.UnityHelpers.isUnityFileSupported(m)),[e,o.length,l,m,t])},ot=e=>{const{file:t,sharedLinkInfo:n,onDismiss:a,openInAppData:r,fileViewerSessionId:o,filePreviewSessionId:s,onAppDownload:l,logUserAction:d,fileViewOrigin:c,deviceId:u}=e,_=i.getFilename(t),m=Ye.default.useCallback((e=>{i.MobileFilePreviewLogger.log(e,o,s,t.ns_id,t.sjid,{context:i.UserActionContext.AppDownloadInterstitial,location:"file_viewer",origin:c}),null==d||d(e,i.UserActionContext.AppDownloadInterstitial)}),[t,s,o,d,c]);Ye.default.useEffect((()=>{i.mark_time_to_interactive(),m(i.UserAction.AppDownloadInterstitialView),i.SUSIUXAEventLogger.logDeviceIdWithSource("file_viewer",u)}),[u,m]);const p=Ye.default.useCallback((()=>{a(),m(i.UserAction.AppDownloadInterstitialContinue)}),[a,m]),f=Ye.default.useCallback((()=>{m(i.UserAction.AppDownloadInterstitialInstall),null==l||l()}),[m,l]);return Ye.default.createElement(i.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"File Preview"},Ye.default.createElement("div",{"aria-label":_},Ye.default.createElement(i.AppDownloadInterstitialWithCss,{fileOrFolderName:_,openInAppData:r,onContinue:p,onAppDownload:f,ownerName:n.ownerName,ownerTeamName:n.ownerTeamName})))};ot.displayName="FvsdkAppDownloadInterstitial";const st=e=>{const{onHide:t,user:n,activePreviewFile:a}=e,{logUserAction:r}=i.useFileViewerContext(),o=Ye.default.useCallback((()=>{r(i.UserAction.OpenInApp,i.UserActionContext.OpenInAppBanner)}),[r]),s=Ye.default.useCallback((()=>{r(i.UserAction.OpenInAppBannerClose,i.UserActionContext.OpenInAppBanner),t()}),[r,t]);if(!d.is_mobile_or_tablet()&&(d.iOS||d.is_android()))return null;const{file:l,shareToken:c,sharePermission:u,sharedLinkInfo:_,openInAppData:m}=a,p=i.prepareOpenInAppData(m,l,n,i.UserActionContext.OpenInAppBanner,_);if(p){const e=!(l&&c&&u);return Ye.default.createElement("div",{style:{width:"100%"},tabIndex:0},Ye.default.createElement(i.OpenInAppBanner,{urls:p,onClick:o,onClose:s,isMountedFile:e}))}return null};st.displayName="OpenInAppHeader",st.displayName="OpenInAppHeader";const lt=e=>({previewsGetArchiveFiles:(t,n)=>i.GetPreviewsRoutes(e).rpc("get_archive_files",t,n),previewsLoggedOutGetArchiveFiles:(t,n)=>i.GetPreviewsRoutes(e).rpc("logged_out/get_archive_files",t,n)}),dt=({canShowFileFlippers:e,previewContentOnly:t,cloudDocPreviewMode:n})=>{var a,r,o,l,c,u,_,m,p;const f=s.getActiveUserId(),g=i.useFileViewerConfiguration(),v=f?g.initialVideoBandwidthByUserId[f]:void 0,h=null!==(r=null===(a=i.useExperiment("previews_transcript_edit",!0).experiment)||void 0===a?void 0:a.variant)&&void 0!==r?r:"OFF",w=null!==(l=null===(o=i.useExperiment("previews_transcription_translation",!0).experiment)||void 0===o?void 0:o.variant)&&void 0!==l?l:"OFF",y="ON"===(null===(c=i.useExperiment("previews_exp_enable_mux_data",!0).experiment)||void 0===c?void 0:c.variant),E=null!==(_=null===(u=i.useExperiment("previews_mobile_web_redesign",!0).experiment)||void 0===u?void 0:u.variant)&&void 0!==_?_:"OFF",S=null!==(p=null===(m=i.useExperiment("previews_toolbar_optimization",!0).experiment)||void 0===m?void 0:m.variant)&&void 0!==p?p:"OFF";return Ye.default.useMemo((()=>({...{enable_fullscreen:!0,keyboard_shortcuts:!0,preview_types:{[i.PreviewType.SsrDoc]:{...i.DEFAULT_CONFIG.preview_types[i.PreviewType.SsrDoc]}}},file_flipping:e,mobile_web:d.is_supported_mobile_browser(),autohide_video_controls:t,cloud_doc_preview_mode:n,keyboard_shortcuts:!t,initial_video_bandwidth:v,previews_transcript_edit:h,previews_transcription_translation:w,previews_exp_enable_mux_data:y,previews_mobile_web_redesign:E,previews_toolbar_optimization:S})),[e,v,t,y,E,h,w,n,S])};i.injectInternalStyle("/static/metaserver/static/js/file_viewer/file_viewer.module.out-vflKzrZrC.css",(e=>":root{--file_viewer_z_index:500}._fvsdk-container_amzuv_5{bottom:0;display:flex;flex-direction:column;left:0;position:fixed;right:0;top:0;z-index:var(--file_viewer_z_index)}._fvsdk-embed-viewport_amzuv_16{height:100%;position:relative}body,html{height:100%}"));i.injectInternalStyle("/static/metaserver/static/js/file_viewer/mobile_web/mobile_footer.module.out-vflN0LpDp.css",(e=>":root{--mobileFooterHeight:72px}._footerContainer_3b0az_5{background:var(--dig-color__background__base);bottom:0;box-sizing:border-box;height:var(--mobileFooterHeight);padding:var(--dig-spacing__macro__xsmall);width:100%}._footer_3b0az_5,._footerContainer_3b0az_5{align-items:center;display:flex}._footer_3b0az_5{border-top:1px solid var(--dig-color__border__subtle);height:35px;justify-content:space-around;margin-top:var(--dig-spacing__macro__xsmall);padding:0 var(--dig-spacing__macro__small)}._footer_3b0az_5 a,._footer_3b0az_5 span{color:var(--dig-color__text__subtle);cursor:pointer;text-decoration:none}._middleButton_3b0az_33{margin-right:var(--dig-spacing__micro__small)}._rightButtonsContainer_3b0az_37{display:flex;flex:1;justify-content:right}"));const ct="_footerContainer_3b0az_5",ut=()=>Ye.default.createElement("div",{className:ct});i.injectInternalStyle("/static/metaserver/static/js/file_viewer/title_bar/mobile/mobile_title_bar.module.out-vfl97ByBO.css",(e=>":root{--titlebarHeight:64px}._titleBar_ux84q_5{align-items:center;background:var(--color__standard__background);border-bottom:1px solid var(--color__standard__border);display:flex;height:var(--titlebarHeight);justify-content:space-between}._title_ux84q_5{display:flex;overflow:hidden;padding-left:var(--dig-spacing__macro__xsmall);padding-right:var(--dig-spacing__macro__medium)}._mobileMeatball_ux84q_21{padding-right:var(--dig-spacing__micro__large)}"));const _t="_titleBar_ux84q_5",mt=()=>Ye.default.createElement("div",{className:_t}),pt=Ye.lazy((async()=>{const{MobileFooter:t}=await new Promise((function(t,i){e(["./c_file_viewer_mobile_web_mobile_footer"],t,i)}));return{default:t}})),ft=e=>Ye.createElement(Ye.Suspense,{fallback:Ye.createElement(ut,null)},Ye.createElement(pt,{...e}));ft.displayName="LazyMobileFooter";const gt=Ye.lazy((async()=>{const{MobileHeader:t}=await new Promise((function(t,i){e(["./c_file_viewer_mobile_web_mobile_header"],t,i)}));return{default:t}})),vt=e=>Ye.createElement(Ye.Suspense,{fallback:Ye.createElement(mt,null)},Ye.createElement(gt,{...e}));vt.displayName="LazyMobileHeader";const ht=Ye.lazy((async()=>{const{SaveDialog:t}=await new Promise((function(t,i){e(["./c_folder_dialog_save_dialog"],t,i)}));return{default:t}})),wt=e=>Ye.createElement(Ye.Suspense,{fallback:null},Ye.createElement(ht,{...e}));wt.displayName="LazySaveDialog";const yt=()=>{const{mobileActionBar:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>{return e?(t=e,e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(t,{...e}))):y.MobileActionBar;var t}),[e])},Et=()=>{const{mobileHeader:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>e?(e=>t=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(e,{...t})))(e):E.MobileHeader),[e])},St=e=>{const t=(()=>{const{sidebarContent:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>null!=e?e:S.SidebarContent),[e])})();return Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(t,{...e}))},bt=Ye.memo((e=>{const{canCloseViewer:t,inEditMode:n,titleBarActionGetters:a,breakpoint:o}=e,s=r.useIntl(),d=i.useArchiveSubpath(),{previewSurface:c}=g.usePluginMigrationContext(),u=b.useCloseViewerCallback(),_=()=>{n&&a.onClose?a.onClose():u(i.UserActionContext.TitleBarMain)},m=s.formatMessage({id:"R/Hjn0",defaultMessage:"Close"}),p=s.formatMessage({id:"IDlWPW",defaultMessage:"Back"});return t||(null==d?void 0:d.length)?Ye.createElement("span",{className:i.cx(l.closeButton,{[l.small]:o===C.FileViewerBreakpoint.SM})},Ye.createElement(i.IconButton,{onClick:_,variant:"transparent",size:"large","data-uxa-log":"preview_close","data-testid":"preview-close"},Ye.createElement(i.UIIcon,{"aria-label":(null==d?void 0:d.length)?p:m,src:i.CloseLine}))):i.isPolluxDesktopSurface(c)?null:c===i.SDKPreviewSurface.FSS_DESKTOP_PREVIEW?Ye.createElement(i.UIIcon,{className:l.dropboxLineIcon,size:"large",src:i.DropboxLine,"aria-label":"Dropbox"}):Ye.createElement(E.Logo,null)}));bt.displayName="CloseButton",bt.displayName="CloseButton";const Ct=()=>{const{titlebarDropdowns:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>{return e?(t=e,()=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(t,null))):I.TitlebarDropdowns;var t}),[e])},It=a.forwardRef((({fileName:e,allowRename:t,showExpandedView:n,hideFileExtension:o},s)=>{const d=r.useIntl(),c=Ye.default.useRef(null),[u,_]=Ye.default.useState(e),m=x.useIsRenameActive(),[p,f]=Ye.default.useState(.5*window.innerWidth),[g,v]=Ye.default.useState(0),h=Ye.default.useRef(null),{logUserAction:w}=i.useFileViewerContext(),y=l.split_filename(e);Ye.default.useEffect((()=>{window.requestAnimationFrame((()=>{if(!c.current)return;c.current.focus();const t=e;let i=t.lastIndexOf(".");i<0&&(i=t.length),c.current.setSelectionRange(0,i)}))}),[e,m]),Ye.default.useEffect((()=>{h.current&&v(h.current.offsetWidth)}),[h,e,m]),Ye.default.useEffect((()=>{const e=()=>{f(.5*window.innerWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[e]);const E=b.useToggleRenameStateCallback(),S=b.useRenameRootFileCallback(),C=Ye.default.useCallback((()=>{u&&e!==u?S(u,i.UserActionContext.PreviewTitlebar):_(e),E(!1)}),[u,e,E,S]),I=Ye.default.useCallback((()=>{w(i.UserAction.RenameFailed,i.UserActionContext.PreviewTitlebar),_(e),E(!1)}),[e,w,E]),T=Ye.default.useCallback((()=>{w(i.UserAction.Rename,i.UserActionContext.PreviewTitlebar),_(e),E(!0)}),[e,w,E]);return a.useImperativeHandle(s,(()=>({handleEnter(){T()}})),[T]),m?Ye.default.createElement("div",{className:l.fileNameEditingContainer},Ye.default.createElement("span",{ref:h,style:{position:"absolute",opacity:0,zIndex:-100}},Ye.default.createElement(i.Text,null,u)),Ye.default.createElement(i.TextInput,{"data-testid":"file-name-display-text-input",ref:c,"aria-label":d.formatMessage({id:"XlFxo+",defaultMessage:"filename"}),value:u,onChange:e=>_(e.currentTarget.value),onKeyDown:e=>{e.key===i.Key_enum.Key.Enter?(e.stopPropagation(),C()):e.key===i.Key_enum.Key.Escape&&(e.stopPropagation(),I())},onBlur:C,style:{width:g,maxWidth:p}})):n?Ye.default.createElement("div",{className:l.fileNameContainer,onDoubleClick:t?T:void 0,tabIndex:0},Ye.default.createElement(i.Text,{size:"large",isBold:!0,className:l.fileNameFontChange},y.name),!o&&Ye.default.createElement(i.Box,{as:i.Text,fontFamily:"Text",fontSize:"Text Small",fontWeight:"Base",color:"Text Subtle",style:{textTransform:"uppercase"}},y.ext)):Ye.default.createElement(i.Text,{className:i.cx(l.fileNameFontChange,l.fileName),size:"large",isBold:!0,onDoubleClick:t?T:void 0},e)})),Tt=({fileName:e,isBold:t=!1,showFileNameOnly:n=!1})=>{var a;const{name:r,ext:o}=l.split_filename(e);return Ye.default.createElement("div",{className:l.fileNameContainer},Ye.default.createElement(i.Text,{size:n?"medium":"large",isBold:t},r),null!==(a=!n)&&void 0!==a?a:Ye.default.createElement(i.Box,{as:i.Text,fontSize:"Text Small",fontWeight:"Base",color:"Text Subtle",style:{textTransform:"uppercase"}},o))},xt=({user:e,inEditMode:t,file:n,breakpoint:o,shouldUseAlternateStyling:s,hideFolderAndFileExtension:d=!1,hideFolderMenu:c=!1})=>{const u=r.useIntl(),_=i.useArchiveSubpath(),m=x.useIsFullscreen(),p=b.useUpdateArchiveFileCurrentPathCallback(),f=a.useRef(null),g=Ye.default.useCallback(((e,t,n)=>c?Ye.default.createElement(i.Box,{className:l.titleBarFolderHiddenMenu,as:i.Text,fontSize:"Text Small",fontWeight:"Base",color:"Text Subtle"},e):Ye.default.createElement(i.Breadcrumb.Link,{key:"folderMenu"},Ye.default.createElement(i.Menu.Wrapper,null,(({getTriggerProps:a,getContentProps:r})=>{const o=r();return Ye.default.createElement(Ye.default.Fragment,null,Ye.default.createElement(i.Button,{className:n?l.titleBarFolderNoLeftPadding:l.titleBarFolder,variant:o.open?"opacity":"borderless",size:"small",...a()},Ye.default.createElement(i.Box,{as:i.Text,fontSize:"Text Small",fontWeight:"Base",color:"Text Subtle"},e)),Ye.default.createElement(i.Menu.Content,{...o},Ye.default.createElement(i.Menu.Segment,null,...t)))})))),[]),v=Ye.default.useCallback(((e,t,n,a,r)=>Ye.default.createElement(i.Breadcrumb.Link,{href:()=>p(a.slice(1,t+1),!0),isCurrentPath:n,key:`${t}-${e}`},Ye.default.createElement(Tt,{fileName:e,isBold:n,showFileNameOnly:r}))),[p]),h=a.useMemo((()=>{const a=[],r=[],c=n instanceof T.FileSharedWithMe?n.filename:i.getFilename(n),h=!!_,w=h?[c].concat(_):[];if(!t&&!m&&e&&!(n instanceof T.FileSharedWithMe)&&i.isBrowseFile(n)){const t=A.deprecatedGetRootName(u,i.DeprecatedViewer.get_viewer(),e),o=l.parent_dirs(n.fq_path).reverse();o.unshift(""),o.forEach(((n,d)=>{const c=i.browse_uri_for_fq_path(i.DeprecatedViewer.get_viewer(),e,n);a.push(Ye.default.createElement(i.Menu.LinkItem,{key:n,href:c.toString(),onClick:()=>i.redirect(c)},l.filename(n,t))),d===o.length-1&&w.length<2&&r.push(g(l.filename(n,t),a,s))}))}const y=r;return h?w.forEach(((e,t)=>{const n=t===w.length-1;n?r.push(v(e,t,n,w,s||d)):a.push(Ye.default.createElement(i.Menu.ActionItem,{onClick:()=>p(w.slice(1,t+1),!0),key:`${t}-${e}`},e)),t===w.length-2&&r.push(g(e,a,s))})):y.push(Ye.default.createElement(i.Breadcrumb.Link,{isCurrentPath:!0,key:c,tabIndex:0,onKeyDown:e=>{e.key===i.Key_enum.Key.Enter&&f.current&&f.current.handleEnter()}},Ye.default.createElement(It,{ref:f,fileName:c,allowRename:!t&&!(n instanceof T.FileSharedWithMe)&&i.isBrowseFile(n),showExpandedView:!t,hideFileExtension:d}))),o===C.FileViewerBreakpoint.SM||d?y.slice(-1):y}),[n,_,t,m,e,o,g,s,v,p,d]);return Ye.default.createElement(i.Breadcrumb,{"aria-label":u.formatMessage({id:"vWiotS",defaultMessage:"Breadcrumb"}),alwaysShowRoot:!0,className:l.titleBarFileBreadcrumb,"data-tooltip":"title-bar-breadcrumb"},h)};xt.displayName="TitleBarFileBreadcrumb";const At=Ye.default.memo((({inEditMode:e,file:t,breakpoint:n,previewSurface:a,hideFolderAndFileExtension:o})=>{const{pluginArgs:s}=g.usePluginMigrationContext(),{isLoggedIn:d}=i.useFileViewerContext(),c=r.useIntl(),u=a===i.SDKPreviewSurface.LOW_DISTRACTION_VIEW,_=a===i.SDKPreviewSurface.FSS_DESKTOP_PREVIEW;return Ye.default.createElement("div",{className:i.cx(l.titleBarHeader,{[l.loggedOut]:!d})},Ye.default.createElement(xt,{user:s.user,inEditMode:e,file:t,breakpoint:n,hideFolderAndFileExtension:o,hideFolderMenu:_}),u&&Ye.default.createElement(i.Badge,{variant:"attention",size:"small",style:{marginLeft:"16px"}},c.formatMessage({id:"cJe1uc",defaultMessage:"View only"})))}));At.displayName="TitleBarHeader";const Mt=()=>{const{titleBarRightSection:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>{return e?(t=e,e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(t,{...e}))):p.TitleBarRightSection;var t}),[e])};var kt,Nt,Pt,Lt,Rt;i.injectInternalStyle("/static/typescript/component_libraries/files_components/src/content-tile/thumbnail.module.out-vflKV-T_6.css",(e=>"._thumbnailCenter_ho2ri_1{align-items:center;display:flex;justify-content:center;padding:var(--spacing__unit--2)}._thumbnailLandscape_ho2ri_8{padding:var(--spacing__unit--4) var(--spacing__unit--2)}._thumbnailPortrait_ho2ri_12{padding:var(--spacing__unit--2) var(--spacing__unit--4)}._thumbnailCollage_ho2ri_16{padding:0}._itemName_ho2ri_20{margin-top:-27px;text-align:center}._iconWrapper_ho2ri_29,._itemNameText_ho2ri_25{justify-content:center}._iconWrapper_ho2ri_29{align-items:center;display:flex;flex-direction:column;margin-bottom:11px}._img_ho2ri_37{filter:drop-shadow(0 1px 2px rgba(30,25,25,.03)) drop-shadow(0 8px 32px rgba(30,25,25,.03));max-height:100%;max-width:100%}._imgCollageContainer_ho2ri_44{align-items:center;display:flex;height:100%;justify-content:center;position:relative;width:100%}._collageItemCenter_ho2ri_53{object-position:center center}._collageItemCenterTop_ho2ri_57{object-position:center top}._collageItemCover_ho2ri_61{object-fit:cover}._collageItemContain_ho2ri_65{object-fit:contain}._imgCollageContainer_ho2ri_44 img{position:absolute}._imgCollageContainer_ho2ri_44 img:nth-child(2){filter:drop-shadow(0 1px 2px rgba(30,25,25,.03)) drop-shadow(0 8px 16px rgba(30,25,25,.03)) drop-shadow(0 8px 32px rgba(30,25,25,.03));left:12%;max-height:80%;max-width:60%}._imgCollageContainer_ho2ri_44 img:first-child{bottom:15%;filter:drop-shadow(0 1px 2px rgba(30,25,25,.03)) drop-shadow(0 8px 32px rgba(30,25,25,.03));max-height:60%;max-width:65%;right:12%}._imgCollageContainer_ho2ri_44 img:nth-child(3){filter:drop-shadow(0 1px 2px rgba(30,25,25,.03)) drop-shadow(0 2px 4px rgba(30,25,25,.03)) drop-shadow(0 4px 8px rgba(30,25,25,.03)) drop-shadow(0 8px 16px rgba(30,25,25,.03)) drop-shadow(0 8px 32px rgba(30,25,25,.03));margin-left:15%;max-height:55%;max-width:50%;top:15%}")),function(e){e.Landscape="landscape",e.Portrait="portrait",e.Square="square"}(kt||(kt={})),Ye.default.lazy((async()=>{const{ThumbnailError:t}=await new Promise((function(t,i){e(["./c_src_content-tile_thumbnail-error"],t,i)}));return{default:t}})),function(e){e.LOADING_SPINNER="LOADING_SPINNER",e.FILE_ICON="FILE_ICON",e.CONTENT_ICON="CONTENT_ICON",e.IMAGE="IMAGE",e.IMAGE_COLLAGE="IMAGE_COLLAGE",e.VTT_THUMB_IMAGE="VTT_THUMB_IMAGE",e.ERROR_STATE="ERROR_STATE"}(Nt||(Nt={})),function(e){e.CENTER="CENTER",e.CENTER_TOP="CENTER_TOP"}(Pt||(Pt={})),function(e){e.COVER="COVER",e.CONTAIN="CONTAIN"}(Lt||(Lt={})),function(e){e[e.PHOTOS=0]="PHOTOS",e[e.VIDEOS=1]="VIDEOS",e[e.VISUAL_NOTES=2]="VISUAL_NOTES"}(Rt||(Rt={}));const Dt=({file:e})=>{const t=r.useIntl(),n=i.getExtension$1(e),a=e.bytes,o=i.format_bytes$1(t,a);return Ye.createElement("div",null,Ye.createElement(i.Text,{size:"small",color:"faint"},Ye.createElement(i.Truncate,{tooltipControlProps:{auto:!0,placement:"bottom"}},(s=n.toUpperCase(),l=o,s&&""!==s&&l&&""!==l?`${s} • ${l}`:s&&""!==s?s:l))));var s,l};Dt.displayName="UnifiedDesktopSearchTitleBarSection";const Ft=Ye.memo((({commentIconWithUnreadCount:e,file:t,showAuthModal:n})=>{i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.FVSDK_TITLE_BAR_MOUNT);const{previewSurface:a}=g.usePluginMigrationContext(),r=i.isPolluxDesktopSurface(a),{canCloseViewer:o}=i.useFileViewerContext(),s=C.useResponsiveSize(),d=!!x.useActiveEditorId(),c="bright"===i.useTheme().mode,u=Ct(),_=Mt(),m=x.useIsFullscreen(),{titleBarActionGetters:p}=M.useTitlebarEditorActions();return m?Ye.createElement("div",{className:l.titleBarContainer},Ye.createElement("header",{className:i.cx(l.titleBar,{[l.fullscreen]:c&&m}),"data-testid":i.TITLE_BAR_TEST_ID},Ye.createElement("div",{className:l.titleBarLeftSection},Ye.createElement(At,{inEditMode:d,file:t,breakpoint:s,previewSurface:a})),Ye.createElement(k.HideToolbarButton,null))):Ye.createElement("div",{className:i.cx(l.titleBarContainer,{[l.polluxTitleBarContainer]:r})},Ye.createElement("header",{className:i.cx(l.titleBar,{[l.editMode]:p.isEditorReady}),"data-testid":i.TITLE_BAR_TEST_ID},Ye.createElement(bt,{canCloseViewer:o,inEditMode:d,titleBarActionGetters:p,breakpoint:s}),Ye.createElement("div",{className:l.titleBarLeftSection},Ye.createElement(At,{inEditMode:d,file:t,breakpoint:s,previewSurface:a,hideFolderAndFileExtension:a===i.SDKPreviewSurface.POLLUX_DESKTOP_SEARCH_PREVIEW}),d||s===C.FileViewerBreakpoint.SM||a===i.SDKPreviewSurface.POLLUX_DESKTOP_SEARCH_PREVIEW?null:Ye.createElement(u,null),a===i.SDKPreviewSurface.POLLUX_DESKTOP_SEARCH_PREVIEW&&Ye.createElement(Dt,{file:t})),Ye.createElement(_,{titleBarActionGetters:p,commentIconWithUnreadCount:e,showAuthModal:n,breakpoint:s})))}));Ft.displayName="TitleBar",Ft.displayName="TitleBar";const Ot=r.defineMessage({id:"skwHGv",defaultMessage:"Comment"}),Ut=["ON","INTERNAL_RELEASE","BETA"],Vt=e=>Ut.includes(e||""),Bt=[i.SDKPreviewSurface.BROWSE,i.SDKPreviewSurface.SEARCH,i.SDKPreviewSurface.HOME,i.SDKPreviewSurface.RECENTS,i.SDKPreviewSurface.STANDALONE_PREVIEW,i.SDKPreviewSurface.STARRED,i.SDKPreviewSurface.DESKTOP_PREVIEW,i.SDKPreviewSurface.FSS_DESKTOP_PREVIEW,i.SDKPreviewSurface.INBAND_SHARE,i.SDKPreviewSurface.SHARED_LINK,i.SDKPreviewSurface.SHARED_CONTENT_LINK,i.SDKPreviewSurface.LOW_DISTRACTION_VIEW],zt={filterValidFile:e=>nt(e)?e:void 0,filterValidUser:P.filterLoggedInUser,shouldShowForPreviewSurface:P.filterSurfaceIn(Bt),shouldShowForPreviewType:P.alwaysShow},Ht=({previewsToolbarOptimizationVariant:e,previewType:t,sharedLinkInfo:n})=>{if(e===i.Variant.V2&&t===i.PreviewType.SsrDoc)return{icon:L.AddCommentLine,label:r.defineMessage({id:"r0xU6o",defaultMessage:"Mark up"}),action:{actionType:i.UserAction.OpenMarkUpDropdown,actionContext:i.UserActionContext.MarkUpDropdown}};const a=n?r.defineMessage({id:"jlFPdY",defaultMessage:"Edit a copy"}):r.defineMessage({id:"C+UT8f",defaultMessage:"Edit"});return{icon:D.EditLine,label:a,action:{actionType:i.UserAction.OpenEditDropdown,actionContext:i.UserActionContext.EditFileDropdown}}},Wt=({actions:e,logUserAction:t,actionContext:n})=>Ye.default.createElement(i.Menu.Segment,null,null==e?void 0:e.map(((e,a)=>{const o="string"==typeof(null==e?void 0:e.label)?null==e?void 0:e.label:r.intl.formatMessage(null==e?void 0:e.label),s=e.tooltip,l="string"==typeof(null==s?void 0:s.text)?s.text:s?r.intl.formatMessage(s.text):"",d=(null==s?void 0:s.keyboardShortcut)?" "+s.keyboardShortcut:"",c=Ye.default.createElement(i.UIIcon,{isOpticallyAligned:!0,src:null==e?void 0:e.icon,width:"20px",height:"20px"});return Ye.default.createElement(i.Tooltip,{key:a,title:l+d,placement:"right",hidden:!e.tooltip},"click"===e.handler.type?Ye.default.createElement(i.Menu.ActionItem,{withLeftAccessory:c,withTitle:o,disabled:e.disabled,onClick:()=>{"click"===e.handler.type&&e.handler.handler(),e.actionType&&t(e.actionType,n)}}):Ye.default.createElement(i.Menu.Submenu,{key:o,withTriggerContent:o,withLeftAccessory:c,onSubmenuOpened:()=>{e.actionType&&t(e.actionType,n)}},Ye.default.createElement(Ye.default.Fragment,null,e.handler.menu)))}))),Kt=(e,t,n,a)=>{const r=m.getToolbarHandlerWithPluginActivation();return[{icon:B.SliderLine,label:l.actionBarStrings.adjustButtonText,handler:r({handler:m.onAdjust(e,t,n),keyboardBinding:{key:"a"}}),tooltip:a?void 0:{text:l.actionBarStrings.adjustButtonText,keyboardShortcut:l.actionBarStrings.adjustKeyboardShortcut},actionType:a?i.UserAction.LoggedOutAdjust:i.UserAction.Adjust}]},Gt=(e,t,n,a,r,o,s)=>{const d=m.getToolbarHandlerWithPluginActivation(),c=m.onUpscale(e,t,o),u=m.onColorCorrect(e,t,o),_=m.onAutoStraighten(e,t,o),p=m.onImageFilter(e,t,o);let f;n&&"image"===n[".tag"]&&n.image_width&&n.image_height&&(f={width:n.image_width,height:n.image_height});const g=(null==r?void 0:r.upscale)||(null==r?void 0:r.colorCorrect)||(null==r?void 0:r.autoStraighten)||(null==r?void 0:r.filter),v=[{icon:V.ShapeRotateLeftLine,label:l.actionBarStrings.rotateLeftButtonText,handler:d({handler:m.onRotate(m.RotationDirection.LEFT,e,t,o),keyboardBinding:{key:"l"}}),tooltip:a?void 0:{text:l.actionBarStrings.rotateLeftButtonText,keyboardShortcut:l.actionBarStrings.rotateLeftButtonKeyboardShortcut},actionType:a?i.UserAction.LoggedOutRotateLeft:i.UserAction.RotateLeft},{icon:V.ShapeRotateRightLine,label:l.actionBarStrings.rotateRightButtonText,handler:d({handler:m.onRotate(m.RotationDirection.RIGHT,e,t,o),keyboardBinding:{key:"r"}}),tooltip:a?void 0:{text:l.actionBarStrings.rotateRightButtonText,keyboardShortcut:l.actionBarStrings.rotateRightButtonKeyboardShortcut},actionType:a?i.UserAction.LoggedOutRotateRight:i.UserAction.RotateRight},{icon:V.FlipHorizontalLine,label:l.actionBarStrings.flipButtonText,handler:d({handler:m.onFlip(e,t,o)}),tooltip:a?void 0:{text:l.actionBarStrings.flipButtonText},actionType:a?i.UserAction.LoggedOutFlipHorizontal:i.UserAction.FlipHorizontal},{icon:V.CropLine,label:l.actionBarStrings.cropButtonText,handler:d({handler:m.onCrop(e,t,o),keyboardBinding:{key:"c"}}),tooltip:a?void 0:{text:l.actionBarStrings.cropButtonText,keyboardShortcut:l.actionBarStrings.cropButtonKeyboardShortcut},actionType:a?i.UserAction.LoggedOutCrop:i.UserAction.Crop},...Kt(e,t,o,a)],h=[];if(!a&&g){const e={icon:U.ImageEnhanceLine,label:l.actionBarStrings.enhanceButtonText,handler:{type:"submenu",menu:Ye.default.createElement(m.MagicTools,{onUpscale:c,onColorCorrect:u,onAutoStraighten:_,onFilter:p,imageDimensions:f,previewsImageEnhancements:r})},actionType:i.UserAction.Enhance};s===i.Variant.V2?h.push(e):v.push(e)}return{imageEditingButtons:v,enhanceButton:h}},jt=e=>O.isToolbarOptimizationExperimentEnabled(e)?i.UserActionContext.EditFileDropdown:i.UserActionContext.PreviewToolbar,qt=(e,t)=>{const i=Ye.default.lazy((async()=>({default:(await t())[e]}))),n=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(i,{...e}));return n.displayName=`Async${e}`,n},Qt=[F.imageEditingActionCondition,F.audioVideoEditingActionCondition,F.pdfEditActionCondition,m.selfSignActionCondition,m.sendForSignatureActionCondition],Yt=qt("OpenInMenuContent",(()=>new Promise((function(t,i){e(["./c_action_plugins_open_in_action_dropdown"],t,i)})))),$t=e=>e&&[i.SDKPreviewSurface.QUICK_VIEW_BROWSE,i.SDKPreviewSurface.QUICK_VIEW_SEARCH].includes(e),Xt=(e,t)=>{const n=P.getActionCondition(e,_.openInActionConditions);if(n&&(i.MSOFFICE_EDITOR_FILE_EXTS.includes(`.${i.getExtension$1(n.file)}`)||!(e=>{for(const t of Qt)if(P.getActionCondition(e,t))return!0;return!1})(e)||$t(t)))return n},Zt=(e,t,n)=>{const a=Xt(e,n);if(!a||!t)return[];const r=$t(n)?i.UserActionContext.QuickViewToolbar:i.UserActionContext.PreviewToolbar;return[{label:z.OPEN_IN_ACTION_STRING,icon:i.OpenLine,handler:{type:"menu",menu:Ye.default.createElement(Yt,{user:a.user.user,file:a.file,actionContext:r,surface:n})},actionType:i.UserAction.OpenInMenu}]},Jt=(e,t,i)=>[ii(e,t,i),ni(e,t,i),ai(e,t,i)],ei=async()=>await new Promise((function(t,i){e(["./c_action_plugins_pdf_edit_action_action"],t,i)})),ti=(e,t,n)=>({handler:null!=t?t:m.clickHandler(p.loggedOutSUSIAndActionContinuationHandler({action:"edit"},i.PreviewType.SsrDoc,n)),actionType:t?e:i.UserAction.LoggedOutEditPdfAttempt,tooltip:t?void 0:{text:p.loggedOutEditButtonTooltip}}),ii=(e,t,n)=>{let a=m.NonSignEntryPoints.UNFURL_ACTIONS_DRAW;return(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.BROWSE?a=m.NonSignEntryPoints.BROWSE_PREVIEW_UNFURL_ACTIONS_DRAW:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.STANDALONE_PREVIEW?a=m.NonSignEntryPoints.STANDALONE_PREVIEW_UNFURL_ACTIONS_DRAW:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.SHARED_LINK&&(a=m.NonSignEntryPoints.SHARED_LINK_UNFURL_ACTIONS_DRAW),{icon:B.ScribbleLine,label:r.intl.formatMessage({id:"7E2+UP",defaultMessage:"Draw"}),...ti(i.UserAction.Draw,e?m.clickHandler((async()=>{(await ei()).pdfEditAction(e,si(n),a)})):void 0,t)}},ni=(e,t,n)=>{let a=m.NonSignEntryPoints.UNFURL_ACTIONS_HIGHLIGHT;return(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.BROWSE?a=m.NonSignEntryPoints.BROWSE_PREVIEW_UNFURL_ACTIONS_HIGHLIGHT:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.STANDALONE_PREVIEW?a=m.NonSignEntryPoints.STANDALONE_PREVIEW_UNFURL_ACTIONS_HIGHLIGHT:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.SHARED_LINK&&(a=m.NonSignEntryPoints.SHARED_LINK_UNFURL_ACTIONS_HIGHLIGHT),{icon:B.HighlightLine,label:r.intl.formatMessage({id:"e7+jFI",defaultMessage:"Highlight"}),...ti(i.UserAction.Highlight,e?m.clickHandler((async()=>{(await ei()).pdfEditAction(e,si(n),a)})):void 0,t)}},ai=(e,t,n)=>{let a=m.NonSignEntryPoints.UNFURL_ACTIONS_ADD_TEXT;return(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.BROWSE?a=m.NonSignEntryPoints.BROWSE_PREVIEW_UNFURL_ACTIONS_ADD_TEXT:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.STANDALONE_PREVIEW?a=m.NonSignEntryPoints.STANDALONE_PREVIEW_UNFURL_ACTIONS_ADD_TEXT:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.SHARED_LINK&&(a=m.NonSignEntryPoints.SHARED_LINK_UNFURL_ACTIONS_ADD_TEXT),{icon:B.TextBoxLine,label:r.intl.formatMessage({id:"B1Oo3m",defaultMessage:"Add text"}),...ti(i.UserAction.AddText,e?m.clickHandler((async()=>{(await ei()).pdfEditAction(e,si(n),a)})):void 0,t)}},ri=(e,t,n)=>{const a="V2"===n?r.intl.formatMessage({id:"SlX2PZ",defaultMessage:"Edit"}):r.intl.formatMessage({id:"ey0C8F",defaultMessage:"Edit PDF"});let o=m.NonSignEntryPoints.DEFAULT_ENTRY_POINT;return(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.BROWSE?o=m.NonSignEntryPoints.BROWSE_PREVIEW_EDIT_PDF:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.STANDALONE_PREVIEW?o=m.NonSignEntryPoints.STANDALONE_PREVIEW_EDIT_PDF:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.SHARED_LINK&&(o=m.NonSignEntryPoints.SHARED_LINK_EDIT_PDF),{icon:D.EditLine,label:a,campaignElementId:"toolbar-edit-pdf-button",...ti(i.UserAction.EditPdf,e?m.clickHandler((async()=>{(await ei()).pdfEditAction(e,i.UserActionContext.PreviewToolbar,o)})):void 0,t)}},oi=(e,t,n)=>{let a=m.NonSignEntryPoints.UNFURL_ACTIONS_EDIT_TEXT;return(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.BROWSE?a=m.NonSignEntryPoints.BROWSE_PREVIEW_UNFURL_ACTIONS_EDIT_TEXT:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.STANDALONE_PREVIEW?a=m.NonSignEntryPoints.STANDALONE_PREVIEW_UNFURL_ACTIONS_EDIT_TEXT:(null==e?void 0:e.previewSurface)===i.SDKPreviewSurface.SHARED_LINK&&(a=m.NonSignEntryPoints.SHARED_LINK_UNFURL_ACTIONS_EDIT_TEXT),{icon:U.PlaceholderTextLine,label:r.intl.formatMessage({id:"JlEwCY",defaultMessage:"Edit text"}),...ti(i.UserAction.EditPdfText,e?m.clickHandler((async()=>{(await ei()).pdfEditAction(e,si(n),a)})):void 0,t)}},si=e=>O.isToolbarOptimizationExperimentEnabled(e)?e===i.Variant.V1?i.UserActionContext.EditFileDropdown:i.UserActionContext.MarkUpDropdown:i.UserActionContext.PreviewToolbar;i.injectInternalStyle("/static/metaserver/static/js/file_viewer/toolbar/toolbar.module.out-vflFDenq_.css",(e=>"._sign-dropdown-button-icon_1asll_1{display:flex;margin-right:calc(var(--dig-spacing__micro__medium)/2)}"));const li=(t,n,a,r,o,s,l,c,u)=>{const{previewType:_}=t,p=!!c&&["V1","V2"].includes(c),f=((t,n,a,r,o,s,l,c,u)=>{if(o||!s&&t.user)return[];const _=!l||t.user&&!i.isSharedFile(t.file)?m.sendForSignatureActionCondition:m.loggedOutSendForSignatureActionCondition,p=P.getActionCondition(t,_),f=p&&m.getActionArgs(n,a,p.user.user,p.file,r,u,l),g=f&&{label:l?z.GET_SIGNAURES_ACTION_STRING:z.SEND_FOR_SIGNATURE_ACTION_STRING,icon:l?U.SignableDocumentPictogram:H.SendLine,handler:m.clickHandler((async()=>{t.user?(await new Promise((function(t,i){e(["./c_action_plugins_send_for_signature_action_action"],t,i)}))).sendForSignatureAction(f):c()})),actionType:i.UserAction.SendForSignature},v=!l||t.user&&!i.isSharedFile(t.file)?m.selfSignActionCondition:m.loggedOutSelfSignActionCondition,h=d.is_supported_mobile_browser()?void 0:P.getActionCondition(t,v),w=h&&m.getSelfSignActionArgs(a,n,h.user.user,h.file,r,i.UserActionContext.PreviewToolbar,u,l),y=w&&{label:l?z.SIGN_YOURSELF_ACTION_STRING:z.SELF_SIGN_ACTION_STRING,icon:W.SignatureLine,handler:m.clickHandler((async()=>{t.user?(await new Promise((function(t,i){e(["./c_action_plugins_self_sign_action_action"],t,i)}))).selfSignAction(w):c()})),actionType:i.UserAction.SelfSign};return[...y?[y]:[],...g?[g]:[]]})(t,n,a,r,o,s,p,(async()=>{const{showAuthModal:n}=await new Promise((function(t,i){e(["./c_file_viewer_common_show_auth_modal"],t,i)})).then((function(e){return e.show_auth_modal_esnext}));n({...{mode:i.AuthMode.REGISTER,encryptionOptions:l,kind:i.LoginOrRegisterKind$1.LOGGED_OUT_PDF_SIGN,authDialogPreviousElement:i.AuthDialogPreviousElementTag.EDIT,loggingExtra:{signup_source:"sign"},sharedLinkUrl:null==u?void 0:u.url,webSignInTag:i.getWebSignInTag(!!t.user,t.previewSurface,t.sharePermission),sharedLinkInfo:u}})}),t.previewSurface);return p?_===i.PreviewType.Image?[]:f.length>0?[{icon:W.SignatureLine,label:u?z.SIGN_A_COPY_STRING:z.SIGN_STRING,handler:{type:"menu",menu:Ye.default.createElement(di,{actions:f,logUserAction:a})},actionType:i.UserAction.OpenSignMenu}]:[]:f},di=({actions:e,logUserAction:t})=>Ye.default.createElement(i.Menu.Segment,null,null==e?void 0:e.map(((e,n)=>{const a=e.label,r=e.icon;return Ye.default.createElement(i.Menu.ActionItem,{key:n},Ye.default.createElement(ci,{label:a,onClick:()=>{var n;"click"===e.handler.type&&(null===(n=e.handler)||void 0===n||n.handler()),e.actionType&&t(e.actionType,i.UserActionContext.SignDropdown)},icon:r}))}))),ci=({label:e,onClick:t,icon:n})=>{const a="string"==typeof e?e:r.intl.formatMessage(e);return Ye.default.createElement(K.PreviewButton,{variant:"transparent",hasNoUnderline:!0,onClick:t},Ye.default.createElement("span",{className:"_sign-dropdown-button-icon_1asll_1"},Ye.default.createElement(i.UIIcon,{isOpticallyAligned:!0,src:n,width:"20px",height:"20px"})),a)};ci.displayName="SignButton";const ui=P.withActionCondition(m.textEditingActionCondition,((e,t,n)=>[{icon:D.EditLine,label:m.editContentText,handler:m.clickHandler(m.onEdit(t,n,i.UserActionContext.PreviewToolbar),{key:"e"}),actionType:i.UserAction.EditText}]),[]);const _i=(t,n)=>{if(!P.getActionCondition(t,_.unzipActionConditions))return[];const a={file:t.file,sharePermission:t.sharePermission,shareToken:n,user:t.user},o=r.intl.formatMessage({id:"pB6h1Y",defaultMessage:"Archive files over 512 MB cannot be extracted"}),s=a.file.bytes/1048576>=i.UNZIP_MAX_FILESIZE_MB;return a.user?[{label:r.intl.formatMessage({id:"u1R/iY",defaultMessage:"Extract all"}),icon:q.ZipLine,handler:m.clickHandler((async()=>{(await new Promise((function(t,i){e(["./c_conversions_actions_unzip"],t,i)}))).UnzipAction.convert([a.file],a.user,{shareToken:n,source:"preview"})})),actionType:i.UserAction.ExtractAll,disabled:s,tooltip:s?{text:o}:void 0}]:[]},mi=(e,t,n,a,r,o)=>{const s=pi(a.previews_toolbar_optimization),l=m.clickHandler(m.trimHandler(n,r,s)),d=m.clickHandler(m.cropHandler(n,r,s)),c=m.clickHandler(m.rotateLeftHandler(n,r,s)),u=m.clickHandler(m.rotateRightHandler(n,r,s)),_=m.clickHandler(m.flipHorizontalHandler(n,r,s)),p=m.clickHandler(m.flipVerticalHandler(n,r,s)),{trimLabel:f,cropLabel:g,rotateLeftLabel:v,rotateRightLabel:h,flipHorizontalLabel:w,flipVerticalLabel:y}=t,E=[{label:f,icon:V.CutLine,handler:m.clickHandler(m.trimHandler(n,r,i.UserActionContext.PreviewToolbar)),actionType:i.UserAction.Trim,tooltip:o?{text:o}:void 0,disabled:!!o}],S=[{label:f,icon:V.CutLine,handler:l,actionType:i.UserAction.Trim,tooltip:o?{text:o}:void 0,disabled:!!o},{label:g,icon:V.CropLine,handler:d,actionType:i.UserAction.Crop,tooltip:o?{text:o}:void 0,disabled:!!o},{label:v,icon:V.ShapeRotateLeftLine,handler:c,actionType:i.UserAction.RotateLeft,tooltip:o?{text:o}:void 0,disabled:!!o},{label:h,icon:V.ShapeRotateRightLine,handler:u,actionType:i.UserAction.RotateRight,tooltip:o?{text:o}:void 0,disabled:!!o},{label:w,icon:V.FlipHorizontalLine,handler:_,actionType:i.UserAction.FlipHorizontal,tooltip:o?{text:o}:void 0,disabled:!!o},{label:y,icon:V.FlipVerticalLine,handler:p,actionType:i.UserAction.FlipVertical,tooltip:o?{text:o}:void 0,disabled:!!o}];return e===i.PreviewType.Video?S:E},pi=e=>O.isToolbarOptimizationExperimentEnabled(e)?i.UserActionContext.EditFileDropdown:i.UserActionContext.PreviewToolbar,fi=(e,t,n,a,o,s,l,d,c,u,_)=>{var p,f;const{logUserAction:g,featureConfig:v}=i.useFileViewerContext(),h=i.useCurrentPreviewMetadata(),w=Y.useStrings(),y=null!==(p=null==h?void 0:h.previewType)&&void 0!==p?p:i.PreviewType.Other,E=i.useStabilizedCallback(((e,t,n)=>g(e,n?i.UserActionContext.Keyboard:t?i.UserActionContext.PreviewToolbarOverflowMenu:i.UserActionContext.PreviewToolbar))),S=x.useCurrentPageCount(),{previewsToolbarOptimizationVariant:C}=null!=_?_:{},I=x.useGetCurrentDocPageCallback(),T=i.useIsNestedArchiveFile(),A=Ye.default.useMemo((()=>({user:e,file:t,previewSurface:a,previewType:y,sharePermission:n,isNestedArchiveFile:T,sharedLinkInfo:u})),[e,t,a,y,n,T,u]),M=i.useRootFileMetadata(),k=m.useAudioVideoEditDisabledTooltipMsg(null==M?void 0:M.file_name,null==M?void 0:M.size),O=i.useRootFile(),{data:U}=Q.useFileContentMetadataQuery(O),V=null===(f=null==U?void 0:U.apiData)||void 0===f?void 0:f.metadata,B=b.useSetActiveEditorCallback(),{previewsImageEnhancements:H}=m.useImageEnhancements(e),{imageEditingButtons:W,enhanceButton:K}=Ye.default.useMemo((()=>((e,t,i,n,a,r)=>{if(!P.getActionCondition(e,F.imageEditingActionCondition))return{imageEditingButtons:[],enhanceButton:[]};const o=jt(r);return Gt(t,i,n,!e.user,a,o,r)})(A,B,g,V,H,C)),[A,V,g,H,B,C]),q=Ye.default.useMemo((()=>ui(A,B,g)),[A,g,B]),$=Ye.default.useMemo((()=>((e,t,i,n,a,r)=>P.getActionCondition(e,F.audioVideoEditingActionCondition)?mi(e.previewType,t,i,n,a,r):[])(A,w,g,v,B,k)),[k,A,v,g,B,w]),{editPdfButton:X,markUpPdfActions:Z}=Ye.default.useMemo((()=>((e,t,n,a,r,o,s)=>{if(!P.getActionCondition(e,F.pdfEditActionCondition))return{editPdfButton:[],markUpPdfActions:[]};const l={previewSurface:r,logUserAction:t,setActiveEditorCallback:n,getCurrentPage:a},{previewsToolbarOptimizationVariant:d,pdfTextEditingVariant:c}=null!=s?s:{},u=c&&[i.Variant.UPSELL,i.Variant.INLINE].includes(c),_=d&&[i.Variant.V1,i.Variant.V2].includes(d),m=u&&_?[oi(l,o,d)]:[];return{editPdfButton:[ri(l,o,d)],markUpPdfActions:Jt(l,o,d).concat(m)}})(A,g,B,I,a,c,_)),[A,c,I,g,a,B,_]),J=i.useCanWatermarkFile({file:A.file,user:A.user}),ee=Ye.default.useMemo((()=>J?((e,t)=>P.getActionCondition(e,m.watermarkActionCondition)?[{icon:D.StampLine,label:r.intl.formatMessage({id:"Hmnxto",defaultMessage:"Watermark"}),handler:m.clickHandler((async()=>t(m.WATERMARKING_PLUGIN_ID,i.UserActionContext.PreviewToolbar))),actionType:i.UserAction.Watermark}]:[])(A,B):[]),[J,A,B]),te="V2"===C,ie="V1"===C||te?Z:X.concat(Z),ne=Ye.default.useMemo((()=>[...W,...$,...ie,...ee,...q]),[W,$,ie,ee,q]),ae=(e=>{const t=x.useRightSidebarId()===b.TRANSCRIPT_BLADE_PLUGIN_ID,n=b.useCloseSidebarCallback(b.TRANSCRIPT_BLADE_PLUGIN_ID,i.UserActionContext.PreviewToolbar),a=b.useSetRightSidebarCallback(b.TRANSCRIPT_BLADE_PLUGIN_ID,i.UserActionContext.PreviewToolbar);if(!P.getActionCondition(e,G.transcriptActionConditions))return[];const r=m.clickHandler((async()=>{t?n():a()}));return[{icon:j.ClosedCaptionsLine,label:z.TRANSCRIPT_ACTION_STRING,handler:r,actionType:void 0}]})(A),re=(e=>{var t;const n=x.useRightSidebarId()===b.AI_PLUGIN_ID,a=b.useCloseSidebarCallback(b.AI_PLUGIN_ID,i.UserActionContext.Toolbar),o=b.useSetRightSidebarCallback(b.AI_PLUGIN_ID,i.UserActionContext.Toolbar),s=null===(t=i.useExperiment("previews_exp_dropbox_ai_assistant",!0).experiment)||void 0===t?void 0:t.variant;if(!P.getActionCondition(e,zt)||!Vt(s))return[];const l=b.AI_PLUGIN_ID+"-action-button"+(n?"-opened":"-closed");return[{icon:R.Twinkle2Line,label:r.intl.formatMessage({id:"aNz4Ju",defaultMessage:"Dropbox AI"}),handler:m.clickHandler((async()=>{n?a():o()})),actionType:i.UserAction.DropboxAI,campaignElementId:l}]})(A),oe=(e=>{const{handleClick:t}=N.useCommentSidebarInteraction(i.UserActionContext.PreviewToolbar);return P.getActionCondition(e,N.commentActionCondition)?[{icon:L.CommentLine,label:Ot,handler:m.clickHandler((async()=>t())),actionType:void 0}]:[]})(A),se=Ye.default.useMemo((()=>[..._i(A,d),...ae,...Zt(A,o),...li(A,B,g,S,s,l,c,C,u),...re,...oe]),[A,B,g,d,ae,S,s,l,o,re,oe,c,C,u]),le=(({previewType:e,editActions:t,logUserAction:n,sharedLinkInfo:a,previewsToolbarOptimizationVariant:r})=>{const o=!r||r===i.Variant.OFF||r===i.Variant.CONTROL,s=[i.PreviewType.Image,i.PreviewType.Video,i.PreviewType.SsrDoc,i.PreviewType.Loading].includes(e);if(o||!s)return t;const{icon:l,label:d,action:c}=Ht({previewsToolbarOptimizationVariant:r,previewType:e,sharedLinkInfo:a});return t.length>0?[{icon:l,label:d,handler:{type:"menu",menu:Ye.default.createElement(Wt,{actions:t,actionContext:c.actionContext,logUserAction:n})},actionType:c.actionType}]:[]})({previewsToolbarOptimizationVariant:C,logUserAction:g,editActions:ne,previewType:y,sharedLinkInfo:u});return{actions:Ye.default.useMemo((()=>ne.length||se.length?{editActions:te?[...X,...le,...K]:le,fileActions:se}:void 0),[ne,se,le,te,K,X]),logAction:E}},gi=()=>{const{toolbar:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>{return e?(t=e,e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(t,{...e}))):X.Toolbar;var t}),[e])};i.injectInternalStyle("/static/js/file_viewer/toolbar/toolbar_wrapper.module.out-vflPTiRfz.css",(e=>"._sizer_1idgd_1{width:100%}"));const vi=new Set([i.PreviewType.SsrDoc,i.PreviewType.Image,i.PreviewType.HTML,i.PreviewType.Text]),hi=({actions:e,logAction:t,noLeftMargin:n=!1})=>{const a=i.useCurrentPreviewMetadata(),r=null==a?void 0:a.previewType,o=C.useResponsiveSize(),s=gi();return Ye.default.createElement("div",{className:"_sizer_1idgd_1"},vi.has(r)||e?Ye.default.createElement(s,{noLeftMargin:n,actions:e,logAction:t,breakpoint:o}):null)};hi.displayName="ToolbarWrapper";const wi=e=>{const{user:t,activePreviewFile:n,previewSurface:a,shareToken:r,sharedLinkInfo:o,toolbarExperiments:s}=e,{file:l,sharePermission:d,encryptionOptions:c}=n,u=$.useUserHasDmtConflict(),_=$.useIsSendForSignatureEnabled(),{hasOpenInActions:m}=g.usePluginMigrationContext(),{actions:p,logAction:f}=fi(t,l,d,a,m,u,_,r,c,o,s),v=i.isPolluxDesktopSurface(a);return Ye.default.createElement(hi,{actions:p,logAction:f,noLeftMargin:v})};wi.displayName="MetaserverToolbarWrapper";const yi=e=>{const t=(()=>{const{signUpBanner:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>null!=e?e:i.SignUpBannerFilePreview),[e])})();return Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(t,{...e}))};i.injectInternalStyle("/static/js/file_viewer/components/preview.module.out-vflg2Iru1.css",(e=>"._container_xhhy1_1{align-items:stretch;display:flex;flex:1;font-family:AtlasGrotesk,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:var(--type__body__standard--fontsize);justify-content:flex-end;min-height:0;position:relative;width:100%}._container_xhhy1_1 *,._container_xhhy1_1 :after,._container_xhhy1_1 :before{box-sizing:border-box}._container_xhhy1_1 aside{background:var(--color__standard__background)}._containerV2_xhhy1_25{flex-direction:column;justify-content:flex-start}"));const Ei=(e,t,i=[])=>{const n=a.useRef(null),r=()=>{n.current&&(window.clearTimeout(n.current),n.current=null)};return a.useEffect((()=>r),[...i,t]),()=>{r(),n.current=window.setTimeout(e,t)}},Si=Ye.default.memo((e=>{const{fileViewerId:t,isDeleteEnabled:n,isFileFlippingEnabled:a,isPreviewZoomed:r,enableFullscreen:o,fileIndex:s,collectionFileCount:l}=e,{logUserAction:d}=i.useFileViewerContext(),c=i.useRootPreviewKey(t),u=i.useFileViewerSelector(i.getIsDeleteFileModalOpen,t),_=!!x.useActiveEditorId(),m=ne.useDispatch(),p=b.useEnterFullScreenCallback(),f=o&&!_?ie.getKeyboardBinding({callback:()=>p({actionContext:i.UserActionContext.Keyboard}),key:"f"}):null,g=b.useCloseViewerCallback(),v=ie.getKeyboardBinding({key:i.Key_enum.Key.Escape,callback:()=>{g(i.UserActionContext.Keyboard)}}),h=c&&ie.getDeleteFileBindings((e=>{d(i.UserAction.Delete,i.UserActionContext.Keyboard),m(Z.deleteFile({previewKey:c,fileViewerId:t,actionContext:i.UserActionContext.Keyboard,key:e===i.Key_enum.Key.Delete?"delete":"backspace"}))})),w=ie.useFileFlippingBindings({requireCommandKey:r,fileIndex:s,collectionFileCount:l}),y=[];return f&&y.push(f),a&&!u&&(y.push(...w),y.push(v)),n&&!u&&h&&y.push(...h),Ye.default.createElement(ie.KeyboardBindingConnector,{name:"app",keyboardBindings:y})}));function bi(e){return e&&function(e){return!!e&&"editUI"in e}(e)?e:void 0}Si.displayName="PreviewKeyboardBindings";const Ci=(e,t,n)=>{const a=Ye.default.useRef(!1),r=i.useSetLocalErrorCallback(t);Ye.default.useEffect((()=>{if(!a.current&&t&&(null==n?void 0:n.previewType)&&(i.PreviewsEventLogger.mark(i.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA_START_START),e.isSuccess&&(i.PreviewsEventLogger.mark(i.PreviewsTimingEvents.FVSDK_GET_RIVIERA_DATA),a.current=!0),e.isError)){const t=i.isFVError(e.error)?e.error:new i.FVError(i.FVErrorCode.RivieraDataFetchFailure,i.ErrorLifecycle.Download,e.error.message);r(t),a.current=!0}}),[null==n?void 0:n.previewType,t,e.error,e.isError,e.isSuccess,r])},Ii=qt("PreviewArchive",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_archive2"],t,i)})))),Ti=e=>{const{previewKey:t,previewSessionId:n}=e,a=i.useCurrentPreviewMetadata(),r=i.useArchiveDataQuery(t,a);return te.useDownloadSucceeded(n,r.isSuccess),Ci(r,t,a),Ye.default.createElement(Ii,{...e,archiveDataResult:r})};Ti.displayName="AsyncPreviewArchiveWithRivieraFetch";const xi=qt("PreviewAudioVideo",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_audio_video_preview_video"],t,i)})).then((function(e){return e.preview_video_esnext})))),Ai=e=>{const{previewKey:t,previewSessionId:n,featureConfig:a,setLocalError:r}=e;Ye.default.useEffect((()=>{i.isNestedArchiveFilePreviewKey(t)&&r(new i.FVError(i.FVErrorCode.NestedFiletypeNotSupported,i.ErrorLifecycle.Render))}),[t,r]);const o=i.useCurrentPreviewMetadata(),s=oe.useQueryClient();Ye.default.useMemo((()=>{o&&i.prefetchAudioVideoRivieraData(s,t,o,a.videojs_preload)}),[a.videojs_preload,o,t,s]),te.useDownloadSucceeded(n,!0);const l=i.useMediaMetadataQuery(t,o),d=i.useWaveformDataQuery(t,o),c=(null==o?void 0:o.previewType)===i.PreviewType.Audio?d:l;return Ci(c,t,o),Ye.default.createElement(xi,{...e})};Ai.displayName="AsyncPreviewAudioVideoWithLifecycleLogging";const Mi=qt("PreviewCloudDoc",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_cloud_doc"],t,i)})))),ki=e=>(te.useDownloadSucceeded(e.previewSessionId,!0),Ye.default.createElement(Mi,{...e}));ki.displayName="AsyncPreviewCloudDocWithRivieraFetch";const Ni=()=>{const{previewContent:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>{return e?(t=e,e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(t,{...e}))):k.PreviewContent;var t}),[e])},Pi=qt("PreviewDoc",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_doc"],t,i)})))),Li=e=>{const{previewKey:t,previewSessionId:n}=e,a=i.useCurrentPreviewMetadata(),r=i.useSsrDocRivieraDataInfiniteQuery(t,a);Ci(r,t,a);const o=i.useSsrDocDataPreparedForDisplay(null==a?void 0:a.content,r);return te.useDownloadSucceeded(n,!!o&&!(null==o?void 0:o.needsPassword)),i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.ASYNC_DOC_CONTAINER_MOUNT),Ye.default.createElement(Pi,{...e,rivieraDataResult:r})};Li.displayName="AsyncPreviewDocWithRiviera";const Ri=qt("PreviewError",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_error"],t,i)}))));class Di extends Ye.default.PureComponent{componentDidCatch(e){this.props.onError(e)}static getDerivedStateFromError(){return{}}render(){return this.props.children}}Di.displayName="UnconnectedErrorBoundary";const Fi=({children:e})=>{var t;const{fileViewerId:n}=i.useFileViewerContext(),a=i.useRootPreviewKey(n),r=i.useCurrentPreviewMetadata(),o=i.useFileMetadata(a),s=i.getFileExtension(null==o?void 0:o.file_name),l=null===(t=i.useFileViewerContext().optionalIOClients.reportExceptionClient)||void 0===t?void 0:t.reportException,d=i.useSetLocalErrorCallback(a),c=i.useStabilizedCallback((e=>{var t;null==l||l(e,(null===(t=null==r?void 0:r.content)||void 0===t?void 0:t[".tag"])||"other",s,"critical"),d(i.isFVError(e)?e:new i.FVError(i.FVErrorCode.Unknown,i.ErrorLifecycle.Render,e.message))}));return Ye.default.createElement(Di,{onError:c},e)};Fi.displayName="ErrorBoundary";const Oi=qt("PreviewHTML",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_html"],t,i)})))),Ui=e=>(te.useDownloadSucceeded(e.previewSessionId,!0),Ye.default.createElement(Oi,{...e}));Ui.displayName="AsyncPreviewHTMLWithRivieraFetch";const Vi=qt("PreviewImage",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_image"],t,i)})))),Bi=e=>(te.useDownloadSucceeded(e.previewSessionId,!0),i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.ASYNC_IMAGE_CONTAINER_MOUNT),Ye.default.createElement(Vi,{...e})),zi=qt("PreviewLinkfile",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_linkfile2"],t,i)})))),Hi=e=>{const{previewKey:t,previewSessionId:n}=e,a=i.useCurrentPreviewMetadata(),r=i.useLinkfileUriQuery(t,a);return te.useDownloadSucceeded(n,r.isSuccess),Ci(r,t,a),Ye.default.createElement(zi,{...e,linkfileResult:r})};Hi.displayName="AsyncPreviewLinkfileWithLifecycleLogging";const Wi=qt("PreviewText",(()=>new Promise((function(t,i){e(["./c_file_viewer_preview_text2"],t,i)})).then((function(e){return e.preview_text_esnext})))),Ki=e=>{const t=i.useCurrentPreviewMetadata(),{data:{apiData:n}={},isLoading:a}=i.useTextDataQuery(e.previewKey,t);return te.useDownloadSucceeded(e.previewSessionId,void 0!==n),a?Ye.default.createElement("div",{className:se.spinnerContainer},Ye.default.createElement(i.Spinner,{size:"large"})):Ye.default.createElement(Wi,{...e,fileContent:n})};Ki.displayName="AsyncPreviewTextWithRivieraFetch";const Gi=e=>{const{featureConfig:t,sourceSession:n,isLoggedIn:a,logger:r,apiV2Client:o}=i.useFileViewerContext(),s=i.useRootPreviewMetadata(),l=oe.useQueryClient();i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.PREVIEW_COMPONENT_MOUNT);const c=Ye.useMemo((()=>{var e;return{logDuration:()=>Promise.resolve(null==r?void 0:r.logDuration),tags:i.makeApiLoggerTags(n.source_context,a,null===(e=s.content)||void 0===e?void 0:e[".tag"])}}),[a,null==r?void 0:r.logDuration,s.content,n.source_context]);return i.useFileViewerPrefetch(t,s,l,e.fileInfo,c,o,t.videojs_preload,d.is_supported_mobile_browser(),e.sharedLinkInfo),Ye.createElement(ji,null,(({width:t,height:i})=>Ye.createElement(qi,{...e,width:t,height:i})))};Gi.displayName="Preview";const ji=e=>{const{children:t}=e,{nodeRef:n,contentRect:a}=ee.useContentRect();return Ye.createElement("div",{className:i.cx("_container_xhhy1_1","_containerV2_xhhy1_25"),ref:n,id:"fvsdk-container"},a&&a&&(null==t?void 0:t(a)))};ji.displayName="PreviewContentRectSizer";const qi=e=>{var t,n;const{fileInfo:a,fileMetadata:r,sharedLinkInfo:o,editors:s}=e,{fileViewerId:l,featureConfig:d,sourceSession:c}=i.useFileViewerContext(),u=i.useSetFileViewerAtom(i.sharedLinkInfoAtom),_=i.useFileViewerSelector(i.isPreviewZoomed,l),m=Ni(),p=ne.useDispatch(),f=Ye.useMemo((()=>i.getPreviewKeyFromFileInfo(a)),[a]);Ye.useEffect((()=>{p(Z.setRootFileInfo({fileViewerId:l,fileInfo:a,previewKey:f}))}),[p,a,l,f]),Ye.useEffect((()=>{p(Z.setFileMetadata({...r,previewKey:f}))}),[p,r,f]),Ye.useEffect((()=>{o&&u(o)}),[u,o]);const g=i.useFileViewerSelector(i.getRootFile,l);Ye.useEffect((()=>{g&&g.file_id!==a.file_id&&(c.was_flipped=!0)}));const v=Ye.useMemo((()=>({...i.DEFAULT_FILE_CONFIG,...e.fileConfig})),[e.fileConfig]),h=x.useActiveEditorId(),w=h?bi(null==s?void 0:s[h]):void 0;return le.useMaybeOpenEditorBasedOnUrl(),Ye.createElement(Ye.Fragment,null,Ye.createElement(m,null,Ye.createElement(Fi,null,Ye.createElement(Qi,{...e,fileConfig:v,brandingInfo:e.brandingInfo||{},activeOverlayEditor:w}))),Ye.createElement(Si,{fileViewerId:l,enableFullscreen:d.enable_fullscreen,isDeleteEnabled:!w,isFileFlippingEnabled:null!=r&&!!r.file_collection_context&&!w,isPreviewZoomed:_,fileIndex:(null===(t=null==r?void 0:r.file_collection_context)||void 0===t?void 0:t.file_index)||0,collectionFileCount:(null===(n=null==r?void 0:r.file_collection_context)||void 0===n?void 0:n.parent_files_count)||0}))};qi.displayName="PreviewWithSize";const Qi=({callbacks:e,...t})=>{var n;const a=ne.useDispatch(),{fileInfo:r,fileMetadata:o,textHighlighters:s}=t,{fileViewerId:l,featureConfig:d}=i.useFileViewerContext(),c=i.useCurrentPreviewMetadata(),u=null==c?void 0:c.previewType,m=i.useFileViewerSelector(i.getCurrentPreviewKey,l),p=te.useInitializePreviewSession(m,r,o,null==e?void 0:e.onPreviewSessionInitialized);te.useSupportConfirmed(p,!!u&&u!==i.PreviewType.Loading&&u!==i.PreviewType.Error),i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.PREVIEW_RENDERER_MOUNT),te.useEndSession(p),M.useTimingLogging(l,u);const f=Ei((()=>{a(J.logPreviewEvent({event:i.EventType.UserEngaged3SecondsAfterRenderSucceeded,fileViewerId:l}))}),3e3,[l,p]),g=i.useStabilizedCallback((()=>{var t;f(),null===(t=null==e?void 0:e.onRenderSucceeded)||void 0===t||t.call(e)})),v=i.useSetLocalErrorCallback(m);re.useMaybeSetPasswordProtectedArchiveError();const h=Ye.useMemo((()=>s&&Object.values(s).filter((e=>!!e))),[s]),w=x.useActiveTextHighlighterId(),y=w?null==s?void 0:s[w]:void 0;if(!p||!m||!u)return null;const E={previewSessionId:p,onRenderSucceeded:g,previewKey:m,textHighlightersInstances:h,activeTextHighlighter:y,fileViewerId:l,featureConfig:d,setLocalError:v};switch(u){case i.PreviewType.Image:return Ye.createElement(Bi,{...t,...E,key:m.serialized});case i.PreviewType.SsrDoc:case i.PreviewType.CloudDoc:return"preview"!==d.cloud_doc_preview_mode&&_.getCloudDocExitUrl(c)?Ye.createElement(ki,{...t,...E,key:m.serialized}):(null===(n=null==o?void 0:o.file_name)||void 0===n?void 0:n.endsWith(".gsheet"))?Ye.createElement(Ui,{...t,...E,isRawHtml:!0,key:m.serialized}):Ye.createElement(Li,{...t,...E,key:m.serialized});case i.PreviewType.Video:case i.PreviewType.Audio:return Ye.createElement(Ai,{...t,...E,isAudio:u===i.PreviewType.Audio,key:m.serialized});case i.PreviewType.Excel:case i.PreviewType.RawHTML:return Ye.createElement(Ui,{...t,...E,isRawHtml:u===i.PreviewType.RawHTML,key:m.serialized});case i.PreviewType.Text:case i.PreviewType.HTML:return Ye.createElement(Ki,{...t,...E,key:m.serialized});case i.PreviewType.Archive:return Ye.createElement(Ti,{...t,...E,key:m.serialized});case i.PreviewType.Linkfile:return Ye.createElement(Hi,{...t,...E,key:m.serialized});case i.PreviewType.Error:return Ye.createElement(Ri,{error:(null==c?void 0:c.error)||new i.FVError(i.FVErrorCode.Unknown,i.ErrorLifecycle.Render),...t,...E,onRenderFailed:null==e?void 0:e.onRenderFailed});case i.PreviewType.Loading:return Ye.createElement(ae.LoadingIndicator,null)}return Ye.createElement(Ri,{error:new i.FVError(i.FVErrorCode.UnsupportedPreviewType,i.ErrorLifecycle.Render),...t,...E,onRenderFailed:null==e?void 0:e.onRenderFailed})};Qi.displayName="PreviewRenderer",Qi.displayName="PreviewRenderer";i.injectInternalStyle("/static/js/file_viewer/right_rail/right_rail.module.out-vflGyYAhv.css",(e=>"._editPluginContainer_kj1u0_1{background-color:var(--dig-color__background__raised);height:100%;width:328px}"));const Yi=({Sidebar:e})=>Ye.default.createElement("div",{className:"_editPluginContainer_kj1u0_1"},Ye.default.createElement(e,null));Yi.displayName="EditPluginSidebarInternal";const $i=Ye.default.memo(Yi);$i.displayName="EditPluginSidebar";i.injectInternalStyle("/static/js/file_viewer/ui/drawer_wrapper.module.out-vflbfZJSU.css",(e=>"._drawer-wrapper_lyxv4_1{color-scheme:var(--dig-color-scheme,light dark);flex:1;min-width:0}._inline-drawer_lyxv4_8{box-sizing:border-box;width:329px}"));const Xi=({leftSidebarContent:e,rightSidebarContent:t,defaultUi:n,children:a})=>((e=>{var t;const{optionalIOClients:n}=i.useFileViewerContext(),{preferencesClient:a}=n,r=null==e?void 0:e.defaultLeftSidebar,o=null==e?void 0:e.defaultRightSidebar,s=null===(t=null==a?void 0:a.sidebar)||void 0===t?void 0:t.getSidebarState(),l=null!=r?r:null==s?void 0:s.left,d=null!=o?o:null==s?void 0:s.right,c=b.useSetLeftSidebarCallback(l,r?i.UserActionContext.Initialization:i.UserActionContext.UserPreference),u=b.useSetRightSidebarCallback(d,o?i.UserActionContext.Initialization:i.UserActionContext.UserPreference);Ye.default.useEffect((()=>{c(),u()}),[])})(n),Ye.default.createElement(de.Drawer.InlineFrame,{withDrawer:Ye.default.createElement(Zi,{sidebarContent:t,alignment:"right"}),className:"_drawer-wrapper_lyxv4_1"},Ye.default.createElement(de.Drawer.InlineFrame,{withDrawer:Ye.default.createElement(Zi,{sidebarContent:e,alignment:"left"})},a)));Xi.displayName="DrawerWrapper";const Zi=({sidebarContent:e,alignment:t})=>{var n;const{fileViewerId:a}=i.useFileViewerContext(),r=i.useFileViewerSelector(i.getFileViewerUi,a),o=null!==(n=null==r?void 0:r.shouldAnimateSidebar)&&void 0!==n&&n,s=ce.usePrevious(e);return Ye.default.createElement(le.ErrorBoundary,{fallback:null},Ye.default.createElement(de.Drawer.InlineDrawer,{alignment:t,isOpen:!!e,className:"_inline-drawer_lyxv4_8",shouldAnimate:o},null!=e?e:s))};Zi.displayName="SidebarDrawer";const Ji=e=>{var t,n;const{editors:a,sidebars:r,comments:o,previewProps:s,showAuthModal:d,activePreviewFile:c,user:u,previewSurface:_,shareToken:m,previewContentOnly:p,webSignInTag:f,authModalKind:g,onFileChanged:v,browseContext:w,handleSusiClick:y,textHighlighters:E,userPresentableVerdict:S}=e,{fileViewerId:b,featureConfig:C}=i.useFileViewerContext(),I=x.useAreAudioVideoControlsHidden(),T=x.useAreToolsHidden(),A=x.useIsFullscreen(),k=le.useIsEditingVideo(b),N=i.useCurrentPreviewMetadata().previewType;i.useMarkTimingEventOnMount(i.PreviewsTimingEvents.FVSDK_APP_MOUNT);const P=C.mobile_web,L=x.useActiveEditorId(),R=L?bi(null==a?void 0:a[L]):void 0,D=L?(F=null==a?void 0:a[L])&&function(e){return!!e&&"fullscreenLayer"in e}(F)?F:void 0:void 0;var F;const O=!(R&&!(null==R?void 0:R.allowTitleBar)||C.mobile_web&&A||T||p),{titleBarActionGetters:U}=M.useTitlebarEditorActions(),V=null==U?void 0:U.isEditorReady,B=x.useLeftSidebarId(),z=x.useRightSidebarId(),[H,W]=Ye.useState(!1),K=Ye.useCallback((()=>{W(!0)}),[]),G=h.isMobileRedesignEnabled(C);Ye.useEffect((()=>{C.mobile_web&&C.previews_mobile_web_redesign&&"OFF"!==C.previews_mobile_web_redesign&&i.logStormcrowExposure("previews_mobile_web_redesign",C.previews_mobile_web_redesign,null==u?void 0:u.id)}),[C.mobile_web,C.previews_mobile_web_redesign,null==u?void 0:u.id]);const j=_===i.SDKPreviewSurface.SHARED_LINK||_===i.SDKPreviewSurface.SHARED_CONTENT_LINK||_===i.SDKPreviewSurface.SHARED_COLLECTION||_===i.SDKPreviewSurface.LOW_DISTRACTION_VIEW,q=i.isEncryptedFile(c.file),Q=i.useExperimentVariant("pro_sharing_presentation_links").variant,{variant:Y}=i.useExperimentVariant("previews_toolbar_optimization"),{variant:$}=i.useExperimentVariant("pdf_editing_text_editing"),X=Ye.useMemo((()=>({previewsToolbarOptimizationVariant:Y,pdfTextEditingVariant:$})),[$,Y]),Z=yt(),J=!q&&!p&&(G?Ye.createElement(Z,{activePreviewFile:c,previewSurface:_,user:u,webSignInTag:f,userPresentableVerdict:S,lowDistractionViewVariant:Q}):Ye.createElement(ft,{user:u,isSharedLink:j,activePreviewFile:c,authModalKind:g,webSignInTag:f,userPresentableVerdict:S,lowDistractionViewVariant:Q})),ee=Et(),te=G?Ye.createElement(ee,{activePreviewFile:c,webSignInTag:f,user:u,previewSurface:_,userPresentableVerdict:S,lowDistractionViewVariant:Q}):Ye.createElement(vt,{user:u,isSharedLink:j,isEncrypted:q,activePreviewFile:c,authModalKind:g,browseContext:w,onFileChanged:v,webSignInTag:f,userPresentableVerdict:S,lowDistractionViewVariant:Q}),ie=i.useRootFile(),ne=x.useEditorActivationParams();if(D&&ie){const e=D.fullscreenLayer;return Ye.createElement("div",{className:l.editPluginFullscreenContainer},Ye.createElement(e,{file:ie,activationParams:ne}))}const ae=N===i.PreviewType.Video,re=O&&(P?te:Ye.createElement(Ft,{file:c.file,showAuthModal:d,commentIconWithUnreadCount:null==o?void 0:o.commentUI.CommentIconWithUnreadCount})),oe=null===(t=null==R?void 0:R.editUI)||void 0===t?void 0:t.Sidebar,se=null===(n=null==R?void 0:R.editUI)||void 0===n?void 0:n.LeftSidebar;let de,ce;const ue=!(p||A||T||R||k),_e=A||k,me=oe?Ye.createElement($i,{Sidebar:oe}):void 0,pe=se?Ye.createElement($i,{Sidebar:se}):void 0;if(ue){const e=B&&(null==r?void 0:r[B]);de=B&&e&&Ye.createElement(St,{sidebarPluginId:B,sidebarPlugin:e});const t=z&&(null==r?void 0:r[z]);ce=z&&t&&Ye.createElement(St,{sidebarPluginId:z,sidebarPlugin:t})}return Ye.createElement(Ye.Fragment,null,Ye.createElement("div",{className:i.cx(l.titleBarWrapper,{[l.titleBarBorder]:!V,[l.isVideo]:ae,[l.isFullScreen]:A,[l.hidden]:I})},re,!p&&!T&&!V&&!P&&!(ae&&A)&&Ye.createElement(wi,{activePreviewFile:c,shareToken:m,user:u,previewSurface:_,toolbarExperiments:X,sharedLinkInfo:c.sharedLinkInfo})),Ye.createElement("div",{className:l.rendererRow},Ye.createElement("div",{style:_e?{display:"none"}:{}},pe),Ye.createElement(Xi,{leftSidebarContent:de,rightSidebarContent:ce,defaultUi:e.defaultUi},Ye.createElement("div",{className:l.centerSection},ue&&y&&!H&&!p&&Ye.createElement(yi,{handleSUSIClick:y,sharedLinkInfo:c.sharedLinkInfo,isFile:!0,onClose:K,isSharedFile:i.isSharedFile(c.file),user:u}),Ye.createElement(Gi,{...s,textHighlighters:E,commentPlugin:o,editors:a}))),Ye.createElement("div",{style:_e?{display:"none"}:{}},me)),Ye.createElement("div",{className:l.footerRow,style:A?{display:"none"}:{}},P?J:null))};Ji.displayName="MetaserverFileViewerLayout";function en(e,t,n){return{rename:async({newFilename:a,onRename:r,onRenameSuccess:o,onRenameFailed:s})=>{const{file:l}=t();if(!i.isBrowseFile(l))return;r();const d=i.isRenameValid(a,i.getExtension$1(l));let c;if(d&&(me.renameSnackBarInProgress(i.PREVIEWS_SNACKBAR_ID),c=await pe.renameFile(l.fq_path,a,e,{checkFSWs:!0})),!c||c.isError||"success"!==c.result.entries[0][".tag"])return s(),void me.renameFailedSnackBar(d?(null==c?void 0:c.isError)?c:pe.createUndefinedRpcResult():{...pe.createUndefinedRpcResult(),error:{".tag":"to",to:{".tag":"malformed_path",malformed_path:{}}}},l.fq_path,i.PREVIEWS_SNACKBAR_ID);const u=c.result.entries[0].success;n&&u&&"file"===u[".tag"]&&n(l,{fq_path:u.path_display||l.fq_path,revision_id:u.rev,file_id:u.id}),o(),me.renameCompleteSnackBar(i.PREVIEWS_SNACKBAR_ID)},delete:({onDelete:a,onDeleteSuccess:o,onDeleteFailed:s,onDeleteFailedNoPermission:l,onDeleteCancel:d,setDeleteFileModalOpen:c})=>{const{file:u}=t();if(!i.isBrowseFile(u)||P.isPnmLinkNodeSelected(u)||!P.isLiveFile(u))return;if(a(),u.read_only)return i.Snackbar.warn(r.intl.formatMessage({id:"szm+5q",defaultMessage:"You don't have permission to make changes to this file"}),i.PREVIEWS_SNACKBAR_ID),void l();const _={file_id:u.file_id,is_dir:u.is_dir};ue.portableDelete({user:e,filesPath:[_],fq_path:u.fq_path},{onNetworkRequest:()=>_e.deleteSnackBarInProgress(i.PREVIEWS_SNACKBAR_ID),onSuccess:()=>{_e.deleteCompleteSnackBar(i.PREVIEWS_SNACKBAR_ID),n&&n(u),o()},onError:e=>{_e.deleteFailedSnackBar(e,i.PREVIEWS_SNACKBAR_ID),s()},onRequestClose:()=>{d()},setDeleteFileModalOpen:c})}}}function tn(e,t){i.defaultEmitter$2.select(i.ON_CLICK_SHARED_CONTENT_ACTION).emit({actionElement:e,action:t})}function nn(t,n,{allowCopyToDropbox:a,shareToken:r,encryptionOptions:o,sharePermission:s,authModalKind:l,webSignInTag:d,userPresentableVerdict:c}){return{copyToDropbox:!a||s&&!i.isDownloadAllowed(s)?()=>{}:async({logModalConfirm:i,logModalCancel:a})=>{const{file:s}=n(),{saveToDropbox:l}=await new Promise((function(t,i){e(["./c_file_viewer_common_download_utils"],t,i)})).then((function(e){return e.download_utils_esnext}));tn("previews_dropdown","copy_to_dropbox"),l(s,(e=>{"save_to_dropbox_approve"===e?i():"save_to_dropbox_cancel"===e&&a()}),t,r,o,void 0,void 0,d)},downloadFile:async()=>{const{file:i}=n(),{downloadActiveFile:a}=await new Promise((function(t,i){e(["./c_file_viewer_common_download_utils"],t,i)})).then((function(e){return e.download_utils_esnext}));tn("previews_dropdown","download"),a({file:i,user:t,encryptionOptions:o,authModalKind:l,shareToken:r,webSignInTag:d,userPresentableVerdict:c})}}}let an;function rn(){(function(){const e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement})()||(null==an||an(),ln())}function on(){null==an||an(),cn()}function sn(){var e;e=rn,document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e),function(e){window.addEventListener("popstate",e)}(on)}function ln(){var e;e=rn,document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e),function(e){window.removeEventListener("popstate",e)}(on),an=()=>{}}function dn({onExitFunction:e}){!function(e){an=e}(e),function(){const e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}(),sn()}function cn(){ln(),function(){const e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()}()}function un(){return{enterFullScreen:(e,t)=>{t||dn({onExitFunction:e})},exitFullScreen:e=>{e||cn()}}}function _n(e,t,i,n,a){return{closeViewer:e?()=>{e()}:void 0,flipToNextFile:t,showAuthModal:n,flipToPreviousFile:i,openUrl:a}}function mn(e,t,i,n,a){return{closeViewer:e?()=>{e()}:void 0,flipToNextFile:t,flipToPreviousFile:i,updateFiles:n?()=>n():void 0,openUrl:a}}function pn(e,t,i,n){return{closeViewer:e?()=>{e()}:void 0,flipToNextFile:t,flipToPreviousFile:i,openUrl:n}}function fn(e,t,i,n){return{closeViewer:e?()=>{e()}:void 0,flipToNextFile:t,flipToPreviousFile:i,openUrl:n}}function gn(e){return{openUrl:e}}const vn=(t,n,a)=>{const r=n(),o=i.UserActionContext.PreviewError;return{renderMenuContent:t&&(async()=>{if(!t)return;const{RenderOpenInMenuContent:i}=await new Promise((function(t,i){e(["./c_file_viewer_common_open_in_dropdown_content"],t,i)}));return i(t,r,o,a)})}},hn="file_viewer_left_sidebar_preference",wn="file_viewer_right_sidebar_preference",yn="file_viewer_doc_sidebar_collapsed_preference",En="file_viewer_video_volume_preference",Sn="file_viewer_video_muted_preference",bn="file_viewer_ui_hidden_preference",Cn="file_viewer_ui_links_warning";function In(e,t){return t?function(e,t){return{docSidebar:{setCollapsedState:({isCollapsed:t})=>{!function(e,t){try{i.UserLocalStorage.set(e,yn,t)}catch(e){}}(e.id,t)},getCollapsedState:()=>function(e){var t;try{return null===(t=i.UserLocalStorage.get(e,yn))||void 0===t||t}catch(e){return!0}}(e.id)},video:{getVolumeState:()=>function(e){var t;try{return parseFloat(null!==(t=i.UserLocalStorage.get(e,En))&&void 0!==t?t:1)}catch(e){return 1}}(e.id),setVolumeState:t=>function(e,t){try{i.UserLocalStorage.set(e,En,t)}catch(e){}}(e.id,t),getMutedState:()=>function(e){var t;try{return null!==(t=i.UserLocalStorage.get(e,Sn))&&void 0!==t&&t}catch(e){return!1}}(e.id),setMuteState:t=>function(e,t){try{i.UserLocalStorage.set(e,Sn,t)}catch(e){}}(e.id,t)},sidebar:{setLeftSidebarState:t=>function(e,t){try{i.UserLocalStorage.set(e,hn,t)}catch(e){}}(e.id,t),setRightSidebarState:t=>function(e,t){try{i.UserLocalStorage.set(e,wn,t)}catch(e){}}(e.id,t),getSidebarState:()=>function(e){var t,n;try{const a=null!==(t=i.UserLocalStorage.get(e,hn))&&void 0!==t?t:void 0,r=null!==(n=i.UserLocalStorage.get(e,wn))&&void 0!==n?n:void 0;if(!a&&!r)return;return{left:a,right:r}}catch(e){return}}(e.id)},ui:{setHiddenState:({isHidden:t})=>{!function(e,t){try{i.UserLocalStorage.set(e,bn,t)}catch(e){}}(e.id,t)},getHiddenState:()=>function(e){var t;try{return null!==(t=i.UserLocalStorage.get(e,bn))&&void 0!==t&&t}catch(e){return!1}}(e.id)},link:{setWarningHiddenState:({isHidden:n})=>{!function(e,t,n){try{i.UserLocalStorage.set(e,Cn+t,n)}catch(e){}}(e.id,t,n)},getWarningHiddenState:()=>function(e,t){var n;try{return null!==(n=i.UserLocalStorage.get(e,Cn+t))&&void 0!==n&&n}catch(e){return!1}}(e.id,t)}}}(t,e):{docSidebar:{setCollapsedState:({})=>{},getCollapsedState:()=>!0}}}function Tn(){return{print:(e,t)=>{var n;t===i.PreviewType.SsrDoc?(n=e,fe.safe_open_tab_and_redirect(n)):t===i.PreviewType.Image&&function(e){const t=window.open("about:blank");if(!t)throw new Error(r.intl.formatMessage({id:"X9xK6f",defaultMessage:"Could not open new window"}));window.setTimeout((()=>{const i=t.document.createElement("style");i.innerHTML="\n      @page { margin: 0;}\n      img { max-width: 100%; max-height: 100%}\n    ",t.document.head.appendChild(i);const n=t.document.createElement("img");n.src=e,n.onload=()=>{t.print()},n.onerror=()=>{t.close()},t.document.body.appendChild(n)}),50)}(e)}}}function xn(e){return!(e&&e.canPrintRoles&&0===e.canPrintRoles.length)}const An=e=>({logStormcrowExposure:(t,n)=>i.logStormcrowExposure(t,n,null==e?void 0:e.id)});function Mn(e){return{getQueryStringParameter(e){const t=i.get_uri().getQuery();return e in t?t[e]:null},getAllQueryStringParameters:()=>i.DBHistory.get_uri().getQuery(),setQueryStringParameter(e,t){const n=i.DBHistory.get_uri();null!==t?n.updateQuery(e,t):n.removeQuery(e),i.DBHistory.push_state(n.getPath(),n.getQuery())},onQueryStringParameterChange(e,t){const n=`/${i.get_uri().getPath().split("/")[1]}`,a=(i,n)=>{let a=null;if(e in n){const t=n[e];a=t instanceof Array?t.length?t[0]:null:null!=t?t:null}t(e,a)};return i.DBHistory.add_callback(n,a,!0),()=>i.DBHistory.remove_callback(n,a)},openFile(t,n){if(n){const n=i.preview_uri_for_fq_path(e,t);i.replace_location(n)}else{const n=i.get_browse_root(i.DeprecatedViewer.get_viewer(),e)+w.URI.encode_parts(t);i.replace_location(n)}},redirect(e,t){t?fe.safe_open_tab_and_redirect(e):fe.redirect(e)},reload(){i.reload()},replaceState(e){const t=i.DBHistory.get_uri();i.DBHistory.replace_state(t.getPath(),e)}}}i.injectInternalStyle("/static/metaserver/static/js/file_viewer/modals/shared_folder_modal/shared_folder_modal.module.out-vflx-E3Hn.css",(e=>"._shared-folder-modal-facepile-container_ppprr_1{display:flex;justify-content:center;margin-bottom:var(--dig-spacing__micro__xlarge);margin-top:var(--dig-spacing__micro__large);width:100%}._shared-folder-modal-avatar_ppprr_9 div{font-size:28px;height:80px;width:80px}"));const kn=r.defineMessage({id:"pWXkpn",defaultMessage:"Working on a project with {senderGivenName}?"}),Nn=r.defineMessage({id:"zV0/JW",defaultMessage:"Create a shared folder that you both can upload to and edit."}),Pn=r.defineMessage({id:"9/kJZU",defaultMessage:"Create folder"}),Ln=r.defineMessage({id:"NVkpY9",defaultMessage:"Skip"}),Rn=({senderGivenName:e,onConfirm:t,onDismiss:n,senderPhotoUrl:a,senderInitials:o,receiverPhotoUrl:s,receiverInitials:l,modalUxaLog:d,confirmUxaLog:c,dismissUxaLog:u})=>{const _=Ye.default.createElement(i.ThemeProvider,{mode:"bright"},Ye.default.createElement(i.ThemeContainer,null,Ye.default.createElement(i.Box,{className:"_shared-folder-modal-facepile-container_ppprr_1"},Ye.default.createElement(i.Facepile,{size:"large"},Ye.default.createElement(i.Facepile.Item,{src:a},o),Ye.default.createElement(i.Facepile.Item,{src:s},l)))));return Ye.default.createElement(ge.MiniModal,{titleText:r.intl.formatMessage(kn,{senderGivenName:e}),bodyText:r.intl.formatMessage(Nn),confirmText:r.intl.formatMessage(Pn),dismissText:r.intl.formatMessage(Ln),onConfirm:t,onDismiss:n,headerContents:_,shouldShowImage:!1,modalUxaLog:d,confirmUxaLog:c,dismissUxaLog:u})};Rn.displayName="SharedFolderMiniModal";const Dn=({senderName:e,senderPhotoUrl:t,receiver:n,showFolderCreationModal:a})=>{const r=i.Modal$1.close,o=i.getInitials(e),s=i.getInitials(n.display_name),l=n.photo_url;let d;if(i.isCjkLocale()){const t=e.trim().split(" ");d=t[t.length-1]}else d=e.trim().split(" ")[0];const c={senderGivenName:d,onConfirm:a,onDismiss:r,senderInitials:o,receiverInitials:s,senderPhotoUrl:t,receiverPhotoUrl:l};return Ye.default.createElement(Rn,{modalUxaLog:"create_shared_folder_dialog",dismissUxaLog:"create_shared_folder_dialog_dismiss",confirmUxaLog:"create_shared_folder_dialog_start",...c})};Dn.displayName="SharedFolderModal";function Fn(e){var t,n,a;const r=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"/log/video_preview",o=null!==(n=null==e?void 0:e.routeParams)&&void 0!==n?n:{},s=null!==(a=null==e?void 0:e.base)&&void 0!==a?a:window.location.origin;return new i.AjaxURL(i.replacePattern(r,o),s)}const On=(e,t)=>({event_name:e,client_timestamp_ms:i.WebTimingUtil.getNow(),file_preview_session_id:t.file_preview_session_id,video_format:t.video_format,video_duration_seconds:t.video_duration_seconds,video_truncated:t.video_truncated,ns_id:t.ns_id,sj_id:t.sj_id,file_id:t.file_id,extra:JSON.stringify({...t.extra})}),Un=e=>{ve.asyncBeaconRequest({url:Fn(),data:e})},Vn=e=>({file_preview_session_id:e.file_preview_session_id,file_viewer_session_id:e.file_viewer_session_id,device_type:e.device_type,extra:{...e.extra,video_format:`${e.video_format}`,video_duration_seconds:`${e.video_duration_seconds}`,video_truncated:`${e.video_truncated}`,source_context:e.source_context,preview_type:e.preview_type}}),Bn=(e,t,i)=>{const n=On(e,i);Un(n);const a=Vn(i);ve.logQuantityToAMISAndUDCL(e,t,"web_audiovideo_previews",a,void 0,n)},zn=(e,t,i)=>{const n=On(e,i);Un(n);const a=Vn(i);ve.logDurationToAMISAndUDCL(e,t,"web_audiovideo_previews",a,void 0,n)},Hn=()=>{const{previewTour:e}=i.useFileViewerSubRegionContext();return Ye.default.useMemo((()=>{return e?(t=e,e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(t,{...e}))):we.PreviewTourWrapper;var t}),[e])},Wn=[".maestro-chrome","#maestro-nav","#page-footer","#page-content","#page-header","#page-sidebar","#flash-upload-container","#maestro-header","#maestro-header-portal","#maestro-prompt",".snackbar-container","#onboarding-sidebar-pagelet",".maestro-portal"].join(),Kn="data-preview-old-display";function Gn(){Array.from(document.querySelectorAll(Wn)).forEach((e=>{e.style.display=e.hasAttribute(Kn)?e.getAttribute(Kn):""}))}class jn{constructor(){this.client=null}subscribe(e,t,n){const a=new i.SignedChannelState(e.app_id,e.unique_id,e.revision,e.token);this.client?this.client.update_states([a]):(this.client=new i.MetaserverBoltClient([a],t,n),this.client.start())}unsubscribe(){this.client&&(this.client.unsubscribe(),this.client=null)}}function qn(e){return{id:e.dbx_account_id,email:e.email,name:{display:e.name,initials:i.getInitials(e.name),public:i.getShortName(e.name)},photoUrl:e.photo_url||e.avatar_url}}class Qn{constructor(e,t=!1,i){this.cache={},this.filterContact=e=>{const t=!!e.group_id,i=!this.allowMentionSelf&&e.email===this.user.email;return!(t||i)},this.updateCache=(e,t,i)=>{let n;const a=t.map(qn);if(i){n=[...this.cache[e]||[],...a]}else n=a;return this.cache={...this.cache,[e]:n},this.cache},this.user=e,this.allowMentionSelf=t,this.searchConfig=i,this.dataSource=new Ee.ContactsDataSourceV2(this.user,i,this.filterContact)}query(e,t,i){this.dataSource.search(e,(i=>{t(this.updateCache(e,i,!1))}),(n=>{(i||t)(this.updateCache(e,n,!0))}))}getMatchesWithStarterSuggestions(){const e=Ee.BloodhoundContactsV2.getAll(this.user,this.searchConfig).filter(this.filterContact).map(qn),t=Se.sortBy(e.slice(0,50),(e=>e.name||e.email));return this.cache={...this.cache,"":t},this.cache}}const Yn="reactions";function $n(e,t){let i;if(e&&t){let n=null;const a=()=>{const i=function(e,t,i){return t?new Qn(t,i,e):{cache:{},query:()=>{},getMatchesWithStarterSuggestions:()=>({})}}(t,e);return{search(e,t){0!==e.length?i.query(e,t):t(i.getMatchesWithStarterSuggestions())}}};i=()=>(n||(n=a()),n)}return{boltIOClient:(e=>{let t=e=>{};return{subscribe:i=>(i.forEach((i=>{e.subscribe(function({channelId:e,revisionInfo:t}){return{app_id:e.appId,unique_id:e.uniqueId,revision:t.revision.toString(),token:t.token}}(i),t,t)})),Promise.resolve()),unsubscribe:()=>Promise.resolve(e.unsubscribe()),onSignal:e=>{t=t=>{const i=t.map((e=>{return{channelId:{appId:(t=e).app_id,uniqueId:t.unique_id},revisionInfo:{revision:parseInt(null!==(i=t.revision)&&void 0!==i?i:"",10),token:t.token}};var t,i}));e({updatedChannels:i})}}}})(new jn),reactionsBoltIOClient:(n=new jn,{subscribe:(e,t,i)=>{const a=e=>{e.filter((e=>e.app_id===Yn)).length>0&&t()},r=e=>{e.filter((e=>e.app_id===Yn)).length>0&&(n.unsubscribe(),i())};e.forEach((e=>{const{app_id:t,revision:i,token:o,unique_id:s}=e,l={app_id:t,revision:i,token:o,unique_id:s};n.subscribe(l,a,r)}))},unsubscribe:()=>n.unsubscribe()}),mentionsIOClient:i};var n}function Xn(e){return{class:"previews",action:"comment",object:"file",properties:e}}function Zn(e){return{class:"previews",action:"comment",object:"file_add_name",properties:e}}function Jn(e){return{class:"previews",action:"comment",object:"file_area",properties:e}}function ea(e){return{class:"previews",action:"comment",object:"comment",properties:e}}function ta(e){return{class:"previews",action:"comment",object:"file_timestamp",properties:e}}function ia(e){return{class:"previews",action:"select",object:"comments_sticker_pane",properties:e}}function na(e){return{class:"previews",action:"select",object:"comments_mentions_pane",properties:e}}const aa=["newest","oldest","unread","timestamp","page"];function ra(e){return{class:"previews",action:"select",object:"comment_action",properties:e}}function oa(e){return{class:"previews",action:"add",object:"comment_reaction",properties:e}}function sa(e){return{class:"previews",action:"remove",object:"comment_reaction",properties:e}}var la;t.SortType=void 0,(la=t.SortType||(t.SortType={})).newest="newest",la.oldest="oldest",la.unread="unread",la.timestamp="timestamp",la.page="page";const da=[t.SortType.newest,t.SortType.oldest,t.SortType.unread,t.SortType.page,t.SortType.timestamp],ca=[t.SortType.newest,t.SortType.oldest,t.SortType.unread],ua=[...ca,t.SortType.timestamp],_a=[...ca,t.SortType.page];var ma;t.CommentsEventName=void 0,(ma=t.CommentsEventName||(t.CommentsEventName={})).ADD_COMMENT="add_comment",ma.POST_COMMENT="post_comment",ma.DELETE_COMMENT="delete_comment",ma.REPLY_COMMENT="reply_comment",ma.START_EDIT_COMMENT="start_edit_comment",ma.EDIT_COMMENT="edit_comment",ma.RESOLVE_COMMENT="resolve_comment",ma.UNRESOLVE_COMMENT="unresolve_comment",ma.SUBSCRIBE_COMMENTS="subscribe_comments",ma.UNSUBSCRIBE_COMMENTS="unsubscribe_comments",ma.DISABLE_COMMENTS="disable_comments",ma.ENABLE_COMMENTS="enable_comments",ma.SHOW_RESOLVED_COMMENTS="show_resolved_comments",ma.HIDE_RESOLVED_COMMENTS="hide_resolved_comments",ma.SORT_COMMENTS="sort_comments",ma.ENABLE_CONTINUOUS_ANNOTATIONS="enable_continuous_annotations",ma.DISABLE_CONTINUOUS_ANNOTATIONS="disable_continuous_annotations",ma.ENABLE_CONTINUOUS_COMMENTING="enable_continuous_commenting",ma.DISABLE_CONTINUOUS_COMMENTING="disable_continuous_commenting",ma.ADD_COMMENT_START="add_comment_start",ma.ADD_COMMENT_CANCEL="add_comment_cancel",ma.REPLY_COMMENT_START="reply_comment_start",ma.REPLY_COMMENT_CANCEL="reply_comment_cancel",ma.MARK_THREAD_READ="mark_thread_read",ma.MARK_THREAD_UNREAD="mark_thread_unread",ma.COMMENT_ON_A_SECTION="comment_on_a_section",ma.START_ANNOTATION_TIMESTAMP="start_annotation_timestamp",ma.START_ANNOTATION_HIGHLIGHT="start_annotation_highlight",ma.STICKER_START="sticker_start",ma.ADD_EMOJI="add_emoji",ma.STICKER_SUCCESS="sticker_success",ma.STICKER_CANCELED="sticker_canceled",ma.TAG_SOMEONE="tag_someone",ma.MENTION_START="mention_start",ma.MENTION_SUCCESS="mention_success",ma.MENTION_CANCELED="mention_canceled",ma.SAVE_EDIT_COMMENT="save_edit_comment",ma.CANCEL_COMMENT="cancel_comment",ma.VIEW_COMMENTS="view_comments",ma.ADD_COMMENT_REACTION_START="add_comment_reaction_start",ma.ADD_COMMENT_REACTION="add_comment_reaction",ma.ADD_COMMENT_REACTION_SUCCESS="add_comment_reaction_success",ma.REMOVE_COMMENT_REACTION="remove_comment_reaction",ma.REMOVE_COMMENT_REACTION_SUCCESS="remove_comment_reaction_success",ma.SELECT_COMMENT_MARK="select_comment_mark",ma.ADD_NAME_START="add_name_start",ma.ADD_NAME_CANCEL="add_name_cancel",ma.ADD_NAME="add_name";const pa="preview",fa="file",ga=e=>{(e=>{const{event:n,extra:a}=e,r=(null==a?void 0:a.fileName)?i.getExtension$1({filename:a.fileName}):void 0,o=r?i.getFileTypeFromString(r):void 0,s=he.getPapPreviewType(null==a?void 0:a.previewType),l="true"===(null==a?void 0:a.addedFromExistingReaction);switch(n){case t.CommentsEventName.SELECT_COMMENT_MARK:i.UDCL.logEvent(ra({actionSurface:"previews",actionElement:"preview_sidebar",commentAction:"select_comment_mark",commentsAnnotationType:a?a.commentsAnnotationType:void 0}));break;case t.CommentsEventName.ADD_COMMENT_START:"true"===(null==a?void 0:a.hasDraftAnnotation)?i.UDCL.logEvent(Jn({actionSurface:pa,eventState:"start",commentsAnnotationType:a.commentsAnnotationType,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0})):"true"===(null==a?void 0:a.isTimestampAnnotation)?i.UDCL.logEvent(ta({actionSurface:pa,eventState:"start",isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0})):i.UDCL.logEvent(Xn({actionSurface:pa,eventState:"start",isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0}));break;case t.CommentsEventName.ADD_COMMENT_CANCEL:"true"===(null==a?void 0:a.hasDraftAnnotation)?i.UDCL.logEvent(Jn({actionSurface:pa,eventState:"canceled",commentsAnnotationType:a.commentsAnnotationType,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0})):"true"===(null==a?void 0:a.isTimestampAnnotation)?i.UDCL.logEvent(ta({actionSurface:pa,eventState:"canceled",isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0})):i.UDCL.logEvent(Xn({actionSurface:pa,eventState:"canceled",isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0}));break;case t.CommentsEventName.ADD_COMMENT:"true"===(null==a?void 0:a.hasDraftAnnotation)?i.UDCL.logEvent(Jn({actionSurface:pa,eventState:"success",hasSticker:"true"===(null==a?void 0:a.isSticker),hasTag:"true"===(null==a?void 0:a.hasMention),commentsAnnotationType:a.commentsAnnotationType,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0})):"true"===(null==a?void 0:a.isTimestampAnnotation)?i.UDCL.logEvent(ta({actionSurface:pa,eventState:"success",hasSticker:"true"===a.isSticker,hasTag:"true"===a.hasMention,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0})):(i.UDCL.logEvent(Xn({actionSurface:pa,eventState:"success",hasSticker:"true"===(null==a?void 0:a.isSticker),hasTag:"true"===(null==a?void 0:a.hasMention),isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.POST_COMMENT,actionElement:"preview_sidebar"})));break;case t.CommentsEventName.REPLY_COMMENT_START:i.UDCL.logStart(ea({actionSurface:pa,eventState:"start",hasSticker:"true"===(null==a?void 0:a.isSticker),hasTag:"true"===(null==a?void 0:a.hasMention),isCollabEvent:!0}));break;case t.CommentsEventName.REPLY_COMMENT_CANCEL:i.UDCL.logEnd(ea({actionSurface:pa,eventState:"canceled",isCollabEvent:!0}));break;case t.CommentsEventName.REPLY_COMMENT:i.UDCL.logEnd(ea({actionSurface:pa,eventState:"success",isCollabEvent:!0})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.REPLY_COMMENT,actionElement:"preview_sidebar",isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0}));break;case t.CommentsEventName.DELETE_COMMENT:i.UDCL.logEvent({class:"previews",action:"delete",object:"comment",properties:{actionSurface:pa,eventState:"success"}}),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.DELETE_COMMENT,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.EDIT_COMMENT:i.UDCL.logEvent({class:"previews",action:"edit",object:"comment",properties:{actionSurface:pa,eventState:"success"}}),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.SAVE_EDIT_COMMENT,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.START_EDIT_COMMENT:i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.EDIT_COMMENT,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.RESOLVE_COMMENT:i.UDCL.logEvent(function(e){return{class:"previews",action:"resolve",object:"comment",properties:e}}({actionSurface:pa,eventState:"success"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.RESOLVE_COMMENT,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.ENABLE_COMMENTS:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_enable",properties:e}}({actionSurface:pa,eventState:"success"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.ENABLE_COMMENTS,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.DISABLE_COMMENTS:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_disable",properties:e}}({actionSurface:pa,eventState:"success"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.DISABLE_COMMENTS,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.ENABLE_CONTINUOUS_COMMENTING:i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.ENABLE_CONTINUOUS_COMMENTING,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.DISABLE_CONTINUOUS_COMMENTING:i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.DISABLE_CONTINUOUS_COMMENTING,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.SHOW_RESOLVED_COMMENTS:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_show_resolved",properties:e}}({actionSurface:pa,eventState:"success"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.SHOW_RESOLVED_COMMENTS,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.HIDE_RESOLVED_COMMENTS:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_hide_resolved",properties:e}}({actionSurface:pa,eventState:"success"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.SHOW_RESOLVED_COMMENTS,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.SUBSCRIBE_COMMENTS:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_subscribe",properties:e}}({actionSurface:pa,eventState:"success"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.SUBSCRIBE_COMMENTS,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.UNSUBSCRIBE_COMMENTS:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_unsubscribe",properties:e}}({actionSurface:pa,eventState:"success"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.UNSUBSCRIBE_COMMENTS,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.SORT_COMMENTS:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_sort",properties:e}}({actionSurface:pa,commentsSortOrder:(null==a?void 0:a.sortType)?(d=a.sortType,aa.find((e=>e===(null==d?void 0:d.toLowerCase())))):void 0}));break;case t.CommentsEventName.MARK_THREAD_READ:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_mark_as_read",properties:e}}({actionSurface:pa}));break;case t.CommentsEventName.MARK_THREAD_UNREAD:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_mark_as_unread",properties:e}}({actionSurface:pa}));break;case t.CommentsEventName.START_ANNOTATION_TIMESTAMP:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_annotation_timestamp",properties:e}}({actionSurface:pa}));break;case t.CommentsEventName.START_ANNOTATION_HIGHLIGHT:i.UDCL.logEvent(function(e){return{class:"previews",action:"select",object:"comments_annotation_highlight",properties:e}}({actionSurface:pa}));break;case t.CommentsEventName.STICKER_START:i.UDCL.logStart(ia({actionSurface:pa,eventState:"start"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.ADD_EMOJI,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.ADD_EMOJI:i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.ADD_EMOJI,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.STICKER_SUCCESS:i.UDCL.logEnd(ia({actionSurface:pa,eventState:"success"}));break;case t.CommentsEventName.STICKER_CANCELED:i.UDCL.logEnd(ia({actionSurface:pa,eventState:"canceled"}));break;case t.CommentsEventName.MENTION_START:i.UDCL.logStart(na({actionSurface:pa,eventState:"start"})),i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.TAG_SOMEONE,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.TAG_SOMEONE:i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.TAG_SOMEONE,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.MENTION_SUCCESS:i.UDCL.logEnd(na({actionSurface:pa,eventState:"success"}));break;case t.CommentsEventName.MENTION_CANCELED:i.UDCL.logEnd(na({actionSurface:pa,eventState:"canceled"}));break;case t.CommentsEventName.CANCEL_COMMENT:i.UDCL.logEvent(ra({actionSurface:"previews",commentAction:t.CommentsEventName.CANCEL_COMMENT,actionElement:"preview_sidebar"}));break;case t.CommentsEventName.VIEW_COMMENTS:i.UDCL.logEvent(function(e){return{class:"previews",action:"view",object:"comments",properties:e}}({fileType:o,previewType:s,existingReactions:"true"===(null==a?void 0:a.existingReactions),commentId:null==a?void 0:a.commentId}));break;case t.CommentsEventName.ADD_COMMENT_REACTION_START:i.UDCL.logEvent(oa({commentStreamType:fa,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0,eventState:"start"}));break;case t.CommentsEventName.ADD_COMMENT_REACTION:i.UDCL.logEvent(oa({commentStreamType:fa,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0,addedFromExistingReaction:l}));break;case t.CommentsEventName.ADD_COMMENT_REACTION_SUCCESS:i.UDCL.logEvent(oa({commentStreamType:fa,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0,eventState:"success",addedFromExistingReaction:l}));break;case t.CommentsEventName.REMOVE_COMMENT_REACTION:i.UDCL.logEvent(sa({commentStreamType:fa,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0}));break;case t.CommentsEventName.REMOVE_COMMENT_REACTION_SUCCESS:i.UDCL.logEvent(sa({commentStreamType:fa,isSharedLink:"true"===(null==a?void 0:a.isSharedLink),fileExtension:r,fileType:o,fileObjId:null==a?void 0:a.fileId,previewType:s,isCollabEvent:!0,eventState:"success"}));break;case t.CommentsEventName.ADD_NAME_START:i.UDCL.logEvent(Zn({actionSurface:pa,eventState:"start"}));break;case t.CommentsEventName.ADD_NAME_CANCEL:i.UDCL.logEvent(Zn({actionSurface:pa,eventState:"canceled"}));break;case t.CommentsEventName.ADD_NAME:i.UDCL.logEvent(Zn({actionSurface:pa,eventState:"success"}))}var d})(e),(e=>{const{event:n}=e;n!==t.CommentsEventName.ADD_COMMENT&&n!==t.CommentsEventName.REPLY_COMMENT||i.UserSurvey.trackEvent("comment_created","previews")})(e)};function va(e){return(t,i,n)=>({type:e,payload:t,meta:i,error:n})}function ha(e){return function(t){return({dispatch:i})=>n=>async a=>{let r,o=n(a);const s=e[a.type];if(s){try{r=s.action({arg:a.payload.arg,result:await t.rpc(s.endpoint,a.payload.arg,a.payload.params||{})},a.meta)}catch(e){r=s.action({arg:a.payload.arg,params:a.payload.params},a.meta,e)}return i(r)}return o}}}const wa="@@apiv2_redux/comments2/add_comment",ya="@@apiv2_redux/comments2/add_comment_result",Ea="@@apiv2_redux/comments2/check_onboarding_status",Sa="@@apiv2_redux/comments2/check_onboarding_status_result",ba="@@apiv2_redux/comments2/delete_comment",Ca="@@apiv2_redux/comments2/delete_comment_result",Ia="@@apiv2_redux/comments2/disable_commenting",Ta="@@apiv2_redux/comments2/disable_commenting_result",xa="@@apiv2_redux/comments2/edit_comment",Aa="@@apiv2_redux/comments2/edit_comment_result",Ma="@@apiv2_redux/comments2/enable_commenting",ka="@@apiv2_redux/comments2/enable_commenting_result",Na="@@apiv2_redux/comments2/get_folder_live_updating_info",Pa="@@apiv2_redux/comments2/get_folder_live_updating_info_result",La="@@apiv2_redux/comments2/list_comments",Ra="@@apiv2_redux/comments2/list_comments_result",Da="@@apiv2_redux/comments2/list_comments_batch",Fa="@@apiv2_redux/comments2/list_comments_batch_result",Oa="@@apiv2_redux/comments2/list_threads_batch_paginated",Ua="@@apiv2_redux/comments2/list_threads_batch_paginated_result",Va="@@apiv2_redux/comments2/list_threads_paginated",Ba="@@apiv2_redux/comments2/list_threads_paginated_result",za="@@apiv2_redux/comments2/log_event",Ha="@@apiv2_redux/comments2/log_event_result",Wa="@@apiv2_redux/comments2/log_perf_event",Ka="@@apiv2_redux/comments2/log_perf_event_result",Ga="@@apiv2_redux/comments2/logged_out/add_comment",ja="@@apiv2_redux/comments2/logged_out/add_comment_result",qa="@@apiv2_redux/comments2/logged_out/list_comments",Qa="@@apiv2_redux/comments2/logged_out/list_comments_result",Ya="@@apiv2_redux/comments2/logged_out/list_comments_batch",$a="@@apiv2_redux/comments2/logged_out/list_comments_batch_result",Xa="@@apiv2_redux/comments2/mark_has_onboarded",Za="@@apiv2_redux/comments2/mark_has_onboarded_result",Ja="@@apiv2_redux/comments2/mark_thread_read",er="@@apiv2_redux/comments2/mark_thread_read_result",tr="@@apiv2_redux/comments2/mark_thread_unread",ir="@@apiv2_redux/comments2/mark_thread_unread_result",nr="@@apiv2_redux/comments2/resolve_thread",ar="@@apiv2_redux/comments2/resolve_thread_result",rr="@@apiv2_redux/comments2/subscribe",or="@@apiv2_redux/comments2/subscribe_result",sr="@@apiv2_redux/comments2/unresolve_thread",lr="@@apiv2_redux/comments2/unresolve_thread_result",dr="@@apiv2_redux/comments2/unsubscribe",cr="@@apiv2_redux/comments2/unsubscribe_result",ur=va(wa),_r=va(ya),mr=va(Sa),pr=va(ba),fr=va(Ca),gr=va(Ia),vr=va(Ta),hr=va(xa),wr=va(Aa),yr=va(Ma),Er=va(ka),Sr=va(Pa),br=va(La),Cr=va(Ra),Ir=va(Fa),Tr=va(Ua),xr=va(Ba),Ar=va(za),Mr=va(Ha),kr=va(Ka),Nr=va(Ga),Pr=va(ja),Lr=va(qa),Rr=va(Qa),Dr=va($a),Fr=va(Za),Or=va(Ja),Ur=va(er),Vr=va(tr),Br=va(ir),zr=va(nr),Hr=va(ar),Wr=va(rr),Kr=va(or),Gr=va(sr),jr=va(lr),qr=va(dr),Qr=va(cr),Yr=ha({[wa]:{endpoint:"add_comment",action:_r},[Ea]:{endpoint:"check_onboarding_status",action:mr},[ba]:{endpoint:"delete_comment",action:fr},[Ia]:{endpoint:"disable_commenting",action:vr},[xa]:{endpoint:"edit_comment",action:wr},[Ma]:{endpoint:"enable_commenting",action:Er},[Na]:{endpoint:"get_folder_live_updating_info",action:Sr},[La]:{endpoint:"list_comments",action:Cr},[Da]:{endpoint:"list_comments_batch",action:Ir},[Oa]:{endpoint:"list_threads_batch_paginated",action:Tr},[Va]:{endpoint:"list_threads_paginated",action:xr},[za]:{endpoint:"log_event",action:Mr},[Wa]:{endpoint:"log_perf_event",action:kr},[Ga]:{endpoint:"logged_out/add_comment",action:Pr},[qa]:{endpoint:"logged_out/list_comments",action:Rr},[Ya]:{endpoint:"logged_out/list_comments_batch",action:Dr},[Xa]:{endpoint:"mark_has_onboarded",action:Fr},[Ja]:{endpoint:"mark_thread_read",action:Ur},[tr]:{endpoint:"mark_thread_unread",action:Br},[nr]:{endpoint:"resolve_thread",action:Hr},[rr]:{endpoint:"subscribe",action:Kr},[sr]:{endpoint:"unresolve_thread",action:jr},[dr]:{endpoint:"unsubscribe",action:Qr}});var $r;function Xr(e){return{type:$r.ActivateThread,payload:e}}function Zr(e){return{type:$r.DeactivateAllThreads,payload:e}}function Jr(e,t){return{type:$r.HoverThread,payload:{fileViewerId:e,threadId:t}}}function eo(e,t){return{type:$r.FocusThread,payload:{fileViewerId:e,threadId:t}}}function to(e,t){return{type:$r.ConfirmDraftAnnotation,payload:{fileViewerId:e,annotationType:t}}}function io(e){return{type:$r.CancelAnnotating,payload:{fileViewerId:e}}}function no(e){return{type:$r.ResolveNavigationToActiveThreadAnnotation,payload:{fileViewerId:e}}}!function(e){e.ActivateThread="@@comments/activateThread",e.DeactivateAllThreads="@@comments/deactivateThread",e.FocusThread="@@comments/focusThread",e.HoverThread="@@comments/hoverThread",e.BoltSubscribe="@@comments/bolt/subscribe",e.BoltUnsubscribe="@@comments/bolt/unsubscribe",e.UpdateDraftAnnotation="@@comments/updateDraftAnnotation",e.ClearDraftAnnotation="@@comments/clearDraftAnnotation",e.FocusEditor="@@comments/focusEditor",e.EditorDidFocus="@@comments/editorDidFocus",e.ResolveNavigationToActiveThreadAnnotation="@@comments/resolveNavigationToActiveThreadAnnotation",e.UpdateShowResolvedComments="@@comments/updateShowResolvedComments",e.UpdateAnnotationMode="@@comments/UpdateCurrentAnnotationMode",e.StartAnnotating="@@comments/startAnnotating",e.ConfirmDraftAnnotation="@@comments/confirmDraftAnnotation",e.CancelAnnotating="@@comments/cancelAnnotating",e.SortComments="@@comments/sortComments"}($r||($r={}));const ao="@@apiv2_redux/files/add_content_references",ro="@@apiv2_redux/files/add_content_references_result",oo="@@apiv2_redux/files/add_content_references_to_path",so="@@apiv2_redux/files/add_content_references_to_path_result",lo="@@apiv2_redux/files/alpha/get_metadata",co="@@apiv2_redux/files/alpha/get_metadata_result",uo="@@apiv2_redux/files/alpha/upload",_o="@@apiv2_redux/files/alpha/upload_result",mo="@@apiv2_redux/files/browse",po="@@apiv2_redux/files/browse_result",fo="@@apiv2_redux/files/browse_continue",go="@@apiv2_redux/files/browse_continue_result",vo="@@apiv2_redux/files/content_tiles_metadata_v2",ho="@@apiv2_redux/files/content_tiles_metadata_v2_result",wo="@@apiv2_redux/files/copy_v2",yo="@@apiv2_redux/files/copy_v2_result",Eo="@@apiv2_redux/files/copy",So="@@apiv2_redux/files/copy_result",bo="@@apiv2_redux/files/copy_batch_v2",Co="@@apiv2_redux/files/copy_batch_v2_result",Io="@@apiv2_redux/files/copy_batch",To="@@apiv2_redux/files/copy_batch_result",xo="@@apiv2_redux/files/copy_batch/check_v2",Ao="@@apiv2_redux/files/copy_batch/check_v2_result",Mo="@@apiv2_redux/files/copy_batch/check",ko="@@apiv2_redux/files/copy_batch/check_result",No="@@apiv2_redux/files/copy_batch_sync",Po="@@apiv2_redux/files/copy_batch_sync_result",Lo="@@apiv2_redux/files/copy_reference/get",Ro="@@apiv2_redux/files/copy_reference/get_result",Do="@@apiv2_redux/files/copy_reference/save",Fo="@@apiv2_redux/files/copy_reference/save_result",Oo="@@apiv2_redux/files/create_folder_v2",Uo="@@apiv2_redux/files/create_folder_v2_result",Vo="@@apiv2_redux/files/create_folder",Bo="@@apiv2_redux/files/create_folder_result",zo="@@apiv2_redux/files/create_folder_batch",Ho="@@apiv2_redux/files/create_folder_batch_result",Wo="@@apiv2_redux/files/create_folder_batch/check",Ko="@@apiv2_redux/files/create_folder_batch/check_result",Go="@@apiv2_redux/files/delete_v2",jo="@@apiv2_redux/files/delete_v2_result",qo="@@apiv2_redux/files/delete",Qo="@@apiv2_redux/files/delete_result",Yo="@@apiv2_redux/files/delete_batch",$o="@@apiv2_redux/files/delete_batch_result",Xo="@@apiv2_redux/files/delete_batch/check",Zo="@@apiv2_redux/files/delete_batch/check_result",Jo="@@apiv2_redux/files/delete_batch_with_changeset_sync",es="@@apiv2_redux/files/delete_batch_with_changeset_sync_result",ts="@@apiv2_redux/files/delete_with_changeset",is="@@apiv2_redux/files/delete_with_changeset_result",ns="@@apiv2_redux/files/download",as="@@apiv2_redux/files/download_result",rs="@@apiv2_redux/files/download_zip",os="@@apiv2_redux/files/download_zip_result",ss="@@apiv2_redux/files/export",ls="@@apiv2_redux/files/export_result",ds="@@apiv2_redux/files/get_browse_bolt_data",cs="@@apiv2_redux/files/get_browse_bolt_data_result",us="@@apiv2_redux/files/get_content_references_info",_s="@@apiv2_redux/files/get_content_references_info_result",ms="@@apiv2_redux/files/get_description_batch",ps="@@apiv2_redux/files/get_description_batch_result",fs="@@apiv2_redux/files/get_file_content_metadata",gs="@@apiv2_redux/files/get_file_content_metadata_result",vs="@@apiv2_redux/files/get_file_info",hs="@@apiv2_redux/files/get_file_info_result",ws="@@apiv2_redux/files/get_file_lock_batch",ys="@@apiv2_redux/files/get_file_lock_batch_result",Es="@@apiv2_redux/files/get_metadata",Ss="@@apiv2_redux/files/get_metadata_result",bs="@@apiv2_redux/files/get_metadata_batch",Cs="@@apiv2_redux/files/get_metadata_batch_result",Is="@@apiv2_redux/files/get_preview_v2",Ts="@@apiv2_redux/files/get_preview_v2_result",xs="@@apiv2_redux/files/get_preview_v3",As="@@apiv2_redux/files/get_preview_v3_result",Ms="@@apiv2_redux/files/get_preview",ks="@@apiv2_redux/files/get_preview_result",Ns="@@apiv2_redux/files/get_previewable_extensions",Ps="@@apiv2_redux/files/get_previewable_extensions_result",Ls="@@apiv2_redux/files/get_query_suggestions",Rs="@@apiv2_redux/files/get_query_suggestions_result",Ds="@@apiv2_redux/files/get_temporary_link",Fs="@@apiv2_redux/files/get_temporary_link_result",Os="@@apiv2_redux/files/get_temporary_upload_link",Us="@@apiv2_redux/files/get_temporary_upload_link_result",Vs="@@apiv2_redux/files/get_thumbnail",Bs="@@apiv2_redux/files/get_thumbnail_result",zs="@@apiv2_redux/files/get_thumbnail_v2",Hs="@@apiv2_redux/files/get_thumbnail_v2_result",Ws="@@apiv2_redux/files/get_thumbnail_batch",Ks="@@apiv2_redux/files/get_thumbnail_batch_result",Gs="@@apiv2_redux/files/get_thumbnail_batch_link",js="@@apiv2_redux/files/get_thumbnail_batch_link_result",qs="@@apiv2_redux/files/get_upload_info",Qs="@@apiv2_redux/files/get_upload_info_result",Ys="@@apiv2_redux/files/has_folder_access",$s="@@apiv2_redux/files/has_folder_access_result",Xs="@@apiv2_redux/files/list_folder",Zs="@@apiv2_redux/files/list_folder_result",Js="@@apiv2_redux/files/list_folder/continue",el="@@apiv2_redux/files/list_folder/continue_result",tl="@@apiv2_redux/files/list_folder/get_latest_cursor",il="@@apiv2_redux/files/list_folder/get_latest_cursor_result",nl="@@apiv2_redux/files/list_folder/get_mount_info",al="@@apiv2_redux/files/list_folder/get_mount_info_result",rl="@@apiv2_redux/files/list_revisions",ol="@@apiv2_redux/files/list_revisions_result",sl="@@apiv2_redux/files/list_subfolders",ll="@@apiv2_redux/files/list_subfolders_result",dl="@@apiv2_redux/files/lock_file_batch",cl="@@apiv2_redux/files/lock_file_batch_result",ul="@@apiv2_redux/files/media_transcode",_l="@@apiv2_redux/files/media_transcode_result",ml="@@apiv2_redux/files/move_v2",pl="@@apiv2_redux/files/move_v2_result",fl="@@apiv2_redux/files/move",gl="@@apiv2_redux/files/move_result",vl="@@apiv2_redux/files/move_batch_v2",hl="@@apiv2_redux/files/move_batch_v2_result",wl="@@apiv2_redux/files/move_batch",yl="@@apiv2_redux/files/move_batch_result",El="@@apiv2_redux/files/move_batch/check_v2",Sl="@@apiv2_redux/files/move_batch/check_v2_result",bl="@@apiv2_redux/files/move_batch/check",Cl="@@apiv2_redux/files/move_batch/check_result",Il="@@apiv2_redux/files/move_batch_sync",Tl="@@apiv2_redux/files/move_batch_sync_result",xl="@@apiv2_redux/files/paper/create",Al="@@apiv2_redux/files/paper/create_result",Ml="@@apiv2_redux/files/paper/update",kl="@@apiv2_redux/files/paper/update_result",Nl="@@apiv2_redux/files/permanently_delete",Pl="@@apiv2_redux/files/permanently_delete_result",Ll="@@apiv2_redux/files/properties/add",Rl="@@apiv2_redux/files/properties/add_result",Dl="@@apiv2_redux/files/properties/overwrite",Fl="@@apiv2_redux/files/properties/overwrite_result",Ol="@@apiv2_redux/files/properties/remove",Ul="@@apiv2_redux/files/properties/remove_result",Vl="@@apiv2_redux/files/properties/template/get",Bl="@@apiv2_redux/files/properties/template/get_result",zl="@@apiv2_redux/files/properties/template/list",Hl="@@apiv2_redux/files/properties/template/list_result",Wl="@@apiv2_redux/files/properties/update",Kl="@@apiv2_redux/files/properties/update_result",Gl="@@apiv2_redux/files/recents_v2",jl="@@apiv2_redux/files/recents_v2_result",ql="@@apiv2_redux/files/remove_content_references",Ql="@@apiv2_redux/files/remove_content_references_result",Yl="@@apiv2_redux/files/request_unlock_file_batch",$l="@@apiv2_redux/files/request_unlock_file_batch_result",Xl="@@apiv2_redux/files/restore",Zl="@@apiv2_redux/files/restore_result",Jl="@@apiv2_redux/files/restore_path_batch_sync",ed="@@apiv2_redux/files/restore_path_batch_sync_result",td="@@apiv2_redux/files/save_url",id="@@apiv2_redux/files/save_url_result",nd="@@apiv2_redux/files/save_url/check_job_status",ad="@@apiv2_redux/files/save_url/check_job_status_result",rd="@@apiv2_redux/files/search",od="@@apiv2_redux/files/search_result",sd="@@apiv2_redux/files/search_v2",ld="@@apiv2_redux/files/search_v2_result",dd="@@apiv2_redux/files/search/continue_v2",cd="@@apiv2_redux/files/search/continue_v2_result",ud="@@apiv2_redux/files/search_ex",_d="@@apiv2_redux/files/search_ex_result",md="@@apiv2_redux/files/set_description",pd="@@apiv2_redux/files/set_description_result",fd="@@apiv2_redux/files/set_user_sort_preference",gd="@@apiv2_redux/files/set_user_sort_preference_result",vd="@@apiv2_redux/files/starred_v2",hd="@@apiv2_redux/files/starred_v2_result",wd="@@apiv2_redux/files/tags/add",yd="@@apiv2_redux/files/tags/add_result",Ed="@@apiv2_redux/files/tags/get",Sd="@@apiv2_redux/files/tags/get_result",bd="@@apiv2_redux/files/tags/remove",Cd="@@apiv2_redux/files/tags/remove_result",Id="@@apiv2_redux/files/team_folder/copy",Td="@@apiv2_redux/files/team_folder/copy_result",xd="@@apiv2_redux/files/team_folder/copy/check",Ad="@@apiv2_redux/files/team_folder/copy/check_result",Md="@@apiv2_redux/files/team_folder/create",kd="@@apiv2_redux/files/team_folder/create_result",Nd="@@apiv2_redux/files/team_folder/create/check",Pd="@@apiv2_redux/files/team_folder/create/check_result",Ld="@@apiv2_redux/files/team_folder/delete",Rd="@@apiv2_redux/files/team_folder/delete_result",Dd="@@apiv2_redux/files/team_folder/move",Fd="@@apiv2_redux/files/team_folder/move_result",Od="@@apiv2_redux/files/team_folder/move/check",Ud="@@apiv2_redux/files/team_folder/move/check_result",Vd="@@apiv2_redux/files/team_folder/rename",Bd="@@apiv2_redux/files/team_folder/rename_result",zd="@@apiv2_redux/files/team_folder/restore",Hd="@@apiv2_redux/files/team_folder/restore_result",Wd="@@apiv2_redux/files/tree_view_folders",Kd="@@apiv2_redux/files/tree_view_folders_result",Gd="@@apiv2_redux/files/undo_batch",jd="@@apiv2_redux/files/undo_batch_result",qd="@@apiv2_redux/files/unlock_file_batch",Qd="@@apiv2_redux/files/unlock_file_batch_result",Yd="@@apiv2_redux/files/upload_v2",$d="@@apiv2_redux/files/upload_v2_result",Xd="@@apiv2_redux/files/upload",Zd="@@apiv2_redux/files/upload_result",Jd="@@apiv2_redux/files/upload_session/append_v2",ec="@@apiv2_redux/files/upload_session/append_v2_result",tc="@@apiv2_redux/files/upload_session/append",ic="@@apiv2_redux/files/upload_session/append_result",nc="@@apiv2_redux/files/upload_session/append_batch",ac="@@apiv2_redux/files/upload_session/append_batch_result",rc="@@apiv2_redux/files/upload_session/check_finish_batch_job_status",oc="@@apiv2_redux/files/upload_session/check_finish_batch_job_status_result",sc="@@apiv2_redux/files/upload_session/finish_v2",lc="@@apiv2_redux/files/upload_session/finish_v2_result",dc="@@apiv2_redux/files/upload_session/finish",cc="@@apiv2_redux/files/upload_session/finish_result",uc="@@apiv2_redux/files/upload_session/finish_batch",_c="@@apiv2_redux/files/upload_session/finish_batch_result",mc="@@apiv2_redux/files/upload_session/finish_batch_v2",pc="@@apiv2_redux/files/upload_session/finish_batch_v2_result",fc="@@apiv2_redux/files/upload_session/finish_batch/check",gc="@@apiv2_redux/files/upload_session/finish_batch/check_result",vc="@@apiv2_redux/files/upload_session/finish_processed",hc="@@apiv2_redux/files/upload_session/finish_processed_result",wc="@@apiv2_redux/files/upload_session/finish_processed/check",yc="@@apiv2_redux/files/upload_session/finish_processed/check_result",Ec="@@apiv2_redux/files/upload_session/start",Sc="@@apiv2_redux/files/upload_session/start_result",bc="@@apiv2_redux/files/upload_session/start_batch",Cc="@@apiv2_redux/files/upload_session/start_batch_result",Ic="@@apiv2_redux/files/validate_upload",Tc="@@apiv2_redux/files/validate_upload_result",xc=ha({[ao]:{endpoint:"add_content_references",action:va(ro)},[oo]:{endpoint:"add_content_references_to_path",action:va(so)},[lo]:{endpoint:"alpha/get_metadata",action:va(co)},[uo]:{endpoint:"alpha/upload",action:va(_o)},[mo]:{endpoint:"browse",action:va(po)},[fo]:{endpoint:"browse_continue",action:va(go)},[vo]:{endpoint:"content_tiles_metadata_v2",action:va(ho)},[wo]:{endpoint:"copy_v2",action:va(yo)},[Eo]:{endpoint:"copy",action:va(So)},[bo]:{endpoint:"copy_batch_v2",action:va(Co)},[Io]:{endpoint:"copy_batch",action:va(To)},[xo]:{endpoint:"copy_batch/check_v2",action:va(Ao)},[Mo]:{endpoint:"copy_batch/check",action:va(ko)},[No]:{endpoint:"copy_batch_sync",action:va(Po)},[Lo]:{endpoint:"copy_reference/get",action:va(Ro)},[Do]:{endpoint:"copy_reference/save",action:va(Fo)},[Oo]:{endpoint:"create_folder_v2",action:va(Uo)},[Vo]:{endpoint:"create_folder",action:va(Bo)},[zo]:{endpoint:"create_folder_batch",action:va(Ho)},[Wo]:{endpoint:"create_folder_batch/check",action:va(Ko)},[Go]:{endpoint:"delete_v2",action:va(jo)},[qo]:{endpoint:"delete",action:va(Qo)},[Yo]:{endpoint:"delete_batch",action:va($o)},[Xo]:{endpoint:"delete_batch/check",action:va(Zo)},[Jo]:{endpoint:"delete_batch_with_changeset_sync",action:va(es)},[ts]:{endpoint:"delete_with_changeset",action:va(is)},[ns]:{endpoint:"download",action:va(as)},[rs]:{endpoint:"download_zip",action:va(os)},[ss]:{endpoint:"export",action:va(ls)},[ds]:{endpoint:"get_browse_bolt_data",action:va(cs)},[us]:{endpoint:"get_content_references_info",action:va(_s)},[ms]:{endpoint:"get_description_batch",action:va(ps)},[fs]:{endpoint:"get_file_content_metadata",action:va(gs)},[vs]:{endpoint:"get_file_info",action:va(hs)},[ws]:{endpoint:"get_file_lock_batch",action:va(ys)},[Es]:{endpoint:"get_metadata",action:va(Ss)},[bs]:{endpoint:"get_metadata_batch",action:va(Cs)},[Is]:{endpoint:"get_preview_v2",action:va(Ts)},[xs]:{endpoint:"get_preview_v3",action:va(As)},[Ms]:{endpoint:"get_preview",action:va(ks)},[Ns]:{endpoint:"get_previewable_extensions",action:va(Ps)},[Ls]:{endpoint:"get_query_suggestions",action:va(Rs)},[Ds]:{endpoint:"get_temporary_link",action:va(Fs)},[Os]:{endpoint:"get_temporary_upload_link",action:va(Us)},[Vs]:{endpoint:"get_thumbnail",action:va(Bs)},[zs]:{endpoint:"get_thumbnail_v2",action:va(Hs)},[Ws]:{endpoint:"get_thumbnail_batch",action:va(Ks)},[Gs]:{endpoint:"get_thumbnail_batch_link",action:va(js)},[qs]:{endpoint:"get_upload_info",action:va(Qs)},[Ys]:{endpoint:"has_folder_access",action:va($s)},[Xs]:{endpoint:"list_folder",action:va(Zs)},[Js]:{endpoint:"list_folder/continue",action:va(el)},[tl]:{endpoint:"list_folder/get_latest_cursor",action:va(il)},[nl]:{endpoint:"list_folder/get_mount_info",action:va(al)},[rl]:{endpoint:"list_revisions",action:va(ol)},[sl]:{endpoint:"list_subfolders",action:va(ll)},[dl]:{endpoint:"lock_file_batch",action:va(cl)},[ul]:{endpoint:"media_transcode",action:va(_l)},[ml]:{endpoint:"move_v2",action:va(pl)},[fl]:{endpoint:"move",action:va(gl)},[vl]:{endpoint:"move_batch_v2",action:va(hl)},[wl]:{endpoint:"move_batch",action:va(yl)},[El]:{endpoint:"move_batch/check_v2",action:va(Sl)},[bl]:{endpoint:"move_batch/check",action:va(Cl)},[Il]:{endpoint:"move_batch_sync",action:va(Tl)},[xl]:{endpoint:"paper/create",action:va(Al)},[Ml]:{endpoint:"paper/update",action:va(kl)},[Nl]:{endpoint:"permanently_delete",action:va(Pl)},[Ll]:{endpoint:"properties/add",action:va(Rl)},[Dl]:{endpoint:"properties/overwrite",action:va(Fl)},[Ol]:{endpoint:"properties/remove",action:va(Ul)},[Vl]:{endpoint:"properties/template/get",action:va(Bl)},[zl]:{endpoint:"properties/template/list",action:va(Hl)},[Wl]:{endpoint:"properties/update",action:va(Kl)},[Gl]:{endpoint:"recents_v2",action:va(jl)},[ql]:{endpoint:"remove_content_references",action:va(Ql)},[Yl]:{endpoint:"request_unlock_file_batch",action:va($l)},[Xl]:{endpoint:"restore",action:va(Zl)},[Jl]:{endpoint:"restore_path_batch_sync",action:va(ed)},[td]:{endpoint:"save_url",action:va(id)},[nd]:{endpoint:"save_url/check_job_status",action:va(ad)},[rd]:{endpoint:"search",action:va(od)},[sd]:{endpoint:"search_v2",action:va(ld)},[dd]:{endpoint:"search/continue_v2",action:va(cd)},[ud]:{endpoint:"search_ex",action:va(_d)},[md]:{endpoint:"set_description",action:va(pd)},[fd]:{endpoint:"set_user_sort_preference",action:va(gd)},[vd]:{endpoint:"starred_v2",action:va(hd)},[wd]:{endpoint:"tags/add",action:va(yd)},[Ed]:{endpoint:"tags/get",action:va(Sd)},[bd]:{endpoint:"tags/remove",action:va(Cd)},[Id]:{endpoint:"team_folder/copy",action:va(Td)},[xd]:{endpoint:"team_folder/copy/check",action:va(Ad)},[Md]:{endpoint:"team_folder/create",action:va(kd)},[Nd]:{endpoint:"team_folder/create/check",action:va(Pd)},[Ld]:{endpoint:"team_folder/delete",action:va(Rd)},[Dd]:{endpoint:"team_folder/move",action:va(Fd)},[Od]:{endpoint:"team_folder/move/check",action:va(Ud)},[Vd]:{endpoint:"team_folder/rename",action:va(Bd)},[zd]:{endpoint:"team_folder/restore",action:va(Hd)},[Wd]:{endpoint:"tree_view_folders",action:va(Kd)},[Gd]:{endpoint:"undo_batch",action:va(jd)},[qd]:{endpoint:"unlock_file_batch",action:va(Qd)},[Yd]:{endpoint:"upload_v2",action:va($d)},[Xd]:{endpoint:"upload",action:va(Zd)},[Jd]:{endpoint:"upload_session/append_v2",action:va(ec)},[tc]:{endpoint:"upload_session/append",action:va(ic)},[nc]:{endpoint:"upload_session/append_batch",action:va(ac)},[rc]:{endpoint:"upload_session/check_finish_batch_job_status",action:va(oc)},[sc]:{endpoint:"upload_session/finish_v2",action:va(lc)},[dc]:{endpoint:"upload_session/finish",action:va(cc)},[uc]:{endpoint:"upload_session/finish_batch",action:va(_c)},[mc]:{endpoint:"upload_session/finish_batch_v2",action:va(pc)},[fc]:{endpoint:"upload_session/finish_batch/check",action:va(gc)},[vc]:{endpoint:"upload_session/finish_processed",action:va(hc)},[wc]:{endpoint:"upload_session/finish_processed/check",action:va(yc)},[Ec]:{endpoint:"upload_session/start",action:va(Sc)},[bc]:{endpoint:"upload_session/start_batch",action:va(Cc)},[Ic]:{endpoint:"validate_upload",action:va(Tc)}});var Ac;function Mc(e){return({dispatch:t})=>i=>n=>{const a=i(n);if(n.type===Ac.SearchContacts){const i=e();try{i.search(n.payload,(e=>{var i;t((i={query:n.payload,result:e[n.payload]},{type:Ac.SearchContactsResult,payload:i}))}))}catch(e){}}else n.type===Ac.WarmContacts&&e();return a}}!function(e){e.WarmContacts="@@contacts/warm",e.SearchContacts="@@contacts/search",e.SearchContactsResult="@@contacts/searchResult"}(Ac||(Ac={}));const kc="comments2";function Nc(e){return({dispatch:t,getState:i})=>(e.onSignal((e=>{e.updatedChannels.filter((e=>e.channelId.appId===kc)).map((e=>{const n=i().boltInfo.boltUniqueIdToStream[e.channelId.uniqueId];n&&t(br({arg:{include_permissions:!0,stream:n}}))}))})),t=>i=>{switch(i.type){case $r.BoltSubscribe:e.subscribe(i.payload.map((e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}}))));break;case $r.BoltUnsubscribe:e.unsubscribe(i.payload.map((e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}}))))}return t(i)})}const Pc=(e,t)=>t||e,Lc=(()=>{let e,t;const i=[];for(e=0,t=e;e<=255;e++,t=e)i.push((t+256).toString(16).substr(1));return i})();function Rc(e){return e.map((e=>Lc[e])).join("")}function Dc(){const e=function(){const e=new Uint8Array(16);return window.crypto&&window.crypto.getRandomValues(e),e}();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(Rc).join("-")}function Fc({content:e,threadId:t,author:i,actionType:n}){const a=new Date;return{id:Dc(),timestamp:a,threadId:t,author:i,content:e,userPermissions:{canDelete:!1,canEdit:!1},revisionInfo:{isCurrent:!0,timestamp:a},pending:{action:n,originalValue:void 0,pendingValue:e}}}function Oc(e){return{type:{".tag":"file"},identifier:{".tag":"file_path_or_id",file_path_or_id:e}}}function Uc(e,t){return t?function(e){return{type:{".tag":"file"},identifier:{".tag":"shared_link_details",url:e}}}(t):Oc(e)}const Vc=()=>({dispatch:e,getState:t})=>i=>async n=>{const a=i(n);if(n.type===$r.ActivateThread){const{threadId:i,fileId:r,sharedLinkURL:o}=n.payload,s=t().threads[Pc(r,o)];if(null==s)return a;const l=s[i];if(l&&!l.read&&!l.readonly){const t=Uc(r,o);e(Or({arg:{id:l.id,stream:t}}))}}return a};function Bc(e,t){return e[".tag"]===t}function zc(e){var t;if(Bc(e,"video"))return{type:"video",time:e.time||0,timeSec:e.time_sec||0};if(Bc(e,"audio"))return{type:"audio",time:e.time};if(Bc(e,"document")){const t=e.region_type[".tag"];if("highlight"!==t&&"rectangle"!==t&&"point"!==t)return;return{type:"document",regionType:t,label:e.label,regions:e.regions}}if(Bc(e,"image")){const i=null===(t=e.region_type)||void 0===t?void 0:t[".tag"];if(void 0===i)return{type:"image",region:e.region,label:e.label,regionType:"rectangle"};if("rectangle"!==i&&"point"!==i)return;return{type:"image",region:e.region,label:e.label,regionType:i}}throw new Error("Attempted to convert an annotation type that does not yet exist.")}function Hc(e){return"video"===e.type?{".tag":"video",time:e.time,time_sec:e.timeSec}:"audio"===e.type?{".tag":"audio",time:e.time}:"document"===e.type?{".tag":"document",regions:e.regions,region_type:{".tag":e.regionType}}:{".tag":"image",region:{...e.region,page:1},region_type:{".tag":e.regionType}}}function Wc(e){return"image"===e.type?{type:e.regionType,regions:[e.region]}:{type:e.regionType,regions:e.regions}}function Kc(e,t){return e.type===t}function Gc(e){return Kc(e,"mention")}function jc(e){return Kc(e,"style")}function qc(e){return Kc(e,"sticker")}function Qc(e){return Kc(e,"guest")}function Yc(e){return Kc(e,"reel")}function $c(e){return Kc(e,"hyperlink")}function Xc(e){const t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function Zc(e){const t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');const i={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:i}}function Jc(e){if(e.url&&e.location)return{location:e.location,type:"hyperlink",url:e.url}}function eu(e){const t=[...e.formatting.map(Xc),...e.mentions.map(Zc)];if(e.sticker){const i=function(e){if(e.url&&e.name&&e.description)return{type:"sticker",id:e.id,url:e.url,name:e.name,description:e.description}}(e.sticker);i&&t.push(i)}if(e.guest){const i=function(e){if(e.first_name||e.last_name)return{type:"guest",first_name:e.first_name,last_name:e.last_name}}(e.guest);i&&t.push(i)}if(e.reel){const i=function(e){if(e.annotation_data)return{type:"reel",annotation_data:e.annotation_data}}(e.reel);i&&t.push(i)}if(e.hyperlinks){const i=e.hyperlinks.map(Jc);for(const e of i)e&&$c(e)&&t.push(e)}return t}function tu(e){const t=e.filter(jc).map((e=>({format:{".tag":e.style},location:e.location}))),i=e.filter(Gc).map((e=>({user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}))),n=e.find(qc),a=n?{id:n.id}:void 0,r=e.find(Qc),o=r?{first_name:r.first_name,last_name:r.last_name}:void 0,s=e.find(Yc);return{formatting:t,mentions:i,sticker:a,guest:o,reel:s?{annotation_data:s.annotation_data}:void 0,hyperlinks:e.filter($c).map((e=>({url:e.url,location:e.location})))}}function iu(e,t){const i=t.timestamp?new Date(t.timestamp):void 0;return{isCurrent:e.ns_id===t.ns_id&&e.sjid===t.sjid,revision:{nsId:t.ns_id,sjId:t.sjid},timestamp:i}}function nu(e){return e&&"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}function au({annotation:e,content:t,stream:i}){return{annotation_data:e?Hc(e):void 0,content:t.text,metadata:tu(t.metadata),revision:nu(i)}}function ru(e,t){if("resolved_no_details"===e[".tag"])return{type:"no_details"};if(function(e){return"resolved_with_details"===e[".tag"]}(e))return{type:"with_details",resolver:t[e.resolver_id],resolvedTimestamp:new Date(e.resolved_timestamp)};throw new Error("Not a valid type for ResolvedInfo.")}function ou(e,t,i){const n=e.comments.map((n=>function(e,t,i,n){return{author:i[e.author_id],content:{metadata:eu(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),revisionInfo:n&&e.revision?iu(n,e.revision):{isCurrent:!0},userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}}(n,e.id,t,i))),a=e.resolved_info?{resolved:!0,resolvedInfo:ru(e.resolved_info,t)}:{resolved:!1};return{annotation:e.annotation_data?zc(e.annotation_data):void 0,comments:n,id:e.id,read:e.read,readonly:e.readonly,isThirdParty:e.is_third_party,...a,timestamp:n[0].timestamp}}function su(e,t,i){const n=e.map((e=>ou(e,t,i)));return Se.lodashExports.keyBy(n,"id")}function lu(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url,isCurrentUser:e.is_current_user}}function du(e){const t=e.map(lu);return Se.lodashExports.keyBy(t,"id")}var cu;!function(e){e[e.Disabled=0]="Disabled",e[e.ReadOnly=1]="ReadOnly",e[e.FullyEnabled=2]="FullyEnabled"}(cu||(cu={}));const uu={},_u={fileIdentifierToBoltMap:{},boltUniqueIdToStream:{}},mu={},pu={},fu={},gu={currentQuery:"",result:[]},vu={},hu={},wu={},yu={},Eu={},Su={},bu={},Cu={},Iu=!1,Tu={state:"annotating"},xu=e=>{const{payload:{arg:{stream:t}}}=e;return Au(t)};function Au(e){return"file_path_or_id"===e.identifier[".tag"]?e.identifier.file_path_or_id:"shared_link_details"===e.identifier[".tag"]?e.identifier.url:void 0}function Mu(e){const{stream:t,id:i}=e.payload.arg;return"file_path_or_id"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.file_path_or_id,threadId:i}:"shared_link_details"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.url,threadId:i}:{}}function ku(e){var t;const{payload:{arg:{id:i,stream:{identifier:n}}}}=e,a=null===(t=e.meta)||void 0===t?void 0:t.threadId;return"file_path_or_id"===n[".tag"]?{fileIdOrUrl:n.file_path_or_id,commentId:i,threadId:a}:"shared_link_details"===n[".tag"]?{fileIdOrUrl:n.url,commentId:i,threadId:a}:{}}function Nu(e,t,i,n){return{...e,[t]:i,pending:{action:n,originalValue:e[t],pendingValue:i}}}function Pu(e,t,i,n,a){const{comments:r}=e,o=r.findIndex((e=>e.id===t)),s=r[o];if(!s)return e;const l={...s,[i]:n},d=[...r];return d.splice(o,1,l),Nu(e,"comments",d,a)}function Lu(e,t,i){return{...e,[t]:i?e.pending.originalValue:e[t],pending:void 0}}const Ru={boltInfo:(e=_u,t)=>{if(t.type===Ra){const{payload:{arg:i,result:n}}=t,a=Au(i.stream);if(a&&n)return{fileIdentifierToBoltMap:{...e.fileIdentifierToBoltMap,[a]:n.bolt_info},boltUniqueIdToStream:{...e.boltUniqueIdToStream,[n.bolt_info.unique_id]:i.stream}}}return e},threads:(e=uu,t)=>{const i=!!t.error;switch(t.type){case wa:case Ga:return Du(e,t);case ya:case ja:return Fu(e,t,i);case Ja:case tr:return Ou(e,t);case er:case ir:return Uu(e,t,i);case nr:case sr:return Vu(e,t);case ar:case lr:return Bu(e,t,i);case xa:return zu(e,t);case Aa:return Hu(e,t,i);case ba:return Wu(e,t);case Ca:return Ku(e,t,i);case Ra:case Qa:return Gu(e,t);default:return e}},supportedEnhancements:(e={},t)=>{var i;if(t.type===Ra){const{payload:{arg:n,result:a}}=t,r=Au(n.stream);if(null!=r&&null!=a)return{...e,[r]:null!==(i=a.supported_enhancements)&&void 0!==i?i:{}}}return e},activeThreadID:(e=mu,t)=>{switch(t.type){case $r.ActivateThread:return{...e,[t.payload.fileViewerId]:t.payload.threadId};case $r.DeactivateAllThreads:return{...e,[t.payload.fileViewerId]:""};case wa:case Ga:if(t.meta&&t.meta.tempThreadId)return{...e,[t.meta.fileViewerId]:t.meta.tempThreadId};break;case ya:case ja:const{meta:i,payload:{result:n}}=t;if(n&&i&&i.tempThreadId===e[i.fileViewerId])return{...e,[i.fileViewerId]:n.id}}return e},focusedThreadID:(e=pu,{type:t,payload:i})=>{if(t===$r.FocusThread){const t={...e};return null==i.threadId?delete t[i.fileViewerId]:t[i.fileViewerId]=i.threadId,t}return e},hoverThreadID:(e=fu,{type:t,payload:i})=>{if(t===$r.HoverThread){const t={...e};return null==i.threadId?delete t[i.fileViewerId]:t[i.fileViewerId]=i.threadId,t}return e},mentionsSearchResult:(e=gu,t)=>{switch(t.type){case Ac.SearchContacts:return{...e,currentQuery:t.payload};case Ac.SearchContactsResult:if(t.payload.query===e.currentQuery)return{...e,result:t.payload.result}}return e},permissions:(e=hu,t)=>{if(t.type!==Ra&&t.type!==Qa)return e;const{payload:{arg:i,result:n}}=t,a=Au(i.stream);if(!a||!n)return e;const r=n.permissions;return{...e,[a]:r}},draftAnnotation:(e=vu,t)=>{switch(t.type){case $r.UpdateDraftAnnotation:{const{fileViewerId:i,annotation:n}=t.payload;return n===e[i]?e:{...e,[i]:n}}case $r.ActivateThread:case $r.CancelAnnotating:case $r.ClearDraftAnnotation:{const{fileViewerId:i}=t.payload;if(!(i in e))return e;const n={...e};return delete n[i],n}case wa:case Ga:if(null!=t.meta){const{fileViewerId:i}=t.meta;if(!(i in e))return e;const n={...e};return delete n[i],n}}return e},annotationSettings:(e=Tu,t)=>{switch(t.type){case $r.CancelAnnotating:return{...e,state:"annotating"};case Ta:return{...e,state:null};case wa:case Ga:return{...e,state:"annotating"};case $r.ActivateThread:return null===e.state?{...e,state:"viewing"}:"viewing"!==e.state?{...e,state:"annotating"}:e;case $r.DeactivateAllThreads:return"viewing"===e.state?{...e,state:"annotating"}:e;case $r.StartAnnotating:return t.payload.accessible?{...e,state:"annotating-ax"}:{...e,state:"annotating"};case $r.ConfirmDraftAnnotation:return{...e,state:"commenting"}}return e},editorFocusRequest:(e=wu,{type:t,payload:i})=>{if(t===$r.ConfirmDraftAnnotation&&!e[i.fileViewerId])return{...e,[i.fileViewerId]:!0};if(t===$r.FocusEditor&&!e[i.fileViewerId])return{...e,[i.fileViewerId]:!0};if(t===$r.EditorDidFocus&&e[i.fileViewerId]){const t={...e};return delete t[i.fileViewerId],t}return e},pendingNavigationToActiveThreadAnnotation:(e=yu,{type:t,payload:i})=>{if(t===$r.ActivateThread)return{[i.fileViewerId]:!0,...e};if(t===$r.ResolveNavigationToActiveThreadAnnotation){const t={...e};return delete t[i.fileViewerId],t}return e},status:(e=Eu,t)=>{if(t.type===Ra){const{payload:{arg:i,result:n}}=t,a=Au(i.stream);if(a&&n)switch(n.status[".tag"]){case"disabled":return{...e,[a]:cu.Disabled};case"enabled":return{...e,[a]:cu.FullyEnabled};case"readonly":return{...e,[a]:cu.ReadOnly}}}if(t.type===Qa){const{payload:{arg:i}}=t,n=Au(i.stream);if(n)return{...e,[n]:cu.FullyEnabled}}return e},thirdPartySource:(e=Su,t)=>{if(t.type!==Ra)return e;const{payload:{arg:i,result:n}}=t,a=Au(i.stream);if(!a||!n)return e;const r=n.supported_enhancements&&n.supported_enhancements.third_party_source;return{...e,[a]:r?(o=r,o[".tag"]):void 0};var o},subscriptionStatus:(e=bu,t)=>{if(t.type!==or&&t.type!==cr)return e;const i=xu(t);if(void 0===i)return e;switch(t.type){case or:return{...e,[i]:{isSubscribed:!0,canSubscribe:!0}};case cr:return{...e,[i]:{isSubscribed:!1,canSubscribe:!0}};default:return e}},enableCommentStatus:(e=Cu,t)=>{var i;if(t.type!==ka&&t.type!==Ta&&t.type!==Ra&&t.type!==Qa)return e;const n=xu(t);if(void 0===n)return e;switch(t.type){case ka:return{...e,[n]:{commentsEnabled:!0,canEnableCommenting:!0}};case Ta:return{...e,[n]:{commentsEnabled:!1,canEnableCommenting:!0}};case Ra:case Qa:const a=t.payload.result;return a?{...e,[n]:{commentsEnabled:!("disabled"===a.status[".tag"]),canEnableCommenting:!!(null===(i=a.permissions)||void 0===i?void 0:i.can_enable_commenting)}}:e;default:return e}},showResolvedComments:(e=Iu,t)=>t.type===$r.UpdateShowResolvedComments?t.payload.showResolvedComments:e},Du=(e,t)=>{const{payload:{arg:{thread_id:i,stream:n}}}=t,a=Au(n);if(!a||!t.meta)return e;const r=e[a],{content:o,author:s,annotation:l}=t.meta;if(i){const n=r[i],{comments:d}=n,c={...n,comments:[...d,Fc({content:o,threadId:i,author:s,actionType:t.type})],annotation:l||n.annotation};return{...e,[a]:{...r,[i]:{...c,pending:{action:t.type,originalValue:n,newValue:c}}}}}const{tempThreadId:d}=t.meta;if(d){const i=Fc({threadId:d,author:s,content:o,actionType:t.type}),n={id:d,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[i],annotation:l,isThirdParty:!1},c={...n,pending:{action:t.type,originalValue:void 0,pendingValue:n}};return{...e,[a]:{...r,[d]:c}}}return e},Fu=(e,t,i)=>{const{payload:{arg:{thread_id:n,stream:a}}}=t,r=Au(a);if(!r||!t.meta)return e;const o=e[r];if(n){const t={...o[n]},{originalValue:a}=t.pending;return t.pending=void 0,{...e,[r]:{...o,[n]:i?a:t}}}const{tempThreadId:s}=t.meta;let l=o;if(!i&&s&&s in o&&t.payload.result){l={...o},delete l[s];const e=o[s],{id:i}=t.payload.result;e.readonly=!1,e.id=i,l[i]={...e,pending:void 0}}return{...e,[r]:l}},Ou=(e,t)=>{const{fileIdOrUrl:i,threadId:n}=Mu(t);if(!i||!n)return e;const a=e[i];return{...e,[i]:{...a,[n]:Nu(a[n],"read",t.type===Ja,t.type)}}},Uu=(e,t,i)=>{const{fileIdOrUrl:n,threadId:a}=Mu(t);if(!n||!a)return e;const r=e[n];return{...e,[n]:{...r,[a]:Lu(r[a],"read",i)}}},Vu=(e,t)=>{const{fileIdOrUrl:i,threadId:n}=Mu(t);if(!i||!n)return e;const a=e[i];return{...e,[i]:{...a,[n]:Nu(a[n],"resolved",t.type===nr,t.type)}}},Bu=(e,t,i)=>{const{fileIdOrUrl:n,threadId:a}=Mu(t);if(!n||!a)return e;const r=e[n];return{...e,[n]:{...r,[a]:Lu(r[a],"resolved",i)}}},zu=(e,t)=>{const{fileIdOrUrl:i,threadId:n,commentId:a}=ku(t);if(!(i&&n&&a&&t.meta))return e;const r=e[i],{content:o}=t.meta;return{...e,[i]:{...r,[n]:Pu(r[n],a,"content",o,t.type)}}},Hu=(e,t,i)=>{const{fileIdOrUrl:n,threadId:a,commentId:r}=ku(t);if(!n||!a||!r)return e;const o=e[n];return{...e,[n]:{...o,[a]:Lu(o[a],"comments",i)}}},Wu=(e,t)=>{const{fileIdOrUrl:i,threadId:n,commentId:a}=ku(t);if(!i||!n||!a)return e;const r=e[i];return{...e,[i]:{...r,[n]:Pu(r[n],a,"deleted",!0,t.type)}}},Ku=(e,t,i)=>{const{fileIdOrUrl:n,threadId:a,commentId:r}=ku(t);if(!n||!a||!r)return e;const o=e[n];return{...e,[n]:{...o,[a]:Lu(o[a],"comments",i)}}},Gu=(e,t)=>{const{payload:{arg:i,result:n}}=t,a=Au(i.stream);return a&&n?{...e,[a]:su(n.threads,du(n.users))}:e},ju=i.combineReducers(Ru);const qu="dbid:guest_id",Qu={id:qu,name:{display:"?",initials:"?",public:"?"}},Yu=a.createContext(null),$u=()=>Ye.default.useContext(Yu);function Xu(e,t){for(const i of e){const e=i.comments;for(const n of e)if(n.id===t)return{comment:n,thread:i}}return null}const Zu="logged_out_commenting",Ju=()=>{const e=window.localStorage.getItem(Zu);return e?JSON.parse(e):void 0},e_=e=>{const t=Ju();if(!t||!e)return Qu;const i=t.first_name.concat(t.last_name),n=t_(i);return{id:qu,photoUrl:"",name:{display:i,initials:n,public:i}}},t_=e=>{if(!e)return"";const t=e.toUpperCase().trim().split(" "),i=t[0],n=t[t.length-1];return t.length>=2?i[0]+n[0]:i[0]};function i_({dispatch:e,user:t,getFileId:i,getUrl:n,getCommentsBladeId:a,onEditorFocused:r,showAuthModal:o,onClickAnnotation:s,reportException:l,getAllowLoggedOutCommenting:d}){const c=()=>{const t=n();if(t){e(Lr({arg:{include_permissions:!0,stream:{identifier:{".tag":"shared_link_details",url:t},type:{".tag":"file"}}}}))}};return{onThreadCreated:async(r,s)=>{if(t)try{await e(ur({arg:{stream:Uc(i(),n()),comment:au({content:r,annotation:s}),source:{".tag":"editor"}}},{tempThreadId:Dc(),content:r,annotation:s,author:t,fileViewerId:a()}))}catch(e){e instanceof Error&&l(e)}else{if(null==d?void 0:d()){try{await e(Nr({arg:{stream:Uc(i(),n()),comment:au({content:r,annotation:s}),source:{".tag":"editor"}}},{tempThreadId:Dc(),content:r,annotation:s,author:e_(!0),fileViewerId:a()})),c()}catch(e){e instanceof Error&&l(e)}return}if(!o)throw new Error("showAuthModal or stream is not defined");o()}},onThreadActivated(t){e(Xr({fileId:i(),sharedLinkURL:n(),fileViewerId:a(),threadId:t.id,isThirdParty:t.isThirdParty}))},onAllThreadsDeactivated(){e(Zr({fileViewerId:a()})),e(eo(a(),null))},onThreadMouseEnter(t){e(Jr(a(),t))},onThreadMouseLeave(){e(Jr(a(),null))},onThreadFocus(t){e(eo(a(),t))},onThreadBlur(){e(eo(a(),null))},onThreadRepliedTo:async(r,s)=>{if(t)e(ur({arg:{stream:Uc(i(),n()),thread_id:r,comment:au({content:s})}},{content:s,author:t,fileViewerId:a()}));else{if(null==d?void 0:d())try{return await e(Nr({arg:{stream:Uc(i(),n()),thread_id:r,comment:au({content:s})}},{content:s,author:e_(!0),fileViewerId:a()})),void c()}catch(e){e instanceof Error&&l(e)}if(!o)throw new Error("showAuthModal or stream is not defined");o()}},onThreadMarkedAsRead(a){if(t)e(Or({arg:{id:a,stream:Uc(i(),n())}}));else{if(!o)throw new Error("showAuthModal or stream is not defined");o()}},onThreadMarkedAsUnread(a){if(t)e(Vr({arg:{id:a,stream:Uc(i(),n())}}));else{if(!o)throw new Error("showAuthModal or stream is not defined");o()}},onThreadResolved(a){if(t)e(zr({arg:{id:a,stream:Uc(i(),n())}}));else{if(!o)throw new Error("showAuthModal or stream is not defined");o()}},onThreadUnresolved(a){if(t)e(Gr({arg:{id:a,stream:Uc(i(),n())}}));else{if(!o)throw new Error("showAuthModal or stream is not defined");o()}},onCommentEdited(t,a,r){e(hr({arg:{id:t,stream:Uc(i(),n()),comment:au({content:a})}},{threadId:r,content:a}))},onEnableComments(){e(yr({arg:{stream:Uc(i(),n())}}))},onDisableComments(){e(gr({arg:{stream:Uc(i(),n())}}))},onCommentDeleted(t,a){e(pr({arg:{id:t,stream:Uc(i(),n())}},{threadId:a}))},onSortComments(t){window.localStorage.setItem("comments-sort-pref",t),e(function(e){return{type:$r.SortComments,payload:{sortType:e}}}(t))},onMentionsQueryUpdated(t){var i;e((i=t,{type:Ac.SearchContacts,payload:i}))},onCommentDraftCancel(){e(io(a()))},onEditorFocused(){var t,i;e((t=a(),{type:$r.EditorDidFocus,payload:{fileViewerId:t}})),e((i={},{type:Ac.WarmContacts,payload:i})),null==r||r()},onClickAnnotation(e){null==s||s(e)},onSubscribe(){e(Wr({arg:{stream:Uc(i(),n())}}))},onUnsubscribe(){e(qr({arg:{stream:Uc(i(),n())}}))},onEditorStateChange:Se.lodashExports.noop,onCommentActivated(t,r){const o=Xu(r,t);o&&e(Xr({fileId:i(),sharedLinkURL:n(),fileViewerId:a(),threadId:o.thread.id,isThirdParty:o.thread.isThirdParty}))}}}const n_={canComment:!0,canModifyThreads:!0,canShowEditor:!0,canShowEditorMeatball:!1},a_={canComment:!1,canModifyThreads:!1,canShowEditor:!1,canShowEditorMeatball:!1},r_=(e,t)=>e.activeThreadID[t],o_=(e,t)=>e.threads[t],s_=e=>e.showResolvedComments,l_=(e,t,i)=>t===d_(e,i),d_=(e,t)=>e.activeThreadID[t],c_=(e,t,i)=>t===u_(e,i),u_=(e,t)=>e.focusedThreadID[t],__=(e,t,i)=>t===m_(e,i),m_=(e,t)=>e.hoverThreadID[t],p_=(e,t)=>e.draftAnnotation[t],f_=e=>e.annotationSettings.state,g_=i.atom(void 0),v_=i.atom(!1);i.injectInternalStyle("/static/js/file_viewer/comments2/annotations/layer.module.out-vflTBAf2M.css",(e=>"._layer_lrgpe_1{bottom:0;left:0;pointer-events:none;position:absolute;right:0;top:0}._layer_lrgpe_1._interactable_lrgpe_10{pointer-events:auto}._comment-conductor_lrgpe_14._show_comment_cursor_lrgpe_14,._comment-conductor_lrgpe_14._show_comment_cursor_lrgpe_14:hover{cursor:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='20' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='20' height='20' rx='10' fill='%230061FE'/%3E%3Cpath fill='%230061FE' d='M0 10h10v10H0z'/%3E%3C/svg%3E\") 0 20,auto}"));const h_="_layer_lrgpe_1",w_=r.defineMessage({id:"tgNuiG",defaultMessage:"Currently selecting {timestamp}"}),y_=Ye.memo((e=>{var t;const{children:n,ui:a,file:o,navigationCallbacks:s}=e,l=r.useIntl(),{fileViewerId:d}=i.useFileViewerContext(),c=null!==(t=Ce.useFrameRate(o))&&void 0!==t?t:10,u=i.useSelector((e=>e.annotationSettings.state)),_=ne.useDispatch(),m=null==s?void 0:s.seekRelative,p=i.useStabilizedCallback((e=>{"annotating-ax"===u&&("ArrowLeft"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),null!=c&&e.shiftKey?null==m||m(-1/c):null==m||m(-1)),"ArrowRight"===e.key&&(e.stopImmediatePropagation(),e.preventDefault(),null!=c&&e.shiftKey?null==m||m(1/c):null==m||m(1)),"Enter"===e.key&&_(to(d))," "===e.key&&(e.stopImmediatePropagation(),e.preventDefault()))})),f=Ye.useRef(),g=Ye.useCallback((e=>{null==e||e.addEventListener("keydown",p),f.current=e||void 0}),[p]),v=Ye.useRef();Ye.useEffect((()=>{"annotating-ax"===u&&"annotating-ax"!==v.current&&f.current&&f.current.focus(),v.current=u}),[u]);const h=(e=>{const t=Math.round(e),i=String(Math.round(t%60)).padStart(2,"0"),n=String(Math.floor(t/60)%60).padStart(2,"0"),a=Math.floor(t/3600);return a>0?`${a}:${n}:${i}`:`${n}:${i}`})(a.currentTimestamp),w="annotating-ax"===u?l.formatMessage(w_,{timestamp:h}):"";return Ye.createElement("div",{className:h_,ref:g,"aria-label":w,tabIndex:-1},n)}));function E_(e,t){let i=!0,n=null;function a(){i=!0,null!==n&&(e(...n),n=null)}return function(...r){i?(i=!1,e(...r),setTimeout(a,t)):n=r}}y_.displayName="AudioVideoAnnotationLayer",y_.displayName="AudioVideoAnnotationLayer";i.injectInternalStyle("/static/js/file_viewer/comments2/annotations/conductor_layer/conductor_layer.module.out-vflb10RUM.css",(e=>"._sc-annotation-conductor-layer_qk7d5_1{bottom:0;cursor:auto;left:0;position:absolute;right:0;top:0}._sc-annotation-conductor-layer_qk7d5_1._sc-annotation-conductor-layer__can-create_qk7d5_10{cursor:inherit;pointer-events:all}._sc-annotation-conductor-layer__can-create_qk7d5_10._sc-annotation-conductor-layer__pixel-commenting-off_qk7d5_16{cursor:crosshair}._sc-annotation-conductor-layer__can-create_qk7d5_10 img,._sc-annotation-conductor-layer__is-creating-rnd_qk7d5_26{-webkit-user-select:none;-ms-user-select:none;user-select:none}._accessibilityWarning_qk7d5_30{clip:rect(0,0,0,0)!important;border:0!important;display:none!important;height:1px!important;margin:-1px!important;overflow:hidden!important;padding:0!important;position:absolute!important;width:1px!important}"));const S_="_sc-annotation-conductor-layer_qk7d5_1";var b_;!function(e){e[e.None=0]="None",e[e.Text=1]="Text",e[e.Link=2]="Link",e[e.Creation=3]="Creation"}(b_||(b_={}));const C_=8;function I_(e,t,i){const n=i?function(e,t){const i=e.x+e.width-t.width,n=e.y+e.height-t.height;return{x:Math.min(i,t.x),y:Math.min(n,t.y),width:t.width,height:t.height}}(t,e):function(e,t){const i=e.x+e.width,n=e.y+e.height,a=e.x,r=e.y,o={x:Ie.normalizeValue(t.x,a,i),y:Ie.normalizeValue(t.y,r,n)},s=Ie.normalizeValue(t.x+t.width,a,i),l=Ie.normalizeValue(t.y+t.height,r,n);return{x:o.x,y:o.y,width:s-o.x,height:l-o.y}}(t,e);return function(e,t){let{x:i,y:n,width:a,height:r}=e;const o=i+a,s=n+r,l=t.x+t.width,d=t.y+t.height;return a<=C_&&o+C_>l&&(i=o-C_,a=C_),r<=C_&&s+C_>d&&(n=s-C_,r=C_),{x:i,y:n,width:a,height:r}}(n,t)}const T_=(e,t)=>{const i=Ie.createNormalizedRegion({left:e.x,top:e.y,width:0,height:0},{left:t.x,top:t.y,width:t.width,height:t.height});return{x:i.x,y:i.y,width:0,height:0}};i.injectInternalStyle("/static/js/file_viewer/comments2/annotations/creation_layer/creation_layer.module.out-vflgFingj.css",(e=>"._highlight-creation-layer_8v4o0_1{bottom:0;left:0;position:absolute;right:0;top:0}._highlight-creation-layer_8v4o0_1 a::selection,._highlight-creation-layer_8v4o0_1 p::selection{background:var(--dig-color__highlight__yellow)}._add-annotation-highlight-button_8v4o0_14{background-color:var(--color__inverse__elevated__background);box-sizing:border-box;color:var(--color__inverse__standard__text);margin-left:-4px;opacity:0;padding:4px;position:absolute;transition:opacity .1s ease-in-out,margin 0ms ease-in-out .4s;z-index:1000}._add-annotation-highlight-button__visible_8v4o0_26{margin-left:0;opacity:1;pointer-events:all;transition:opacity .15s ease-in-out,margin .15s ease-in-out}._annotation-rectangle-creation-layer_8v4o0_33{bottom:0;left:0;position:absolute;right:0;top:0}._annotation-rectangle-creation-draft_8v4o0_41{border:2px solid var(--dig-color__utility__focus-ring);box-sizing:border-box;cursor:all-scroll;height:100px;left:0;pointer-events:all;position:absolute;top:0;width:100px}._annotation-creation-draft_8v4o0_53{cursor:all-scroll;pointer-events:all}._annotation-handle-v2_8v4o0_58{background:var(--color__core__secondary);background-clip:padding-box;border:1px solid var(--color__core__accent);border-radius:50%;position:absolute}._annotation-handle_8v4o0_58{background:var(--dig-color__utility__focus-ring);border-radius:50%}._annotation-edge_8v4o0_73,._annotation-handle_8v4o0_58{background-clip:padding-box;position:absolute}._highlight-segment-draft_8v4o0_78{background:var(--dig-color__highlight__yellow);box-sizing:border-box;opacity:.5;pointer-events:none;position:absolute}"));function x_(e){return e+1}const A_=.02;function M_(e){return 100*e+"%"}function k_({x:e,y:t,width:i,height:n}){return{top:M_(t),left:M_(e),width:M_(i),height:M_(n)}}const N_=e=>"image"===e.type?{type:e.regionType,regions:[e.region]}:{type:e.regionType,regions:e.regions};const P_=({highlight:e,children:t})=>Ye.createElement("div",{className:"_highlight-creation-layer_8v4o0_1"},t,e&&{highlight:e}.highlight.map(((e,t)=>Ye.createElement("div",{key:`sc-annotation-highlight-draft-${t}`,style:k_(e),className:"_highlight-segment-draft_8v4o0_78"}))));P_.displayName="AnnotationHighlightCreationLayer";class L_ extends Ye.PureComponent{constructor(e){super(e),this.requestId=null,this.updateStyles=()=>{this.setState(((e,t)=>(this.requestId=null,{style:t.style})))},this.state={style:e.style}}componentWillUnmount(){this.requestId&&cancelAnimationFrame(this.requestId)}componentDidUpdate(){this.requestId||(this.requestId=requestAnimationFrame(this.updateStyles))}render(){return Ye.Children.only(this.props.children(this.state.style))}}var R_,D_;L_.displayName="RafStyle",function(e){e.TopLeft="topLeft",e.TopRight="topRight",e.BottomLeft="bottomLeft",e.BottomRight="bottomRight"}(R_||(R_={})),function(e){e.Top="top",e.Bottom="bottom",e.Left="left",e.Right="right"}(D_||(D_={}));const F_="drag";function O_(e){return 0===e.button}function U_({x:e,y:t,width:i,height:n},{deltaX:a,deltaY:r},o){switch(o){case F_:return{x:e+a,y:t+r,width:i,height:n};case R_.BottomRight:return{x:a<-i?e+(i+a):e,y:r<-n?t+(n+r):t,width:Math.abs(i+a),height:Math.abs(n+r)};case R_.BottomLeft:return{x:a>i?e+i:e+a,y:r<-n?t+(n+r):t,width:Math.abs(i-a),height:Math.abs(n+r)};case R_.TopRight:return{x:a<-i?e+(i+a):e,y:r>n?t+n:t+r,width:Math.abs(i+a),height:Math.abs(n-r)};case R_.TopLeft:return{x:a>i?e+i:e+a,y:r>n?t+n:t+r,width:Math.abs(i-a),height:Math.abs(n-r)};case D_.Left:return{x:a>i?e+i:e+a,y:t,width:Math.abs(i-a),height:n};case D_.Right:return{x:a<-i?e+(i+a):e,y:t,width:Math.abs(i+a),height:n};case D_.Top:return{x:e,y:r>n?t+n:t+r,width:i,height:Math.abs(n-r)};case D_.Bottom:return{x:e,y:r<-n?t+(n+r):t,width:i,height:Math.abs(n+r)}}}function V_(e,{x:t,y:i}){return{deltaX:t-e.x,deltaY:i-e.y}}const B_=(e,t)=>e===R_.TopLeft||e===R_.TopRight||e===R_.BottomLeft||e===R_.BottomRight?t?"_annotation-handle_8v4o0_58":"_annotation-handle-v2_8v4o0_58":e===D_.Bottom||e===D_.Top||e===D_.Left||e===D_.Right?"_annotation-edge_8v4o0_73":void 0,z_=(e,t,i)=>e===R_.TopLeft||e===R_.TopRight||e===R_.BottomLeft||e===R_.BottomRight?function(e,t,i){let n,a;switch(i?(n=t?{width:"14px",height:"14px"}:{width:"2px",height:"2px"},a=t?"-8px":"-2px"):(n={width:"12px",height:"12px"},a="-7px"),e){case R_.TopLeft:return{...n,top:a,left:a,cursor:"nw-resize"};case R_.TopRight:return{...n,top:a,right:a,cursor:"ne-resize"};case R_.BottomLeft:return{...n,bottom:a,left:a,cursor:"sw-resize"};case R_.BottomRight:return{...n,bottom:a,right:a,cursor:"se-resize"}}}(e,e===t,i):e===D_.Bottom||e===D_.Top||e===D_.Left||e===D_.Right?function(e){const t="-5px",i="6px",n="0",a={bottom:n,top:n,left:n,right:n};switch(e){case D_.Top:return{...a,top:t,height:i,bottom:void 0,cursor:"n-resize"};case D_.Left:return{...a,left:t,width:i,right:void 0,cursor:"w-resize"};case D_.Bottom:return{...a,bottom:t,height:i,top:void 0,cursor:"s-resize"};case D_.Right:return{...a,right:t,width:i,left:void 0,cursor:"e-resize"}}}(e):void 0;i.injectInternalStyle("/static/js/file_viewer/comments2/annotations/cursor/cursor.module.out-vflfD-Ncl.css",(e=>"._comment-cursor_19p38_1{background-color:var(--dig-color__primary__base);border-radius:50% 50% 50% 0}._comment-cursor__active_19p38_6{border:2px solid var(--dig-color__background__base)}"));const H_=({placement:e,isActive:t,onMouseDown:n})=>{const a=t?28:20,r=i.cx("_comment-cursor_19p38_1",{"_comment-cursor__active_19p38_6":t});return Ye.createElement("div",{style:{width:a,height:a,position:"absolute",left:e.x,top:e.y-a},className:r,onMouseDown:n})};H_.displayName="CommentCursor";i.injectInternalStyle("/static/js/file_viewer/comments2/annotations/view_layer/view_layer.module.out-vflTVv1Jf.css",(e=>'._view-layer_15d4z_1{bottom:0;left:0;pointer-events:none;position:absolute;right:0;top:0}._regular-rectangle-sublayer_15d4z_11{opacity:.3;transition:opacity .3s ease-in-out,background-color .3s ease-in-out}._regular-highlight-sublayer_15d4z_16,._regular-point-sublayer_15d4z_21{opacity:1;transition:opacity .3s ease-in-out,background-color .3s ease-in-out}._hide-regular-sublayer_15d4z_26 ._regular-highlight-sublayer_15d4z_16,._hide-regular-sublayer_15d4z_26 ._regular-point-sublayer_15d4z_21,._hide-regular-sublayer_15d4z_26 ._regular-rectangle-sublayer_15d4z_11{opacity:0}._annotation-rectangle_15d4z_38{border:2px solid var(--color__inverse__attention__border);box-sizing:border-box;position:absolute}._annotation-rectangle_15d4z_38._emphasized_15d4z_44{border:2px solid var(--dig-color__utility__focus-ring)}._annotation-rectangle-frame-segment_15d4z_48{cursor:pointer;pointer-events:auto;position:absolute}._emphasis-sublayer_15d4z_55 ._annotation-rectangle_15d4z_38{opacity:0;transition:opacity .3s ease-in-out}._emphasis-sublayer_15d4z_55 ._emphasized_15d4z_44{opacity:1}._highlight-segment_15d4z_65{box-sizing:border-box;cursor:pointer;pointer-events:auto;position:absolute}._highlight-segment_15d4z_65:after{background:var(--dig-color__highlight__yellow);bottom:0;box-sizing:border-box;content:"";height:2px;left:0;opacity:1;position:absolute;right:0}._emphasis-sublayer_15d4z_55 ._highlight-segment_15d4z_65:after{opacity:0}._emphasis-sublayer_15d4z_55 ._highlight-segment_15d4z_65:before{background-color:var(--dig-color__highlight__yellow);bottom:2px;content:"";left:0;opacity:0;position:absolute;right:0;top:0;transition:opacity .3s ease-in-out}._emphasis-sublayer_15d4z_55 ._emphasized_15d4z_44:before{opacity:.5}._comment-mark_15d4z_106{background:var(--dig-color__secondary__base);border-radius:var(--dig-spacing__micro__medium) var(--dig-spacing__micro__medium) var(--dig-spacing__micro__medium) 0;box-shadow:0 4px 12px 0 #0000001a;gap:var(--dig-spacing__dimension__8);padding:var(--dig-spacing__dimension__4);pointer-events:auto;position:absolute}._comment-mark_15d4z_106,._comment-mark_15d4z_106 button{cursor:pointer}._comment-mark-facepile-transparent_15d4z_122{opacity:.5}._comment-mark_15d4z_106._comment-mark__hovered_15d4z_126{background:var(--dig-color__secondary__on-surface)}._comment-mark_15d4z_106._comment-mark__facepile_15d4z_130{padding-left:calc(var(--dig-spacing__dimension__8) + var(--dig-spacing__dimension__4))}._comment-mark_15d4z_106._comment-mark__loading_15d4z_136{padding:var(--dig-spacing__dimension__8)}._comment-mark_15d4z_106._emphasized_15d4z_44{border:2px solid var(--color__standard__background);border-radius:var(--dig-spacing__micro__large) var(--dig-spacing__micro__large) var(--dig-spacing__micro__large) 0;z-index:1}._comment-mark_15d4z_106._emphasized_15d4z_44._comment-mark__facepile_15d4z_130{padding-left:calc(var(--dig-spacing__dimension__4) + var(--dig-spacing__dimension__4))}'));const W_="_emphasized_15d4z_44",K_="_highlight-segment_15d4z_65",G_=({rectangle:e,isEmphasized:t})=>Ye.createElement("div",{style:k_(e),className:i.cx("_annotation-rectangle_15d4z_38",{[W_]:t}),"data-testid":"annotation-rectangle"});G_.displayName="AnnotationRectangle";const j_=({x:e,y:t,width:n,height:a,onMouseEnter:r,onMouseLeave:o})=>Ye.createElement("div",{style:k_({x:e,y:t,width:n,height:a}),className:i.cx("_annotation-rectangle-frame-segment_15d4z_48"),onMouseEnter:r,onMouseLeave:o});j_.displayName="FrameSegment";const q_=e=>{const{rectangle:{x:t,y:i,width:n,height:a},onMouseEnter:r,onMouseLeave:o}=e;return Ye.createElement(Ye.Fragment,null,Ye.createElement(j_,{x:t-A_,y:i-A_,width:n+.04,height:.04,onMouseEnter:r,onMouseLeave:o}),Ye.createElement(j_,{x:t-A_,y:i+a-A_,width:n+.04,height:.04,onMouseEnter:r,onMouseLeave:o}),Ye.createElement(j_,{x:t-A_,y:i+A_,width:.04,height:a-.04,onMouseEnter:r,onMouseLeave:o}),Ye.createElement(j_,{x:t+n-A_,y:i+A_,width:.04,height:a-.04,onMouseEnter:r,onMouseLeave:o}))};q_.displayName="AnnotationRectangleFrame";const Q_=({placement:{x:e,y:t,width:i,height:n}})=>Ye.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%"},Ye.createElement("mask",{id:"annotation-cutout"},Ye.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),Ye.createElement("rect",{x:e+1,y:t+1,width:i-2,height:n-2,fill:"black"})),Ye.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"black",opacity:"0.4",mask:"url(#annotation-cutout)"}));function Y_(e){const{x:t,y:i,width:n,height:a}=e;return{transform:`translate(${t}px, ${i}px)`,width:n,height:a}}Q_.displayName="AnnotationCutoutOverlay",Q_.displayName="AnnotationCutoutOverlay";const $_=e=>e.preventDefault(),X_=({onChangeStart:e,onRectChange:t,onChangeEnd:n,rectanglePlacement:r,pointPlacement:o,children:s,onPointChange:l,onMouseEnterDraft:d,onMouseLeaveDraft:c})=>{const[u,_]=a.useState(void 0),[m,p]=a.useState(void 0),[f,g]=a.useState(!0),{experiments:{isPixelCommentingEnabled:v}}=$u(),[h]=i.useAtom(v_),w=h||v,y=a.useRef(null),E=a.useRef(null),S=a.useCallback((e=>f||u&&function({x:e,y:t},{clientX:i,clientY:n}){return Math.max(Math.abs(e-i),Math.abs(t-n))>5}(u.originPoint,e)),[f,u]),b=i.useStabilizedCallback((e=>{if(!u||!S(e))return;g(!0);const{clientX:i,clientY:n}=e,{originPoint:a,deltaMovement:r,originDraft:s}=u,d=V_(a,{x:i,y:n}),c=!f;if((r===R_.BottomLeft||r===R_.BottomRight||r===R_.TopLeft||r===R_.TopRight)&&s){const e=((e,t,i)=>{let n;switch(i){case R_.BottomRight:n={x:e.x,y:e.y};break;case R_.BottomLeft:n={x:e.x+e.width,y:e.y};break;case R_.TopLeft:n={x:e.x+e.width,y:e.y+e.height};break;case R_.TopRight:n={x:e.x,y:e.y+e.height}}const a=V_(n,{x:t.x,y:t.y}),{deltaX:r,deltaY:o}=a;return r>0&&o>0?R_.BottomRight:r>0&&o<0?R_.TopRight:r<0&&o>0?R_.BottomLeft:R_.TopLeft})(s,{x:i,y:n},r);p(e)}r===F_&&o?s&&(null==l||l(U_(s,d,r))):s&&t(U_(s,d,r),r===F_,c)})),C=i.useStabilizedCallback((()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",C),document.removeEventListener("selectstart",$_),_(void 0),n(null==u?void 0:u.originPoint,f)})),I=a.useCallback((()=>{document.addEventListener("mousemove",b,!0),document.addEventListener("mouseup",C)}),[b,C]),T=a.useCallback((()=>{document.addEventListener("selectstart",$_)}),[]),x=a.useCallback(((t,i,n=!1)=>{if(O_(t)){T();const{clientX:a,clientY:r}=t,o=E.current,s={x:a,y:r},l=n?{...s,width:0,height:0}:o&&function({top:e,left:t,width:i,height:n}){return{x:t,y:e,width:i,height:n}}(o.getBoundingClientRect());I(),e(),_({originPoint:s,deltaMovement:i,originDraft:l})}}),[I,T,e]),A=a.useCallback((e=>{e.currentTarget===e.target&&(x(e,F_),g(!0))}),[x]),M=a.useCallback((e=>{var t;const i=e.target,n=function(e){const t=e.target.tagName.toUpperCase();return"P"===t||"TEXT"===t}(e)||function(e){return"A"===e.target.tagName}(e),a=null===(t=E.current)||void 0===t?void 0:t.contains(i);n||a||(g(!1),x(e,R_.BottomRight,!0))}),[x]),k=a.useCallback((()=>{if(!r&&!o)return null;const e=w&&Ye.default.createElement(H_,{placement:{x:0,y:r?2:0},isActive:!0,onMouseDown:A}),t=(e=>{if(e)switch(e){case R_.BottomRight:return R_.TopLeft;case R_.BottomLeft:return R_.TopRight;case R_.TopLeft:return R_.BottomRight;case R_.TopRight:return R_.BottomLeft}})(m),n=[D_.Top,D_.Left,D_.Right,D_.Bottom,R_.TopLeft,R_.TopRight,R_.BottomLeft,R_.BottomRight].map((i=>Ye.default.createElement("div",{style:z_(i,t,w),key:i,className:B_(i,w),onMouseDown:e=>x(e,i)},i===m&&e))),a=i.cx("_annotation-creation-draft_8v4o0_53",{"_annotation-rectangle-creation-draft_8v4o0_41":!!r});return Ye.default.createElement(L_,{style:r||o},(t=>t?Ye.default.createElement(Ye.default.Fragment,null,Ye.default.createElement("div",{ref:E,style:Y_(t),className:a,onMouseDown:A,onMouseEnter:d,onMouseLeave:c},r&&n,o&&e),Ye.default.createElement(Q_,{placement:t})):null))}),[m,w,x,A,d,c,o,r]);return Ye.default.createElement("div",{ref:y,className:"_annotation-rectangle-creation-layer_8v4o0_33",onMouseDown:M},s,k())};function Z_(e){const{top:t,left:i,width:n,height:a}=e.currentTarget.getBoundingClientRect(),{clientX:r,clientY:o}=e,[s,l]=[r-i,o-t];return{x:s/n,y:l/a}}function J_(e,t,i,n){const{x:a,y:r,width:o,height:s}=e;return{x:a*t+((null==n?void 0:n.x)||0),y:r*i+((null==n?void 0:n.y)||0),width:o*t,height:s*i}}X_.displayName="AnnotationRectangleCreationLayer";const em=({canCreateRectangle:e,layerSize:t,handleClick:n,onAnnotationConfirm:a,onAnnotationChange:o,onHoverPointChange:s,isActive:l,children:d,annotation:c,setShowCommentCursor:u})=>{const _=r.useIntl(),{experiments:{isPixelCommentingEnabled:m},commentsBladeId:p}=$u(),f=i.useSelector((e=>r_(e,p))),g=i.useSelector(f_),[v]=i.useAtom(v_),h=v||m,w=Ye.useRef(null),y=Ye.useRef(b_.None),E=Ye.useRef(!1),[S,b]=Ye.useState(null),[C,I]=Ye.useState(null),[T,x]=Ye.useState(),[A,M]=Ye.useState(!1),k=Ye.useMemo((()=>{if(C&&"rectangle"===C.type){return J_(C.regions[0],t.width,t.height)}return null}),[C,t]),N=Ye.useMemo((()=>{if(C&&"point"===C.type){return J_(C.regions[0],t.width,t.height)}return null}),[C,t]);Ye.useEffect((()=>{I(c)}),[c]);const P="highlight"===(null==c?void 0:c.type)?c.regions:null,L=null!==c,R=Ye.useCallback(((e,t)=>{if("rectangle"!==e.type&&"point"!==e.type)return;const i=e.regions[0],n=t||"point"===e.type?_.formatMessage({id:"Ycv46p",defaultMessage:"Annotation updated with position x: {x}, y: {y}"},{x:Math.round(100*i.x),y:Math.round(100*i.y)}):_.formatMessage({id:"JCBqbG",defaultMessage:"Annotation updated with size width: {width}, height: {height}"},{width:Math.round(100*i.width),height:Math.round(100*i.height)});x(n)}),[_]),D=Ye.useCallback((t=>{e&&t.preventDefault()}),[e]),F=Ye.useCallback(((t,i,n)=>{if(S&&e){u(!1);const e=function(e,t){return Ie.createNormalizedRegion({left:e.x,top:e.y,width:e.width,height:e.height},{left:t.x,top:t.y,width:t.width,height:t.height})}(I_(t,S,i),S),a={type:"rectangle",regions:[e]};n?o(a):(I(a),R(a,i))}}),[S,e,u,o,R]),O=Ye.useCallback(((e,i,n)=>{if(!S||!C)return;const{x:a,y:r,width:o,height:s}=C.regions[0],{width:l,height:d}=t,c=.01;let u;u=n?{x:a,y:r,width:o+e*c,height:s+i*c}:{x:a+e*c,y:r+i*c,width:o,height:s};const _=J_(u,l,d,S);F(_,!n)}),[C,S,t,F]),U=Ye.useCallback((e=>{L&&c&&c.type===e&&o(null)}),[c,L,o]),V=Ye.useCallback((()=>{U("highlight")}),[U]),B=Ye.useCallback((()=>{U("rectangle")}),[U]),z=Ye.useCallback((()=>{U("point")}),[U]),H=Ye.useMemo((()=>E_((e=>{null==s||s(e)}),50)),[s]),W=Ye.useCallback((()=>{u(!1)}),[u]),K=Ye.useCallback((()=>{u(!0)}),[u]),G=Ye.useCallback((e=>{E.current=!0;0===(void 0!==e.buttons?e.buttons:e.nativeEvent.which)&&!c&&H(Z_(e))}),[c,H]),j=Ye.useCallback((e=>{O_(e)&&(y.current=function(e){return function(e){return"A"===e.target.tagName}(e)?b_.Link:function(e){const t=e.target.tagName.toUpperCase();return"P"===t||"TEXT"===t}(e)?b_.Text:function(e,t){return e.target.classList.contains(t)}(e,S_)||function(e){return"IMG"===e.target.tagName}(e)?b_.Creation:b_.None}(e),E.current=!1,M(!1))}),[]),q=Ye.useCallback((e=>{E.current||(P?(V(),M(!0)):f&&(null==n||n(Z_(e)),M(!0))),y.current=b_.None}),[f,V,n,P]),Q=Ye.useCallback((()=>{H(void 0)}),[H]),Y=Ye.useCallback((()=>{if(w.current&&t){const{left:e,top:i}=w.current.getBoundingClientRect(),{width:n,height:a}=t,r={x:e,y:i,width:n,height:a};return b(r),r}}),[t]),$=Ye.useCallback((e=>{if(S){const t=T_(e,S);o({type:"point",regions:[t]})}}),[S,o]),X=Ye.useCallback(((e,t)=>{A||(t?(o(C),null==a||a()):N||k?(z(),B()):e&&h&&($(e),null==a||a()),b(null),u(!0))}),[z,B,$,C,A,o,a,N,k,h,u]),Z=Ye.useCallback((e=>{if(!C||"rectangle"!==C.type)return;let t=!1;"Enter"===e.key?(X(void 0,!0),t=!0):"ArrowUp"===e.key?(O(0,-1,e.shiftKey),t=!0):"ArrowDown"===e.key?(O(0,1,e.shiftKey),t=!0):"ArrowLeft"===e.key?(O(-1,0,e.shiftKey),t=!0):"ArrowRight"===e.key&&(O(1,0,e.shiftKey),t=!0),t&&(e.stopImmediatePropagation(),e.preventDefault())}),[C,O,X]);return Ye.useEffect((()=>{var t;if(l&&"annotating-ax"===g&&e){const e=Y();if(e){const i=e.width>500?200/e.width:.2,n=e.height>250?100/e.height:.1;o({type:"rectangle",regions:[{x:0,y:0,width:i,height:n}]}),null===(t=w.current)||void 0===t||t.focus()}}}),[e,o,l,g,Y]),Ye.useEffect((()=>{if(w.current){const e=w.current;return e.addEventListener("keydown",Z),()=>e.removeEventListener("keydown",Z)}return()=>{}}),[Z]),Ye.createElement(Ye.Fragment,null,Ye.createElement("div",{ref:w,onMouseDown:j,onMouseUp:q,onMouseLeave:Q,onMouseMove:G,className:i.cx(S_,{"_sc-annotation-conductor-layer__can-create_qk7d5_10":e,"_sc-annotation-conductor-layer__is-creating-rnd_qk7d5_26":S,"_sc-annotation-conductor-layer__pixel-commenting-off_qk7d5_16":!h}),onDragStart:D,tabIndex:-1},Ye.createElement("span",{role:"alert",className:"_accessibilityWarning_qk7d5_30"},Ye.createElement(Te.FormattedMessage,{...tm.accessibilityWarning})),Ye.createElement(P_,{highlight:P},Ye.createElement(X_,{rectanglePlacement:k,pointPlacement:h?N:void 0,onChangeStart:Y,onChangeEnd:X,onRectChange:F,onPointChange:h?t=>{if(S&&e){u(!1);const e=T_(t,S),i={type:"point",regions:[{...e,width:0,height:0}]};I({type:"point",regions:[{...e,width:0,height:0}]}),R(i,!0)}}:void 0,onMouseEnterDraft:W,onMouseLeaveDraft:K},d))),Ye.createElement("div",{style:{opacity:0,position:"absolute"},"aria-live":"polite"},T))};em.displayName="AnnotationConductorLayer";const tm=r.defineMessages({accessibilityWarning:{id:"WUrnLf",defaultMessage:"Note: There may be limited functionality for screen reader users for this commenting tool."}}),im=e=>{const{layer:t,draftAnnotation:n,ui:{scaleFactor:a},children:r,isActive:o,onClick:s,onHoverPointChange:l,handleRegionSelection:d,handleAnnotationConfirm:c,setShowCommentCursor:u}=e,_=ne.useDispatch(),m=i.useSelector(f_),{fileViewerId:p}=i.useFileViewerContext(),f=Ye.default.useCallback((e=>{d(e,"pageIndex"in t?t.pageIndex:null)}),[d,t]),g=Ce.isEditingAnnotation(m);Ye.default.useEffect((()=>{if(g)return()=>{_(io(p))}}),[g,_,p]);const v=Ye.default.useMemo((()=>t.dimensions?{height:t.dimensions.height*a,width:t.dimensions.width*a}:void 0),[a,t.dimensions]);return v?Ye.default.createElement(em,{canCreateRectangle:Ce.isEditingAnnotation(m),annotation:n,onAnnotationChange:f,onAnnotationConfirm:c,handleClick:s,onHoverPointChange:l,layerSize:v,isActive:o,setShowCommentCursor:u},r):Ye.default.createElement(Ye.default.Fragment,null,r)};function nm(e){return void 0!==e&&"document"===e.type}function am(e){return void 0!==e&&("audio"===e.type||"video"===e.type)}function rm(e){const{annotation:t}=e;return!!t&&am(t)}im.displayName="AnnotationConductor";const om=e=>0===e.x&&0===e.y&&1===e.width&&1===e.height,sm=r.defineMessage({id:"O3lKDp",defaultMessage:"and {overflowNumber, plural, one {{overflowNumber} other} other {{overflowNumber} others}}"}),lm=r.defineMessage({id:"GiBBTp",defaultMessage:"Loading new comment replies"}),dm=({thread:e,layerSize:n,onMouseEnter:a,onMouseLeave:o})=>{const{commentsBladeId:s,fileId:l,url:d,logEvent:c}=$u(),{annotation:u,comments:_,id:m,isThirdParty:p}=e,{regions:f,type:g}=N_(u),v=ne.useDispatch(),h=r.useIntl(),[w,y]=Ye.useState(!1),[E,S]=Ye.useState([]),[b,C]=Ye.useState(28),I=Ye.useRef(null),T=i.useSelector((e=>l_(e,m,s))),x=i.useSelector((e=>c_(e,m,s))),A=i.useSelector((e=>__(e,m,s))),M=T||x;Ye.useEffect((()=>{if(_.some((e=>!!e.pending)))return void y(!0);y(!1);const e=new Set,t=[];_.forEach((i=>{i.author&&!e.has(i.author.id)&&(e.add(i.author.id),t.push(i.author))})),S(t)}),[_]);const k=Ye.useMemo((()=>E.length<=3?E.slice(0,3):E.slice(0,2)),[E]),N=Ye.useCallback((e=>{c({event:t.CommentsEventName.SELECT_COMMENT_MARK,extra:{commentsAnnotationType:g}}),e.stopPropagation(),v(eo(s,m)),v(Xr({fileId:l,sharedLinkURL:d,threadId:m,fileViewerId:s,isThirdParty:p}))}),[c,g,v,s,m,l,d,p]),P=Ye.useCallback((()=>{null==a||a(),v(Jr(s,m))}),[v,s,a,m]),L=Ye.useCallback((()=>{null==o||o(),v(Jr(s,null))}),[v,s,o]),R=Ye.useCallback((e=>{e.stopPropagation()}),[]),D=Ye.useMemo((()=>e.read||!!e.resolvedInfo),[e]);if(Ye.useEffect((()=>{I.current&&(E.length>0||w)&&C(I.current.offsetHeight)}),[M,w,E]),om(f[0]))return null;const F=i.cx("_comment-mark_15d4z_106",{[W_]:M,"_comment-mark__hovered_15d4z_126":A,"_comment-mark__facepile_15d4z_130":!w,"_comment-mark__loading_15d4z_136":w}),{x:O,y:U,width:V}=f[0];return Ye.createElement(i.Box,{ref:I,className:F,style:{top:M_(U-b/n.height),left:M_(O+V),position:"absolute"},"data-testid":"comment-mark-test-id",onClick:N,onMouseEnter:P,onMouseLeave:L,onMouseMove:R},w?Ye.createElement(i.Spinner,{size:"xsmall","aria-valuetext":h.formatMessage(lm)}):Ye.createElement("div",{className:i.cx({"_comment-mark-facepile-transparent_15d4z_122":D})},Ye.createElement(i.ThemeProvider,{mode:"dark"},Ye.createElement(i.ThemeContainer,null,Ye.createElement(i.Facepile,{size:M?"small":"xsmall"},k.map((e=>Ye.createElement(i.Facepile.Item,{alt:e.name.display,src:e.photoUrl,key:e.id},e.name.initials))),E.length>3&&Ye.createElement(i.Facepile.Item,{alt:h.formatMessage(sm,{overflowNumber:E.length-k.length})},E.length-k.length))))))};function cm(e){const{rectangle:t,isEmphasized:n,onMouseEnter:a,onMouseLeave:r}=e,o=i.cx(K_,{[W_]:n});return Ye.createElement("div",{style:k_(t),className:o,"data-testid":"annotation-highlight-segment",onMouseEnter:a,onMouseLeave:r})}function um({threads:e,shouldAllowPixelCommenting:t,layerSize:i,activeThreadId:n,focusedThreadId:a,hoveredThreadId:r,setShowCommentCursor:o}){return e.map((e=>{const{id:s,annotation:l}=e,{type:d,regions:c}=N_(l),u=[n,a,r].includes(s),_=()=>o(!1),m=()=>o(!0),p=t&&i?Ye.createElement(dm,{thread:e,layerSize:i,onMouseEnter:_,onMouseLeave:m,key:`comment-mark-${e.id}`}):null;switch(d){case"rectangle":return Ye.createElement(Ye.Fragment,{key:s},p,Ye.createElement(G_,{rectangle:c[0],isEmphasized:u}),Ye.createElement(q_,{rectangle:c[0],onMouseEnter:_,onMouseLeave:m}));case"highlight":return Ye.createElement(Ye.Fragment,{key:s},p,c.map(((e,t)=>Ye.createElement(cm,{key:`${s}-${t}`,rectangle:e,isEmphasized:u,onMouseEnter:_,onMouseLeave:m}))));case"point":return Ye.createElement(Ye.Fragment,{key:s},p)}}))}function _m(e){const{threads:t,hideLayer:n,layerSize:a,handleClick:r,handleHoverPointChange:o,setShowCommentCursor:s}=e,{commentsBladeId:l,experiments:{isPixelCommentingEnabled:d}}=$u(),c=i.useSelector((e=>d_(e,l))),u=i.useSelector((e=>u_(e,l))),_=i.useSelector((e=>m_(e,l))),[m]=i.useAtom(v_),p=m||d,f=n?{layerSize:a,activeThreadId:c,focusedThreadId:u,hoveredThreadId:_,setShowCommentCursor:s}:{shouldAllowPixelCommenting:p,layerSize:a,activeThreadId:c,focusedThreadId:u,hoveredThreadId:_,setShowCommentCursor:s},g=t.filter((e=>"rectangle"===N_(e.annotation).type)),v=t.filter((e=>"highlight"===N_(e.annotation).type)),h=p?t.filter((e=>"point"===N_(e.annotation).type)):[],w=um({threads:g,...f}),y=um({threads:v,...f}),E=um({threads:h,shouldAllowPixelCommenting:p,...f}),S=um({threads:[...g,...v,...h],...f});let b;if(a){const e=[...g,...h].filter((e=>e.id===c));if(e&&1===e.length){b=J_(N_(e[0].annotation).regions[0],a.width,a.height)}}const C=Ye.useCallback((e=>{null==o||o(Z_(e))}),[o]),I=Ye.useCallback((e=>{null==r||r(Z_(e))}),[r]);return Ye.createElement("div",{className:"_view-layer_15d4z_1","data-testid":"annotation-view-layer",onMouseMove:C,onClick:I},Ye.createElement("div",{className:i.cx({"_hide-regular-sublayer_15d4z_26":n})},Ye.createElement("div",{className:"_regular-rectangle-sublayer_15d4z_11"},w),Ye.createElement("div",{className:"_regular-highlight-sublayer_15d4z_16"},y),Ye.createElement("div",{className:"_regular-point-sublayer_15d4z_21","data-testid":"point-view-layer"},E)),Ye.createElement("div",{className:"_emphasis-sublayer_15d4z_55","data-testid":"annotation-emphasis-sublayer"},S),b&&Ye.createElement(Q_,{placement:b}))}const mm=({threads:e,layer:{dimensions:t},draftAnnotation:i,ui:{scaleFactor:n},onClick:a,onHoverPointChange:r,setShowCommentCursor:o})=>{if(null==t)return null;const{height:s,width:l}=t;return Ye.createElement(_m,{threads:e,hideLayer:null!=i,layerSize:{height:s*n,width:l*n},handleClick:a,handleHoverPointChange:r,setShowCommentCursor:o})};mm.displayName="AnnotationHighlights";const pm=i.atom({});pm.debugLabel="_reactionsAtom";const fm=i.atom((e=>e(pm)),((e,t,i)=>{const n=e(pm);t(pm,{...n,...i})}));fm.debugLabel="reactionsAtom";const gm=i.atom({});gm.debugLabel="_reactionsBoltInfoAtom";const vm=i.atom((e=>e(gm)),((e,t,i)=>{const n=e(gm);t(gm,{...n,...i})}));vm.debugLabel="reactionsBoltInfoAtom";const hm=i.atom({});hm.debugLabel="_reactionsUsersAtom";const wm=i.atom((e=>e(hm)),((e,t,i)=>{const n=e(hm);t(hm,{...n,...i})}));wm.debugLabel="reactionsUsersAtom";const ym=i.atom(void 0);ym.debugLabel="_currentUserPidAtom";const Em=i.atom((e=>e(ym)),((e,t,i)=>t(ym,i))),Sm=({children:t,...n})=>{const[r,o]=a.useState(!1),{file:s,user:l,reportException:d,logEvent:c,sharedLinkInfo:u,comments2024FeatureFlags:_,audioVideoUi:m,docUi:p,reactionsBoltIOClient:f,navigationCallbacks:g,previewType:v,showSnackbar:h,handleCopyLinkClick:w}=n,{fileViewerId:y,optionalIOClients:{navigationClient:E},apiV2Client:S}=i.useFileViewerContext(),b=ne.useDispatch(),C=!l,I=_.isLoggedOutCommentingEnabled,T=i.useStickersQuery(S),[x,A]=a.useState(void 0);Ye.default.useEffect((()=>{void 0===x&&(async()=>{const t=await new Promise((function(t,i){e(["./c_emoji-mart_data_sets_14_native"],t,i)}));A(t)})()}),[x]);const M=a.useCallback(((e=i.CommentTextVariant.POST,t)=>{if(!(null==E?void 0:E.showAuthModal))throw new Error("showAuthModal must be passed for logged out user");const n=new URL(s.url);return n.searchParams.set("comment","true"),null==E?void 0:E.showAuthModal({sharedLinkUrl:n.href,mode:i.AuthMode.REGISTER,kind:i.LoginOrRegisterKind$1.COMMENT,loggingExtra:{source:"file_viewer_comments_pane"},commentParams:{variant:e,stream:{type:"file",id:s.fileId,ns_id:s.nsId,sjid:s.sjId,linkUrl:s.url,isVersionHistoryMode:!1,bytes:s.size,filename:s.name}},signupTag:t,webSignInTag:"file_viewer_comments_pane",authDialogPreviousElement:i.AuthDialogPreviousElementTag.COMMENT,sharedLinkInfo:u})}),[s.fileId,s.name,s.nsId,s.size,s.sjId,s.url,E,u]),k=a.useMemo((()=>{if(g)return v===i.PreviewType.Audio||v===i.PreviewType.Video?{type:"av",seek:g.seek,pause:g.pause}:void 0}),[g,v]),N=a.useCallback((e=>{b(Xr({fileId:s.fileId,sharedLinkURL:s.url,threadId:e.threadID,fileViewerId:y,isThirdParty:!1}))}),[s.fileId,s.url,y,b]),P=a.useCallback((()=>i_({dispatch:b,user:l,getFileId:()=>s.fileId,getUrl:()=>s.url,getCommentsBladeId:()=>y,onEditorFocused:()=>{M&&C&&!I&&!r&&(o(!0),M())},seek:e=>{"av"===(null==k?void 0:k.type)&&k.seek(e)},pause:()=>{"av"===(null==k?void 0:k.type)&&k.pause()},onClickAnnotation:N,showAuthModal:M,reportException:d,getAllowLoggedOutCommenting:()=>I})),[k,b,s.fileId,s.url,y,r,C,N,d,M,l,I]),L=a.useMemo((()=>({apiV2Client:S,user:null!=l?l:e_(I),isLoggedOut:C,fileId:s.fileId,fileName:s.name,url:s.url,commentsBladeId:y,navigation:k,showAuthModal:M,reportException:d,onClickAnnotation:N,logEvent:c,stickerPacks:T,actionsAdapter:P(),experiments:_,docUi:p,audioVideoUi:m,reactionsBoltIOClient:f,emojiData:x,previewType:v,showSnackbar:h,handleCopyLinkClick:w})),[S,l,I,C,s.fileId,s.name,s.url,y,k,M,d,N,c,T,P,_,p,m,f,x,v,h,w]);return Ye.default.createElement(Yu.Provider,{value:L},t)};Sm.displayName="CommentsContextProvider";const bm=({children:t,...n})=>{const a=ne.useDispatch(),{commentsBladeId:r,fileId:o,url:s,experiments:{isPixelCommentingEnabled:l}}=$u(),d=i.useSelector((e=>r_(e,r))),c=i.useSelector(f_),u=i.useAfterDisplayPassthroughCallback({importer:async()=>{const{annotationHandleClick:t}=await new Promise((function(t,i){e(["./c_comments2_annotations_annotation_layer.after-display"],t,i)}));return{default:{fn:t}}}}),_=i.useAfterDisplayPassthroughCallback({importer:async()=>{const{handleHoverPointChange:t}=await new Promise((function(t,i){e(["./c_comments2_annotations_annotation_layer.after-display"],t,i)}));return{default:{fn:t}}}}),m=Ye.useRef(null),[p]=i.useAtom(v_),f=p||l,[g,v]=Ye.useState(Boolean(f)),[h,w]=Ye.useState(!1);Ye.useEffect((()=>{v(h)}),[h]),Ye.useEffect((()=>{const e=e=>{m.current&&m.current.contains(e.target)?h||w(!0):h&&w(!1)};return document.addEventListener("mousemove",e),()=>{document.removeEventListener("mousemove",e)}}),[h]);const[,y]=i.useAtom(v_);Ye.useLayoutEffect((()=>{n.threads.some((e=>"point"===N_(e.annotation).type))&&y(!0)}),[n.threads,y]);const E=Ye.useRef(!1),S=Ce.isAnnotating(c)||null!=n.draftAnnotation;if(!E.current&&0===n.threads.length&&!S)return null;E.current=!0;const b=n.layer.viewportRef,C=e=>u.fn(e,n.threads,a,r,o,s),I=e=>_.fn(n.threads,a,r,e),T=n.previewType===i.PreviewType.CloudDoc||n.previewType===i.PreviewType.SsrDoc||n.previewType===i.PreviewType.Image,x=Ye.createElement(i.ClickOutside,{isClickThroughPortaled:!1,shouldPropagateMouseEvents:!0,onClickOutside:e=>{var t,i;e.target&&(null===(t=b.current)||void 0===t?void 0:t.contains(e.target))&&a((i=r,{type:$r.ClearDraftAnnotation,payload:{fileViewerId:i}}))},shouldClickOutsideWhenDefaultPrevented:!1,isActive:!!n.draftAnnotation},Ye.createElement("div",{ref:m,className:i.cx(h_,"_comment-conductor_lrgpe_14",{_show_comment_cursor_lrgpe_14:l&&T&&g})},Ye.createElement(im,{...n,onClick:C,onHoverPointChange:I,setShowCommentCursor:v},t))),A=Ye.createElement(i.ClickOutside,{isClickThroughPortaled:!1,shouldPropagateMouseEvents:!0,onClickOutside:e=>{var t;e.target&&(null===(t=b.current)||void 0===t?void 0:t.contains(e.target))&&(a(Zr({fileViewerId:r})),a(eo(r,null)))},shouldClickOutsideWhenDefaultPrevented:!1,isActive:n.threads.some((e=>d===e.id))},Ye.createElement("div",{className:h_},null===n.draftAnnotation&&Ye.createElement(mm,{...n,onClick:C,onHoverPointChange:I,setShowCommentCursor:v})));return Ye.createElement(Ye.Fragment,null,!n.viewOnly&&x,n.displayLayers.textLayer&&Ye.createElement(km,{textLayer:n.displayLayers.textLayer}),A)};bm.displayName="BaseAnnotationLayer";const Cm=e=>{const{fileId:t,url:n,commentsBladeId:a}=$u(),r=Pc(t,n),o=i.useSelector((e=>o_(e,r)))||{},s=i.useSelector(s_),l=Object.values(o).filter((e=>{return null!=(t=e).annotation&&"image"===t.annotation.type&&Im(e,s);var t})),d=i.useSelector((e=>p_(e,a))),c=Ye.useMemo((()=>null==d||"image"!==d.type?null:Wc(d)),[d]);return Ye.createElement(bm,{...e,threads:l,draftAnnotation:c,isActive:!0})};function Im(e,t){return t||!e.resolvedInfo}function Tm(e,t){if(!e||!e.regions)return!1;const i=x_(t);return e.regions.some((e=>e.page===i))}Cm.displayName="ImageAnnotationLayer";const xm=e=>{const{fileId:t,url:n,commentsBladeId:a}=$u(),r=Pc(t,n),o=i.useSelector((e=>o_(e,r)))||{},s=i.useSelector(s_),l=i.useSelector((e=>p_(e,a))),{ui:d,layer:c}=e,u=d.currentPageIndex,_=c.pageIndex,m=Object.values(o).filter((e=>{return null!=(t=e).annotation&&"document"===t.annotation.type&&Im(e,s)&&Tm(e.annotation,_);var t})),p=Ye.useMemo((()=>null!=l&&"document"===l.type&&Tm(l,_)?Wc(l):null),[l,_]);return Ye.createElement(bm,{...e,threads:m,draftAnnotation:p,isActive:_===u})};xm.displayName="DocAnnotationLayer";const Am=e=>e.previewType===i.PreviewType.Image?Ye.createElement(Cm,{...e}):e.previewType===i.PreviewType.SsrDoc||e.previewType===i.PreviewType.CloudDoc?Ye.createElement(xm,{...e}):e.previewType===i.PreviewType.Audio||e.previewType===i.PreviewType.Video?Ye.createElement(y_,{...e}):Ye.createElement(Ye.Fragment,null,e.children);Am.displayName="AnnotationLayerInternal";const Mm=e=>Ye.createElement(Sm,{...e},Ye.createElement(Am,{...e}));Mm.displayName="AnnotationLayer";const km=({textLayer:e})=>{const{commentsBladeId:t}=$u();return i.useSelector((e=>p_(e,t)))?null:e};km.displayName="CommentTextLayer",Mm.displayName="AnnotationLayer";const Nm=e=>i.useSelector((t=>e?((e,t)=>{const i=e.threads[t];return i?Object.values(i).filter((e=>!e.read&&!e.resolvedInfo&&e.comments.some((e=>!e.deleted)))).length:void 0})(t,e):0)),Pm=({fileId:e,sharedLinkURL:t,setCommentsSidebar:n,comments2024FeatureFlags:a})=>{const r=Nm(Pc(e,t)),[o,s]=Ye.default.useState(!0);return Ye.default.useEffect((()=>{o&&void 0!==r&&n&&((null==a?void 0:a.isLoggedOutCommentingEnabled)?n(i.UserActionContext.LoggedOutCommenting):r>0&&n(i.UserActionContext.UnreadComments),s(!1))}),[null==a?void 0:a.isLoggedOutCommentingEnabled,n,o,r]),Ye.default.createElement("span",{className:l.iconContainer},Ye.default.createElement(i.UIIcon,{src:L.CommentLine,className:l.commentButton}),!!r&&r>0&&Ye.default.createElement(i.Badge,{variant:"attention",className:l.unreadBadge,"aria-label":"Comments notification unread count"},r))};Pm.displayName="CommentIconWithUnreadCount";function Lm({event:e,stream:t,thread_id:i,comment_id:n,is_third_party:a,error:r}){return Ar({arg:{event:r?{".tag":"comment_error"}:e,stream:t,thread_id:i,comment_id:n,is_third_party:a,oref:"dfv",product_surface:{".tag":"file_preview"},product_surface_context:{".tag":"file_preview"},error_message:r?r.message:void 0}})}const Rm=({dispatch:e})=>t=>i=>{const n=t(i);if(i.type===ya)e(Lm({event:i.payload.arg.thread_id?{".tag":"reply_to_comment"}:{".tag":"new_comment"},stream:i.payload.arg.stream,thread_id:i.payload.arg.thread_id,error:i.error}));else if(i.type===er)e(Lm({event:{".tag":"mark_thread_as_read"},stream:i.payload.arg.stream,thread_id:i.payload.arg.id,error:i.error}));else if(i.type===ir)e(Lm({event:{".tag":"mark_thread_as_unread"},stream:i.payload.arg.stream,thread_id:i.payload.arg.id,error:i.error}));else if(i.type===ar)e(Lm({event:{".tag":"resolve_thread"},stream:i.payload.arg.stream,thread_id:i.payload.arg.id,error:i.error}));else if(i.type===lr)e(Lm({event:{".tag":"unresolve_thread"},stream:i.payload.arg.stream,thread_id:i.payload.arg.id,error:i.error}));else if(i.type===Ca)e(Lm({event:{".tag":"delete_comment"},stream:i.payload.arg.stream,thread_id:i.meta?i.meta.threadId:void 0,comment_id:i.payload.arg.id,error:i.error}));else if(i.type===Aa)e(Lm({event:{".tag":"edit_comment"},stream:i.payload.arg.stream,thread_id:i.meta?i.meta.threadId:void 0,comment_id:i.payload.arg.id,error:i.error}));else if(i.type===$r.ActivateThread){const{fileId:t,isThirdParty:n,threadId:a}=i.payload,r=Oc(t);e(Lm({event:{".tag":"activate_thread"},stream:r,thread_id:a,is_third_party:n}))}return n};var Dm;!function(e){e.FULL_PREVIEW="full_preview",e.QUICK_VIEW="quick_view"}(Dm||(Dm={}));i.injectInternalStyle("/static/js/file_viewer/components/highlight_action_bar_button.module.out-vflc93YdQ.css",(e=>"._highlight-action-bar-button_1ygwc_1{background-color:var(--color__elevated__background);pointer-events:all}"));const Fm=({icon:e,label:t,...n})=>Ye.default.createElement(i.IconButton,{className:"_highlight-action-bar-button_1ygwc_1","aria-label":t,variant:"outline",...n},Ye.default.createElement(i.UIIcon,{src:e}));Fm.displayName="HighlightActionBarButton";const Om=Ye.default.lazy((async()=>{const{CommentsPluginPane:t}=await new Promise((function(t,i){e(["./c_file_viewer_comments2_plugin_pane"],t,i)}));return{default:t}}));Om.displayName="LazyCommentsPluginPane";const Um=()=>Ye.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},Ye.default.createElement(i.Spinner,{className:"comments-blade-loading-spinner",size:"standard"}));Um.displayName="LoadingIndicator";const Vm=Ye.default.lazy((async()=>{const{CommentsMeatball:t}=await new Promise((function(t,i){e(["./c_file_viewer_comments2_meatball_menu"],t,i)}));return{default:t}}));Vm.displayName="LazyCommentsMeatball";const Bm=Ye.default.lazy((async()=>{const{CommentMarkers:t}=await new Promise((function(t,i){e(["./c_file_viewer_comments2_comment_markers"],t,i)}));return{default:t}}));Bm.displayName="LazyCommentMarkers";const zm=Ye.default.lazy((async()=>{const{CommentsPluginDrawer:t}=await new Promise((function(t,i){e(["./c_file_viewer_comments2_plugin_comments_drawer"],t,i)}));return{default:t}}));zm.displayName="LazyCommentsDrawer";const Hm=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(Vm,{...e}));Hm.displayName="AsyncCommentsMeatball";const Wm=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:Ye.default.createElement(Um,null)},Ye.default.createElement(Om,{...e}));Wm.displayName="AsyncCommentsPluginPane";const Km=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(Bm,{...e}));Km.displayName="AsyncCommentMarkers";const Gm=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(zm,{...e}));Gm.displayName="AsyncCommentsDrawer";const jm=e=>{let t,n;const a=b.useSetRightSidebarCallback(b.COMMENTS_PLUGIN_ID,i.UserActionContext.SurfaceGesture);switch(e){case Dm.FULL_PREVIEW:t=a,n=i.UserActionContext.Sidebar;break;case Dm.QUICK_VIEW:t=()=>{},n=i.UserActionContext.QuickViewCommentPlugin;break;default:t=()=>{},n=i.UserActionContext.Sidebar}const r=b.useSeekCallback(),o=b.useSeekRelativeCallback(),s=b.useNavigateToPageCallback(n),l=b.usePauseCallback();return Ye.default.useMemo((()=>({openCommentStreamUI:t,seek:r,seekRelative:o,navigateToPage:s,pause:l})),[s,t,l,r,o])};function qm(e){var n;const{apiV2Client:a,commentsPlatformAdapter:o,user:s,reportException:l,commentsPluginInitialParams:d,useLogEvent:c,comments2024Experiments:u,commentSurface:m,showSnackbar:p}=e,f=null==d?void 0:d.commentId,g=null!==(n=null==d?void 0:d.shouldFocusComment)&&void 0!==n&&n,v=(e=>{const{comments2024PixelCommenting:t,previewsLoggedOutCommenting:i,comments2024CopyLinkToComment:n,comments2024VisualRefresh:a,commentsInQuickView:r}=e;return{isPixelCommentingEnabled:t===Je.ON,isLoggedOutCommentingEnabled:i===Je.ON,isCopyLinkToCommentEnabled:n===Je.ON,isVisualRefreshEnabled:a===Je.ON,commentsInQuickViewEnabled:r===Je.ON}})(u);let h;const w=new Set,y=()=>{const{fileViewerId:e}=i.useFileViewerContext(),t=jm(m),n=Ye.default.useCallback((()=>(h||(h=new Promise((n=>{if(!t)return;const r=((e,t)=>({getState:i,dispatch:n})=>a=>r=>{var o;switch(a(r),r.type){case $r.ResolveNavigationToActiveThreadAnnotation:return;case $r.ActivateThread:{const{fileId:a,sharedLinkURL:s}=r.payload,l=i();for(const i of Object.getOwnPropertyNames(l.pendingNavigationToActiveThreadAnnotation)){if(i===e){const e=Pc(a,s),r=l.activeThreadID[i],d=null===(o=l.threads[e])||void 0===o?void 0:o[r];if(d&&d.annotation){const e=d.annotation;if("document"===e.type){const i=om(e.regions[0])?void 0:e.regions[0].y+e.regions[0].height/2;t.navigateToPage((e.regions[0].page||1)-1,i?{offsetType:"percentage",centerOnYPercentageOffset:i}:void 0)}"audio"!==e.type&&"video"!==e.type||t.seek(e.time),t.openCommentStreamUI(),n(no(i))}}break}break}case $r.ConfirmDraftAnnotation:return void t.openCommentStreamUI()}})(e,t);n(function({apiv2ClientBase:e,boltIOClient:t,mentionsIOClient:n},a){const r=[xc(i.GetFilesRoutes(e)),Yr((o=e,o.ns("comments2"))),Nc(t),Vc()];var o;n&&r.push(Mc(n)),a&&r.push(...a);const s=i.applyMiddleware(...r),l=window.__REDUX_DEVTOOLS_EXTENSION__,d=null==l?s:i.compose(s,l({name:"FVSDK Comments2 Plugin"}));return i.createStore(ju,d)}({apiv2ClientBase:a,boltIOClient:o.boltIOClient,mentionsIOClient:o.mentionsIOClient},[r,Rm]))}))),h)),[e,t]),[r,s]=Ye.default.useState(null);return Ye.default.useEffect((()=>{n().then(s)}),[e,n]),r},E=()=>{const e=i.useRootFile(),t=i.useSharedLinkInfo(),n=y(),a=null==s?void 0:s.id,r=Ye.default.useCallback((()=>{if(!n||!e)return;w.add(e.fileId);const i=e.url||(null==t?void 0:t.url)||void 0;if(i){const e={include_permissions:!0,stream:{identifier:{".tag":"shared_link_details",url:i},type:{".tag":"file"}}};a?n.dispatch(br({arg:e})):n.dispatch(Lr({arg:e}))}else n.dispatch(br({arg:{include_permissions:!0,stream:{identifier:{".tag":"file_path_or_id",file_path_or_id:e.fileId},type:{".tag":"file"}}}}))}),[e,null==t?void 0:t.url,n,a]);Ye.default.useEffect((()=>{e&&!w.has(e.fileId)&&r()}),[r,e])},S=()=>{const e=y(),{fileViewerId:t}=i.useFileViewerContext(),n=Ye.default.useCallback((()=>{((e,t)=>{e&&e.getState().annotationSettings.state&&(e.getState().annotationSettings.state&&e.dispatch(io(t)),e.dispatch(Zr({fileViewerId:t})),e.dispatch(eo(t,null)))})(e,t)}),[t,e]);return[ie.getKeyboardBinding({key:i.Key_enum.Key.Escape,callback:n})]},C=(e,t)=>_.useLogExposure(e,t,!0),I=(e,n,a,r,o,s)=>{if(null==r)return void n.dispatch(io(e));const l=function(e,t,n){if(null==n)return null;const{regions:a,type:r}=n;return e===i.PreviewType.Image?"rectangle"!==r&&"point"!==r?null:{type:"image",region:a[0],regionType:r}:e===i.PreviewType.SsrDoc&&null!=t?{type:"document",regionType:r,regions:a.map((e=>({...e,page:x_(t)})))}:null}(s,o,r);null!=l&&(n.dispatch(function(e,t){return{type:$r.UpdateDraftAnnotation,payload:{fileViewerId:e,annotation:t}}}(e,l)),a({event:t.CommentsEventName.START_ANNOTATION_HIGHLIGHT}))},T=(e,i,n)=>{i.dispatch(to(e)),n({event:t.CommentsEventName.START_ANNOTATION_TIMESTAMP})},A={commentUI:{VideoSeekBarLayer:e=>{const t=y();return t?Ye.default.createElement(i.Provider,{store:t},Ye.default.createElement(Km,{...e})):null},CommentIconWithUnreadCount:e=>{E();const t=y(),n=b.useSetRightSidebarCallback(b.COMMENTS_PLUGIN_ID,i.UserActionContext.UnreadComments),a=b.useSetRightSidebarCallback(b.COMMENTS_PLUGIN_ID,i.UserActionContext.LoggedOutCommenting);return t?Ye.default.createElement(i.Provider,{store:t},Ye.default.createElement(Pm,{fileId:e.fileId,sharedLinkURL:e.sharedLinkURL,setCommentsSidebar:e=>{e===i.UserActionContext.UnreadComments?n():e===i.UserActionContext.LoggedOutCommenting&&a()},comments2024FeatureFlags:v})):null},mediaScrubber:{clickOutsideMarkers:e=>{null==h||h.then((t=>t.dispatch(Zr({fileViewerId:e}))))}}}},k={sidebarUI:{Icon:()=>{const e=i.useRootFile(),t=y();return(null==e?void 0:e.fileId)&&t?Ye.default.createElement(i.Provider,{store:t},Ye.default.createElement(Pm,{fileId:e.fileId,sharedLinkURL:e.url})):null},Title:()=>{const e=r.useIntl();return Ye.default.createElement(Ye.default.Fragment,null,e.formatMessage({id:"extqcT",defaultMessage:"Comments"}))},TitleAccessory:()=>{const e=i.useRootFile(),t=y(),n=c();return(null==e?void 0:e.fileId)&&t?Ye.default.createElement(i.Provider,{store:t},Ye.default.createElement(Hm,{fileId:e.fileId,sharedLinkURL:e.url,size:"standard",logEvent:n})):null},Content:()=>{C("comments_2024_visual_refresh",u.comments2024VisualRefresh),C("comments_2024_copy_link_to_comment",u.comments2024CopyLinkToComment),E();const{fileViewerId:t}=i.useFileViewerContext(),n=x.useRightSidebarId();M.useRecordPreviewsTimerOnMount(t,i.PreviewsTimer.SidebarContentsMount,{bladeId:b.COMMENTS_PLUGIN_ID},n===b.COMMENTS_PLUGIN_ID);const a=i.useRootFile(),r=y(),d=c(),_=i.useRootPreviewType(),h=x.useRootDocUi(),w=x.useRootAudioVideoUi();Ye.default.useEffect((()=>()=>{null!=(null==r?void 0:r.getState().annotationSettings.state)&&(null==r||r.dispatch(io(t)))}),[t,r]);const I=S(),T=jm(m),A=i.useSharedLinkInfo(),k=(()=>{const[t,i]=Ye.default.useState(void 0);return Ye.default.useEffect((()=>{m===Dm.FULL_PREVIEW&&(async()=>{const{asyncImportShowCopyLinkUICallback:t,handleCopyLinkClick:n}=e,a=await t(),r=(e,t)=>n(a,e,t);i((()=>r))})()}),[]),t})();return a&&r?Ye.default.createElement(i.Provider,{store:r},Ye.default.createElement(ie.KeyboardBindingConnector,{name:"comment_plugin",keyboardBindings:I}),Ye.default.createElement(Wm,{fileViewerId:t,file:a,previewType:_,docUi:h,audioVideoUi:w,navigationCallbacks:T,user:s,reportException:l,logEvent:d,sharedLinkInfo:A,comments2024FeatureFlags:v,reactionsBoltIOClient:o.reactionsBoltIOClient,showSnackbar:p,handleCopyLinkClick:k,commentId:f,shouldFocusComment:g})):null}}},N={layerUI:{Layer:e=>{E();const t=i.useRootPreviewType(),n=y(),{fileViewerId:a}=i.useFileViewerContext(),r=c(),o=Ce.useIsCommentsModeActive();C("comments_2024_pixel_commenting",u.comments2024PixelCommenting);const d=Ye.default.useCallback((()=>{n&&T(a,n,r)}),[a,r,n]),_=Ye.default.useCallback(((e,i)=>{n&&I(a,n,r,e,i,t)}),[a,r,t,n]),p=i.useRootFile(),f=jm(m);return p&&n&&o?Ye.default.createElement(i.Provider,{store:n},Ye.default.createElement(Mm,{...e,fileViewerId:a,navigationCallbacks:f,file:p,handleAnnotationConfirm:d,handleRegionSelection:_,user:s,reportException:l,logEvent:r,comments2024FeatureFlags:v,viewOnly:m===Dm.QUICK_VIEW})):null}},highlightMenuOption:({selectedText:e})=>{const t=r.useIntl(),n=i.useRootPreviewType(),a=y(),{fileViewerId:o}=i.useFileViewerContext(),s=c(),l=Ye.default.useCallback((()=>{a&&(I(o,a,s,{type:"highlight",regions:e.selectionAreas.map((t=>Ie.createNormalizedRegion(t,e.page.bounds)))},e.page.pageNumber,n),T(o,a,s))}),[o,s,n,e.page.bounds,e.page.pageNumber,e.selectionAreas,a]);return Ye.default.createElement(Fm,{label:t.formatMessage({id:"DwVkLn",defaultMessage:"Comment on text"}),icon:L.CommentLine,onClick:l})},allowLayers:["imageLayer","highlightLayer","pluginOverlay","linksLayer"],textHighlighterId:b.COMMENTS_PLUGIN_ID},P={CommentsDrawer:e=>{E();const t=y(),{fileViewerId:n}=i.useFileViewerContext(),a=jm(m),r=i.useRootFile(),o=i.useRootPreviewType(),d=c();return r&&t?Ye.default.createElement(i.Provider,{store:t},Ye.default.createElement(Gm,{fileViewerId:n,file:r,previewType:o,navigationCallbacks:a,user:s,reportException:l,logEvent:d,comments2024FeatureFlags:v,...e})):null}};switch(m){case Dm.FULL_PREVIEW:return{...A,...k,...N};case Dm.QUICK_VIEW:return{...A,...N,...P};default:return Ce.exhaustiveCheck(m)}}const Qm=e=>{h.reportException({err:e,force:!0,tags:["comments-blade-previews"]})},Ym=({apiV2Client:e,previewSurface:t,file:n,previewContentOnly:a,commentsPluginInitialParams:r,user:o,sharedLinkInfo:s})=>{const{comments2024Experiments:l,isLoading:c}=(e=>{const{variant:t,isLoading:n}=i.useExperimentVariant("comments_2024_q2_revamp"),{variant:a,isLoading:r}=i.useExperimentVariant("comments_2024_pixel_commenting"),{variant:o,isLoading:s}=i.useExperimentVariant("comments_2024_copy_link_to_comment"),{variant:l,isLoading:d}=i.useExperimentVariant("comments_2024_visual_refresh"),{variant:c,isLoading:u}=i.useExperimentVariant("previews_logged_out_commenting_fe"),{variant:_,isLoading:m}=i.useExperimentVariant("comments_in_quick_view_2024"),p=(null==e?void 0:e.allowLoggedOutCommenting)?c:Je.OFF;return Ye.default.useMemo((()=>({comments2024Experiments:{comments2024Q2Revamp:null!=t?t:Je.OFF,comments2024PixelCommenting:null!=a?a:Je.OFF,previewsLoggedOutCommenting:null!=p?p:Je.OFF,comments2024CopyLinkToComment:null!=o?o:Je.OFF,comments2024VisualRefresh:null!=l?l:Je.OFF,commentsInQuickView:null!=_?_:Je.OFF},isLoading:n||r||s||d||u||m})),[_,t,a,p,o,l,n,r,s,d,u,m])})(s),{config:u,isLoading:_}=Ee.useContactsSearchConfig(null==o?void 0:o.id),m=Ye.default.useCallback(((e,t,a)=>{if(!o)return;e({browseFile:n,user:o,filePath:n.file_id,setIsCreatingSharedLink:()=>{},anchorRef:t,userActionSurfaceLogValue:i.ActionSurfaceLogValue.COMMENTS_SIDEBAR,zIndexOverride:500,yOffsetDistance:8,commentId:a})}),[o,n]),p=Ye.default.useMemo((()=>{if(_||c||a||d.is_supported_mobile_browser())return;if(!N.shouldShowCommentsForPreviewSurface(t)||!u)return;const n=$n(o,u),s=o?function(e){return{id:e.account_id,userId:e.id,name:{display:e.display_name,initials:i.getInitials(e.display_name),public:i.getShortName(e.display_name)},photoUrl:e.photo_circle_url}}(o):void 0;return qm({apiV2Client:e,commentsPlatformAdapter:n,user:s,reportException:Qm,commentsPluginInitialParams:r,useLogEvent:()=>{const{logUserAction:e}=i.useFileViewerContext();return Ye.default.useCallback((t=>{e(t.event,"right_sidebar",t.extra),ga(t)}),[e])},comments2024Experiments:l,commentSurface:Dm.FULL_PREVIEW,showSnackbar:e=>function(e,t){setTimeout((()=>{i.Snackbar.complete(Ye.default.createElement(i.Snackbar,{title:e,id:"comments-fv-snackbar"}),t)}),0)}(e,i.PREVIEWS_SNACKBAR_ID),asyncImportShowCopyLinkUICallback:be.getShowCopyLinkMiniModalCallback,handleCopyLinkClick:m})}),[_,c,a,t,u,o,e,r,l,m]);return Ye.default.useMemo((()=>{const e=i.getFilename(n);if(Ce.isSupportedPreviewType(e))return p}),[p,n])},$m=r.defineMessage({id:"k2Cs7f",defaultMessage:"{ownerName} & {receiverName} shared folder"});i.injectInternalStyle("/static/metaserver/static/js/file_viewer/text_editor/plugin.module.out-vflRQUuG7.css",(e=>"._spinnerContainer_tw3fw_1{align-items:center;display:flex;height:100%;justify-content:center;width:100%}"));const Xm=a.lazy((async()=>{const{TextEditorLayer:t}=await new Promise((function(t,i){e(["./c_file_viewer_text_editor_layers"],t,i)}));return{default:t}})),Zm=ke.He.div`
  display: flex;
  align-items: center;
  justify-content: center;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
`,Jm=()=>Ye.default.createElement(Zm,null,Ye.default.createElement(i.Spinner,{size:"standard"}));function ep(){const e=new Uint8Array(16);window.crypto.getRandomValues(e);return`a${Array.from(e).map((e=>e.toString(16).padStart(2,"0"))).join("")}`}Jm.displayName="LoadingScreen";const tp=i.lazyAfterDisplay((async()=>{const{Layer:t}=await new Promise((function(t,i){e(["./c_pdf_editor_plugin_layer.after-display"],t,i)}));return{default:t}}));class ip{constructor(e,t,i,n,a){this.fullscreenLayer=({activationParams:e,file:t})=>{const i=r.useIntl();Ye.default.useEffect((()=>(this.setIsPdfEditorActive(!0),()=>this.setIsPdfEditorActive(!1))),[]);const n=this.user;return Ye.default.useEffect((()=>{n&&Ne.markModuleAsCompleted(n,"edit_pdf_milestone")}),[n]),t?Ye.default.createElement(Ye.default.Suspense,{fallback:Ye.default.createElement(Jm,null)},Ye.default.createElement(tp,{file:t,intl:i,user:n,nonce:this.nonce,activationParams:e,encryptionOptions:this.encryptionOptions,readOnly:this.readOnly,sharedLinkInfo:this.sharedLinkInfo})):null},this.nonce=ep(),this.readOnly=e,this.user=i,this.setIsPdfEditorActive=n,this.encryptionOptions=a,this.sharedLinkInfo=t}}i.injectInternalStyle("/static/typescript/component_libraries/photo-editor/src/components/loading.module.out-vflJk0JYG.css",(e=>"._loading_t585w_1{background-color:#000}._loading_t585w_1,._loading--integrated-editor_t585w_11{align-items:center;display:flex;flex-direction:column;height:100%;justify-content:center;width:100%}._loading--integrated-editor_t585w_11{background:var(--dig-color__background__subtle)}"));function np({integratedEditor:e}){const{loadingAriaLabel:t}={loadingAriaLabel:r.useIntl().formatMessage({id:"I2tb5f",defaultMessage:"Loading"})};return Ye.default.createElement("div",{className:e?"_loading--integrated-editor_t585w_11":"_loading_t585w_1"},Ye.default.createElement(i.Spinner,{"aria-valuetext":t,size:"standard"}))}const ap=i.lazyAfterDisplay((async()=>{const{PhotoEditor:t}=await new Promise((function(t,i){e(["./c_photo-editor_layout_photo_editor.after-display"],t,i)}));return{default:t}}));class rp{constructor(e,t,i){this.user=e,this.onImageChanged=t,this.encryptionOption=i,this.integratedEditor=!1}}class op extends rp{constructor(e,t,n){super(e,t,n),this.user=e,this.onImageChanged=t,this.encryptionOptions=n,this.layerUI={Layer:({activationParams:e})=>{const{logUserAction:t}=i.useFileViewerContext(),{previewsImageEnhancements:n}=m.useImageEnhancements(this.user),r=i.useRootFile(),o=i.useRootPreviewMetadata();p.removeFragmentFromURL("#edit"),p.removeQueryParams(["edit",p.INITIAL_ACTION_QUERY_PARAM]);const{variant:s}=i.useExperimentVariant("previews_toolbar_optimization"),l=i.useSharedLinkInfo(),d=Ye.default.useCallback(((e,i,n)=>{t(e,i,{actionSurface:"image_edit",...n})}),[t]),c=Ye.default.useMemo((()=>this.onImageChanged||(()=>{})),[]),u=b.useExitEditModeCallback(),_=b.useResetPreviewCallback(),f=b.useCloseViewerCallback(),g=a.useMemo((()=>({exit:u,onImageChanged:c,resetPreview:_,logUserAction:d,redirectToFile:(e,t)=>{i.redirect(i.preview_uri_for_fq_path(this.user,e,t))},closeViewer:()=>f(i.UserActionContext.Editor)})),[_,u,f,c,d]),v=Ye.default.useMemo((()=>performance.now()),[]);return r?Ye.default.createElement(a.Suspense,{fallback:Ye.default.createElement(np,{integratedEditor:this.integratedEditor})},Ye.default.createElement(ap,{previewsToolbarOptimizationVariant:s,user:this.user,imageFile:r,imagePreviewUrl:o.preview_url,pluginApi:g,sharedLinkInfo:l,integratedEditor:this.integratedEditor,editorInitializationTimeMs:v,activationParams:e,entryPoint:Le.EntryPoint.PREVIEWS,previewsImageEnhancements:n,encryptionOption:this.encryptionOption})):null}},this.editUI={},this.shouldReplacePreview=!0,this.allowTitleBar=!0,this.integratedEditor=!0}}const sp={layerUI:{Layer:()=>null},editUI:{},allowTitleBar:!0},lp="@@apiv2_redux/file_viewer/watermarking/watermark_file",dp="@@apiv2_redux/file_viewer/watermarking/watermark_file_result",cp=va(lp),up=ha({[lp]:{endpoint:"watermarking/watermark_file",action:va(dp)}});const _p=(e,t)=>{const{mode:i,textWatermarkOptions:n,imageWatermarkOptions:a}=t;return"image"===i[e]?a[e]:n[e]},mp=e=>e.toDataURL().split(",",2).pop(),pp=({dispatch:e,getState:t})=>i=>n=>{if("ApplyWatermark"===n.type){const{fileViewerId:i,file:a,overwrite:r}=n.payload,{mode:o,textWatermarkOptions:s,imageWatermarkOptions:l}=t(),d=o[i],c=s[i],u=l[i],_=_p(i,t()),{position:m,marginX:p,marginY:f}=_,g={path:a.fileId,overwrite:r};if("REPEAT"===m){const{canvas:e,distanceX:t,distanceY:i,startX:n,startY:a,offsetXPerRow:r,offsetYPerCol:o}=Re.tilingFunc({scale:c.scale,mode:d,textWatermarkOptions:c,imageWatermarkOptions:u}),s=mp(e);if(null==s)return;g.tiled_image={image:s,distance_x:Math.round(t),distance_y:Math.round(i),start_x:Math.round(n),start_y:Math.round(a),offset_x_per_row:Math.round(r),offset_y_per_col:Math.round(o)}}else{let e;if("text"===d){const{text:t,size:i,scale:n,fontFamily:a,color:r,opacity:o,angle:s}=c;e=Re.drawTextTile({text:t,size:i*n,fontFamily:a,color:r,opacity:o,angle:s}).canvas}else{const{image:t,size:i,scale:n,opacity:a,angle:r}=u;if(null==t)return;e=Re.drawImageTile({image:t,scale:i*n,opacity:a,angle:r}).canvas}const t=mp(e);if(null==t)return;g.image_watermark={image:t,position:m,margin_x:Math.round(p),margin_y:Math.round(f)}}e(cp({arg:g},{fileViewerId:i,fqPath:a.fqPath}))}i(n)},fp=e=>e===i.PreviewType.SsrDoc?300/72:1,gp={status:(e={},t)=>{var i;if(t.type===dp){const n=null===(i=t.meta)||void 0===i?void 0:i.fileViewerId;if(null!=n){if(t.error)return{...e,[n]:{state:"errored",error:t.error}};if(t.payload)return{...e,[n]:{state:"loaded",data:t.payload}}}return e}return"ApplyWatermark"===t.type?{...e,[t.payload.fileViewerId]:{state:"pending"}}:"InitializeWatermarkPlugin"===t.type||"SetStatusReady"===t.type?{...e,[t.payload.fileViewerId]:{state:"ready"}}:e},mode:(e={},t)=>"SetMode"===t.type?{...e,[t.payload.fileViewerId]:t.payload.mode}:"InitializeWatermarkPlugin"===t.type?{...e,[t.payload.fileViewerId]:"text"}:e,imageWatermarkOptions:(e={},t)=>{if("SetImageWatermarkOptions"===t.type){const{fileViewerId:i,options:n}=t.payload;return{...e,[i]:{...e[i],...n}}}if("InitializeWatermarkPlugin"===t.type){const{fileViewerId:i,previewType:n}=t.payload;return{...e,[i]:{image:void 0,position:"REPEAT",angle:45,angleStep:15,opacity:.3,size:.0464,marginX:40,marginY:40,scale:fp(n),minSize:.2,maxSize:5}}}return e},textWatermarkOptions:(e={},t)=>{if("SetTextWatermarkOptions"===t.type){const{fileViewerId:i,options:n}=t.payload;return{...e,[i]:{...e[i],...n}}}if("InitializeWatermarkPlugin"===t.type){const{fileViewerId:i,previewType:n}=t.payload;return{...e,[i]:{text:"DRAFT",color:"dark",position:"REPEAT",angle:45,angleStep:15,opacity:.3,size:20,lineHeight:3,fontFamily:"Helvetica, sans-serif",marginX:40,marginY:40,scale:fp(n),minSize:5,maxSize:200}}}return e}},vp=({apiv2ClientBase:e,onWatermarkingSuccessHandler:t})=>{const n=i.combineReducers(gp),a=[pp,up((r=e,r.ns("file_viewer")))];var r;return t&&a.push((e=>({})=>t=>i=>{var n;if(i.type===dp&&!i.error&&i.payload.result){const a=t(i),r=i.payload.result.fq_path||(null===(n=i.meta)||void 0===n?void 0:n.fqPath);return e({fqPath:r,overwrite:i.payload.arg.overwrite}),a}return t(i)})(t)),i.createStore(n,i.applyMiddleware(...a))},hp=i.lazyAfterDisplay((async()=>{const{WatermarkingPane:t}=await new Promise((function(t,i){e(["./c_plugin_components_watermarking_pane.after-display"],t,i)}));return{default:t}})),wp=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:Ye.default.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},Ye.default.createElement(i.Spinner,null))},Ye.default.createElement(hp,{...e}));wp.displayName="AsyncWatermarkingPane";const yp=Ye.default.lazy((async()=>{const{WatermarkingLayer:t}=await new Promise((function(t,i){e(["./c_plugin_components_watermarking_layer"],t,i)}));return{default:t}})),Ep=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(yp,{...e}));Ep.displayName="AsyncWatermarkingLayer";class Sp{constructor(e,t){this.getStore=()=>(this.storePromise||(this.storePromise=new Promise((e=>{e(vp({apiv2ClientBase:this.apiV2Client,onWatermarkingSuccessHandler:this.onWatermarkingSuccessHandler}))}))),this.storePromise),this.layerUI={Layer:e=>{const{fileViewerId:t}=i.useFileViewerContext(),{titleBarActionSetters:n}=M.useTitlebarEditorActions(),[a,r]=Ye.default.useState(null);return Ye.default.useEffect((()=>{this.getStore().then(r)}),[]),!a||e.previewType!==i.PreviewType.Image&&e.previewType!==i.PreviewType.SsrDoc&&e.previewType!==i.PreviewType.CloudDoc?null:Ye.default.createElement(i.Provider,{store:a},Ye.default.createElement(Ep,{fileViewerId:t,titleBarActionSetters:n,...e}))}},this.useCurrentDocFirstPageDimensions=e=>{const t=i.useFileViewerSelector(i.getCurrentPreviewKey,e),n=i.useCurrentPreviewMetadata(),a=i.useSsrDocPages(t,n),r=null==a?void 0:a[0].dimension[0],o=null==a?void 0:a[0].dimension[1];if(r&&o)return{width:r,height:o}},this.editUI={Sidebar:e=>{const t=r.useIntl(),{fileViewerId:n,logUserAction:a}=i.useFileViewerContext(),o=i.useRootPreviewType(),[s,l]=Ye.default.useState(null);Ye.default.useEffect((()=>{this.getStore().then(l)}),[]),Ye.default.useEffect((()=>{null==s||s.dispatch((({fileViewerId:e,previewType:t})=>({type:"InitializeWatermarkPlugin",payload:{fileViewerId:e,previewType:t}}))({fileViewerId:n,previewType:o})),a(ve.WorkflowsEvent.WatermarkStart,"top_nav_meatball_menu")}),[n,o,a,s]);const d=this.useCurrentDocFirstPageDimensions(n),c=x.useRootDocUi(),u=x.useRootImageUi(),_=i.useRootFile(),m=b.useExitEditModeCallback(),p=b.useResetPreviewCallback(),{titleBarActionSetters:f}=M.useTitlebarEditorActions();return s&&_?Ye.default.createElement(i.Provider,{store:s},Ye.default.createElement(wp,{file:_,previewType:o,intl:t,fileViewerId:n,exitEditModeCallback:m,resetPreviewCallback:p,currentDocFirstPageDimensions:d,docUi:c,imageUi:u,titleBarActionSetters:f,...e})):null}},this.mode={type:"edit"},this.allowTitleBar=!0,this.apiV2Client=e,this.onWatermarkingSuccessHandler=t,this.storePromise=void 0}}const bp=()=>{},Cp=({user:e,file:t,sharePermission:n,featureConfig:r,previewSurface:o,previewContentOnly:s,setIsPdfEditorActive:l,onFileChanged:c=bp,apiV2Client:u,encryptionOptions:_,sharedLinkInfo:p})=>{const f=[i.SDKPreviewSurface.VERSION_HISTORY,i.SDKPreviewSurface.BACKUP,i.SDKPreviewSurface.SHARED_LINK_EMBED,i.SDKPreviewSurface.TRANSFER,i.SDKPreviewSurface.UNKNOWN,i.SDKPreviewSurface.LOW_DISTRACTION_VIEW,i.SDKPreviewSurface.DESKTOP_PREVIEW].includes(o),g=at({file:t,sharePermission:n,user:e}),v=Ye.default.useMemo((()=>g?sp:void 0),[g]),h=i.useCanWatermarkFile({file:t,user:e}),w=Ye.default.useMemo((()=>h?((e,t,n)=>new Sp(t,(({fqPath:t,overwrite:a})=>{a&&n===i.SDKPreviewSurface.BROWSE||(t&&e?i.replace_location(i.preview_uri_for_fq_path(e,t,{context:i.SourceContext.Workflow})):i.reload())})))(e,u,o):void 0),[u,o,h,e]),y=Pe.showEditPlugin(t,n),E=Ye.default.useMemo((()=>y?new op(e,c,_):void 0),[_,c,y,e]),S=m.showTextEditPlugin(t,n),C=Ye.default.useMemo((()=>S?((e,t,n)=>({layerUI:{Layer:r=>Ye.default.createElement(a.Suspense,{fallback:Ye.default.createElement("div",{className:"_spinnerContainer_tw3fw_1"},Ye.default.createElement(i.Spinner,{size:"large"}))},Ye.default.createElement(Xm,{...r,user:e,file:t,onFileChanged:n}))},editUI:{},allowTitleBar:!0}))(e,t,c):void 0),[t,c,S,e]),I=Pe.showEditPlugin$1(t,n,!0),T=i.isBrowseFile(t)&&!!t.read_only,x=Ye.default.useMemo((()=>{const t=!e;return o!==i.SDKPreviewSurface.FSS_DESKTOP_PREVIEW&&(e||t)&&I?new ip(T,p,e,l,_):void 0}),[_,T,I,o,l,p,e]);return Ye.default.useMemo((()=>f||d.is_supported_mobile_browser()||s?{}:{[b.VIDEO_EDITOR_PLUGIN_ID]:v,[m.WATERMARKING_PLUGIN_ID]:w,[b.PHOTO_EDITOR_PLUGIN_ID]:E,[b.PDF_EDITOR_PLUGIN_ID]:x,[b.TEXT_EDITOR_PLUGIN_ID]:C}),[f,x,E,s,v,w,C])},Ip=["Fetch network failure - message aborted or user offline","invalid_csrf_token","invalid_logged_out_cookie","too_many_requests","no_file"];function Tp(e){return e.ns("previews_ai")}const xp="ai_blade_consent";var Ap,Mp,kp;t.AIBladePages=void 0,(Ap=t.AIBladePages||(t.AIBladePages={})).BROWSE="BROWSE",Ap.PREVIEWS="PREVIEWS",t.CheckFileStatus=void 0,(Mp=t.CheckFileStatus||(t.CheckFileStatus={})).Passed="passed",Mp.Failed="failed",Mp.Removed="removed",Mp.Loading="loading",t.AIBladeActions=void 0,(kp=t.AIBladeActions||(t.AIBladeActions={})).SET_CURRENT_QUERY="SET_CURRENT_QUERY",kp.SET_IS_LOADING="SET_IS_LOADING",kp.SET_RESULT="SET_RESULT",kp.START_GET_SUMMARY="START_GET_SUMMARY",kp.START_GET_ANSWER="START_GET_ANSWER",kp.RESET_STATE="RESET_STATE",kp.SET_SHOW_CONSENT_MODAL="SET_SHOW_CONSENT_MODAL",kp.SET_HAS_CONSENTED="SET_HAS_CONSENTED",kp.SET_SHOW_AICC_BANNER="SET_SHOW_AICC_BANNER",kp.SET_CHECK_FILE_STATUS="SET_CHECK_FILE_STATUS";const Np=(e,i)=>{var n;switch(i.type){case t.AIBladeActions.SET_CURRENT_QUERY:return{...e,currentQuery:i.payload.currentQuery};case t.AIBladeActions.SET_IS_LOADING:return{...e,isLoading:i.payload.isLoading};case t.AIBladeActions.SET_RESULT:return{...e,result:i.payload.result,isLoading:!1};case t.AIBladeActions.START_GET_SUMMARY:return{...e,currentQuery:{type:"SUMMARY"},result:void 0};case t.AIBladeActions.START_GET_ANSWER:return{...e,currentQuery:{type:"ANSWER",query:i.payload.query},result:void 0};case t.AIBladeActions.RESET_STATE:return{...e,isLoading:!1,currentQuery:void 0,result:void 0,checkFileStatus:{}};case t.AIBladeActions.SET_SHOW_CONSENT_MODAL:return{...e,showConsentModal:i.payload.showConsentModal};case t.AIBladeActions.SET_HAS_CONSENTED:return{...e,hasConsented:i.payload.hasConsented};case t.AIBladeActions.SET_SHOW_AICC_BANNER:return{...e,showAiccBanner:i.payload.showAiccBanner};case t.AIBladeActions.SET_CHECK_FILE_STATUS:return{...e,checkFileStatus:{...e.checkFileStatus,[i.payload.fileName]:{status:i.payload.status,error:null===(n=i.payload)||void 0===n?void 0:n.error}}};default:return e}},Pp=Ye.default.createContext(void 0),Lp=Ye.default.createContext(void 0),Rp=({children:e,userId:t})=>{const n=!!t&&i.UserLocalStorage.get(t,xp),[a,r]=Ye.default.useReducer(Np,{currentQuery:void 0,isLoading:!1,result:void 0,hasConsented:n,showConsentModal:!1,showAiccBanner:!0,checkFileStatus:{}});return Ye.default.createElement(Pp.Provider,{value:a},Ye.default.createElement(Lp.Provider,{value:r},e))};Rp.displayName="AIBladeProvider";const Dp=()=>{const e=Ye.default.useContext(Pp);if(void 0===e)throw new Error("useAIBladestate must be used within a AIBladeProvider");return e},Fp=Ye.default.createContext(void 0),Op=({children:e,previewType:n,isSharedLink:r})=>{const{currentQuery:o}=Dp(),{logUserAction:s}=i.useFileViewerContext(),l=a.useRef(o);l.current=o;const c=Oe.useStabilizedCallback(((e,a={})=>{var o,d;s(e,i.UserActionContext.PreviewSidebar,{...a,preview_type:n,query_type:null!==(d=null===(o=l.current)||void 0===o?void 0:o.type)&&void 0!==d?d:"unknown",page:t.AIBladePages.PREVIEWS,is_shared_link_page:r?"true":"false",is_browse_page:"false"})})),u=Oe.useStabilizedCallback(((e,i={})=>{var a,r;Fe.getMetricsReporter().createStats({ns:"web_ai_blade",name:e},{preview_type:n,query_type:null!==(r=null===(a=l.current)||void 0===a?void 0:a.type)&&void 0!==r?r:"unknown",page:t.AIBladePages.PREVIEWS,...i}).record(1)})),_=Oe.useStabilizedCallback(((e,i,a={})=>{var r,o;Fe.getMetricsReporter().createStats({ns:"web_ai_blade",name:e},{preview_type:n,query_type:null!==(o=null===(r=l.current)||void 0===r?void 0:r.type)&&void 0!==o?o:"unknown",page:t.AIBladePages.PREVIEWS,...a}).recordDuration(i,d.TimeUnit.MILLISECONDS)})),m=a.useMemo((()=>({logUserAction:c,recordToAMIS:u,recordDurationToAMIS:_})),[c,u,_]);return Ye.default.createElement(Fp.Provider,{value:m},e)};Op.displayName="AIBladeLoggingProvider";const Up=Ye.default.lazy((async()=>{const{AIBlade:t}=await new Promise((function(t,i){e(["./c_dropbox_ai_assistant_file_viewer_plugin_ai_blade"],t,i)}));return{default:t}})),Vp=()=>Ye.default.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},Ye.default.createElement(i.Spinner,null));Vp.displayName="LazyBladeSpinner";const Bp=()=>{const e=r.useIntl();return Ye.default.createElement("div",{style:{width:"100%",height:"100%",padding:"0 16px"}},Ye.default.createElement(i.Text,{color:"error",isBold:!0},e.formatMessage({id:"ciK24m",defaultMessage:"Sorry, there was a problem"})))};Bp.displayName="AIPluginErrorFallback";const zp=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:Ye.default.createElement(Vp,null)},Ye.default.createElement(Up,{...e}));zp.displayName="LazyAsyncAIBlade";class Hp{constructor(e,t,n,a){var r;this.layerUI={},this.sidebarUI={Icon:()=>Ye.default.createElement(i.UIIcon,{src:R.Twinkle2Line}),Title:()=>Ye.default.createElement("div",null,"Dropbox AI"," ",Ye.default.createElement(i.Badge,null,"Alpha")),Content:()=>{var e;const t=i.useRootFile(),n=i.useRootPreviewType(),{fileViewerId:a}=i.useFileViewerContext();return t&&l.isAIBladeSupportedForFile(t.name)?Ye.default.createElement(Rp,{userId:this.user?this.user.id:void 0},Ye.default.createElement(i.ErrorBoundary$1,{componentTag:"previews-ai-blade",exceptionTags:["previews-ai","ai-blade"],reportMetrics:!0,fallback:Ye.default.createElement(Bp,null)},Ye.default.createElement(Op,{previewType:n,isSharedLink:Boolean(null===(e=null==this?void 0:this.sharedLinkInfo)||void 0===e?void 0:e.url)},Ye.default.createElement(zp,{fileViewerId:a,apiV2Client:this.apiV2Client,userApiProps:this.user,isTeamAdmin:!!this.user&&this.user.is_team_admin,checkFileWithCache:this.checkFileWithCache,callerId:"dropbox_web/previews",sharedLinkInfo:this.sharedLinkInfo})))):null}},this.apiV2Client=e,this.user=t,this.sharedLinkInfo=a,this.checkFileWithCache=(()=>{const e={};return(t,i)=>{var n;const a=i?{link_info:{url:i,encrypted_grant_book:it(i)},file:t}:{file:t};return e[t]=null!==(n=e[t])&&void 0!==n?n:Tp(this.apiV2Client).rpc("check_file",a,{}),e[t]}})(),this.checkFileWithCache(n,null===(r=null==this?void 0:this.sharedLinkInfo)||void 0===r?void 0:r.url)}}class Wp{constructor(e){this.category="web-transcript_feedback",this.user_id=null,this.user_agent=null,this.is_transcript_accurate=e.is_transcript_accurate,this.feedback=e.feedback,this.comments=e.comments,e.hasOwnProperty("user_id")&&void 0!==e.user_id&&(this.user_id=e.user_id),e.hasOwnProperty("user_agent")&&void 0!==e.user_agent&&(this.user_agent=e.user_agent)}}const Kp={GetActivityStream:"@@apiv2_redux/file_activity_stream/get_activity_stream",GetActivityStreamResult:"@@apiv2_redux/file_activity_stream/get_activity_stream_result",GetActivityStreamBatch:"@@apiv2_redux/file_activity_stream/get_activity_stream_batch",GetActivityStreamBatchResult:"@@apiv2_redux/file_activity_stream/get_activity_stream_batch_result",GetFileActivityState:"@@apiv2_redux/file_activity_stream/get_file_activity_state",GetFileActivityStateResult:"@@apiv2_redux/file_activity_stream/get_file_activity_state_result",RecentFilesWithLatestEvents:"@@apiv2_redux/file_activity_stream/recent_files_with_latest_events",RecentFilesWithLatestEventsResult:"@@apiv2_redux/file_activity_stream/recent_files_with_latest_events_result"},Gp=va(Kp.GetActivityStream),jp=va(Kp.GetActivityStreamResult),qp=va(Kp.GetActivityStreamBatchResult),Qp=va(Kp.GetFileActivityStateResult),Yp=va(Kp.RecentFilesWithLatestEventsResult),$p=ha({[Kp.GetActivityStream]:{endpoint:"get_activity_stream",action:jp},[Kp.GetActivityStreamBatch]:{endpoint:"get_activity_stream_batch",action:qp},[Kp.GetFileActivityState]:{endpoint:"get_file_activity_state",action:Qp},[Kp.RecentFilesWithLatestEvents]:{endpoint:"recent_files_with_latest_events",action:Yp}}),Xp="file_activity_blade_state";var Zp,Jp;t.EventState=void 0,(Zp=t.EventState||(t.EventState={})).loading="loading",Zp.error="error",Zp.loaded="loaded",t.FilterType=void 0,(Jp=t.FilterType||(t.FilterType={})).added="added",Jp.viewed="viewed",Jp.moved="moved",Jp.renamed="renamed",Jp.edited="edited",Jp.shared="shared",Jp.commented="commented";const ef=[t.FilterType.added,t.FilterType.viewed,t.FilterType.moved,t.FilterType.renamed,t.FilterType.edited,t.FilterType.shared,t.FilterType.commented],tf={filter:{},eventHistory:{}};function nf(e=tf,i){switch(i.type){case Kp.GetActivityStream:return{...e,eventHistory:{...e.eventHistory,[i.payload.arg.file_path_or_id]:{status:t.EventState.loading}}};case Kp.GetActivityStreamResult:return function(e,i){var n,a,r;const o=i.payload.arg.file_path_or_id;return i.error?{...e,eventHistory:{...e.eventHistory,[o]:{status:t.EventState.error,errorString:(null===(n=i.error)||void 0===n?void 0:n.message)||""}}}:{...e,eventHistory:{...e.eventHistory,[o]:{status:t.EventState.loaded,activity:(s=null!==(r=null===(a=i.payload.result)||void 0===a?void 0:a.activity_group)&&void 0!==r?r:[],s.reduce(((e,t)=>e.concat(t.activities)),[]))}}};var s}(e,i);case t.FileActivityActionTypes.SET_FILTER:return{...e,filter:i.filter};default:return e}}t.FileActivityActionTypes=void 0,(t.FileActivityActionTypes||(t.FileActivityActionTypes={})).SET_FILTER="FILE_ACTIVITY/SET_FILTER";const af=i.lazyAfterDisplay((async()=>{const{FileActivity:t}=await new Promise((function(t,i){e(["./c_file_activity_component_file_activity.after-display"],t,i)}));return{default:t}})),rf=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(af,{...e}));rf.displayName="AsyncFileActivity";const of=i.lazyAfterDisplay((async()=>{const{VersionHistoryMenu:t}=await new Promise((function(t,i){e(["./c_file_activity_component_version_history_menu.after-display"],t,i)}));return{default:t}})),sf=e=>Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(of,{...e}));sf.displayName="AsyncVersionHistoryMenu";const lf=({user:e,onOpenVersionHistory:t})=>{let n;const o=e=>(n||(n=new Promise((t=>{const n=function({apiV2Client:e}){const t=i.combineReducers({[Xp]:nf});return i.createStore(t,i.applyMiddleware($p(e.ns("file_activity_stream"))))}({apiV2Client:e});t(n)}))),n);return{sidebarUI:{Icon:()=>Ye.default.createElement(i.UIIcon,{src:Ve.FileHistoryLine}),Title:()=>{const e=r.useIntl();return Ye.default.createElement(Ye.default.Fragment,null,e.formatMessage({id:"g4fiTc",defaultMessage:"File Activity"}))},TitleAccessory:()=>{const{logUserAction:e}=i.useFileViewerContext(),n=a.useMemo((()=>t?{enabled:!0,onVersionHistoryClicked:()=>{t(),e(i.UserAction.VersionHistory,i.UserActionContext.PreviewSidebar)}}:{enabled:!1}),[e]);return n&&n.enabled?Ye.default.createElement(sf,{onVersionHistoryClicked:n.onVersionHistoryClicked,iconSize:"standard"}):null},Content:()=>{const{fileViewerId:t,logUserAction:n,apiV2Client:a}=i.useFileViewerContext(),r=x.useLeftSidebarId(),[s,l]=Ye.default.useState(null);Ye.default.useEffect((()=>{o(a).then(l)}),[a]),M.useRecordPreviewsTimerOnMount(t,i.PreviewsTimer.SidebarContentsMount,{bladeId:b.FILE_ACTIVITY_PLUGIN_ID},r===b.FILE_ACTIVITY_PLUGIN_ID);const d=i.useRootFile();return d&&s?Ye.default.createElement(i.Provider,{store:s},Ye.default.createElement(rf,{fileId:d.fileId,user:e,logUserAction:n})):null}}}};i.injectInternalStyle("/static/typescript/component_libraries/files_components/src/right-rail/index.module.out-vflV10oEC.css",(e=>"._rc-expanded-right-rail-container_x3imz_1{background-color:var(--dig-color__background__base);display:flex;flex-direction:column;height:100%;width:328px}._rc-right-rail-title-container_x3imz_11{align-items:center;display:flex;min-height:56px}._rc-collapsed-right-rail-container_x3imz_17>._rc-right-rail-title-container_x3imz_11{padding-left:var(--spacing__unit--1_5);padding-right:var(--spacing__unit--1_5)}._rc-expanded-right-rail-container_x3imz_1>._rc-right-rail-title-container_x3imz_11{padding-left:var(--spacing__unit--2);padding-right:var(--spacing__unit--1_5)}._rc-right-rail-title-container--title_x3imz_27{flex-grow:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}._rc-right-rail-title-container--collapse-button_x3imz_34{flex-shrink:0;padding-left:var(--spacing__unit--1_5)}._rc-right-rail-header-container_x3imz_39{display:flex;padding:0 var(--spacing__unit--2)}._rc-right-rail-content-container_x3imz_44{display:flex}._rc-collapsed-right-rail-container_x3imz_17{background-color:var(--dig-color__background__base);display:flex;flex-direction:column;height:100%;width:56px}._rc-collapsed-blade--container_x3imz_58{height:100%}._rc-collapsed-blade-icons-container_x3imz_62{align-items:center;border-top:1px solid var(--dig-color__border__base);display:flex;flex-direction:column;height:100%;min-height:0;padding-top:var(--spacing__unit--0_5)}._rc-collapsed-blade-icon_x3imz_62{margin-top:var(--spacing__unit--2);position:relative}._rc-right-rail-compact-content-wrapper_x3imz_77,._rc-right-rail-content-wrapper_x3imz_78{flex-grow:1;height:100%}._rc-right-rail-compact-content-menu-wrapper_x3imz_84,._rc-right-rail-compact-content-menu-wrapper_x3imz_84>div,._rc-right-rail-compact-content-wrapper_x3imz_77{height:100%;min-height:0;width:100%}._rc-right-rail-compact-content-wrapper_x3imz_77 ._rc-right-rail-content-wrapper_x3imz_78 ._rc-right-rail-compact-header_x3imz_93{cursor:pointer}._rc-right-rail-compact-menu_x3imz_97{margin-left:16px}._rc-collapsed-blade-icon--notification-badge_x3imz_101{left:16px;position:absolute;top:-2px}"));const df="_rc-expanded-right-rail-container_x3imz_1",cf="_rc-right-rail-title-container_x3imz_11",uf="_rc-collapsed-right-rail-container_x3imz_17",_f="_rc-right-rail-title-container--title_x3imz_27",mf="_rc-right-rail-title-container--collapse-button_x3imz_34",pf="_rc-right-rail-header-container_x3imz_39",ff="_rc-collapsed-blade--container_x3imz_58",gf="_rc-collapsed-blade-icons-container_x3imz_62",vf="_rc-collapsed-blade-icon_x3imz_62",hf="_rc-right-rail-compact-content-wrapper_x3imz_77",wf="_rc-right-rail-content-wrapper_x3imz_78",yf="_rc-right-rail-compact-content-menu-wrapper_x3imz_84",Ef="_rc-right-rail-compact-header_x3imz_93",Sf="_rc-right-rail-compact-menu_x3imz_97",bf="_rc-collapsed-blade-icon--notification-badge_x3imz_101",Cf=({className:e,children:t})=>Ye.createElement("div",{className:i.cx(pf,e)},t);Cf.displayName="Header",Cf.displayName="Header";const If={expandedPanels:new Set([]),variant:"standard"},Tf=Ye.createContext(If),xf=Ye.createContext({id:"",isActive:!1}),Af=({className:e,children:t,...n})=>Ye.createElement(Tf.Provider,{value:{expandedPanels:"blades"===n.variant?new Set([n.expandedPanel]):new Set(n.expandedPanels),variant:n.variant}},Ye.createElement("div",{className:i.cx("exp-dig-AccordionWrapper",e,{"exp-dig-AccordionWrapper--blades":"blades"===n.variant,"exp-dig-AccordionWrapper--standard":"standard"===n.variant})},t));Af.displayName="Wrapper";const Mf=({id:e,children:t})=>{const{expandedPanels:n}=Ye.useContext(Tf),a=n.has(e),r=Ye.useMemo((()=>({id:e,isActive:a})),[e,a]);return Ye.createElement(xf.Provider,{value:r},Ye.createElement("div",{className:i.cx("exp-dig-AccordionItem",{"exp-dig-AccordionItem--active":a})},t))};Mf.displayName="Item";const kf=({children:e,spacing:t="standard",className:n})=>Ye.createElement("div",{className:i.cx("exp-dig-AccordionPanel",{"exp-dig-AccordionPanel-spacing--small":"small"===t,"exp-dig-AccordionPanel-spacing--standard":"standard"===t,"exp-dig-AccordionPanel-spacing--large":"large"===t},n)},e);kf.displayName="Panel";const Nf=({withTitle:e,withLeftAccessory:t,withTitleRightAccessory:n,withSubtitle:a,size:r="standard",spacing:o="standard",onClick:s,className:l})=>{const{id:d,isActive:c}=Ye.useContext(xf),{variant:u}=Ye.useContext(Tf),_=Ye.useCallback((()=>{s&&s(d)}),[s,d]),m=Ye.useCallback((e=>{!s||13!==e.keyCode&&32!==e.keyCode||s(d)}),[s,d]);return Ye.createElement("div",{className:i.cx("exp-dig-AccordionHeader",{"exp-dig-AccordionHeader-spacing--standard":"standard"===o,"exp-dig-AccordionHeader-spacing--small":"small"===o,"exp-dig-AccordionHeader-spacing--large":"large"===o},l),onClick:_,onKeyDown:m,role:"button",tabIndex:0,"aria-expanded":c,"aria-disabled":c},t&&Ye.createElement("div",{className:"exp-dig-AccordionHeader-left-accessory"},t),Ye.createElement("div",{className:"exp-dig-AccordionHeader-title-container"},Ye.createElement("div",{className:"exp-dig-AccordionHeader-title-badge-container"},Ye.createElement(i.Text,{isBold:!0,size:"standard"===r?"medium":r,variant:"label",className:"exp-dig-AccordionHeader-title"},e),n&&Ye.createElement("div",{className:"exp-dig-AccordionHeader-title-right-accessory"},n)),Ye.createElement(i.Text,{size:"standard"===r?"medium":r,color:"faint",variant:"label"},a)),"standard"===u&&Ye.createElement("div",{className:"exp-dig-AccordionHeader-chevron"},Ye.createElement(i.UIIcon,{src:c?i.ChevronUpLine:i.ChevronDownLine,size:"small"})))};Nf.displayName="Header";const Pf=Af,Lf=Mf,Rf=Nf,Df=kf,Ff=Ye.createContext({expandedBlade:""});const Of=Ye.createContext({isMenuItem:!1}),Uf=Ye.createContext(void 0),Vf=({className:e,children:t})=>{const{expandedBlade:n,onExpandBlade:r}=Ye.useContext(Ff),[o,s]=function(){const e=a.useRef(null),t=a.useRef(),[i,n]=a.useState(),r=a.useCallback((()=>{t.current=new Be.index((e=>n(e[0]))),(null==e?void 0:e.current)&&t.current.observe(e.current)}),[e.current]);return a.useLayoutEffect((()=>(r(),()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.disconnect()})),[r]),[e,i]}(),l=s&&s.contentRect.height<344,d=Ye.useCallback((e=>{r&&r(e)}),[r]);return Ye.createElement("div",{ref:o,className:hf,"data-testid":"rc-right-rail-compact-content-wrapper",style:{height:"100%",minHeight:"0"}},l?Ye.createElement(i.Menu.Wrapper,{isBlock:!0,onSelection:d,className:yf},(({getTriggerProps:a,getContentProps:r})=>Ye.createElement(Pf,{variant:"blades",expandedPanel:n||"",className:i.cx(wf,e)},Ye.createElement(Uf.Provider,{value:{getTriggerProps:a}},t),Ye.createElement(i.Menu.Content,{...r(),className:Sf},Ye.createElement(i.Menu.Segment,null,Ye.createElement(Of.Provider,{value:{isMenuItem:!0}},t)))))):Ye.createElement(Pf,{variant:"blades",expandedPanel:n||"",className:i.cx(wf,e)},t))};Vf.displayName="Content",Vf.displayName="Content";const Bf=({id:e,withTitle:t,withIcon:n,withTitleRightAccessory:a,headerTooltipDataAttribute:r,bladePanelClassname:o,children:s})=>{const{onExpandBlade:l,expandedBlade:d}=Ye.useContext(Ff),{isMenuItem:c}=Ye.useContext(Of),u=Ye.useContext(Uf),_=Ye.useCallback((()=>{l&&l(e)}),[e,l]),m=d===e;return c?Ye.createElement(i.Menu.SelectItem,{key:e,value:e,selected:m,withRightAccessory:n},t):u&&!m?null:Ye.createElement(Lf,{id:e},Ye.createElement("div",{...null==u?void 0:u.getTriggerProps(),"data-tooltip":r},Ye.createElement(Rf,{withTitle:t,withLeftAccessory:n,onClick:_,withTitleRightAccessory:Ye.createElement(Ye.Fragment,null,u?Ye.createElement(i.UIIcon,{src:i.ChevronDownLine,size:"small"}):void 0,a),className:u&&Ef})),Ye.createElement(Df,{className:i.cx(ff,o)},m?s:null))};Bf.displayName="Blade",Bf.displayName="Blade";const zf=({id:e,withIcon:t,withNotificationBadge:n=0,tooltip:a,buttonTooltipDataAttribute:r})=>{const{onExpandBlade:o}=Ye.useContext(Ff),s=Ye.useCallback((()=>{o&&o(e)}),[o,e]);return Ye.createElement("div",{className:vf,"data-tooltip":r},Ye.createElement(i.Tooltip,{title:a,placement:"left"},Ye.createElement(i.IconButton,{variant:"transparent",onClick:s},t)),n>0&&Ye.createElement(i.Badge,{className:bf,variant:"attention"},n))};zf.displayName="CollapsedBladeIcon",zf.displayName="CollapsedBladeIcon";const Hf=({isExpanded:e,withTitle:t,expandedBlade:n,onCollapse:a,onExpandBlade:o,onExpand:s,header:l,expandedChildren:d,collapsedChildren:c,className:u,isCollapsible:_=!0,tooltipProps:m})=>{const p=m||{placement:"top",openDelay:500},f=r.useIntl(),g=e?f.formatMessage({id:"BgMbCS",defaultMessage:"Close details pane"}):f.formatMessage({id:"J5TC1D",defaultMessage:"Open details pane"});return Ye.createElement(Ye.Fragment,null,Ye.createElement(Ff.Provider,{value:{onExpandBlade:o,expandedBlade:n}},Ye.createElement("div",{className:i.cx(u,{[df]:e,[uf]:!e})},Ye.createElement("div",{className:cf,"data-testid":"rc-right-rail-title-container","data-tooltip":"right-rail-title"},e&&Ye.createElement("div",{className:_f,"data-testid":"rc-right-rail-title-container--title"},Ye.createElement(i.Text,{isBold:!0,role:"heading","aria-level":2},Ye.createElement(i.Truncate,{location:.5,tooltipControlProps:p},t))),Ye.createElement("div",{className:i.cx({[mf]:e}),"data-testid":e?"rc-right-rail-title-container--collapse-button":void 0},_&&Ye.createElement(i.Tooltip,{title:g,placement:"left"},Ye.createElement(i.IconButton,{onClick:e?a:s,variant:"transparent"},Ye.createElement(i.UIIcon,{src:e?ze.CollapseRightLine:L.ExpandLeftLine,"aria-label":g}))))),e?Ye.createElement(Ye.Fragment,null,l&&Ye.createElement(Cf,null,l),Ye.createElement(Vf,null,d)):Ye.createElement("div",{className:gf},c))))};Hf.displayName="RightRailWrapper",Hf.displayName="RightRailWrapper";const Wf=Bf,Kf=zf;Ye.memo((({id:e,intl:t,children:n})=>Ye.createElement(r.Provider,{value:t},Ye.createElement(Wf,{withIcon:Ye.createElement(i.UIIcon,{src:i.InfoLine}),withTitle:t.formatMessage({id:"pehNW7",defaultMessage:"Info"}),id:e},n)))).displayName="InfoBlade";Ye.memo((({id:e,intl:t})=>Ye.createElement(r.Provider,{value:t},Ye.createElement(Kf,{withIcon:Ye.createElement(i.UIIcon,{src:i.InfoLine,"aria-label":t.formatMessage({id:"Jf5mVf",defaultMessage:"Open info panel"})}),id:e,tooltip:t.formatMessage({id:"+PrmmG",defaultMessage:"Info"})})))).displayName="InfoBladeCollapsedBladeButton";i.injectInternalStyle("/static/typescript/component_libraries/files_components/src/blades/info_blade/index.module.out-vfl8DHoZN.css",(e=>"._info-blade--metadata-row_8xw62_1{display:flex}._info-blade--metadata-title_8xw62_9{display:flex;width:92px}._info-blade--metadata-data_8xw62_14{flex:1 1 0;margin-left:var(--spacing__unit--2);min-width:0}._info-blade--basic-metadata-container_8xw62_21{display:flex;flex-direction:column}._info-blade--file-breadcrumb-link_8xw62_26>span{color:var(--dig-color__text__base)}._info-blade--pathbar_8xw62_30 a{color:var(--dig-color__text__subtle)}._info-blade--expand-fields-button_8xw62_34{margin-top:var(--spacing__base_unit)}"));const Gf="_info-blade--metadata-row_8xw62_1",jf="_info-blade--metadata-title_8xw62_9",qf="_info-blade--metadata-data_8xw62_14",Qf="_info-blade--basic-metadata-container_8xw62_21",Yf="_info-blade--file-breadcrumb-link_8xw62_26",$f="_info-blade--pathbar_8xw62_30",Xf="_info-blade--expand-fields-button_8xw62_34",Zf=Ye.memo((({path:e,size:t="small",openPath:n,accountRootName:a,browseRoot:r,...o})=>{const s=l.normalize(e),d=a,c=l.parent_dirs(s).reverse();c.unshift("");const u=e=>{if(r)return e.startsWith("/")||(e="/"+e),r.startsWith("/")||(r="/"+r),`https://www.dropbox.com${r}${e}`};return Ye.createElement(i.Breadcrumb,{size:t,isRootOverflow:!0,...o},c.map((e=>Ye.createElement(i.Breadcrumb.Link,{key:l.filename(e,d),href:u(e),onClick:()=>n(e),isCurrentPath:!1,className:Yf},l.filename(e,d)))))}));function Jf(){const[e,t]=Ye.useState("top"),i=Ye.useCallback((e=>{t(e)}),[t]);return{placement:e,onChangePlacement:i}}Zf.displayName="FileBreadcrumb";const eg=({title:e,data:t})=>{const{placement:n,onChangePlacement:a}=Jf();return Ye.createElement("div",{className:Gf,role:"row"},Ye.createElement("div",{className:jf,role:"rowheader"},Ye.createElement(i.Text,{size:"small",variant:"paragraph",color:"faint",style:{overflow:"hidden"}},Ye.createElement(i.Truncate,{tooltipControlProps:{placement:n,openDelay:500,onChangePlacement:a,maxWidth:210}},e))),Ye.createElement("div",{className:qf,role:"cell"},t))};eg.displayName="InfoBladeMetadataRow";const tg=({title:e,data:t})=>{const{placement:n,onChangePlacement:a}=Jf();return Ye.createElement(eg,{title:e,data:Ye.createElement(i.Text,{variant:"paragraph",size:"small"},Ye.createElement(i.Truncate,{tooltipControlProps:{placement:n,openDelay:500,auto:!0,maxWidth:210,onChangePlacement:a},lines:3},t))})};tg.displayName="InfoBladeTextMetadataRow";const ig=Ye.memo((({file:e,pathBar:t,accountRootName:n="Dropbox",browseRoot:a})=>{const{lastModifiedMs:o,size:s,name:d,fqPath:c}=e,u=r.useIntl();return Ye.createElement("div",{className:Qf},c&&(null==t?void 0:t.enabled)&&Ye.createElement(eg,{title:u.formatMessage({id:"vRjK3h",defaultMessage:"Saved in"}),data:Ye.createElement(Zf,{className:$f,size:"small",path:c,accountRootName:n,openPath:t.openPath,browseRoot:a})}),void 0!==s&&Ye.createElement(eg,{title:u.formatMessage({id:"7+ns4J",defaultMessage:"Size"}),data:Ye.createElement(i.Text,{variant:"paragraph",size:"small"},He.formatBytes(u,s))}),o&&Ye.createElement(eg,{title:u.formatMessage({id:"3TwhnG",defaultMessage:"Modified"}),data:Ye.createElement(i.Text,{variant:"paragraph",size:"small"},u.formatTime(new Date(o),{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}))}),d&&Ye.createElement(eg,{title:u.formatMessage({id:"VPGq/B",defaultMessage:"Type"}),data:Ye.createElement(i.Text,{variant:"paragraph",size:"small"},l.getFileCategory(l.file_extension(d),u))}))}));ig.displayName="BasicFileMetadata";const ng=1e3,ag=60*ng,rg=60*ag;function og(e,t){if(!e)return;if(isNaN(e)||e<=0)return;const i=Math.floor(e/rg),n=Math.floor(e%rg/ag),a=Math.floor(e%ag/ng),r=Math.floor(e%ng),o=0==i&&0==n&&a<15,s=i>0||n>=10,l={hours:t.formatNumber(i,{minimumIntegerDigits:2,maximumFractionDigits:0}),minutes:t.formatNumber(n,{minimumIntegerDigits:2,maximumFractionDigits:0}),seconds:t.formatNumber(a,{minimumIntegerDigits:2,maximumFractionDigits:0}),millis:String(r).padStart(3,"0")};return o?t.formatMessage({id:"tgiBzN",defaultMessage:"{minutes}:{seconds}.{millis}"},l):s?t.formatMessage({id:"Y2LnVt",defaultMessage:"{hours}:{minutes}:{seconds}"},l):t.formatMessage({id:"eHQbup",defaultMessage:"{minutes}:{seconds}"},l)}function sg(e,t){if(e.audio_freq){if(e.audio_chan_layout){const i=+e.audio_chan_layout;if(!isNaN(i))return t.formatMessage({id:"ZFfsQG",defaultMessage:"{audio_freq} kHz {audio_chan_layout}"},{audio_freq:t.formatNumber(e.audio_freq/1e3),audio_chan_layout:t.formatNumber(i/100)})}return t.formatMessage({id:"o1Wy7v",defaultMessage:"{audio_freq} kHz"},{audio_freq:t.formatNumber(e.audio_freq/1e3)})}}const lg=1e3,dg=60*lg,cg=60*dg,ug=24*cg,_g=7*ug,mg=30*ug,pg=365*ug;function fg(e,t){if(e&&!(isNaN(e)||e<=0))return e<dg?t.formatMessage({id:"XJTRCn",defaultMessage:"{value, plural, one{# second} other{# seconds}}"},{value:Math.round(e/lg)}):e<cg?t.formatMessage({id:"hYCfnh",defaultMessage:"{value, plural, one{# minute} other{# minutes}}"},{value:Math.round(e/dg)}):e<ug?t.formatMessage({id:"5vUoeT",defaultMessage:"{value, plural, one{# hour} other{# hours}}"},{value:Math.round(e/cg)}):e<_g?t.formatMessage({id:"VUIAfM",defaultMessage:"{value, plural, one{# day} other{# days}}"},{value:Math.round(e/ug)}):e<mg?t.formatMessage({id:"0wIJlM",defaultMessage:"{value, plural, one{# week} other{# weeks}}"},{value:Math.round(e/_g)}):e<pg?t.formatMessage({id:"MPX3Ow",defaultMessage:"{value, plural, one{# month} other{# months}}"},{value:Math.round(e/mg)}):t.formatMessage({id:"toXz6N",defaultMessage:"{value, plural, one{# year} other{# years}}"},{value:Math.round(e/pg)})}var gg,vg,hg,wg,yg,Eg;!function(e){e[e.Unknown=0]="Unknown",e[e.Average=1]="Average",e[e.CenterWeightedAverage=2]="CenterWeightedAverage",e[e.Spot=3]="Spot",e[e.MultiSpot=4]="MultiSpot",e[e.MultiSegment=5]="MultiSegment",e[e.Partial=6]="Partial",e[e.Other=7]="Other"}(gg||(gg={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoFlash=1]="NoFlash",e[e.Fired=2]="Fired",e[e.FiredReturnNotDetected=3]="FiredReturnNotDetected",e[e.FiredReturnDetected=4]="FiredReturnDetected",e[e.OnDidNotFire=5]="OnDidNotFire",e[e.OnFired=6]="OnFired",e[e.OnReturnNotDetected=7]="OnReturnNotDetected",e[e.OnReturnDetected=8]="OnReturnDetected",e[e.OffDidNotFire=9]="OffDidNotFire",e[e.OffDidNotFireReturnNotDetected=10]="OffDidNotFireReturnNotDetected",e[e.AutoDidNotFire=11]="AutoDidNotFire",e[e.AutoFired=12]="AutoFired",e[e.AutoFiredReturnNotDetected=13]="AutoFiredReturnNotDetected",e[e.AutoFiredReturnDetected=14]="AutoFiredReturnDetected",e[e.NoFlashFunction=15]="NoFlashFunction",e[e.OffNoFlashFunction=16]="OffNoFlashFunction",e[e.FiredRedEyeReduction=17]="FiredRedEyeReduction",e[e.FiredRedEyeReductionReturnNotDetected=18]="FiredRedEyeReductionReturnNotDetected",e[e.FiredRedEyeReductionReturnDetected=19]="FiredRedEyeReductionReturnDetected",e[e.OnRedEyeReduction=20]="OnRedEyeReduction",e[e.OnRedEyeReductionReturnNotDetected=21]="OnRedEyeReductionReturnNotDetected",e[e.OnRedEyeReductionReturnDetected=22]="OnRedEyeReductionReturnDetected",e[e.OffRedEyeReduction=23]="OffRedEyeReduction",e[e.AutoDidNotFireRedEyeReduction=24]="AutoDidNotFireRedEyeReduction",e[e.AutoFiredRedEyeReduction=25]="AutoFiredRedEyeReduction",e[e.AutoFiredRedEyeReductionReturnNotDetected=26]="AutoFiredRedEyeReductionReturnNotDetected",e[e.AutoFiredRedEyeReductionReturnDetected=27]="AutoFiredRedEyeReductionReturnDetected",e[e.Other=28]="Other"}(vg||(vg={})),function(e){e[e.Unknown=0]="Unknown",e[e.Auto=1]="Auto",e[e.Manual=2]="Manual",e[e.Other=3]="Other"}(hg||(hg={})),function(e){e[e.Unknown=0]="Unknown",e[e.SRgb=1]="SRgb",e[e.AdobeRgb=2]="AdobeRgb",e[e.WideGamutRgb=3]="WideGamutRgb",e[e.IccProfile=4]="IccProfile",e[e.Uncalibrated=5]="Uncalibrated",e[e.Other=6]="Other"}(wg||(wg={})),function(e){e[e.UnknownOrientation=0]="UnknownOrientation",e[e.Horizontal=1]="Horizontal",e[e.MirrorHorizontal=2]="MirrorHorizontal",e[e.Rotate180=3]="Rotate180",e[e.MirrorVertical=4]="MirrorVertical",e[e.MirrorHorizontalRotate270Cw=5]="MirrorHorizontalRotate270Cw",e[e.Rotate90Cw=6]="Rotate90Cw",e[e.MirrorHorizontalRotate90Cw=7]="MirrorHorizontalRotate90Cw",e[e.Rotate270Cw=8]="Rotate270Cw"}(yg||(yg={})),function(e){e[e.UnknownResolutionUnit=0]="UnknownResolutionUnit",e[e.Inch=1]="Inch",e[e.CM=2]="CM"}(Eg||(Eg={}));const Sg=e=>({[hg.Unknown]:e.formatMessage({id:"vHgZs0",defaultMessage:"Unknown"}),[hg.Auto]:e.formatMessage({id:"xhS6fE",defaultMessage:"Auto"}),[hg.Manual]:e.formatMessage({id:"ToNv3C",defaultMessage:"Manual"}),[hg.Other]:e.formatMessage({id:"bmpvII",defaultMessage:"Other"})}),bg=e=>({[wg.Unknown]:e.formatMessage({id:"vHgZs0",defaultMessage:"Unknown"}),[wg.SRgb]:e.formatMessage({id:"a0wUgp",defaultMessage:"sRGB"}),[wg.AdobeRgb]:e.formatMessage({id:"B28Q5y",defaultMessage:"Adobe RGB"}),[wg.WideGamutRgb]:e.formatMessage({id:"Kh3t+h",defaultMessage:"Wide Gamut RGB"}),[wg.IccProfile]:e.formatMessage({id:"h4Q5SZ",defaultMessage:"ICC Profile"}),[wg.Uncalibrated]:e.formatMessage({id:"/7omh+",defaultMessage:"Uncalibrated"}),[wg.Other]:e.formatMessage({id:"bmpvII",defaultMessage:"Other"})}),Cg=e=>({[vg.Unknown]:e.formatMessage({id:"vHgZs0",defaultMessage:"Unknown"}),[vg.NoFlash]:e.formatMessage({id:"CMxZBg",defaultMessage:"No flash"}),[vg.Fired]:e.formatMessage({id:"GxXK+Z",defaultMessage:"Fired"}),[vg.FiredReturnNotDetected]:e.formatMessage({id:"1aQhV4",defaultMessage:"Fired, return not detected"}),[vg.FiredReturnDetected]:e.formatMessage({id:"mxTse0",defaultMessage:"Fired, return detected"}),[vg.OnDidNotFire]:e.formatMessage({id:"VAQlMV",defaultMessage:"On, did not fire"}),[vg.OnFired]:e.formatMessage({id:"IfNe4i",defaultMessage:"On, fired"}),[vg.OnReturnNotDetected]:e.formatMessage({id:"xb3nZ7",defaultMessage:"On, return not detected"}),[vg.OnReturnDetected]:e.formatMessage({id:"GIkKlb",defaultMessage:"On, return detected"}),[vg.OffDidNotFire]:e.formatMessage({id:"hvSCzd",defaultMessage:"Off, did not fire"}),[vg.OffDidNotFireReturnNotDetected]:e.formatMessage({id:"O8+FbV",defaultMessage:"Off, did not fire, return not detected"}),[vg.AutoDidNotFire]:e.formatMessage({id:"KSJ3BI",defaultMessage:"Auto, did not fire"}),[vg.AutoFired]:e.formatMessage({id:"F0TcTd",defaultMessage:"Auto, fired"}),[vg.AutoFiredReturnNotDetected]:e.formatMessage({id:"rLeBiG",defaultMessage:"Auto, fired, return not detected"}),[vg.AutoFiredReturnDetected]:e.formatMessage({id:"qJftjl",defaultMessage:"Auto, fired, return detected"}),[vg.NoFlashFunction]:e.formatMessage({id:"jdWze8",defaultMessage:"No flash function"}),[vg.OffNoFlashFunction]:e.formatMessage({id:"THu+Iw",defaultMessage:"Off, no flash function"}),[vg.FiredRedEyeReduction]:e.formatMessage({id:"B0ZoP1",defaultMessage:"Fired, red-eye reduction"}),[vg.FiredRedEyeReductionReturnNotDetected]:e.formatMessage({id:"XrGwwy",defaultMessage:"Fired, red-eye reduction, return not detected"}),[vg.FiredRedEyeReductionReturnDetected]:e.formatMessage({id:"piA/mD",defaultMessage:"Fired, red-eye reduction, return detected"}),[vg.OnRedEyeReduction]:e.formatMessage({id:"VgJqkZ",defaultMessage:"On, red-eye reduction"}),[vg.OnRedEyeReductionReturnNotDetected]:e.formatMessage({id:"+TI9qg",defaultMessage:"On, red-eye reduction, return not detected"}),[vg.OnRedEyeReductionReturnDetected]:e.formatMessage({id:"j8jQAQ",defaultMessage:"On, red-eye reduction, return detected"}),[vg.OffRedEyeReduction]:e.formatMessage({id:"QLLQth",defaultMessage:"Off, red-eye reduction"}),[vg.AutoDidNotFireRedEyeReduction]:e.formatMessage({id:"AhpZjQ",defaultMessage:"Auto, did not fire, red-eye reduction"}),[vg.AutoFiredRedEyeReduction]:e.formatMessage({id:"Qv2qrm",defaultMessage:"Auto, fired, red-eye reduction"}),[vg.AutoFiredRedEyeReductionReturnNotDetected]:e.formatMessage({id:"gTPkua",defaultMessage:"Auto, fired, red-eye reduction, return not detected"}),[vg.AutoFiredRedEyeReductionReturnDetected]:e.formatMessage({id:"4Ty2Bk",defaultMessage:"Auto, fired, red-eye reduction, return detected"}),[vg.Other]:e.formatMessage({id:"bmpvII",defaultMessage:"Other"})}),Ig=e=>({[gg.Unknown]:e.formatMessage({id:"vHgZs0",defaultMessage:"Unknown"}),[gg.Average]:e.formatMessage({id:"FfhsBR",defaultMessage:"Average"}),[gg.CenterWeightedAverage]:e.formatMessage({id:"FgYWQc",defaultMessage:"Center-weighted average"}),[gg.Spot]:e.formatMessage({id:"xcW6Wd",defaultMessage:"Spot"}),[gg.MultiSpot]:e.formatMessage({id:"RGJ4oA",defaultMessage:"Multi-spot"}),[gg.MultiSegment]:e.formatMessage({id:"iExd56",defaultMessage:"Multi-segment"}),[gg.Partial]:e.formatMessage({id:"Zd4uKj",defaultMessage:"Partial"}),[gg.Other]:e.formatMessage({id:"bmpvII",defaultMessage:"Other"})}),Tg=e=>({[yg.Horizontal]:e.formatMessage({id:"7v6FH2",defaultMessage:"Horizontal (normal)"}),[yg.MirrorHorizontal]:e.formatMessage({id:"s1wRj/",defaultMessage:"Mirror horizontal"}),[yg.Rotate180]:e.formatMessage({id:"YxttK0",defaultMessage:"Rotate 180"}),[yg.MirrorVertical]:e.formatMessage({id:"ykfmPa",defaultMessage:"Mirror vertical"}),[yg.MirrorHorizontalRotate270Cw]:e.formatMessage({id:"GSAufA",defaultMessage:"Mirror horizontal and rotate 270 CW"}),[yg.Rotate90Cw]:e.formatMessage({id:"RUtOD3",defaultMessage:"Rotate 90 CW"}),[yg.MirrorHorizontalRotate90Cw]:e.formatMessage({id:"PzCdEi",defaultMessage:"Mirror horizontal and rotate 90 CW"}),[yg.Rotate270Cw]:e.formatMessage({id:"g6rS8+",defaultMessage:"Rotate 270 CW"})}),xg=(e,t,i)=>{if(void 0!==e&&void 0!==t)return i.formatMessage({id:"P63UMO",defaultMessage:"{width} x {height}"},{width:e,height:t})},Ag=(e,t,i)=>{if(void 0!==e&&void 0!==t)return i.formatMessage({id:"6A4kNh",defaultMessage:"{width} x {height}"},{width:e,height:t})},Mg=(e,t)=>{if(!e)return;let i=e;if(-1===e.indexOf("/")){const n=parseFloat(e);if(isNaN(n))return;i=n<1?t.formatNumber(n,{minimumFractionDigits:2,maximumFractionDigits:2}):t.formatNumber(n,{minimumFractionDigits:1,maximumFractionDigits:1})}return t.formatMessage({id:"ZbTwYS",defaultMessage:"{exposure_time} s"},{exposure_time:i})},kg=(e,t)=>{if(e){const i=t.formatNumber(e,{minimumFractionDigits:1,maximumFractionDigits:1});return t.formatMessage({id:"WOwRDU",defaultMessage:"f/{aperture}"},{aperture:i})}},Ng=(e,t)=>{if(!e)return;const i=parseFloat(e);if(isNaN(i))return;const n=t.formatNumber(i,{minimumFractionDigits:1,maximumFractionDigits:1});return t.formatMessage({id:"BTHLkw",defaultMessage:"{focal_length} mm"},{focal_length:n})},Pg=(e,t)=>{if(e){const i=new Date(e);return t.formatDate(i,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",timeZone:"UTC",hourCycle:"h12"})}};const Lg=({metadata:e,onShowMore:t})=>{const[n,o]=a.useState(!1),s=r.useIntl(),l=Ye.default.useMemo((()=>Rg(e,s).filter((e=>!!e.value))),[e,s]),d=Ye.default.useMemo((()=>n?l:l.slice(0,8)),[l,n]),c=a.useCallback((()=>{null==t||t(!n),o(!n)}),[n,t]),u=s.formatMessage({id:"+kc9n+",defaultMessage:"Show all"}),_=s.formatMessage({id:"5tvWhA",defaultMessage:"Hide"}),m=l.length>8;return Ye.default.createElement("div",null,d.map((e=>Ye.default.createElement(tg,{key:`content-metadata-${e.name}`,title:e.name,data:e.value}))),m&&Ye.default.createElement(i.Button,{className:Xf,variant:"transparent",size:"small",onClick:c,fullWidth:!1},Ye.default.createElement(i.Text,{className:"expand-fields-button--context-text",size:"small",isBold:!0},n?_:u)))};Lg.displayName="FileContentMetadataUI";const Rg=(e,t)=>{switch(e[".tag"]){case"image":return function(e,t){const i=(e=>({captureDate:e.formatMessage({id:"54B7+u",defaultMessage:"Date taken"}),createDate:e.formatMessage({id:"+OuHm4",defaultMessage:"Date created"}),credits:e.formatMessage({id:"WU02lX",defaultMessage:"Credits"}),dimensions:e.formatMessage({id:"5fgW0C",defaultMessage:"Dimensions"}),resolution:e.formatMessage({id:"wscUVd",defaultMessage:"Dots per inch"}),resolution_in_cm:e.formatMessage({id:"P23mCt",defaultMessage:"Dots per CM"}),colorSpace:e.formatMessage({id:"SHDDoj",defaultMessage:"Color profile"}),deviceMake:e.formatMessage({id:"GkqUJK",defaultMessage:"Camera brand"}),deviceModel:e.formatMessage({id:"EPx9jS",defaultMessage:"Camera model"}),lensModel:e.formatMessage({id:"8+mL18",defaultMessage:"Lens"}),apertureValue:e.formatMessage({id:"Hv/B/8",defaultMessage:"Aperture"}),exposureTime:e.formatMessage({id:"5JRhFM",defaultMessage:"Shutter speed"}),focalLength:e.formatMessage({id:"hKz/tt",defaultMessage:"Focal length"}),isoSpeed:e.formatMessage({id:"c7J2CV",defaultMessage:"ISO"}),flash:e.formatMessage({id:"WIBZO6",defaultMessage:"Flash"}),meteringMode:e.formatMessage({id:"WbVH1z",defaultMessage:"Metering"}),whiteBalance:e.formatMessage({id:"USKkbD",defaultMessage:"White balance"}),copyright:e.formatMessage({id:"qQhzrN",defaultMessage:"Copyright"}),keywords:e.formatMessage({id:"jNkBVA",defaultMessage:"Keywords"}),title:e.formatMessage({id:"YyhVRN",defaultMessage:"Title"}),caption:e.formatMessage({id:"1vHwyl",defaultMessage:"Caption"}),creator:e.formatMessage({id:"Z5ApwP",defaultMessage:"Creator"}),artist:e.formatMessage({id:"2mALcS",defaultMessage:"Artist"}),description:e.formatMessage({id:"6hvXWm",defaultMessage:"Description"}),headline:e.formatMessage({id:"1Y0IbU",defaultMessage:"Headline"}),licensorUrl:e.formatMessage({id:"j6C1Hk",defaultMessage:"Licensor URL"}),orientation:e.formatMessage({id:"oDAo/S",defaultMessage:"Orientation"}),usageRights:e.formatMessage({id:"VUwfxH",defaultMessage:"Usage rights"}),category:e.formatMessage({id:"KP48oN",defaultMessage:"PS category"}),userComments:e.formatMessage({id:"tcqDgZ",defaultMessage:"User comments"})}))(t);return[{name:i.description,value:e.description},{name:i.copyright,value:e.copyright},{name:i.keywords,value:e.keywords},{name:i.captureDate,value:Pg(e.date_time_original,t)},{name:i.createDate,value:Pg(e.create_date,t)},{name:i.dimensions,value:xg(e.image_width,e.image_height,t)},{name:i.resolution,value:e.resolution_unit!==Eg.CM?Ag(e.x_resolution,e.y_resolution,t):void 0},{name:i.resolution_in_cm,value:e.resolution_unit===Eg.CM?Ag(e.x_resolution,e.y_resolution,t):void 0},{name:i.colorSpace,value:void 0!==e.colorspace?bg(t)[e.colorspace]:void 0},{name:i.orientation,value:void 0!==e.orientation?Tg(t)[e.orientation]:void 0},{name:i.title,value:e.title},{name:i.caption,value:e.caption},{name:i.creator,value:e.creator},{name:i.artist,value:e.credit},{name:i.headline,value:e.headline},{name:i.credits,value:e.credits},{name:i.licensorUrl,value:e.licensor_url},{name:i.usageRights,value:e.rights_usage_terms},{name:i.category,value:e.category},{name:i.userComments,value:e.user_comments},{name:i.deviceMake,value:e.camera_make},{name:i.deviceModel,value:e.camera_model},{name:i.lensModel,value:e.lens_model},{name:i.focalLength,value:Ng(e.focal_length,t)},{name:i.exposureTime,value:Mg(e.exposure_time,t)},{name:i.apertureValue,value:kg(e.aperture_value,t)},{name:i.isoSpeed,value:void 0!==e.iso_speed?String(e.iso_speed):void 0},{name:i.meteringMode,value:void 0!==e.metering_mode?Ig(t)[e.metering_mode]:void 0},{name:i.flash,value:void 0!==e.flash?Cg(t)[e.flash]:void 0},{name:i.whiteBalance,value:void 0!==e.white_balance?Sg(t)[e.white_balance]:void 0}].filter((e=>!!e.value))}(e,t);case"ms_office":return function(e,t){return[{name:t.formatMessage({id:"Ed/RQ2",defaultMessage:"Title"}),value:e.title},{name:t.formatMessage({id:"TpJn8o",defaultMessage:"Owner"}),value:e.creator},{name:t.formatMessage({id:"WRzvI1",defaultMessage:"Company"}),value:e.company},{name:t.formatMessage({id:"NL8ygk",defaultMessage:"Subject"}),value:e.subject},{name:t.formatMessage({id:"a8+LVV",defaultMessage:"Keywords"}),value:e.keywords},{name:t.formatMessage({id:"yGgaIu",defaultMessage:"Description"}),value:e.description},{name:t.formatMessage({id:"BLmrgy",defaultMessage:"Total edit time"}),value:e.total_edit_time_minutes?fg(60*e.total_edit_time_minutes*1e3,t):void 0},{name:t.formatMessage({id:"oHZfxP",defaultMessage:"Revision number"}),value:e.revision_number},{name:t.formatMessage({id:"EF/17d",defaultMessage:"Pages"}),value:e.pages?t.formatNumber(e.pages,{maximumFractionDigits:0}):void 0},{name:t.formatMessage({id:"RLrbhp",defaultMessage:"Words"}),value:e.words?t.formatNumber(e.words,{maximumFractionDigits:0}):void 0},{name:t.formatMessage({id:"2dpvY4",defaultMessage:"Slides"}),value:e.slides?t.formatNumber(e.slides,{maximumFractionDigits:0}):void 0}].filter((e=>!!e.value))}(e,t);case"pdf":return function(e,t){return[{name:t.formatMessage({id:"EF/17d",defaultMessage:"Pages"}),value:e.pages},{name:t.formatMessage({id:"MeqvVX",defaultMessage:"Dimensions"}),value:e.width&&e.height?t.formatMessage({id:"JEE1p9",defaultMessage:"{width} x {height}"},{width:t.formatNumber(e.width),height:t.formatNumber(e.height)}):void 0}].filter((e=>!!e.value))}(e,t);case"video":return function(e,t){return[{name:t.formatMessage({id:"e4DGmJ",defaultMessage:"Date created"}),value:e.capture_date?t.formatTime(new Date(e.capture_date),{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"}):void 0},{name:t.formatMessage({id:"8I3zJj",defaultMessage:"Capturing device"}),value:e.device},{name:t.formatMessage({id:"R+6yXm",defaultMessage:"Resolution"}),value:`${e.resolution_width}x${e.resolution_height}`},{name:t.formatMessage({id:"fnTy98",defaultMessage:"Aspect ratio"}),value:e.aspect_ratio},{name:t.formatMessage({id:"A4boBS",defaultMessage:"Duration"}),value:e.duration_precise?og(e.duration_precise*ng,t):void 0},{name:t.formatMessage({id:"B3oDhY",defaultMessage:"Frame rate"}),value:`${e.frame_rate} fps`},{name:t.formatMessage({id:"NZhZ/H",defaultMessage:"Color space"}),value:e.color_space},{name:t.formatMessage({id:"Dl8F3e",defaultMessage:"Bit rate"}),value:e.bit_rate?t.formatMessage({id:"/xb44b",defaultMessage:"{bit_rate} kb/s"},{bit_rate:Math.floor(e.bit_rate/1e3)}):void 0},{name:t.formatMessage({id:"C1kd1L",defaultMessage:"Audio"}),value:sg(e,t)},{name:t.formatMessage({id:"yq3RyE",defaultMessage:"Codec"}),value:e.codec}]}(e,t);case"audio":return function(e,t){return[{name:t.formatMessage({id:"yq3RyE",defaultMessage:"Codec"}),value:e.codec},{name:t.formatMessage({id:"akP0tz",defaultMessage:"Sampling rate"}),value:Number(e.sampling_rate)/1e3+" kHz"},{name:t.formatMessage({id:"A4boBS",defaultMessage:"Duration"}),value:e.duration_precise?og(e.duration_precise*ng,t):void 0},{name:t.formatMessage({id:"0Fq1H6",defaultMessage:"Channels"}),value:e.channels},{name:t.formatMessage({id:"Dl8F3e",defaultMessage:"Bit rate"}),value:String(Math.floor(e.bit_rate/1e3))+" kb/s"}]}(e,t);default:return[]}},Dg=({fileId:e,sharedLinkURL:t,onShowMore:i,apiV2Client:n,logUserAction:a})=>{var r,o;Ye.default.useEffect((()=>{null==a||a("info_content_metadata_loading")}),[a]);const s=Q.useFileContentMetadataQuery$1(n,{file_path_or_id:e,url:t}),l=null===(o=null===(r=s.data)||void 0===r?void 0:r.apiData)||void 0===o?void 0:o.metadata;return Ye.default.useEffect((()=>{l||s.isLoading?l&&(null==a||a("info_content_metadata_loaded")):null==a||a("info_content_metadata_error")}),[a,l,s.isLoading]),l?Ye.default.createElement(Lg,{metadata:l,onShowMore:i}):null};Dg.displayName="FileContentMetadata";const Fg=Ye.default.memo((({ownerTeamName:e,ownerName:t})=>{const i=r.useIntl();let n="";return t&&e?n=i.formatMessage({id:"r8Mpyq",defaultMessage:"{owner_name} ({owner_team_name})"},{owner_name:t,owner_team_name:e}):e&&(n=e),n?Ye.default.createElement(tg,{key:`content-metadata-${e}`,title:i.formatMessage({id:"qfF5dJ",defaultMessage:"From"}),data:n}):null}));Fg.displayName="SharedLinkMetadata";const Og=Ye.default.memo((({uploadInfo:e})=>{const t=r.useIntl(),i=[{title:t.formatMessage({id:"bD4kqG",defaultMessage:"Uploaded by"}),data:e.display_name},{title:t.formatMessage({id:"KMbzWs",defaultMessage:"Date uploaded"}),data:t.formatTime(new Date(e.uploaded),{month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})}];return Ye.default.createElement(Ye.default.Fragment,null,i.map((e=>e.data&&Ye.default.createElement(tg,{title:e.title,data:e.data,key:e.title}))))}));Og.displayName="UploadInfoMetadataUI";const Ug="files:get_upload_info",Vg=(e,t)=>Ye.default.useMemo((()=>{return t=e,oe.createGenericQuery({queryRouteFilter:["apiv2",Ug],queryFn:({apiArg:e})=>async()=>({apiData:await i.GetFilesRoutes(t).rpc("get_upload_info",e,{}),pkgData:null}),getQueryKey:oe.getGenericQueryKey("apiv2",Ug)});var t}),[e]).useQuery({apiArg:t,pkgArg:void 0}),Bg=({apiV2Client:e,fileId:t,sharedLinkURL:i})=>{const{isLoading:n,data:{apiData:a}={}}=Vg(e,{file_path_or_id:t,url:i});return!n&&a?Ye.default.createElement(Og,{uploadInfo:a}):null};Bg.displayName="UploadMetadata";i.injectInternalStyle("/static/js/file_viewer/transcript_blade/transcript_blade.module.out-vflQDr8n_.css",(e=>":root{--transcript-search-height:52px}._transcriptBlade_14ixi_10{display:flex;flex-direction:column;overflow:hidden;padding:0}._transcriptBladeContentWrapper_14ixi_17{height:100%;width:100%}._transcriptHeaderOptionMenuWrapper_14ixi_22{display:flex;justify-content:flex-end;width:100%}._transcriptSegmentListContentWrapper_14ixi_28{height:auto;outline:none;overflow:hidden;position:relative;width:100%}._transcriptErrorInfo_14ixi_36{align-items:center;display:flex;gap:8px;padding:12px 16px}._transcriptLoadingScreen_14ixi_43{box-sizing:border-box;height:100%;padding:0 16px}._transcriptLoadingScreen_14ixi_43,._transcriptProgressBarWrapper_14ixi_55{align-items:center;display:flex;flex-direction:column;justify-content:center;text-align:center;width:100%}._transcriptProgressBar_14ixi_55{margin-bottom:16px;width:100%}._transcriptSearchWrapper_14ixi_69{box-sizing:border-box;height:auto;padding:4px 16px 16px}._transcriptSearchMatchFoundText_14ixi_75{margin-top:2px;white-space:nowrap}._transcriptSearchNavigatorWrapper_14ixi_80{align-items:center;display:inline-flex}._transcriptCaptionText_14ixi_85,._transcriptCaptionTextEditMode_14ixi_90{cursor:text;overflow-wrap:anywhere}._transcriptCaptionTextEditMode_14ixi_90{font-family:var(--type__body__small--fontfamily);font-size:var(--type__body__small--fontsize);font-weight:var(--type__body__small--fontweight);line-height:var(--type__body__small--lineheight)}._currentSearchMatch_14ixi_99{background-color:var(--color__highlight__yellow__permanent)}._resumeAutoScrollButton_14ixi_103{bottom:0;left:50%;opacity:0;position:absolute;transform:translate(-50%,100%);transition:all var(--duration__micro-fast) var(--easing__leave)}._resumeAutoScrollButton_14ixi_103._showing_14ixi_112{bottom:8px;opacity:100%;transform:translate(-50%);transition-timing-function:var(--easing__enter)}._transcriptReplaceToggle_14ixi_119{background-color:var(--color__standard__background);border:1px solid var(--color__standard__text);border-radius:8px;color:var(--color__standard__text);display:flex;padding:var(--dig-spacing__dimension__8)}._transcriptReplaceToggle_14ixi_119>*+*{margin-left:var(--dig-spacing__dimension__8);margin-right:var(--dig-spacing__dimension__44)}._transcriptSearchWrapper_14ixi_69>*+*{margin-top:var(--dig-spacing__dimension__8)}._transcriptSearchNavigatorRowWrapper_14ixi_137{align-items:center;display:flex;flex-direction:row}._transcriptSearchNavigatorRowWrapper_14ixi_137>*+*{margin-left:var(--dig-spacing__dimension__8)}._replaceBanner_14ixi_147{bottom:150px;margin:0 var(--dig-spacing__dimension__16)}._transcriptFeedbackPanel_14ixi_152{background-color:var(--dig-color__background__raised);bottom:0;opacity:1;position:absolute;transition:opacity var(--duration__333) var(--easing__enter);width:100%}._transcriptFeedbackPanelHidden_14ixi_161{opacity:0;transition:opacity var(--duration__333) var(--easing__leave)}._transcriptFeedbackHeaderRightAccessory_14ixi_166{align-items:center;display:flex;justify-content:space-around;margin-left:auto;margin-right:var(--dig-spacing__dimension__8)}._transcriptFeedbackChips_14ixi_174{align-content:space-around;display:flex;flex-direction:row;flex-wrap:wrap;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}._transcriptFeedbackChips_14ixi_174>*{margin-bottom:var(--dig-spacing__dimension__4);margin-right:var(--dig-spacing__dimension__4)}._transcriptFeedbackTextbox_14ixi_187{margin:var(--dig-spacing__dimension__8) 0}._transcriptFeedbackButtons_14ixi_191{display:flex;flex-direction:row;justify-content:flex-end}._transcriptFeedbackButtons_14ixi_191>*+*{margin-left:var(--dig-spacing__dimension__8)}"));const zg=Ye.default.memo((({showLoadingMessage:e=!0,previewsTranscriptionTranslationVariant:t=!1})=>{const n=r.useIntl(),[a,o]=Ye.default.useState(!1),s=Ye.default.useRef(null),{fileViewerId:l}=i.useFileViewerContext(),d=i.useFileViewerSelector(i.getCurrentPreviewKey,l),c=i.usePreviewKeyAtomValue(le.translationLanguageAtom,d),u=t&&c;return Ye.default.useEffect((()=>{if(e)return s.current=window.setTimeout((()=>{o(!0),s.current=null}),7e3),()=>{null!=s.current&&window.clearTimeout(s.current)}}),[e]),Ye.default.createElement("div",{className:"_transcriptLoadingScreen_14ixi_43"},Ye.default.createElement(i.ProgressBar,{className:"_transcriptProgressBar_14ixi_55",value:0,in:!0,isIndeterminate:!0}),a&&(u?Ye.default.createElement(i.Text,{variant:"label",size:"small",color:"standard"},n.formatMessage({id:"nl9MyF",defaultMessage:"We’re translating this file. Feel free to do other things while we work."})):Ye.default.createElement(i.Text,{variant:"label",size:"small",color:"standard"},n.formatMessage({id:"PwXEwf",defaultMessage:"We’re transcribing this file. Feel free to do other things while we work."}))))}));zg.displayName="TranscriptProgressBar";const Hg=Ye.memo((({segments:e,isDefaultAudioTrackSelected:t,previewType:n,onMenuSelection:a,showTranscriptionDetails:o,getUserLocale:s,showTranscriptLocaleButton:l,iconSize:d,selectedLanguage:c,previewsTranscriptEditVariant:u,previewsTranscriptionTranslationVariant:_,toggleShowTranscriptSearch:m})=>{const p=r.useIntl();return!e||0===e.length||!t&&n===i.PreviewType.Video?null:Ye.createElement("div",{className:"_transcriptHeaderOptionMenuWrapper_14ixi_22"},"V1"===u&&Ye.createElement(i.Tooltip,{title:p.formatMessage({id:"NqbnZL",defaultMessage:"Search"}),placement:"bottom"},Ye.createElement(i.IconButton,{variant:"transparent",size:"small",onClick:m,title:p.formatMessage({id:"xajPb4",defaultMessage:"Show search"})},Ye.createElement(i.UIIcon,{src:We.SearchLine,size:null!=d?d:"small"}))),Ye.createElement(i.Menu.Wrapper,{onSelection:a,shouldPropagateClickOutsideMouseEvents:!0},(({getContentProps:e,getTriggerProps:t})=>Ye.createElement(Ye.Fragment,null,Ye.createElement(i.IconButton,{...t(),"aria-label":p.formatMessage({id:"OTPHVz",defaultMessage:"Transcript settings"}),variant:"transparent",size:"small"},Ye.createElement(i.UIIcon,{src:i.MoreHorizontalLine,size:null!=d?d:"small"})),Ye.createElement(i.Menu.Content,{id:"parent",...e()},Ye.createElement(i.Menu.Segment,null,Ye.createElement(i.Menu.ActionItem,{key:"toggle_transcript_details",value:"toggle_transcript_details"},o?p.formatMessage({id:"6YJBBm",defaultMessage:"Hide transcript details"}):p.formatMessage({id:"T6egx/",defaultMessage:"Show transcript details"})),Ye.createElement(i.Menu.ActionItem,{key:"copy_transcript",value:"copy_transcript"},p.formatMessage({id:"L//QR/",defaultMessage:"Copy transcript"})),_&&l&&Ye.createElement(i.Menu.ActionItem,{key:"change_transcript_locale",value:"change_transcript_locale"},s?p.formatMessage({id:"ZF53n7",defaultMessage:"Use User Locale"}):p.formatMessage({id:"IPqcGo",defaultMessage:"Use Video Locale"})),_&&Ye.createElement(i.Menu.Submenu,{id:"switch_language_submenu",withTriggerContent:p.formatMessage({id:"rWBzFt",defaultMessage:"Translate to"})},Ye.createElement(i.Menu.Segment,null,le.localeWords.map((e=>Ye.createElement(i.Menu.ActionItem,{key:e,value:`switch_language_${e}`,withLeftAccessory:c===e?Ye.createElement(i.UIIcon,{src:i.CheckmarkLine}):null},e)))))))))))}));Hg.displayName="TranscriptTitleAccessory";const Wg=Ye.default.lazy((async()=>{const{TranscriptBladeContent:t}=await new Promise((function(t,i){e(["./c_transcript_blade_components_transcript_blade_content"],t,i)}));return{default:t}})),Kg=({segments:e,setSegments:t,fileViewerId:n,previewKey:a,previewMetadata:r,logUserAction:o,showTranscriptionDetails:s,getUserLocale:l,permission:d,setIsTranscriptShowing:c,isDefaultAudioTrackSelected:u,previewType:_,previewsTranscriptEditVariant:m,previewsTranscriptionTranslationVariant:p,previewsTranscriptFeedbackVariant:f,fileId:g,language:v,showTranscriptSearch:h,logTranscriptFeedback:w})=>{const y=x.useRightSidebarId(),E=i.useTranscriptDataQuery(a,r,v,!["OFF","CONTROL"].includes(m));return M.useRecordPreviewsTimerOnMount(n,i.PreviewsTimer.SidebarContentsMount,{bladeId:b.TRANSCRIPT_BLADE_PLUGIN_ID},y===b.TRANSCRIPT_BLADE_PLUGIN_ID&&(E.isSuccess||E.isError&&!le.canGenerateTranscriptFromRivieraStatus(E.error.statusCode))),Ye.default.createElement(Ye.default.Suspense,{fallback:Ye.default.createElement(zg,{showLoadingMessage:!1,previewsTranscriptionTranslationVariant:p})},Ye.default.createElement(Wg,{segments:e,setSegments:t,previewType:_,previewKey:a,previewMetadata:r,showTranscriptionDetails:s,getUserLocale:l,permission:d,logUserAction:o,setIsTranscriptShowing:c,isDefaultAudioTrackSelected:u,previewsTranscriptEditVariant:m,previewsTranscriptionTranslationVariant:p,previewsTranscriptFeedbackVariant:f,fileId:g,showTranscriptSearch:h,logTranscriptFeedback:w}))};Kg.displayName="TranscriptContent";const Gg=Ye.default.lazy((async()=>{const{TagsSectionPreview:t}=await new Promise((function(t,i){e(["./c_components_section_tags_section_preview"],t,i)}));return{default:t}})),jg=(e,t,n)=>{const o=Ye.default.useRef(n);o.current=n;const s=Ye.default.useCallback((({context:t})=>{const n=o.current;return e&&i.isBrowseFile(n)&&n.ns_path?Ye.default.createElement(i.LazySuspense,{fallback:null},Ye.default.createElement(Gg,{files:[T.File.fromAnyFileObject(n)],user:e,context:t})):null}),[e]);let l="";e&&i.isBrowseFile(n)&&(l=i.get_browse_root(i.DeprecatedViewer.get_viewer(),e,n));const c=!d.is_supported_mobile_browser()&&t!==i.SDKPreviewSurface.LOW_DISTRACTION_VIEW;return Ye.default.useMemo((()=>c?(({userId:e,rootName:t,tagSection:n,browseRoot:o})=>({sidebarUI:{Icon:()=>Ye.default.createElement(i.UIIcon,{src:i.InfoLine}),Title:()=>{const e=r.useIntl();return Ye.default.createElement(Ye.default.Fragment,null,e.formatMessage({id:"pehNW7",defaultMessage:"Info"}))},Content:()=>{const{fileViewerId:s,apiV2Client:l,optionalIOClients:{urlClient:d}}=i.useFileViewerContext(),c=x.useLeftSidebarId();M.useRecordPreviewsTimerOnMount(s,i.PreviewsTimer.SidebarContentsMount,{bladeId:b.INFO_BLADE_PLUGIN_ID},c===b.INFO_BLADE_PLUGIN_ID);const u=i.useRootFile(),_=i.useSharedLinkInfo(),m=r.useIntl(),p=a.useMemo((()=>{if(!u)return null;const{fqPath:e,name:t,lastModifiedDate:i,size:n}=u;return{fqPath:e,size:n,name:t,lastModifiedMs:i?new Date(i).getTime():void 0}}),[u]),f=a.useMemo((()=>({enabled:!0,openPath:e=>null==d?void 0:d.openFile(e,void 0)})),[d]),{logUserAction:g}=i.useFileViewerContext(),v=a.useCallback((e=>{g(e?i.UserAction.InfoShowMoreMetadata:i.UserAction.InfoHideMoreMetadata,i.UserActionContext.PreviewSidebar)}),[g]);return M.useRecordPreviewsTimerOnMount(s,i.PreviewsTimer.SidebarContentsMount,{bladeId:b.INFO_BLADE_PLUGIN_ID},c===b.INFO_BLADE_PLUGIN_ID),u&&p?Ye.default.createElement(Ye.default.Fragment,null,n&&Ye.default.createElement(n,{context:i.UserActionContext.PreviewSidebar,key:p.fqPath}),Ye.default.createElement(i.Text,{variant:"paragraph",size:"small",isBold:!0},m.formatMessage({id:"bNnicH",defaultMessage:"Properties"})),Ye.default.createElement("div",{role:"table"},Ye.default.createElement(ig,{file:p,pathBar:f,accountRootName:t,browseRoot:o}),Ye.default.createElement(Fg,{..._}),Ye.default.createElement(Bg,{fileId:u.fileId,sharedLinkURL:u.url,apiV2Client:l}),e&&Ye.default.createElement(Dg,{fileId:u.fileId,sharedLinkURL:u.url,onShowMore:v,apiV2Client:l,logUserAction:g}))):null}}}))({userId:e&&String(e.id),rootName:e&&A.deprecatedGetRootName(r.getIntl(),i.DeprecatedViewer.get_viewer(),e),tagSection:s,browseRoot:l}):void 0),[l,s,e,c])},qg=(e,t,n,a,r)=>{var o;const s=((e,t,i)=>Vt(e)&&zt.shouldShowForPreviewSurface(t)&&!!zt.filterValidUser(i))(null===(o=i.useExperiment("previews_exp_dropbox_ai_assistant",!0).experiment)||void 0===o?void 0:o.variant,t,n)&&nt(a)&&!d.is_supported_mobile_browser();return Ye.default.useMemo((()=>s?new Hp(e,n,a.file_id,r):void 0),[e,a.file_id,r,s,n])},Qg=new i.HiveLogger,Yg=(e,t)=>{var n,a;const o=i.resolvePreviewType(t.preview,i.isBrowseFile(t)?t.fq_path:t.filename),s=G.SUPPORTED_VIDEO_TRANSCRIPTION_PREVIEW_SURFACES.includes(e)&&G.SUPPORTED_TRANSCRIPTION_PREVIEW_TYPES.includes(o)&&!d.is_supported_mobile_browser(),l=i.useExperiment("previews_transcript_edit",!0).experiment.variant,c="ON"===(null===(n=i.useExperiment("previews_transcription_translation",!0).experiment)||void 0===n?void 0:n.variant),u="ON"===(null===(a=i.useExperiment("previews_transcript_feedback",!0).experiment)||void 0===a?void 0:a.variant),m=Ye.default.useCallback(((e,t,i)=>{Qg.log(new Wp({is_transcript_accurate:e,feedback:t,comments:null!=i?i:""}))}),[]);return Ye.default.useMemo((()=>s?((e,t,n,a)=>{let o,s=!0,l=!0,d=[],c="V1"!==e;return{sidebarUI:{Icon:()=>Ye.default.createElement(i.UIIcon,{src:j.ClosedCaptionsLine}),Title:()=>{const e=r.useIntl();return Ye.default.createElement(Ye.default.Fragment,null,e.formatMessage({id:"NIbdgH",defaultMessage:"Transcript"}))},TitleAccessory:()=>{var n;const[a,r]=Ye.default.useState(0),[u,_]=Ye.default.useState(null),m=i.useRootPreviewMetadata(),{fileViewerId:p,logUserAction:f}=i.useFileViewerContext(),g=x.useRootAudioVideoUi(),v=null!==(n=null==g?void 0:g.isDefaultAudioTrackSelected)&&void 0!==n&&n,[h,w]=Ye.default.useState(s),[y,E]=Ye.default.useState(l),S=ne.useDispatch(),b=i.useFileViewerSelector(i.getCurrentPreviewKey,p),C=i.useSetPreviewKeyAtom(le.translationLanguageAtom,b);o=()=>r(a+1);const I=Ye.default.useCallback((()=>{w((e=>!e)),s=!s,null==o||o()}),[]),T=Ye.default.useCallback((()=>{E((e=>!e)),l=!l,b&&S(Z.setIsUserLocaleOption({fileViewerId:p,previewKey:b,showing:l})),C(le.USER_LOCALE_OPTION)}),[S,p,b]),A=Ye.default.useCallback((e=>{_(e),C(e)}),[S,p,b]),M=Ye.default.useCallback((()=>{c=!c,null==o||o()}),[]),k=m.previewType,N=Ye.default.useCallback((e=>{if("toggle_transcript_details"===e)I();else if("copy_transcript"===e)le.writeTranscriptToClipboard(d),f(i.UserAction.TranscriptCopyAllClick,i.UserActionContext.PreviewSidebar,{previewType:k});else if("change_transcript_locale"===e)T();else if(e.startsWith("switch_language_")){const t=e.replace("switch_language_","");A(t)}}),[I,f,k,T,A]),P=i.useParameterizedSelector(i.getShowLocaleButton,p,b);return Ye.default.createElement(Hg,{segments:d,isDefaultAudioTrackSelected:v,previewType:k,onMenuSelection:N,showTranscriptionDetails:h,getUserLocale:y,showTranscriptLocaleButton:P,iconSize:"standard",selectedLanguage:u,previewsTranscriptEditVariant:e,previewsTranscriptionTranslationVariant:t,toggleShowTranscriptSearch:M})},Content:()=>{var r,u;const[m,p]=Ye.default.useState(0),[f,g]=Ye.default.useState(d);o=()=>p(m+1);const v=Ye.default.useCallback((e=>{g(e),d=e.slice(0),null==o||o()}),[]),h=oe.useQueryClient(),{fileViewerId:w,logUserAction:y,apiV2Client:E}=i.useFileViewerContext(),S=i.useRootPreviewMetadata(),C=S.previewType,I=null===(r=i.useRootFile())||void 0===r?void 0:r.fileId,T=i.useFileViewerSelector(i.getCurrentPreviewKey,w),A=le.useLanguageForLocale(t),M=!["OFF","CONTROL"].includes(e),{mutate:k}=i.useMaybeGenerateTranscript(T,S),N=le.useShouldGenerateTranscript(T,S,A,M),P=i.useSharedLinkInfo(),L=le.getTranscriptPermission(S.content),R=x.useRootAudioVideoUi(),D=null!==(u=null==R?void 0:R.isDefaultAudioTrackSelected)&&void 0!==u&&u;_.useLogExposure("previews_transcript_edit",e,!0),le.prefetchGetEditedTranscript(E,h,I,e,A);const F=le.useInvalidateEditedTranscriptCallback(I,h,e,t);Ye.default.useEffect((()=>function(){F()}),[F]),Ye.default.useEffect((()=>{N&&k({previewKey:T,previewMetadata:S,fileId:I,sharedLinkUrl:null==P?void 0:P.url,language:A,isTranscriptEditEnabled:M})}),[I,k,T,S,null==P?void 0:P.url,N,A,M]);const O=b.useSetIsTranscriptShowingCallback(),U=C===i.PreviewType.Video,V=C===i.PreviewType.Audio;return L&&(U||V)?Ye.default.createElement(Kg,{segments:f,setSegments:v,fileViewerId:w,previewKey:T,previewMetadata:S,logUserAction:y,showTranscriptionDetails:s,getUserLocale:l,permission:L,setIsTranscriptShowing:O,isDefaultAudioTrackSelected:D,previewType:C,previewsTranscriptEditVariant:e,previewsTranscriptionTranslationVariant:t,previewsTranscriptFeedbackVariant:n,fileId:null!=I?I:"",language:A,showTranscriptSearch:c,logTranscriptFeedback:a}):null}}}})(l,c,u,m):void 0),[s,l,c,u,m])},$g=({user:e,apiV2Client:t,previewSurface:n,file:a,previewContentOnly:r,comments:o,sharedLinkInfo:s})=>{const l=((e,t,n)=>{const a=t!==i.SDKPreviewSurface.VERSION_HISTORY&&i.isBrowseFile(n)?n.fq_path:void 0,r=Ye.default.useMemo((()=>a&&e?()=>Ue.redirectToVersionHistory(a,e):void 0),[e,a]),o=e&&t!==i.SDKPreviewSurface.BACKUP&&t!==i.SDKPreviewSurface.LOW_DISTRACTION_VIEW&&!d.is_supported_mobile_browser();return Ye.default.useMemo((()=>o?lf({user:e,onOpenVersionHistory:r}):void 0),[n.file_id,r,e,o])})(e,n,a),c=jg(e,n,a),u=qg(t,n,e,a,s),_=Yg(n,a);return Ye.default.useMemo((()=>r||d.is_supported_mobile_browser()?void 0:{[b.FILE_ACTIVITY_PLUGIN_ID]:l,[b.INFO_BLADE_PLUGIN_ID]:c,[b.AI_PLUGIN_ID]:u,[b.TRANSCRIPT_BLADE_PLUGIN_ID]:_,[b.COMMENTS_PLUGIN_ID]:o}),[u,o,l,c,r,_])};const Xg=r.defineMessage({id:"q9vhxH",defaultMessage:"Copy to clipboard"}),Zg=r.defineMessage({id:"fl7Vhq",defaultMessage:"Copied!"}),Jg=r.defineMessage({id:"29mCZP",defaultMessage:"Like"}),ev=r.defineMessage({id:"tYu9ZH",defaultMessage:"Dislike"}),tv=r.defineMessage({id:"j2CH0+",defaultMessage:"Close"}),iv=r.defineMessage({id:"ffJ6O4",defaultMessage:"Translation failed."}),nv=r.defineMessage({id:"333LUp",defaultMessage:"Couldn’t translate text. Try again in a few minutes."}),av=r.defineMessage({id:"yViBz2",defaultMessage:"Couldn’t detect language."}),rv=r.defineMessage({id:"1qW8mJ",defaultMessage:"Language not supported."}),ov=r.defineMessage({id:"uQTi4D",defaultMessage:"Translate text"}),sv=r.defineMessage({id:"F0VYqA",defaultMessage:"Translate: {maxLength}-character limit"}),lv=r.defineMessage({id:"K8efmc",defaultMessage:"It looks like this text is already in {language_display_name}."}),dv=r.defineMessage({id:"hx632L",defaultMessage:"How does this work? {link}"}),cv=r.defineMessage({id:"lXbWtY",defaultMessage:"Learn more"});i.injectInternalStyle("/static/metaserver/static/js/dropbox_ai_translations/file_viewer_plugin/translation.module.out-vflLCFLKZ.css",(e=>"._translation-overlay-container_19rhv_1{background-color:var(--dig-color__background__raised);position:absolute}._translation-overlay-header_19rhv_6{display:flex}._translation-overlay-language-selector_19rhv_10{flex-grow:1;margin:var(--spacing__unit--2) 0 0 var(--spacing__unit--2)}._translation-overlay-close-button_19rhv_15{margin:var(--spacing__unit--2) var(--spacing__unit--2) var(--spacing__unit--2) 0}._translation-overlay-language-banner_19rhv_23._translation-overlay-language-banner_19rhv_23{margin:0 var(--spacing__unit--2)}._translation-overlay-error-container_19rhv_27._translation-overlay-error-container_19rhv_27{margin:0 var(--spacing__unit--2) var(--spacing__unit--2) var(--spacing__unit--2)}._translation-overlay-language-selection-container_19rhv_33,._translation-overlay-loading-container_19rhv_32,._translation-overlay-text-container_19rhv_31{background-color:var(--dig-color__opacity__surface);border-radius:var(--spacing__unit--1);margin:var(--spacing__unit--1) var(--spacing__unit--2) var(--spacing__unit--2) var(--spacing__unit--2);min-height:55px;overflow-y:auto;padding:var(--spacing__unit--2)}._translation-overlay-error-icon_19rhv_48{margin-right:var(--spacing__unit--1);min-width:var(--spacing__unit--2_5)}._translation-overlay-language-selection-container_19rhv_33{max-height:357px}._translation-overlay-language-selection-label_19rhv_57{margin-bottom:var(--spacing__unit--0_5);margin-top:var(--spacing__unit--0_5)}._translation-overlay-language-selection_19rhv_33{height:auto;width:100%}._translation-overlay-language-selection_19rhv_33>span{height:auto}._translation-overlay-language-selection-inner_19rhv_71{align-items:center;display:flex;flex-grow:1;justify-content:left}._translation-overlay-language-name_19rhv_78{flex-grow:1;text-align:left;white-space:break-spaces}._translation-overlay-translated-text_19rhv_84{margin-bottom:var(--spacing__unit--0_5);margin-top:var(--spacing__unit--0_5)}._translation-overlay-text-footer_19rhv_89{align-items:center;display:flex;flex-direction:row;justify-content:space-between;margin-top:var(--spacing__unit--2)}._translation-reaction-container_19rhv_97{flex-grow:1}._translation-reaction-button_19rhv_101._translation-reaction-button_19rhv_101:disabled{color:var(--dig-color__selection__base)}._translation-overlay-disclaimer_19rhv_105{align-items:center;display:flex;flex-direction:row;margin:var(--spacing__unit--1) var(--spacing__unit--2) var(--spacing__unit--2) var(--spacing__unit--2)}._translation-overlay-disclaimer-text_19rhv_113{align-items:center;display:flex;flex-direction:row;justify-content:left}._translation-overlay-disclaimer-text_19rhv_113._translation-overlay-disclaimer-text_19rhv_113{margin-right:0}"));const uv={translationOverlayContainer:"_translation-overlay-container_19rhv_1",translationOverlayHeader:"_translation-overlay-header_19rhv_6",translationOverlayLanguageSelector:"_translation-overlay-language-selector_19rhv_10",translationOverlayCloseButton:"_translation-overlay-close-button_19rhv_15",translationOverlayLanguageBanner:"_translation-overlay-language-banner_19rhv_23",translationOverlayErrorContainer:"_translation-overlay-error-container_19rhv_27",translationOverlayLanguageSelectionContainer:"_translation-overlay-language-selection-container_19rhv_33",translationOverlayLoadingContainer:"_translation-overlay-loading-container_19rhv_32",translationOverlayTextContainer:"_translation-overlay-text-container_19rhv_31",translationOverlayErrorIcon:"_translation-overlay-error-icon_19rhv_48",translationOverlayLanguageSelectionLabel:"_translation-overlay-language-selection-label_19rhv_57",translationOverlayLanguageSelection:"_translation-overlay-language-selection_19rhv_33",translationOverlayLanguageSelectionInner:"_translation-overlay-language-selection-inner_19rhv_71",translationOverlayLanguageName:"_translation-overlay-language-name_19rhv_78",translationOverlayTranslatedText:"_translation-overlay-translated-text_19rhv_84",translationOverlayTextFooter:"_translation-overlay-text-footer_19rhv_89",translationReactionContainer:"_translation-reaction-container_19rhv_97",translationReactionButton:"_translation-reaction-button_19rhv_101",translationOverlayDisclaimer:"_translation-overlay-disclaimer_19rhv_105",translationOverlayDisclaimerText:"_translation-overlay-disclaimer-text_19rhv_113"};var _v;t.TranslatableLanguageCode=void 0,(_v=t.TranslatableLanguageCode||(t.TranslatableLanguageCode={})).En="en",_v.DaDk="da_dk",_v.De="de",_v.Es="es",_v.Fr="fr",_v.Id="id",_v.It="it",_v.Ja="ja",_v.Ko="ko",_v.Ms="ms",_v.NbNo="nb_no",_v.NlNl="nl_nl",_v.Pl="pl",_v.PtBr="pt_br",_v.Ru="ru",_v.SvSe="sv_se",_v.ThTh="th_th",_v.UkUa="uk_ua",_v.ZhCn="zh_cn",_v.ZhTw="zh_tw";const mv=[t.TranslatableLanguageCode.En,t.TranslatableLanguageCode.DaDk,t.TranslatableLanguageCode.De,t.TranslatableLanguageCode.Es,t.TranslatableLanguageCode.Fr,t.TranslatableLanguageCode.Id,t.TranslatableLanguageCode.It,t.TranslatableLanguageCode.Ja,t.TranslatableLanguageCode.Ko,t.TranslatableLanguageCode.Ms,t.TranslatableLanguageCode.NbNo,t.TranslatableLanguageCode.NlNl,t.TranslatableLanguageCode.Pl,t.TranslatableLanguageCode.PtBr,t.TranslatableLanguageCode.Ru,t.TranslatableLanguageCode.SvSe,t.TranslatableLanguageCode.ThTh,t.TranslatableLanguageCode.UkUa,t.TranslatableLanguageCode.ZhCn,t.TranslatableLanguageCode.ZhTw];var pv;t.TranslationError=void 0,(pv=t.TranslationError||(t.TranslationError={})).LimitExceeded="limit_exceeded_error",pv.InvalidLocale="invalid_locale",pv.UnknownLocale="unknown_locale",pv.Other="other";const fv=e=>null==e?void 0:e.reduce(((e,t)=>{const i=t.localeCode.toLowerCase();return n=i,mv.includes(n)?[...e,{...t,localeCode:i}]:e;var n}),[]),gv=e=>(null==e?void 0:e.reduce(((e,t)=>({...e,[t.localeCode]:t})),{}))||{},vv=({languageKey:e,isSelectingLanguage:t,toggleLanguageSelection:n,disabled:r})=>{const{data:o,isLoading:s,error:l}=i.useLocaleJS(),d=a.useMemo((()=>fv(null==o?void 0:o.localesWithoutInternal)),[null==o?void 0:o.localesWithoutInternal]),c=a.useMemo((()=>gv(d)),[d]);return s||l||!o?null:Ye.default.createElement("div",{className:uv.translationOverlayLanguageSelector},t?Ye.default.createElement(i.Button,{variant:"borderless",onClick:n,withIconStart:Ye.default.createElement(i.UIIcon,{src:i.ChevronLeftLine}),disabled:r},c[e].localeName):Ye.default.createElement(i.Button,{variant:"borderless",onClick:n,withIconStart:Ye.default.createElement(i.UIIcon,{src:Ge.GlobeLine}),withIconEnd:Ye.default.createElement(i.UIIcon,{src:i.ChevronRightLine}),disabled:r,autoFocus:!0},c[e].localeName))};vv.displayName="LanguageHeaderInternal";const hv=e=>Ye.default.createElement(i.QueryClientProviderWrapper,{isSilent:!0},Ye.default.createElement(vv,{...e})),wv=({language:e,setLanguage:t})=>{const n=r.useIntl(),{data:o,isLoading:s,error:l}=i.useLocaleJS(),d=a.useMemo((()=>fv(null==o?void 0:o.localesWithoutInternal)),[null==o?void 0:o.localesWithoutInternal]);return s||l||!o?null:Ye.default.createElement("div",{className:uv.translationOverlayLanguageSelectionContainer},Ye.default.createElement("div",{className:uv.translationOverlayLanguageSelectionLabel},Ye.default.createElement(i.Text,{size:"small"},n.formatMessage({id:"93SOWe",defaultMessage:"Choose language:"}))),null==d?void 0:d.map((n=>Ye.default.createElement(i.Button,{key:n.localeCode,variant:"borderless",onClick:()=>t(n.localeCode),className:uv.translationOverlayLanguageSelection},Ye.default.createElement("div",{className:uv.translationOverlayLanguageSelectionInner},Ye.default.createElement(i.Text,{className:uv.translationOverlayLanguageName},n.localeName),n.localeCode===e&&Ye.default.createElement(i.UIIcon,{src:i.CheckmarkLine}))))))};wv.displayName="LanguageSelectionInternal";const yv=s.getPageLocale().toLowerCase(),Ev=()=>{},Sv=({layer:e,previewType:t,selectedText:n,onClose:a,languageKey:o,isSelectingLanguage:s,setIsSelectingLanguage:l,setBodyRef:d=Ev,overlayHeight:c,children:u})=>{const _=r.useIntl(),m=((e,t,i,n)=>{if(!e||!t||!i)return{x:0,y:0};const a=Ie.createNormalizedRegion(e,t),r=(a.x+a.width)*t.width+16,o=Math.max(0,0,r+315+24+(i.width-t.width)/2-i.width),s=a.y*t.height;return{x:r-o,y:s-Math.max(0,s+(null!=n?n:300)-t.height)}})(null==n?void 0:n.selectionBounds,null==n?void 0:n.page.bounds,null==n?void 0:n.viewport,c),p=t===i.PreviewType.SsrDoc?e.pageIndex:void 0;if(!(null==n?void 0:n.text)||!n.selectionBounds||n.page.pageNumber!==p)return null;const f=[ie.getKeyboardBinding({key:i.Key_enum.Key.Escape,callback:a})];return Ye.default.createElement(i.ClickOutside,{onClickOutside:a,shouldPropagateMouseEvents:!0,isActive:!0},Ye.default.createElement(ie.KeyboardBindingConnector,{name:"translation_overlay",keyboardBindings:f}),Ye.default.createElement(i.CardNamespace,{className:uv.translationOverlayContainer,style:{left:`${m.x}px`,top:`${m.y}px`},role:"dialog"},Ye.default.createElement(i.CardNamespace.Section,null,Ye.default.createElement("div",{style:{width:"315px"},ref:d},Ye.default.createElement("div",{className:uv.translationOverlayHeader},Ye.default.createElement(hv,{languageKey:o,isSelectingLanguage:s,toggleLanguageSelection:()=>null==l?void 0:l(!s),disabled:!l}),Ye.default.createElement("div",{className:uv.translationOverlayCloseButton},Ye.default.createElement(i.IconButton,{variant:"transparent","aria-label":_.formatMessage(tv),onClick:a},Ye.default.createElement(i.UIIcon,{src:i.CloseLine})))),u))))};Sv.displayName="TranslationOverlaySkeleton";const bv="translation-loading-skeleton",Cv=()=>Ye.default.createElement("div",{className:uv.translationOverlayLoadingContainer},Ye.default.createElement(Ke.Skeleton.Text,{"data-testid":bv,withBorderRadius:"xsmall",size:"large"}),Ye.default.createElement(Ke.Skeleton.Text,{"data-testid":bv,withBorderRadius:"xsmall",size:"large"}),Ye.default.createElement(Ke.Skeleton.Text,{"data-testid":bv,withBorderRadius:"xsmall",size:"large"}),Ye.default.createElement(Ke.Skeleton.Text,{"data-testid":bv,withBorderRadius:"xsmall",size:"large"}),Ye.default.createElement(Ke.Skeleton.Text,{"data-testid":bv,withBorderRadius:"xsmall",size:"large"}),Ye.default.createElement(Ke.Skeleton.Text,{"data-testid":bv,withBorderRadius:"xsmall",size:"large"}));Cv.displayName="TranslationLoadingSection";const Iv={[t.TranslationError.UnknownLocale]:av,[t.TranslationError.InvalidLocale]:rv,[t.TranslationError.LimitExceeded]:nv,[t.TranslationError.Other]:iv},Tv=({errorStatus:e=t.TranslationError.Other})=>{const n=r.useIntl();return Ye.default.createElement(i.Banner,{type:"alert",withLeftIcon:!1,className:uv.translationOverlayErrorContainer},Ye.default.createElement(i.Banner.Message,null,Ye.default.createElement(i.Text,null,n.formatMessage(Iv[e]))))};Tv.displayName="TranslationErrorSection";const xv=mv.includes(yv)?yv:t.TranslatableLanguageCode.En,Av=e=>Ye.default.createElement(Sv,{...e,languageKey:xv,isSelectingLanguage:!1},Ye.default.createElement(Cv,null));Av.displayName="LoadingTranslationOverlaySkeleton";const Mv=e=>Ye.default.createElement(Sv,{...e,languageKey:xv,isSelectingLanguage:!1},Ye.default.createElement(Tv,null));Mv.displayName="ErrorTranslationOverlaySkeleton";const kv=Ye.default.lazy((async()=>{const{TranslationOverlay:t}=await new Promise((function(t,i){e(["./c_dropbox_ai_translations_file_viewer_plugin_translation_overlay"],t,i)}));return{default:t}})),Nv=e=>{var t,n,a,r;const o=e.previewType===i.PreviewType.SsrDoc?e.layer.pageIndex:void 0,s=(null!==(n=null===(t=e.selectedText)||void 0===t?void 0:t.page.pageNumber)&&void 0!==n?n:0)===o;return Ye.default.createElement(Ye.default.Suspense,{fallback:Ye.default.createElement(Av,{...e})},Ye.default.createElement(i.WithCvcPapLogger,{componentKey:"translation_overlay",measurementKey:null!==(r=null===(a=e.selectedText)||void 0===a?void 0:a.text)&&void 0!==r?r:"",trigger:null,triggerWhenFalsy:s,actionSurface:"previews",options:{reportOnNoChange:!1}},Ye.default.createElement(kv,{...e})))};Nv.displayName="LazyAsyncTranslationOverlay";class Pv{constructor(t,n="OFF"){this.layerUI={Layer:e=>{const t=b.useSetActiveTextHighlighterCallback(void 0,i.UserActionContext.Default),[n,a]=Ye.default.useState(0);return this.forceUpdateLayer=()=>a(n+1),e.previewType!==i.PreviewType.SsrDoc?null:Ye.default.createElement(Nv,{onClose:t,selectedText:this.selectedText,...e})}},this.allowTitleBar=!0,this.highlightMenuOption=({selectedText:e})=>{const t=r.useIntl(),n=b.useSetActiveTextHighlighterCallback(b.TRANSLATION_PLUGIN_ID,i.UserActionContext.TextHighlightMenu),a=e.text.length,o=e.page.pageNumber+1,s=Ye.default.useCallback((()=>{var t;this.selectedText=e,n(),null===(t=this.forceUpdateLayer)||void 0===t||t.call(this),i.UDCL.logEvent({class:"dropbox_ai",action:"click",object:"translate_action",properties:{selectionLength:a,pageNum:o}})}),[e,a,o,n]);i.useLocaleJS(),Ye.default.useEffect((()=>{i.UDCL.logEvent({class:"dropbox_ai",action:"shown",object:"translate_action",properties:{selectionLength:a,pageNum:o}})}),[a,o]);const l=a<=1e3,d=l?t.formatMessage(ov):t.formatMessage(sv,{maxLength:t.formatNumber(1e3,{style:"decimal"})});return Ye.default.createElement(i.Tooltip,{title:d},Ye.default.createElement("div",null,Ye.default.createElement(Fm,{label:d,icon:Ge.GlobeLine,onClick:s,disabled:!l})))},this.textHighlighterId="translation_plugin",(e=>["TEST","V1_TRACK_TRAFFIC"].includes(e))(n)&&new Promise((function(t,i){e(["./c_dropbox_ai_translations_file_viewer_plugin_translation_onboarding"],t,i)})).then((({checkForLanguageMismatch:e})=>{e(t)}))}}const Lv=({file:e,user:t,comments:n})=>{var a;const r=(null===(a=i.useExperiment("previews_ai_translation",!0).experiment)||void 0===a?void 0:a.variant)||"",o=((e,t,n)=>{const a=i.getExtension$1(t);return e&&"OFF"!==e&&i.resolvePreviewTypeFromExtension(`.${a}`)===i.PreviewType.SsrDoc&&i.logStormcrowExposure("previews_ai_translation",e,null==n?void 0:n.id),["TEST","ON","V1_INTL","V1_DOMESTIC","V1_TRACK_TRAFFIC"].includes(null!=e?e:"OFF")})(r,e,t)&&!d.is_supported_mobile_browser(),s=Ye.default.useMemo((()=>o?new Pv(e.file_id,r):void 0),[o,e.file_id,r]);return Ye.default.useMemo((()=>({[b.TRANSLATION_PLUGIN_ID]:s,[b.COMMENTS_PLUGIN_ID]:n})),[n,s])},Rv=["docx","pptx","xlsx"],Dv=["gdoc","gsheet","gslides"],Fv=(t,n,a)=>{const r=Ye.default.useRef();Ye.default.useEffect((()=>{if(r.current===n.file_id)return;const o=i.getExtension$1(n);t&&!(e=>(null==e?void 0:e.linkType)===i.SharedLinkType.Shmodel)(a)&&Rv.includes(o)&&((...t)=>{new Promise((function(t,i){e(["./c_cloud_docs_shared_components_routing"],t,i)})).then((({maybeShowDynamicRoutingModal:e})=>e(...t)))})(t,n,o),t&&Dv.includes(o)&&((...t)=>{new Promise((function(t,i){e(["./c_ui_controllers_conversion_modal_controller"],t,i)})).then((({showConversionUiFlow:e})=>e(...t)))})({user:t,fileId:n.file_id,filename:i.filename(i.isSharedFile(n)?n.filename:n.fq_path)}),r.current=n.file_id}),[t,n,a])},Ov=({children:e})=>{const{fileViewerId:t}=i.useFileViewerContext(),n=i.useFileViewerSelector(i.getIsFullScreen,t),a="dark"===i.useTheme().mode,r=n||a?"dark":"bright";return Ye.default.createElement(i.ThemeProvider,{mode:r},Ye.default.createElement(i.ThemeContainer,null,e))};Ov.displayName="FileViewerThemeProvider";const Uv=e=>{const{optionalIOClients:t}=e,{preferencesClient:n}=t,r=a.useMemo((()=>i.createStore$1()),[]);return a.useEffect((()=>{const e=n?((e,t)=>{const i=e.sub(le.volumeAtom,(()=>{var i;const n=e.get(le.volumeAtom);null===(i=t.video)||void 0===i||i.setVolumeState(n)})),n=e.sub(le.mutedAtom,(()=>{var i;const n=e.get(le.mutedAtom);null===(i=t.video)||void 0===i||i.setMuteState(n)}));return()=>{i(),n()}})(r,n):void 0;return()=>{null==e||e()}}),[r,n]),r},Vv={},Bv={},zv={},Hv={},Wv={},Kv={},Gv={},jv={currentPath:void 0,currentSubpaths:void 0},qv={...jv,fitScaleFactor:0},Qv={...jv,currentPageIndex:0,passwordAttempts:0,fitScaleFactor:0},Yv={...jv,currentTimestamp:0,isPlaying:!1,isTranscriptShowing:!1,isClosedCaptionShowing:!1,isDefaultAudioTrackSelected:!0,areControlsHidden:!1,isTranscriptUserLocaleSelected:!0,showTranscriptLocaleButton:!0},$v={isDocSidebarOpen:!1,isFullScreen:!1,hasBeenFlipped:!1,isDeleteFileModalOpen:!1,isTitleBarRenameActive:!1,isUiHidden:{fullscreen:!1,nonFullscreen:!1},shouldAnimateSidebar:!1},Xv=[".gdoc",".gslides",".paper",".papert",".binder"],Zv={max:64,min:.01,multiplier:1.25,delta:.05},Jv=(e,t,i)=>Math.abs(e-t)<Math.abs(e-i)?e:t,eh=(e,t)=>{const{delta:i,multiplier:n}=Zv;let a=e*(t?n:1/n);return i&&(a=Math.round(a/i)*i,Math.abs(a-e)<i&&(a+=t?i:-i)),(e=>{const{min:t,max:i}=Zv;return Math.min(Math.max(e,t),i)})(a)},th=({scaleFactor:e,ascend:t,fitScaleFactor:i})=>{if(!e)return 1;const n=eh(e,t),a=eh(n,t);for(const r of((e,t)=>{const i=[1];return t&&Math.abs(1-t)>.02&&i.push(t),((e,t)=>e?e.sort(((e,i)=>t?e-i:i-e)):[])(i,e)})(t,i))if(t){if(e<r&&a>=r)return Jv(r,n,a)}else if(e>r&&a<=r)return Jv(r,n,a);return n},ih={fileMetadata:(e=Vv,t)=>{if(t.type===Z.Action.SetFileMetadata){const i=t.payload.previewKey.serialized;return{...e,[i]:t.payload}}return e},filePreviewUi:(e=Bv,t)=>{var n,a,r,o,s;if(!t.payload)return e;if(!t.payload.previewKey)return e;const l=t.payload.previewKey,d=l.serialized,c=t.payload.fileViewerId,u=e[c]||{},_=u[d]||{},m=i.filterZoomableFilePreviewUi(_);switch(t.type){case Z.Action.InitializeFilePreviewSession:{const{previewType:n,fileExtension:a}=t.payload,r=((e,t)=>{switch(e){case i.PreviewType.Image:return qv;case i.PreviewType.SsrDoc:return Qv;case i.PreviewType.Audio:case i.PreviewType.Video:return Yv;case i.PreviewType.CloudDoc:return t&&Xv.includes(t)?Qv:jv;default:return jv}})(n,a);return{...e,[c]:{...u,[d]:{...r,currentPath:i.isNestedArchiveFilePreviewKey(l)?l.subpath.split("/").slice(1):void 0,..._}}}}case Z.Action.PageNavigation:{const{pageIndex:i,offset:n}=t.payload;return{...e,[c]:{...u,[d]:{..._,pageNavigation:{pageIndex:i,offset:n}}}}}case Z.Action.ResolvePageNavigation:return{...e,[c]:{...u,[d]:{..._,pageNavigation:void 0}}};case Z.Action.UpdateDocCurrentPageIndex:let{pageIndex:p,totalPageCount:f}=t.payload;const g=null!=f?f:0;return p<0?p=0:g&&p>=g-1&&(p=g-1),{...e,[c]:{...u,[d]:{..._,currentPageIndex:p}}};case Z.Action.IncrementDocPasswordAttempts:const v=null!==(a=null===(n=i.filterDocFilePreviewUiState(_))||void 0===n?void 0:n.passwordAttempts)&&void 0!==a?a:0;return{...e,[c]:{...u,[d]:{..._,passwordAttempts:v+1}}};case Z.Action.ZoomIn:{if(null==m)return e;const t=null!==(r=m.zoomScaleFactor)&&void 0!==r?r:m.fitScaleFactor;return{...e,[c]:{...u,[d]:{..._,zoomScaleFactor:th({scaleFactor:t,ascend:!0,fitScaleFactor:m.fitScaleFactor})}}}}case Z.Action.ZoomOut:{if(null==m)return e;const t=null!==(o=m.zoomScaleFactor)&&void 0!==o?o:m.fitScaleFactor;return{...e,[c]:{...u,[d]:{..._,zoomScaleFactor:th({scaleFactor:t,ascend:!1,fitScaleFactor:m.fitScaleFactor})}}}}case Z.Action.ZoomToggleOriginalOrFit:{if(null==m)return e;const i=null!==(s=m.zoomScaleFactor)&&void 0!==s?s:m.fitScaleFactor,n=i===m.fitScaleFactor?1:void 0,a=(null==m?void 0:m.storedFitScaleFactor)&&1===i?null==m?void 0:m.storedFitScaleFactor:void 0,r=t.payload.fitOnly?void 0:a||n;return{...e,[c]:{...u,[d]:{..._,zoomScaleFactor:r}}}}case Z.Action.UpdateFitScaleFactor:{if(null==m)return e;const{fitScaleFactor:i}=m;return i===t.payload.fitScaleFactor?e:{...e,[c]:{...u,[d]:{..._,storedFitScaleFactor:t.payload.storedFitScaleFactor,fitScaleFactor:t.payload.fitScaleFactor}}}}case Z.Action.UpdateFitToWidthScaleFactor:{if(null==m)return e;const{storedFitToWidthScaleFactor:i}=m;return i===t.payload.storedFitToWidthScaleFactor?e:{...e,[c]:{...u,[d]:{..._,storedFitToWidthScaleFactor:t.payload.storedFitToWidthScaleFactor}}}}case Z.Action.UpdateZoomScaleFactor:{if(null==m)return e;const{fitScaleFactor:i,storedFitScaleFactor:n,storedFitToWidthScaleFactor:a,zoomScaleFactor:r}=m;let o=t.payload.zoomScaleFactor;return"fitToPage"===t.payload.zoomType?o=1===i?i:n:"fitToWidth"===t.payload.zoomType&&(o=a),r===o?e:{...e,[c]:{...u,[d]:{..._,zoomScaleFactor:o}}}}case Z.Action.UpdateDimensions:return{...e,[c]:{...u,[d]:{..._,dimensions:t.payload.dimensions}}};case Z.Action.UpdateArchiveFileCurrentPath:return{...e,[c]:{...u,[d]:{..._,currentPath:t.payload.currentPath}}};case Z.Action.UpdateArchiveFileCurrentSubpaths:return{...e,[c]:{...u,[d]:{..._,currentSubpaths:t.payload.subpaths}}};case Z.Action.UpdateAudioVideoPlaybackState:const h=Se.lodashExports.pick(t.payload,"currentTimestamp","isPlaying");return{...e,[c]:{...u,[d]:{..._,...h}}};case Z.Action.SetIsClosedCaptionShowing:return{...e,[c]:{...u,[d]:{..._,isClosedCaptionShowing:t.payload.showing}}};case Z.Action.SetIsUserLocaleOption:return{...e,[c]:{...u,[d]:{..._,isTranscriptUserLocaleSelected:t.payload.showing}}};case Z.Action.SetShowLocaleButton:return{...e,[c]:{...u,[d]:{..._,showTranscriptLocaleButton:t.payload.showing}}};case Z.Action.SetIsTranscriptShowing:return{...e,[c]:{...u,[d]:{..._,isTranscriptShowing:t.payload.showing}}};case Z.Action.SetIsDefaultAudioTrackSelected:return{...e,[c]:{...u,[d]:{..._,isDefaultAudioTrackSelected:t.payload.isDefaultAudioTrackSelected}}};case Z.Action.SetAreVideoControlsHidden:return{...e,[c]:{...u,[d]:{..._,areControlsHidden:t.payload.areVideoControlsHidden}}}}return e},fileViewerUi:(e=zv,t)=>{if(!t.payload)return e;const{fileViewerId:n}=t.payload,a=e[n];if(!a)return e;switch(t.type){case Z.Action.OpenDocSidebar:return{...e,[n]:{...a,isDocSidebarOpen:!0}};case Z.Action.CloseDocSidebar:return{...e,[n]:{...a,isDocSidebarOpen:!1}};case Z.Action.EnterFullScreen:return{...e,[n]:{...a,isFullScreen:!0}};case Z.Action.ExitFullScreen:return{...e,[n]:{...a,isFullScreen:!1}};case Z.Action.FlipToNextFile:case Z.Action.FlipToPreviousFile:return{...e,[n]:{...a,hasBeenFlipped:!0}};case Z.Action.SetDeleteFileModalOpen:return{...e,[n]:{...a,isDeleteFileModalOpen:t.payload.isOpen}};case Z.Action.SetTitleBarRenameActive:return{...e,[n]:{...a,isTitleBarRenameActive:t.payload.isActive}};case Z.Action.SetUiShown:{const{isFullscreen:i}=t.payload,r=i?"fullscreen":"nonFullscreen";return{...e,[n]:{...a,isUiHidden:{...a.isUiHidden,[r]:!1}}}}case Z.Action.SetUiHidden:{const{isFullscreen:i}=t.payload,r=i?"fullscreen":"nonFullscreen";return{...e,[n]:{...a,isUiHidden:{...a.isUiHidden,[r]:!0}}}}case Z.Action.SetLeftSidebarPlugin:case Z.Action.SetRightSidebarPlugin:{const r=t.payload.actionContext,o=r!==i.UserActionContext.UserPreference&&r!==i.UserActionContext.Initialization&&r!==i.UserActionContext.LoggedOutCommenting&&r!==i.UserActionContext.UnreadComments;return{...e,[n]:{...a,shouldAnimateSidebar:o}}}default:return e}},loggingSessionId:(e=Kv,t)=>{if(t.type===Z.Action.InitializeFilePreviewSession){const{fileViewerId:i,filePreviewSessionId:n}=t.payload;return{...e,[i]:n}}return e},rootFileInfo:(e=Hv,t)=>{if(t.type===Z.Action.SetRootFileInfo){const{fileInfo:i,previewKey:n}=t.payload;return{...e,[t.payload.fileViewerId]:{previewKey:n,...i}}}return e},currentPreviewKey:(e=Wv,t)=>{switch(t.type){case Z.Action.SetRootFileInfo:{const{previewKey:i}=t.payload;return{...e,[t.payload.fileViewerId]:i}}case Z.Action.UpdateArchiveFileCurrentPath:const n=i.getSubpath(t.payload.currentPath),a=t.payload.rootFileInfo;if(!a)return e;const r=0===t.payload.currentPath.length||t.payload.isDir?a.previewKey:i.getPreviewKeyForNestedArchiveFile(a.file_id,n),o=e[t.payload.fileViewerId];return(null==o?void 0:o.serialized)===r.serialized?e:{...e,[t.payload.fileViewerId]:{...r}}}return e},plugins:(e=Gv,t)=>{var i,n,a,r,o;if(t.type===Z.Action.FlipToNextFile||t.type===Z.Action.FlipToPreviousFile){const{fileViewerId:r}=t.payload;if((null===(n=null===(i=e[r])||void 0===i?void 0:i.sidebarPlugins)||void 0===n?void 0:n.right)===b.TRANSCRIPT_BLADE_PLUGIN_ID)return{...e,[r]:{...e[r],sidebarPlugins:{...null===(a=e[r])||void 0===a?void 0:a.sidebarPlugins,right:void 0}}}}if(t.type===Z.Action.SetActiveEditPlugin){const{fileViewerId:i,pluginId:n,pluginActivationParams:a}=t.payload;return{...e,[i]:{...e[i],activeEditPluginId:n,editPluginActivationParams:a}}}if(t.type===Z.Action.SetActiveTextHighlighterPlugin){const{fileViewerId:i,textHighlighterId:n}=t.payload;return{...e,[i]:{...e[i],activeTextHighlighterPluginId:n,activeEditPluginId:void 0,editPluginActivationParams:void 0}}}if(t.type===Z.Action.SetLeftSidebarPlugin){const{fileViewerId:i,pluginId:n}=t.payload;return{...e,[i]:{...e[i],sidebarPlugins:{...null===(r=e[i])||void 0===r?void 0:r.sidebarPlugins,left:n},activeTextHighlighterPluginId:void 0}}}if(t.type===Z.Action.SetRightSidebarPlugin){const{fileViewerId:i,pluginId:n}=t.payload;return{...e,[i]:{...e[i],sidebarPlugins:{...null===(o=e[i])||void 0===o?void 0:o.sidebarPlugins,right:n},activeTextHighlighterPluginId:void 0}}}return e}};function nh(e){return({dispatch:t})=>n=>a=>(a.type===Z.Action.DownloadFile?e.downloadFile():a.type===Z.Action.CopyToDropbox&&e.copyToDropbox({role:a.payload.role,logModalConfirm:()=>{t(J.logUserActionEvent({userAction:i.UserAction.SaveToDropboxApprove,fileViewerId:a.payload.fileViewerId,actionContext:i.UserActionContext.Sidebar}))},logModalCancel:()=>{t(J.logUserActionEvent({userAction:i.UserAction.SaveToDropboxCancel,fileViewerId:a.payload.fileViewerId,actionContext:i.UserActionContext.Sidebar}))}}),n(a))}function ah(e){return()=>t=>i=>{var n;switch(i.type){case Z.Action.OpenWebPreview:return null===(n=e.openWebPreview)||void 0===n||n.call(e),t(i);case Z.Action.OpenUrl:const{url:a,fallbackUrl:r}=i.payload;return e.openUrl&&e.openUrl(a,r),t(i);case Z.Action.ShowAuthModal:const{encryptionOptions:o,sharedLinkUrl:s,kind:l,mode:d,loggingExtra:c,signupTag:u,webSignInTag:_}=i.payload;return e.showAuthModal&&e.showAuthModal({encryptionOptions:o,sharedLinkUrl:s,kind:l,mode:d,loggingExtra:c,signupTag:u,webSignInTag:_}),t(i);case Z.Action.UpdateFiles:return e.updateFiles&&e.updateFiles(),t(i);default:return t(i)}}}function rh(e){return()=>t=>async n=>{var a,r,o,s,l,d,c;switch(n.type){case Z.Action.OpenDocSidebar:null===(a=e.docSidebar)||void 0===a||a.setCollapsedState({isCollapsed:!1});break;case Z.Action.CloseDocSidebar:null===(r=e.docSidebar)||void 0===r||r.setCollapsedState({isCollapsed:!0});break;case Z.Action.SetLeftSidebarPlugin:null===(o=e.sidebar)||void 0===o||o.setLeftSidebarState(n.payload.pluginId);break;case Z.Action.SetRightSidebarPlugin:n.payload.pluginId!==b.AI_PLUGIN_ID&&n.payload.actionContext!==i.UserActionContext.UnreadComments&&n.payload.actionContext!==i.UserActionContext.LoggedOutCommenting&&(null===(s=e.sidebar)||void 0===s||s.setRightSidebarState(n.payload.pluginId));break;case Z.Action.SetUiShown:n.payload.isFullscreen&&(null===(l=e.ui)||void 0===l||l.setHiddenState({isHidden:!1}));break;case Z.Action.SetUiHidden:n.payload.isFullscreen&&(null===(d=e.ui)||void 0===d||d.setHiddenState({isHidden:!0}));break;case Z.Action.SetLinkWarningIsHidden:null===(c=e.link)||void 0===c||c.setWarningHiddenState({isHidden:n.payload.isHidden})}return t(n)}}function oh(e){return()=>t=>async i=>{if(i.type===Z.Action.ReportException){const t=i.payload.fileType||"unknown",n=i.payload.fileExtension||"unknown_extension";e.reportException(i.payload.error,t,n,i.payload.severity)}return t(i)}}function sh(e,t){const{logger:n,optionalIOClients:a}=t,{fileSystemClient:r,fileActionsClient:o,navigationClient:s,urlClient:l,preferencesClient:d,reportExceptionClient:c}=a;var u;return function(e,t){const n="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?i.compose(i.applyMiddleware(...e),window.__REDUX_DEVTOOLS_EXTENSION__({name:"File Viewer SDK"})):i.applyMiddleware(...e);return i.createStore(i.combineReducers(ih),t,n)}([...s?[ah(s)]:[],...l?[b.middleware(l)]:[],...r?[nh(r)]:[],...o?[(u=o,({dispatch:e})=>t=>async n=>{const a=t(n);if(n.type===Z.Action.Rename&&u.rename){const{newFilename:t}=n.payload,a=()=>{e(J.logUserActionEvent({userAction:i.UserAction.RenameStart,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.actionContext}))},r=()=>{e(J.logUserActionEvent({userAction:i.UserAction.RenameSuccess,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.actionContext}))},o=()=>{e(J.logUserActionEvent({userAction:i.UserAction.RenameFailed,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.actionContext}))};u.rename({newFilename:t,onRename:a,onRenameSuccess:r,onRenameFailed:o})}else if(n.type===Z.Action.Delete&&u.delete){e(J.logUserActionEvent({userAction:i.UserAction.DeleteStart,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.actionContext,extra:{key:n.payload.key}}));const t=()=>{},a=()=>{e(J.logUserActionEvent({userAction:i.UserAction.DeleteSuccess,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.actionContext}))},r=()=>{e(J.logUserActionEvent({userAction:i.UserAction.DeleteFailed,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.actionContext}))},o=()=>{e(J.logUserActionEvent({userAction:i.UserAction.DeleteFailedNoPermission,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.actionContext}))},s=()=>{e(J.logUserActionEvent({userAction:i.UserAction.DeleteCancel,fileViewerId:n.payload.fileViewerId,actionContext:n.payload.actionContext}))},l=t=>{e(Z.setDeleteFileModalOpen({isOpen:t,fileViewerId:n.payload.fileViewerId}))};u.delete({onDelete:t,onDeleteSuccess:a,onDeleteFailed:r,onDeleteFailedNoPermission:o,onDeleteCancel:s,setDeleteFileModalOpen:l})}return a})]:[],...d?[rh(d)]:[],...c?[oh(c)]:[],...n?[te.analyticsMiddleware(n)]:[]],{filePreviewUi:{[e]:{}},fileViewerUi:{[e]:$v}})}const lh={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,key:i.Key_enum.Key.Unidentified},dh=Object.keys(lh);function ch(e){return dh.map((t=>`${t}:${e[t]}`)).join("")}function uh(e,t){return function(e,t){return e.reduce(((e,{keyboardEventCriteria:i,callback:n})=>(e[t(i)]=n,e)),{})}(e,(e=>function(e,t){const i=function(e,t){return{altKey:!0===e.altKey,shiftKey:!0===e.shiftKey,key:e.key,ctrlKey:!1,metaKey:!1,[t]:!0===e.osModifierKey}}(e,t);return ch(i)}(e,t)))}class _h{constructor(e,t){this.bindingDict={},this.bindingDict=uh(e,t)}getCallbackForEvent(e){const t=function(e){return{altKey:!0===e.altKey,ctrlKey:!0===e.ctrlKey,metaKey:!0===e.metaKey,shiftKey:!0===e.shiftKey,key:e.key}}(e);return this.bindingDict[ch(t)]}}const mh="default",ph=e=>{const{disableBindings:t,children:i,osModifierKey:n}=e,a=Ye.useRef({}),r=Ye.useRef(mh),o=Ye.useRef(null),s=Ye.useCallback(((e,t,i)=>{var s;if(a.current[i]||(a.current[i]={}),e){if(a.current[i][t])throw new Error(`Keybindings for name ${t} registered twice`);a.current[i][t]=e}else delete a.current[i][t];const l=null!==(s=a.current[r.current])&&void 0!==s?s:{};o.current=new _h((e=>Se.lodashExports.flatten(Object.values(e)))(l),n)}),[n]),l=Ye.useCallback(((e,t,i)=>{i&&t!==r.current&&(r.current=t),s(e,t,i?t:mh)}),[s]),d=Ye.useCallback(((e,t)=>{t&&r.current===e&&(r.current=mh),s(void 0,e,t?e:mh)}),[s]),c=Ye.useCallback((e=>{var t;if(!function(e){const t=e.target||e.srcElement;if(!t)return!0;const i=t.tagName,n="INPUT"===i||"SELECT"===i||"TEXTAREA"===i,a=t instanceof HTMLInputElement&&("submit"===t.type||"button"===t.type),r="NAV"===i||"menu"===t.role||"menuitem"===t.role;return!(t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase())&&(!n||a)&&!r}(e))return;const i=null===(t=o.current)||void 0===t?void 0:t.getCallbackForEvent(e);i&&i(e)}),[]);Ye.useEffect((()=>{if(!0!==t){const e=Se.lodashExports.throttle(c,0);return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}}),[t,c]);const u=Ye.useMemo((()=>({registerKeyBindings:l,unregisterKeyBindings:d,updateKeyBindings:s})),[l,d,s]);return Ye.createElement(ie.KeyboardBindingContext.Provider,{value:u},i)};ph.displayName="KeyboardBindingProvider";const fh={osModifierKey:"ctrlKey"},gh=e=>{const{children:t,intl:n,platformConfig:a,initData:o,featureConfig:s,fileViewerId:d,apiV2Client:c,apiV2ClientShim:u,optionalIOClients:_,logger:m,className:p,id:f,isLoggedIn:g,sourceSession:v,initialEditorParams:h}=e,w=Ye.default.useMemo((()=>null!=d?d:qe.v4()),[d]),y=Ye.default.useMemo((()=>sh(w,{logger:m,optionalIOClients:_})),[w,m,_]),E=Uv({optionalIOClients:_}),S=Ye.default.useMemo((()=>({...i.DEFAULT_CONFIG,...s})),[s]),b=Ye.default.useMemo((()=>({...fh,...a})),[a]);Ye.default.useEffect((()=>{if(h){const{activeEditPlugin:e,editActivationParams:t}=h;y.dispatch(Z.setActiveEditPlugin({fileViewerId:w,pluginId:e,pluginActivationParams:t,actionContext:i.UserActionContext.Initialization}))}}),[w,h,y]);const C=((e,t)=>i.useStabilizedCallback(((n,a,r)=>{e(J.logPreviewEvent({event:i.EventType.UserAction,fileViewerId:t,extra:{action:n,...a?{context:a}:{},...r||{}}}))})))(y.dispatch,w),I=Ye.default.useMemo((()=>{var e;return{fileViewerId:w,featureConfig:S,canCloseViewer:!!(null===(e=_.navigationClient)||void 0===e?void 0:e.closeViewer),isLoggedIn:g,deviceType:(null==o?void 0:o.deviceType)||i.DeviceType.desktop,sourceSession:v,apiV2Client:c,apiV2ClientShim:u,optionalIOClients:_,logger:m,logUserAction:C}}),[c,u,S,w,null==o?void 0:o.deviceType,g,C,m,_,v]),T=i.getIsFullScreen(y.getState(),w);return Ye.default.createElement("div",{className:i.cx(p||l.fvsdkMountPoint),id:f||"fvsdk-mount-point"},Ye.default.createElement(oe.QueryClientProvider,{client:oe.queryClient},Ye.default.createElement(i.Provider$1,{store:E},Ye.default.createElement(i.Provider,{store:y},Ye.default.createElement(r.Provider,{value:n},Ye.default.createElement(i.FileViewerContextProvider,{value:I},Ye.default.createElement(ce.PreviewControlProvider,null,Ye.default.createElement(ph,{disableBindings:!S.keyboard_shortcuts,osModifierKey:b.osModifierKey},Ye.default.createElement(i.LayerContext.Provider,{value:{zIndex:501}},Ye.default.createElement(Ov,null,Ye.default.createElement("div",{className:T?i.cx([l.fullScreenPreview,l.fileViewerArea]):l.fileViewerArea},t)))))))))))};gh.displayName="FileViewer";const vh=[i.SDKPreviewSurface.SHARED_LINK,i.SDKPreviewSurface.SHARED_LINK_EMBED,i.SDKPreviewSurface.SHARED_CONTENT_LINK,i.SDKPreviewSurface.SHARED_COLLECTION,i.SDKPreviewSurface.INBAND_SHARE,i.SDKPreviewSurface.LOW_DISTRACTION_VIEW],hh=!!i.getQueryArgs().from_previews_auto_save&&(i.DBHistory.remove_query_param(i.BrowseQueryArg.from_previews_auto_save),!0),wh=(e,t,n,a,o,s,l,c,u,m,p,f,g,v,w,y,E,S,b,C=!1,I,T,x,A,M,k,N,P,L)=>{const R=n().file,D=()=>{const e=n().file;return{extension:i.getExtension$1(e),size:e.bytes,previewType:i.resolvePreviewType(e.preview,i.getFilename(e)),fileId:e.file_id}},F=f?()=>{f(),i.isAudioPreview(D().extension)?i.UserSurvey.trackEvent("audio_preview_viewed","previews"):i.isVideoPreview(D().extension)&&i.UserSurvey.trackEvent("video_preview_viewed","previews")}:void 0,O=(e,t)=>window.open(e||t,"_blank");let U,V={};i.UserSurvey.addAttribute("DIGTheme",c),d.is_supported_mobile_browser()||i.UserSurvey.trackEvent("preview_viewed","previews"),i.isSharedFile(R)&&setTimeout((()=>{i.trackReceiverUserLeapEvent(i.ReceiverUserLeapEvent.VIEWED_SHARED_FILE)}),5e3);const B=_.makeMetaserverFlowsClient(u),z=In(R.revision_id,w);switch(t){case i.SDKPreviewSurface.BROWSE:case i.SDKPreviewSurface.HOME:case i.SDKPreviewSurface.HELLOSIGN:case i.SDKPreviewSurface.SEARCH:case i.SDKPreviewSurface.RECENTS:case i.SDKPreviewSurface.STARRED:case i.SDKPreviewSurface.STANDALONE_PREVIEW:case i.SDKPreviewSurface.PHOTOS:case i.SDKPreviewSurface.FILE_LOCKING:case i.SDKPreviewSurface.BACKUP:if(!w)throw new Error("Must be logged in to browse");U=en(w,n,x),V={fileSystemClient:nn(w,n,{allowCopyToDropbox:!1,shareToken:o,encryptionOptions:m,authModalKind:T,webSignInTag:M}),fullScreenClient:un(),printClient:Tn(),navigationClient:mn(F,y,E,b,O),fileActionsClient:U,urlClient:Mn(w),preferencesClient:z,flowsClient:B,stormcrowClient:An(w),openInButtonClient:vn(w,n,t)};break;case i.SDKPreviewSurface.VERSION_HISTORY:if(!w)throw Error("user required for version history");V={fileSystemClient:void 0,fullScreenClient:un(),printClient:Tn(),navigationClient:pn(F,y,E,O),urlClient:Mn(w),preferencesClient:z,stormcrowClient:An(w),openInButtonClient:vn(w,n,t)};break;case i.SDKPreviewSurface.SHARED_LINK_EMBED:V={fullScreenClient:un(),printClient:Tn(),urlClient:Mn(w),fileSystemClient:nn(w,n,{allowCopyToDropbox:!0,shareToken:o,encryptionOptions:m,sharePermission:p,authModalKind:T,webSignInTag:M}),navigationClient:fn(void 0,void 0,void 0,O),openInButtonClient:vn(w,n,t)};break;case i.SDKPreviewSurface.LOW_DISTRACTION_VIEW:case i.SDKPreviewSurface.SHARED_LINK:case i.SDKPreviewSurface.SHARED_CONTENT_LINK:case i.SDKPreviewSurface.INBAND_SHARE:case i.SDKPreviewSurface.SHARED_COLLECTION:V={fileSystemClient:nn(w,n,{allowCopyToDropbox:!0,shareToken:o,encryptionOptions:m,sharePermission:p,authModalKind:T,webSignInTag:M,userPresentableVerdict:N}),fullScreenClient:un(),printClient:Tn(),navigationClient:_n(F,y,E,a,O),urlClient:Mn(w),preferencesClient:z,flowsClient:B,stormcrowClient:An(w),openInButtonClient:vn(w,n,t)};break;case i.SDKPreviewSurface.POLLUX_DESKTOP_PREVIEW:case i.SDKPreviewSurface.POLLUX_DESKTOP_SEARCH_PREVIEW:w&&(U=en(w,n,x)),V={fullScreenClient:un(),fileActionsClient:U,flowsClient:B};break;case i.SDKPreviewSurface.FSS_DESKTOP_PREVIEW:w&&(U=en(w,n,x)),V={fullScreenClient:un(),fileActionsClient:U,flowsClient:B,navigationClient:gn(O)}}const H=new URLSearchParams(window.location.search).get("session_id")||void 0,W={log:ve.makeLogger(t,D,P,H),logDuration:ve.logDuration,logVideoEvent:(e,n)=>{var a,r;const o=D();switch(((e,t,n,a)=>{var r;const o=he.previewSurfaceToPreviousSurface[t];Bn(n,1,a),ve.logAudioVideoEventToPap(e,o,n,a),i.isVideoPreview(e.extension)?ve.logVideoPlayPauseToPap(n,{previousSurface:o,file:e},null===(r=a.extra)||void 0===r?void 0:r.action_element):i.isAudioPreview(e.extension)&&ve.logAudioPlayToPap(n,{previousSurface:o,file:e})})(o,t,e,n),e){case je.VideoPreviewEvent.TimeToLoad:i.isAudioPreview(o.extension)?(n.video_duration_seconds&&i.UserSurvey.addAttribute("audioPreviewLength",i.bucketLengthForUserSurvey(n.video_duration_seconds)),i.UserSurvey.addAttribute("audioPreviewType",o.extension),i.UserSurvey.addAttribute("isAudioPreviewFinished","false")):(n.video_duration_seconds&&i.UserSurvey.addAttribute("videoPreviewLength",i.bucketLengthForUserSurvey(n.video_duration_seconds)),i.UserSurvey.addAttribute("videoPreviewType",o.extension),i.UserSurvey.addAttribute("isVideoPreviewFinished","false"),i.UserSurvey.addAttribute("videoPreviewResolution","auto"));break;case je.VideoPreviewEvent.ChangeVideoQuality:(null===(a=n.extra)||void 0===a?void 0:a.new_video_quality)&&i.UserSurvey.addAttribute("videoPreviewResolution",n.extra.new_video_quality);break;case je.VideoPreviewEvent.MediaEnded:i.isAudioPreview(o.extension)?(i.UserSurvey.addAttribute("isAudioPreviewFinished","true"),i.UserSurvey.trackEvent("audio_preview_viewed","previews")):(i.UserSurvey.addAttribute("isVideoPreviewFinished","true"),i.UserSurvey.trackEvent("video_preview_viewed","previews"));break;case je.VideoPreviewEvent.VideoPlaybackSmoothness:(null===(r=n.extra)||void 0===r?void 0:r.num_stalls_per_second_playback)&&i.UserSurvey.addAttribute("videoPreviewNumberOfStallsPerSecondPlayback",n.extra.num_stalls_per_second_playback)}},logVideoEventQuantity:Bn,logVideoEventDuration:zn};return{...{intl:r.intl,apiV2ClientShim:lt(u),apiV2Client:u,logger:W,optionalIOClients:{...V,showAuthModal:a,reportExceptionClient:{reportException:(e,t,i,n)=>h.reportException({err:e,severity:n,tags:["file-viewer",t,i],force:!0})}},initData:{accountId:w?w.account_id:void 0,deviceType:i.getDeviceType()},featureConfig:e,platformConfig:{osModifierKey:d.mac?"metaKey":"ctrlKey"},fileViewerId:A},pluginArgs:{authModalKind:T,browseContext:g,browseExceptions:v,canRestoreRevision:I,encryptionOptions:m,featureConfig:e,fileActionsClient:U,getActiveFile:n,previewContentOnly:C,onFileChanged:x,onRestoreRevision:S,setIsPdfEditorActive:l,sharePermission:p,shareToken:o,sharedLinkInfo:s,user:w,commentsPluginInitialParams:k,fileName:i.getFilename(R),userPresentableVerdict:N}}},yh=(e,t,i,n)=>Ye.default.useMemo((()=>{let a,r=e;new URLSearchParams(window.location.search).get("show_file_activity")&&(r=b.FILE_ACTIVITY_PLUGIN_ID),i||n||t===b.COMMENTS_PLUGIN_ID?a=b.COMMENTS_PLUGIN_ID:new URL(window.location.href).searchParams.get("ai_blade_start_open")||t===b.AI_PLUGIN_ID?a=b.AI_PLUGIN_ID:t===b.TRANSCRIPT_BLADE_PLUGIN_ID&&(a=b.TRANSCRIPT_BLADE_PLUGIN_ID);return new URLSearchParams(window.location.search).get("show_comments")&&(a=b.COMMENTS_PLUGIN_ID),{defaultLeftSidebar:r,defaultRightSidebar:a}}),[n,e,t,i]),Eh=(e,t,n,a,r)=>{const o=[];if(e){const{canCopyToDropboxRoles:s}=e;if(s.length>0){const s=i.getToDropboxOption(i.DeprecatedViewer.get_viewer(),e,t,n,a,void 0,r);o.push({text:s.text,isDisabled:s.isDisabled,role:s.role})}}return o},Sh=t=>{const{file:s,sharedLinkInfo:l,sharePermission:c,shareToken:u,brandingInfo:_,user:v,previewSurface:h,encryptionOptions:w,closeFile:y,flipToNextFile:E,flipToPreviousFile:S,previewCollection:C,updateFiles:I,fileIndex:T,fileCount:x,passSessionId:A,previewContentOnly:M=!1,cloudDocPreviewMode:k="open_in_button",onRestoreRevision:N,canRestoreRevision:P,canShowFileFlippers:L,authModalKind:R,containerId:D,onFileChanged:F,fileViewerId:O,sourceContext:U,implicitTOSVariant:V,shouldFocusComment:B,editActivationParams:z,defaultLeftSidebarPluginId:H,defaultRightSidebarPluginId:W,hideTour:K,fromRegister:G,userPresentableVerdict:j,loggedOutCommentingLinkSenderVariant:q,isPreviewAsRecipientView:Y,commentId:$}=t,X=i.getWebSignInTag(!!v,h,c),Z="openInAppData"in t?t.openInAppData:void 0,J=Ye.default.useMemo((()=>({file:s,sharedLinkInfo:l,sharePermission:c,shareToken:u,encryptionOptions:w,openInAppData:Z})),[s,l,c,u,w,Z]),ee=Ye.default.useRef(J),te=Ye.default.createRef(),ie=Ye.default.useCallback((()=>ee.current),[]),ne=Ye.default.useMemo((()=>D&&document.getElementById(D)||void 0),[D]),[ae,re]=Ye.default.useState(!1),{browseContext:se,browseExceptions:de}=(e=>e.previewSurface===i.SDKPreviewSurface.BROWSE?{browseContext:e.browseContext,browseExceptions:e.browseExceptions}:{})(t),ce=Ye.default.useCallback((e=>f.showAuthModal({...e,encryptionOptions:w,implicitTOSVariant:V,loggingExtra:{signup_source:"file_preview_unlabeled_event",...e.loggingExtra},webSignInTag:X,onCancel:()=>{var t;null===(t=e.onCancel)||void 0===t||t.call(e)}})),[w,V,X]),ue=dt({canShowFileFlippers:L,previewContentOnly:M,cloudDocPreviewMode:k});i.useLogExposureOnce("previews_exp_prewarm_urls");const _e=d.is_mobile_or_tablet();i.useLogExposureOnce("previews_toolbar_optimization");const me=((e,t)=>!d.is_mobile_or_tablet()&&e!==i.SDKPreviewSurface.LOW_DISTRACTION_VIEW&&t!==i.LoginOrRegisterKind.IMMEDIATE)(h,R)&&Boolean(!v&&i.isSharedFile(s)&&l&&u),pe=ye.useShouldShowPreviewTour({previewSurface:h,previewContentOnly:M,isMobile:_e,isEditMode:!!t.editActivationParams,user:v,sourceContext:U,hideTour:!!t.hideTour,surfaceLevelSusiEnabled:me});Ye.default.useEffect((()=>{const e=i.getCampaignsEventContext(s,U);i.emitPreviewPageLoaded(i.CampaignPageName.PREVIEW,e,{disableCampaigns:!!pe||h===i.SDKPreviewSurface.LOW_DISTRACTION_VIEW})}),[s,h,pe,U]);const fe=i.useTheme().theme,ge=Ye.default.useMemo((()=>({shouldFocusComment:B||tt(),commentId:$||et()})),[B,$]),ve=Ye.default.useMemo((()=>new i.ActiveUserApiV2Client),[]),he=Cp({user:v,file:s,sharePermission:c,featureConfig:ue,previewContentOnly:M,previewSurface:h,setIsPdfEditorActive:re,onFileChanged:F,apiV2Client:ve,encryptionOptions:w,sharedLinkInfo:l}),we=Ym({sharedLinkInfo:l,apiV2Client:ve,previewSurface:h,file:s,previewContentOnly:M,commentsPluginInitialParams:ge,user:v}),Ee=Lv({file:s,user:v,comments:we}),Se=$g({user:v,apiV2Client:ve,previewSurface:h,file:s,previewContentOnly:M,sharedLinkInfo:l,comments:we}),be=Ye.default.useMemo((()=>wh(ue,h,ie,ce,u,l,re,fe,ve,w,c,y,se,de,v,E,S,N,I,M,P,R,F,O,X,ge,j,Y)),[v,h,F,Y]),Ce=((e,t,n,a,r,o,s,l)=>Ye.default.useMemo((()=>{if(i.isSharedFile(t))return{download_button:{enable_download_button:!n,can_download:!!a&&i.isDownloadAllowed(a),copy_targets:Eh(a,r,t,o,l)},enable_print:xn(a),enable_view_on_dropbox_button:!1,canEdit:!1};{const e=!!s&&!s.isCurrentPathWriteable(),a=!(t.read_only||e);return{...i.DEFAULT_FILE_CONFIG,download_button:{enable_download_button:!n,can_download:!0,copy_targets:[]},enable_print:!0,enable_view_on_dropbox_button:!1,canEdit:a}}}),[s,o,t,n,a,r,l]))(0,s,M,c,u,w,se,v),Ie=(({file:e,activePreviewFile:t,fileConfig:n,currentIndex:a,totalFileCount:r,sourceContext:o,previewSurface:s,previewCollection:l,user:c,previewContentOnly:u,sharedLinkInfo:_,brandingInfo:m,apiV2Client:p})=>{const f=i.parseTimeRangeFromUrl(),g=Ye.default.useMemo((()=>u||o===i.SourceContext.SharedLinkCollection?()=>null:({onHide:e})=>Ye.default.createElement(st,{activePreviewFile:t,user:c,onHide:e})),[t,u,c,o]),v=i.useStabilizedCallback((()=>{l&&a&&i.maybePrefetchCollection(l,a,void 0,d.is_supported_mobile_browser()),d.is_supported_mobile_browser()&&(i.UserSurvey.trackEvent("mobile_web_preview_viewed","previews"),s===i.SDKPreviewSurface.SHARED_LINK&&i.UserSurvey.trackEvent("mobile_web_receiver_preview_viewed","previews"))})),h=i.useStabilizedCallback((()=>{const t=i.getCampaignsEventContext(e,o);i.emitPreviewPageLoaded(i.CampaignPageName.PREVIEW,t,{disableCampaigns:!0})})),w=Ye.default.useMemo((()=>({file_id:e.file_id,ns_id:e.ns_id,sj_id:e.sjid,url:null==_?void 0:_.url})),[e.file_id,e.ns_id,e.sjid,null==_?void 0:_.url]),y=Ye.default.useMemo((()=>({file_id:e.file_id,file_name:i.getFilename(e),file_path:i.isBrowseFile(e)?e.fq_path:void 0,file_last_modified_date:e.ts?new Date(1e3*e.ts).toISOString():void 0,file_collection_context:r&&void 0!==a?{file_index:a,parent_files_count:r}:void 0,size:e.bytes,revisionId:e.revision_id,timeRange:f,readOnly:!i.isBrowseFile(e)||!!e.read_only})),[a,e,f,r]),E=Ye.default.useMemo((()=>{if(c)return e=>Ye.default.createElement(wt,{user:c,apiv2ClientBase:p,...e})}),[p,c]);return Ye.default.useMemo((()=>({fileInfo:w,fileMetadata:y,fileConfig:n,sharedLinkInfo:_&&{..._,hasPublicAudienceOrVisibility:!!_.hasPublicAudienceOrVisibility,isSameTeam:(null==c?void 0:c.team_name)===_.ownerTeamName},brandingInfo:m||{},header:g,callbacks:{onRenderSucceeded:v,onRenderFailed:h},fileSaver:E})),[w,y,n,_,null==c?void 0:c.team_name,m,g,v,h,E])})({file:s,activePreviewFile:J,featureConfig:ue,fileConfig:Ce,currentIndex:T,totalFileCount:x,sharedLinkInfo:l,brandingInfo:_,user:v,sourceContext:U,previewContentOnly:M,previewSurface:h,previewCollection:C,apiV2Client:ve}),Te=Ye.default.useRef(Ie),ke=Ye.default.useMemo((()=>{var e;const t=null===(e=ee.current)||void 0===e?void 0:e.file,n=t&&i.isBrowseFile(t)&&i.isBrowseFile(s),a=n&&t.file_id===s.file_id&&i.sameTimeRangeFromHref(t.href,s.href);return Te.current&&(ae||a)?(!n||t.fq_path===s.fq_path&&t.href===s.href||(ee.current.file=s),Te.current):(ee.current={file:s,sharedLinkInfo:l,sharePermission:c,shareToken:u,encryptionOptions:w},Ie)}),[w,s,ae,Ie,c,u,l]);Te.current=ke;const Ne=i.getFilename(s);((e,t)=>{var n;const{fileInfo:a,sharedLinkInfo:r}=t,o=be.apiV2Client;i.useLogExposureOnce("previews_exp_exclude_preview_props");const s=Ye.default.useMemo((()=>{var t,n;return{logDuration:()=>{var e;return Promise.resolve(null===(e=be.logger)||void 0===e?void 0:e.logDuration)},tags:i.makeApiLoggerTags(U,!!v,null===(n=null===(t=e.preview)||void 0===t?void 0:t.content)||void 0===n?void 0:n[".tag"])}}),[null===(n=e.preview)||void 0===n?void 0:n.content]);i.useFileViewerPrefetch(be.featureConfig,e.preview,oe.queryClient,a,s,o,!!ue.videojs_preload,d.is_supported_mobile_browser(),r),Ye.default.useMemo((()=>{i.metaserverFileViewerPrefetch({userId:null==v?void 0:v.id,queryClient:oe.queryClient,file:e,sharedLinkInfo:r,apiV2Client:o,currentUrl:window.location.href,sourceContext:U})}),[o,e,r]),((e,t,i,n)=>{Ye.default.useMemo((()=>{null===Q.fileContentMetadataPrefetch||void 0===Q.fileContentMetadataPrefetch||Q.fileContentMetadataPrefetch(e,t,i)}),[t,e,i]),Ye.default.useMemo((()=>{void 0===(null==n?void 0:n.content)||"video"!==n.content[".tag"]&&"audio"!==n.content[".tag"]||le.prefetchMediaAddon(t,i)}),[t,n,i])})(a,o,oe.queryClient,e.preview)})(s,ke);const Le=(e=>Ye.default.useMemo((()=>({source_context:e,page_start_ts:performance.timing.navigationStart,was_flipped:!1})),[e]))(U),Re=yh(H,W,B,ge.commentId),Fe=((e,t,n,a,r,o)=>{const s=Ye.default.useMemo((()=>a?a.source:new URLSearchParams(window.location.search).get("source")),[a]),l=!!m.canShowWatermark(e),d=Pe.showEditPlugin$1(e,r,!0,!0,s),c=Pe.showEditPlugin(e,r),u=at({file:e,sharePermission:r,user:o});return Ye.default.useMemo((()=>{let e,r={};if(a||o&&i.isEditModeActive()){const t=p.getActionFromURL();l&&"watermark"===(null==a?void 0:a.source)?e=m.WATERMARKING_PLUGIN_ID:d?((null==t?void 0:t.initialAction)&&p.isUngatedEditorInitialAction(t.initialAction)&&(r={source:m.NonSignEntryPoints.PREVIEW_UNGATED_PDF_EDITOR}),e=b.PDF_EDITOR_PLUGIN_ID):c?(r={initialAction:(null==t?void 0:t.initialAction)||(null==a?void 0:a.initialEditAction)},e=b.PHOTO_EDITOR_PLUGIN_ID):u&&(r={initialEditAction:(null==t?void 0:t.initialAction)||(null==a?void 0:a.initialEditAction)},e=b.VIDEO_EDITOR_PLUGIN_ID)}return{shouldFocusComment:t,commentId:n,editActivationParams:{...a,...r},activeEditPlugin:e}}),[n,a,d,c,t,o,u,l])})(s,B,ge.commentId,z,c,v);Ye.default.useEffect((()=>{if(h!==i.SDKPreviewSurface.VERSION_HISTORY)return Array.from(document.querySelectorAll(Wn)).forEach((e=>{e.style.display&&e.setAttribute(Kn,e.style.display),e.style.display="none"})),Gn}),[h]),Ye.default.useEffect((()=>{if(v&&i.shouldShowWelcomeModal(v,U)){const t=async t=>{const{showWelcomeModal:i}=await new Promise((function(t,i){e(["./c_modals_welcome_modal"],t,i)}));i(t)};t(v)}}),[U,v]),Ye.default.useEffect((()=>{const e=document.title;return()=>{document.title=e}}),[]),Ye.default.useEffect((()=>{document.title=Ne}),[Ne]),Ye.default.useEffect((()=>(i.scroll_lock_document(),()=>{i.scroll_unlock_document()})),[]),Ye.default.useEffect((()=>{const e=n.key.getScope();return n.key.setScope("fvsdk_scope"),()=>{n.key.setScope(e)}}),[]),Ye.default.useEffect((()=>{const e=i.Snackbar.manager;return i.Snackbar.manager=te.current,()=>{i.Snackbar.manager=e}}),[te]),Ye.default.useEffect((()=>{q&&i.logStormcrowExposure("previews_logged_out_commenting_fe",q),i.logStormcrowExposure("previews_logged_out_commenting_enabled",(null==l?void 0:l.allowLoggedOutCommenting)?"true":"false")}),[]);const Oe=Ye.default.useRef(null),Ue=Ye.default.useCallback((e=>{Oe.current=e;const t=["dragenter","dragover","dragleave","drop"],i=e=>{e.stopPropagation(),e.preventDefault()};for(const n of t)null==e||e.addEventListener(n,i)}),[]);((e,t,n,a)=>{Ye.useEffect((()=>{const r={file_views:[{file_info:{file_identifier:t,shared_link_details:n?{url:n.url}:void 0},platform_type:{".tag":"web"}}]};(async()=>{try{const t=De.GetSeenStateRoutes(e);a?await t.rpc("log_file_view",r,{}):await t.rpc("logged_out/log_file_view",r,{})}catch(e){const t=i.filterApiError(e);if(t&&Ip.some((e=>null==t?void 0:t.message.includes(e))))return;throw e}})()}),[e,t,a,n])})(be.apiV2Client,s.file_id,l,!!v),Ye.default.useEffect((()=>{hh&&i.UDCL.logEvent({class:"onboard",action:"shown",object:"previews_auto_saved_file",properties:{fileId:s.file_id,timestamp:Date.now(),itemCount:1}})}),[hh,s]);const Ve=(e=>{const[t,n]=a.useState(null);return a.useEffect((()=>{if(e){const e=i.LocalStorage.get(i.SHARED_LINK_INFO_LOCAL_STORAGE_KEY);e&&(n(e),i.LocalStorage.delete(i.SHARED_LINK_INFO_LOCAL_STORAGE_KEY))}}),[e]),t})(hh),Be=l||Ve,ze=a.useCallback((({user:t,sharedLinkInfo:n})=>Me.asyncShowNewFolderShareModal({user:t,shouldShowSignUpsCreateShared:!0,initialContentName:r.intl.formatMessage($m,{ownerName:n.ownerName,receiverName:t.fname}),sharePrefillContacts:n.ownerEmail&&n.ownerName?[{email:n.ownerEmail,name:n.ownerName}]:void 0,onSuccessSharing:({fqPath:i})=>new Promise((function(t,i){e(["./c_cloud_docs_create_api"],t,i)})).then((({createNewPointer:e})=>e({userApiProps:t,pathName:i,name:n.displayName,url:n.url,onError:()=>{},logSuccessCallback:()=>{},source:xe.NewFileMenuFromType.SHARE_AUTO_SAVE}))),onShareClick:()=>{i.dispatchElementClicked("create_shared_folder_share")},browseOnboardingPathway:Ae.OAPulsarCampaign.CREATE})),[]),He=Hn(),We=rt({file:s,user:v,shareToken:u,sourceContext:U}),Ke=g.usePluginMigrationContextProviderProps({pluginArgs:be.pluginArgs,passSessionId:A,hasOpenInActions:We,previewSurface:h,fileConfig:Ce}),Ge=Ye.default.useMemo((()=>me?()=>f.showAuthModal({signupTag:o.RegistrationSource.SHARED_FILE_BANNER_REGISTER,webSignInTag:o.RegistrationSource.SHARED_FILE_BANNER_REGISTER,kind:i.LoginOrRegisterKind$1.SURFACE_LEVEL_PREVIEW,encryptionOptions:w,implicitTOSVariant:V,sharedLinkUrl:null==l?void 0:l.url,mode:i.AuthMode.REGISTER}):void 0),[w,V,null==l?void 0:l.url,me]),je=(e=>{const{fromRegister:t,receiver:n,sharedLinkInfo:r,showFolderCreationModal:o,showTour:s,hideTour:l,fromAutoSave:d,isMobileWeb:c}=e,[u,_]=a.useState(!1),m=a.useCallback((()=>{(t&&!l||d)&&(null==n?void 0:n.is_email_verified)&&!(null==n?void 0:n.is_team)&&!c&&!u&&n&&(null==r?void 0:r.ownerName)&&(null==r?void 0:r.ownerEmail)&&o&&(i.Modal$1.showInstance(Ye.default.createElement(Dn,{receiver:n,senderName:r.ownerName,senderPhotoUrl:r.ownerPhotoUrl,showFolderCreationModal:()=>{o({user:n,sharedLinkInfo:r})}})),_(!0))}),[d,t,u,l,c,n,r,o]);return a.useEffect((()=>{s||m()}),[s,m]),m})({receiver:v,sharedLinkInfo:Be,showFolderCreationModal:ze,showTour:pe,hideTour:K,fromRegister:G,fromAutoSave:hh,isMobileWeb:ue.mobile_web});return Fv(v,s,u),Ye.default.createElement(g.PluginMigrationContextProvider,{value:Ke},Ye.default.createElement("div",{ref:Ue,id:"fvsdk_container",className:i.cx("_fvsdk-container_amzuv_5",{"_fvsdk-embed-viewport_amzuv_16":!!ne}),"data-testid":"fvsdk-container"},Ye.default.createElement(i.SnackbarManager,{ref:te,getParentElement:()=>Oe.current}),Ye.default.createElement(gh,{...be,id:i.FVSDK_MOUNT_POINT,fileViewerId:O,isLoggedIn:!!v,sourceSession:Le,initialEditorParams:Fe,featureConfig:ue},Ye.default.createElement(Ji,{previewProps:ke,defaultUi:Re,editors:he,sidebars:Se,comments:we,showAuthModal:ce,activePreviewFile:J,user:v,previewSurface:h,shareToken:u,previewContentOnly:M,handleSusiClick:Ge,webSignInTag:X,authModalKind:R,onFileChanged:F,browseContext:se,textHighlighters:Ee,userPresentableVerdict:j})),Ye.default.createElement(He,{file:J.file,user:v,showTour:pe,previewSurface:h,shareToken:u,linkOwnerName:null==l?void 0:l.ownerName,skipPreviewTourModal:t.skipPreviewTourModal,showAutoSavePromptWithPreviewTour:hh,openSharedFolderModal:je})))};Sh.displayName="_FileViewer",Sh.displayName="_FileViewer";const bh=()=>{const t=Ye.default.useContext(Ch),n=Ye.default.useMemo((()=>i.UUID.v4()),[]),a=Ye.default.useMemo((()=>i.UUID.v4()),[]),[r,o]=Ye.default.useState(!1),s=vh.includes(t.previewSurface)?t.shareToken:void 0,l=i.useEmitter$1(),d=Ye.default.useCallback((e=>{i.logInterstitialEventToAmp(e,"file_viewer")}),[]),c=t.onMobileInterstitialDismissed,u=Ye.default.useCallback((()=>{o(!0),null==c||c()}),[o,c]),_="openInAppData"in t&&t.openInAppData&&!r&&!t.hideOpenInAppInterstitial,m=sessionStorage.getItem("has_seen_interstitial");return Ye.default.useEffect((()=>{if(!m&&_&&sessionStorage.setItem("has_seen_interstitial","true"),m&&_&&!t.user){(async()=>{const{GSIEvent:t,GSIEventManager:i}=await new Promise((function(t,i){e(["./e_file_viewer_static_scl_page_folder"],t,i)})).then((function(e){return e.lib_esnext}));i.getGSIState().gsiInitComplete?i.sendGSIEvent(t.SHOW_PROMPT):i.createGSIEventListener(t.GSI_INIT_COMPLETE,(()=>i.sendGSIEvent(t.SHOW_PROMPT)))})()}}),[_,m,t.user]),i.isSharedFile(t.file)&&"openInAppData"in t&&t.openInAppData&&_&&"true"!==sessionStorage.getItem("has_seen_interstitial")?Ye.default.createElement(ot,{file:t.file,filePreviewSessionId:n,fileViewerSessionId:a,onDismiss:u,openInAppData:t.openInAppData,sharedLinkInfo:t.sharedLinkInfo,fileViewOrigin:t.fileViewOrigin,logUserAction:d,deviceId:t.deviceId}):(s&&(t.isPreviewAsRecipientView||l.select(i.ON_SHARED_FILE_VIEW).emit(null)),Ye.default.createElement(Sh,{...t,fileViewerId:a}))};bh.displayName="FileViewerWithInterstitial";const Ch=Ye.default.createContext(null),Ih=i.createRouteObjects([{path:"*",region:i.region({importer:()=>Promise.resolve({default:bh})})}]),Th=Ze(),xh=e=>{i.PreviewsEventLogger.mark(i.PreviewsTimingEvents.SDK_FILE_VIEWER_CODE_START);const t=!i.MODULAR_APP_FRAMEWORK_ACTIVE,n=Ye.default.useMemo((()=>t?(i.appendErrorBoundary(Ih),i.createBrowserRouter(Ih)):null),[t]);return Ye.default.useEffect((()=>{var t,n,a,r;vh.includes(e.previewSurface)&&(i.Context.defaultValue={rlkey:(null===(t=e.shareToken)||void 0===t?void 0:t.rlkey)||null,tkey:(null===(n=e.shareToken)||void 0===n?void 0:n.linkType)===i.SharedLinkType.Shmodel?e.shareToken.linkKey:null,sckey:(null===(a=e.shareToken)||void 0===a?void 0:a.linkType)===i.SharedLinkType.Content?e.shareToken.linkKey:null,subpath:(null===(r=e.shareToken)||void 0===r?void 0:r.subPath)||null})}),[e.shareToken,e.previewSurface]),Ye.default.createElement(Ch.Provider,{value:e},Ye.default.createElement(i.Provider,{store:Th},Ye.default.createElement(r.Provider,{value:r.intl},Ye.default.createElement(oe.QueryClientProvider,{client:oe.queryClient},t?Ye.default.createElement(Ye.default.Suspense,{fallback:null},Ye.default.createElement(i.RouterProvider,{router:n})):Ye.default.createElement(bh,null)))))};xh.displayName="FileViewerWithProvider",xh.displayName="FileViewerWithProvider";const Ah=i.requireCssWithComponent(xh,["/static/js/file_viewer/index.web-vflDar80-.css","/static/js/comments2/index-vflQdvUHu.css","/static/metaserver/static/css/foundation-vflH6wwwv.css","/static/metaserver/static/css/dig-components/index.web-vflnMddsO.css","/static/typescript/component_libraries/dig-experimental/src/index.web-vflMgkV3K.css","/static/metaserver/static/css/dig-illustrations/index.web-vflEv5rHy.css","/static/metaserver/static/css/spectrum/index.web-vflwvsegv.css","/static/metaserver/static/css/dig/fonts-vflMHuSEC.css","/static/metaserver/static/css/notify-vfl4oJv2S.css"]);Ah.displayName="FileViewer",t.AI_BLADE_CONSENT_KEY=xp,t.ALL_FILTER_TYPES=ef,t.AUTO_SCROLL_PAUSE_THRESHOLD=1e4,t.AllSortTypes=da,t.CLOSE_LABEL=tv,t.COPIED_BUTTON_DISPLAY_THRESHOLD=3e3,t.COPY_TOOLTIP=Xg,t.COPY_TOOLTIP_SUCCESS=Zg,t.CommentsContextProvider=Sm,t.DEFAULT_GUEST=Qu,t.DEFAULT_VIRTUAL_LIST_HEIGHT=1e3,t.DISLIKE_TRANSLATION_LABEL=ev,t.DefaultSortType=ca,t.DocumentSortType=_a,t.ESTIMATE_SEGMENT_ITEM_HEIGHT=132,t.ErrorTranslationOverlaySkeleton=Mv,t.FILE_ACTIVITY_BLADE_NAMESPACE_KEY=Xp,t.FileViewerWithCSS=Ah,t.GetPreviewsAiRoutes=Tp,t.INCLUDE_ALL_FILTER={added:!0,viewed:!0,moved:!0,renamed:!0,edited:!0,shared:!0,commented:!0},t.INTERSECTION_DELTA=A_,t.LEARN_MORE=cv,t.LIKE_TRANSLATION_LABEL=Jg,t.LOGGED_OUT_USER_ID=qu,t.LanguageSelection=e=>Ye.default.createElement(i.QueryClientProviderWrapper,{isSilent:!0},Ye.default.createElement(wv,{...e})),t.Loading=np,t.MAX_AUDIOVIDEO_LENGTH_S=6300,t.MAX_AUDIOVIDEO_SIZE_GB=10,t.RESUME_AUTO_SCROLL_BUTTON_PLACEHOLDER_HEIGHT=40,t.RightRailContext=Ff,t.TRANLSATION_OVERLAY_DEFAULT_HEIGHT=300,t.TRANSCRIPT_ERROR_TESTID="transcript-blade-error",t.TRANSLATION_AI_DISCLAIMER=dv,t.TRANSLATION_MATCHED_LANGUAGE_MESSAGE=lv,t.TimeCodedSortType=ua,t.TranscriptProgressBar=zg,t.TranslatableLanguageCodes=mv,t.TranslationErrorSection=Tv,t.TranslationLoadingSection=Cv,t.TranslationOverlaySkeleton=Sv,t._createAction=va,t._createMiddleware=ha,t.activateThread=Xr,t.applyWatermark=(e,t,i)=>({type:"ApplyWatermark",payload:{fileViewerId:e,file:t,overwrite:i}}),t.areCommentsEnabled=(e,t)=>{var i;const n=e.permissions[t],a=e.enableCommentStatus[t];return Boolean(null!==(i=null==a?void 0:a.commentsEnabled)&&void 0!==i?i:null==n?void 0:n.can_see_comment_editor)},t.availableLanguages=fv,t.boltSubscribe=function(e){return{type:$r.BoltSubscribe,payload:e}},t.boltUnsubscribe=function(e){return{type:$r.BoltUnsubscribe,payload:e}},t.cancelAnnotating=io,t.classes=uv,t.confirmDraftAnnotation=to,t.createCommentFileIdentifier=Pc,t.createStreamFromFileOrSharedLink=Uc,t.currentSearchMatch="_currentSearchMatch_14ixi_99",t.currentUserPidAtom=Em,t.deactivateAllThreads=Zr,t.disableCommentingAction=gr,t.enableCommentingAction=yr,t.findCommentThread=Xu,t.focusEditor=function(e){return{type:$r.FocusEditor,payload:{fileViewerId:e}}},t.focusThread=eo,t.footerContainer=ct,t.generateNonceSubdomain=ep,t.getActiveThreadID=r_,t.getActivityStreamAction=Gp,t.getBoltInfo=(e,t)=>e.boltInfo.fileIdentifierToBoltMap[t],t.getCurrentWatermarkOptions=_p,t.getDraftAnnotation=p_,t.getFileIdFromFile=e=>(null==e?void 0:e.fqPath)||(null==e?void 0:e.fileId),t.getFileIdentifier=(e,t,i)=>t in e.boltInfo.fileIdentifierToBoltMap?t:null!=i?i:t,t.getGrantBook=it,t.getGuestInfo=async e=>{let t=Ju();return t||(t=await e()),Promise.resolve(t)},t.getGuestInfoFromLocalStorage=Ju,t.getLoggedOutUserInfo=e_,t.getMentionsSearchResult=e=>e.mentionsSearchResult,t.getStatus=(e,t)=>e.status[t],t.getStickerMetadata=e=>{const t=e.metadata.findIndex((e=>"sticker"===e.type));return-1===t?void 0:e.metadata[t]},t.getStoreForFileViewer=Ze,t.getStreamSettings=(e,t,i)=>{const n=t in e.boltInfo.fileIdentifierToBoltMap?t:null!=i?i:t;return{...e.status[n]===cu.FullyEnabled?n_:a_,canShowEditorMeatball:!1}},t.getThirdPartySource=(e,t)=>e.thirdPartySource[t],t.getThreads=o_,t.getWatermarkScale=fp,t.hasMention=e=>String(-1!==e.metadata.findIndex((e=>"mention"===e.type))),t.hasSticker=e=>String(-1!==e.metadata.findIndex((e=>"sticker"===e.type))),t.hoverActionFocusedCommentIdAtom=g_,t.hoverThread=Jr,t.isActiveThread=l_,t.isBladeSupportedForFiles=e=>Boolean(e.length>=1&&e.some((e=>l.isAIBladeSupportedForFile(e.name)&&!!e.fileId))),t.isDocumentAnnotation=nm,t.isFocusedThread=c_,t.isHoveredThread=__,t.isPageLevelAnnotation=om,t.isThreadWithDocumentAnnotation=function(e){const{annotation:t}=e;return!!t&&nm(t)&&t.regions.length>0},t.isThreadWithTimecodeAnnotation=rm,t.isTimecodeAnnotation=am,t.isUserLoggedOut=e=>e.id===qu,t.isUserSubscribed=(e,t)=>{var i;const n=e.permissions[t],a=e.subscriptionStatus[t];return Boolean(null!==(i=null==a?void 0:a.isSubscribed)&&void 0!==i?i:null==n?void 0:n.is_subscribed)},t.languageLookup=gv,t.middleButton="_middleButton_3b0az_33",t.minSegmentHeight="42",t.mobileMeatball="_mobileMeatball_ux84q_21",t.reactionsAtom=fm,t.reactionsBoltInfoAtom=vm,t.reactionsUsersAtom=wm,t.replaceBanner="_replaceBanner_14ixi_147",t.resumeAutoScrollButton="_resumeAutoScrollButton_14ixi_103",t.rightButtonsContainer="_rightButtonsContainer_3b0az_37",t.sameAnnotation=function(e,t){return nm(e)&&nm(t)||am(e)&&am(t)},t.setImageWatermarkOptions=(e,t)=>({type:"SetImageWatermarkOptions",payload:{fileViewerId:e,options:t}}),t.setMode=(e,t)=>({type:"SetMode",payload:{fileViewerId:e,mode:t}}),t.setStatusReady=e=>({type:"SetStatusReady",payload:{fileViewerId:e}}),t.setTextWatermarkOptions=(e,t)=>({type:"SetTextWatermarkOptions",payload:{fileViewerId:e,options:t}}),t.shouldShowResolvedComments=s_,t.showing="_showing_14ixi_112",t.sortThreads=(e,t=!1)=>{return e?Object.values(e).sort((i=t,(e,t)=>{const n=rm(e)?e.annotation.time:0,a=rm(t)?t.annotation.time:0;return n!==a?n-a:i?+t.timestamp-+e.timestamp:+e.timestamp-+t.timestamp})):[];var i},t.startAnnotating=function(e,t,i){return{type:$r.StartAnnotating,payload:{fileViewerId:e,accessible:t,annotationType:i}}},t.subscribeAction=Wr,t.throttle=E_,t.title="_title_ux84q_5",t.titleBar=_t,t.transcriptBladeContentWrapper="_transcriptBladeContentWrapper_14ixi_17",t.transcriptCaptionText="_transcriptCaptionText_14ixi_85",t.transcriptCaptionTextEditMode="_transcriptCaptionTextEditMode_14ixi_90",t.transcriptErrorInfo="_transcriptErrorInfo_14ixi_36",t.transcriptFeedbackButtons="_transcriptFeedbackButtons_14ixi_191",t.transcriptFeedbackChips="_transcriptFeedbackChips_14ixi_174",t.transcriptFeedbackHeaderRightAccessory="_transcriptFeedbackHeaderRightAccessory_14ixi_166",t.transcriptFeedbackPanel="_transcriptFeedbackPanel_14ixi_152",t.transcriptFeedbackPanelHidden="_transcriptFeedbackPanelHidden_14ixi_161",t.transcriptFeedbackTextbox="_transcriptFeedbackTextbox_14ixi_187",t.transcriptReplaceToggle="_transcriptReplaceToggle_14ixi_119",t.transcriptSearchMatchFoundText="_transcriptSearchMatchFoundText_14ixi_75",t.transcriptSearchNavigatorRowWrapper="_transcriptSearchNavigatorRowWrapper_14ixi_137",t.transcriptSearchNavigatorWrapper="_transcriptSearchNavigatorWrapper_14ixi_80",t.transcriptSearchWrapper="_transcriptSearchWrapper_14ixi_69",t.transcriptSegmentListContentWrapper="_transcriptSegmentListContentWrapper_14ixi_28",t.unsubscribeAction=qr,t.updateCommentGuestMetadata=(e,t)=>{const i={type:"guest",first_name:t.first_name,last_name:t.last_name};return{text:e.text,metadata:[...e.metadata,i]}},t.updateLocalStorageGuestInfo=e=>{const t=JSON.stringify(e);window.localStorage.setItem(Zu,t)},t.updateShowResolvedComments=function(e){return{type:$r.UpdateShowResolvedComments,payload:{showResolvedComments:e}}},t.useAIBladeDispatch=()=>{const e=Ye.default.useContext(Lp);if(void 0===e)throw new Error("useAIBladeDispatch must be used within a AIBladeProvider");return e},t.useAIBladeLogging=()=>{const e=Ye.default.useContext(Fp);if(!e)throw new Error("useAIBladeLogging must be used within a AIBladeLoggingContext");return e},t.useAIBladeState=Dp,t.useCommentsContext=$u,t.useDelayCallback=Ei,t.useStoreSharedLinkInfo=({sharedLinkInfo:e,shouldRedirectToAutoSave:t})=>{a.useEffect((()=>{t&&i.LocalStorage.set(i.SHARED_LINK_INFO_LOCAL_STORAGE_KEY,e)}),[e,t])}}));
//# sourceMappingURL=c_api_v2_redux_file_viewer.js-vflnMjM-N.map

//# debugId=21df1eeb-ec1d-37e3-b371-0fb541a8ca73